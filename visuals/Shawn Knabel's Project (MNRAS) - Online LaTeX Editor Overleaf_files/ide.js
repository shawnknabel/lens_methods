function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guardMethod__(e,t,n){return"undefined"!=typeof e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guardMethod__(e,t,n){return"undefined"!=typeof e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw o}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function __guardMethod__(e,t,n){return"undefined"!=typeof e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}function __range__(e,t,n){for(var i=[],r=t>e,o=n?r?t+1:t-1:t,s=e;r?o>s:s>o;r?s++:s--)i.push(s);return i}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function focusable(e,t){var n,i,r,o=e.nodeName.toLowerCase();return"area"===o?(n=e.parentNode,i=n.name,e.href&&i&&"map"===n.nodeName.toLowerCase()?(r=$("img[usemap='#"+i+"']")[0],!!r&&visible(r)):!1):(/^(input|select|textarea|button|object)$/.test(o)?!e.disabled:"a"===o?e.href||t:t)&&visible(e)}function visible(e){return $.expr.filters.visible(e)&&!$(e).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}define("libs/polyfills/symbol",[],function(){!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e):t(e)}("undefined"!=typeof window?window:global,function(e){"use strict";function t(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(t){return!1}var n={object:!0,symbol:!0};return n[typeof Symbol.iterator]&&n[typeof Symbol.toPrimitive]&&n[typeof Symbol.toStringTag]?!0:!1}t()||!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e):t(e)}("undefined"!=typeof window?window:e,function(e){var t=Object.defineProperty,n=Object.defineProperties,i=0,r=[],o=Array.prototype.slice,s="object"==typeof e.ES6?e.ES6:e.ES6={},a=Array.isArray,l=Object.prototype.toString,c=Array.prototype.push,u=function(){},d=function(e){return e},h=function(e){return"function"==typeof e},f=function(){},p=function(e,t){this._array=e,this._flag=t,this._nextIndex=0},g=function(e,t){this._string=e,this._flag=t,this._nextIndex=0},m=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)},v=function(e,t){return n(e,{_description:{value:t},_isSymbol:{value:!0},_id:{value:i++}}),e},y=function(e,t){if("number"==typeof e.length&&e.length>=0&&"number"==typeof t.length&&t.length>=0){var n=Math.floor(e.length),i=Math.floor(t.length),r=0;for(e.length=n+i;i>r;++r)t.hasOwnProperty(r)&&(e[n+r]=t[r])}},w=function(e,t){if("function"!=typeof e||"function"!=typeof t)throw new TypeError("Child and Parent must be function type");e.prototype=Object.create(t.prototype),e.prototype.constructor=e},b=function C(e){if(e=void 0===e?"":String(e),this instanceof C)throw new TypeError("Symbol is not a constructor");return v(Object.create(C.prototype),e)};n(b,{"for":{value:function(e){e=String(e);for(var t,n=r.length,i=0;n>i;++i)if((t=r[i]).key===e)return t.symbol;return t={key:e,symbol:b(e)},r.push(t),t.symbol},writable:!0,configurable:!0},keyFor:{value:function(e){if(!s.isSymbol(e))throw new TypeError(String(e)+" is not a symbol");for(var t,n=r.length,i=0;n>i;++i)if((t=r[i]).symbol===e)return t.key},writable:!0,configurable:!0},hasInstance:{value:b("Symbol.hasInstance")},isConcatSpreadable:{value:b("Symbol.isConcatSpreadable")},iterator:{value:b("Symbol.iterator")},toStringTag:{value:b("Symbol.toStringTag")}}),b.prototype.toString=function(){return"@@_____"+this._id+"_____"},b.prototype.valueOf=function(){return this},t(f.prototype,b.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),w(p,f),w(g,f),t(p.prototype,b.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),t(g.prototype,b.toStringTag.toString(),{value:"String Iterator",configurable:!0}),p.prototype.next=function(){if(!(this instanceof p))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var e;return-1===this._nextIndex?{done:!0,value:void 0}:"number"==typeof this._array.length&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(1===this._flag?e=[this._nextIndex,this._array[this._nextIndex]]:2===this._flag?e=this._array[this._nextIndex]:3===this._flag&&(e=this._nextIndex),this._nextIndex++,{done:!1,value:e}):(this._nextIndex=-1,{done:!0,value:void 0})},g.prototype.next=function(){if(!(this instanceof g))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var e,t=new String(this._string);return-1===this._nextIndex?{done:!0,value:void 0}:this._nextIndex<t.length?(e=t[this._nextIndex],this._nextIndex++,{done:!1,value:e}):(this._nextIndex=-1,{done:!0,value:void 0})};var _=function(e,t){this._target=e,this._values=[],this._thisArg=t};return _.prototype.spread=function(){var e=this;return o.call(arguments).forEach(function(t){s.forOf(t,function(t){e._values.push(t)})}),e},_.prototype.add=function(){var e=this;return o.call(arguments).forEach(function(t){e._values.push(t)}),e},_.prototype.call=function(e){if("function"!=typeof this._target)throw new TypeError("Target is not a function");return e=arguments.length<=0?this._thisArg:e,this._target.apply(e,this._values)},_.prototype["new"]=function(){if("function"!=typeof this._target)throw new TypeError("Target is not a constructor");var e,t;return e=Object.create(this._target.prototype),t=this._target.apply(e,this._values),m(t)?t:e},_.prototype.array=function(){if(!a(this._target))throw new TypeError("Target is not a array");return c.apply(this._target,this._values),this._target},n(s,{isSymbol:{value:function(e){return e instanceof b&&function(e){return!0===e._isSymbol&&"number"==typeof e._id&&"string"==typeof e._description}(e)},writable:!0,configurable:!0
},instanceOf:{value:function(e,t){if(!m(t))throw new TypeError("Right-hand side of 'instanceof' is not an object");var n=t[b.hasInstance];if(void 0===n)return e instanceof t;if("function"!=typeof n)throw new TypeError(typeof n+" is not a function");return n.call(t,e)},writable:!0,configurable:!0},forOf:{value:function(e,t,n){if(t="function"!=typeof t?u:t,"function"!=typeof e[b.iterator])throw new TypeError("Iterable[Symbol.iterator] is not a function");var i,r=e[b.iterator]();if("function"!=typeof r.next)throw new TypeError(".iterator.next is not a function");for(;;){if(i=r.next(),!m(i))throw new TypeError("Iterator result "+i+" is not an object");if(i.done)break;t.call(n,i.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(e,t){if("function"!=typeof e&&!a(e))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new _(e,t)},writable:!0,configurable:!0}}),t(e,"Symbol",{value:b,writable:!0,configurable:!0}),t(Function.prototype,b.hasInstance.toString(),{value:function(e){return"function"==typeof this&&e instanceof this}}),t(Array.prototype,"concat",{value:function(){if(void 0===this||null===this)throw new TypeError("Array.prototype.concat called on null or undefined");var e=Object(this),t=o.call(arguments),n=[];return t.unshift(e),t.forEach(function(e){m(e)?void 0!==e[b.isConcatSpreadable]?e[b.isConcatSpreadable]?y(n,e):n.push(e):a(e)?y(n,e):n.push(e):n.push(e)}),n},writable:!0,configurable:!0}),t(Object.prototype,"toString",{value:function(){return void 0===this||null===this?l.call(this):"string"==typeof this[b.toStringTag]?"[object "+this[b.toStringTag]+"]":l.call(this)},writable:!0,configurable:!0}),t(Array.prototype,b.iterator.toString(),{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new p(e,2)},writable:!0,configurable:!0}),t(Array,"from",{value:function(e,t,n){var i,r,o,a=0;if(i=h(this)?this:Array,void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");if(e=Object(e),void 0===t)t=d;else if(!h(t))throw new TypeError(t+" is not a function");if(void 0===e[b.iterator]){if(!("number"==typeof e.length&&e.length>=0))return(o=new i(0)).length=0,o;for(r=Math.floor(e.length),(o=new i(r)).length=r;r>a;++a)o[a]=t.call(n,e[a])}else(o=new i).length=0,s.forOf(e,function(e){o.length++,o[o.length-1]=t.call(n,e)});return o},writable:!0,configurable:!0}),t(Array.prototype,"entries",{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new p(e,1)},writable:!0,configurable:!0}),t(Array.prototype,"keys",{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new p(e,3)},writable:!0,configurable:!0}),t(String.prototype,b.iterator.toString(),{value:function(){if(void 0===this||null===this)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new g(String(this),0)},writable:!0,configurable:!0}),s})})}),define("libs/polyfills/array-fill",[],function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,i=arguments[1],r=i>>0,o=0>r?Math.max(n+r,0):Math.min(r,n),s=arguments[2],a=void 0===s?n:s>>0,l=0>a?Math.max(n+a,0):Math.min(a,n);l>o;)t[o]=e,o++;return t}})}),define("libs/polyfills/array-includes",[],function(){Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function n(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return!1;for(var o=0|t,s=Math.max(o>=0?o:r-Math.abs(o),0);r>s;){if(n(i[s],e))return!0;s++}return!1}})}),angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function(e){return{compile:function(t,n){angular.isFunction(n)&&(n={post:n});var i,r=t.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(t,o){i||(i=e(r)),i(t,function(e){o.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}}}]),define("modules/recursionHelper",function(){});var app=angular.module("ErrorCatcher",[]),UNHANDLED_REJECTION_ERR_MSG="Possibly unhandled rejection: canceled";app.config(["$provide",function(e){return e.decorator("$exceptionHandler",["$log","$delegate",function(e,t){return function(e,n){return e!==UNHANDLED_REJECTION_ERR_MSG||void 0!==n?(null!=("undefined"!=typeof Raven&&null!==Raven?Raven.captureException:void 0)&&Raven.captureException(e),t(e,n)):void 0}}])}]),app.factory("unAuthHttpResponseInterceptor",["$q","$location",function(e,t){return{responseError:function(t){return[401,403].includes(t.status)&&!(null!=t.config?t.config.disableAutoLoginRedirect:void 0)&&(window.location.pathname.match(/^\/project/)?window.location="/login?redir=".concat(encodeURI(window.location.pathname)):window.location="/login"),e.reject(t)}}}]),app.config(["$httpProvider",function(e){return e.interceptors.push("unAuthHttpResponseInterceptor")}]),define("modules/errorCatcher",function(){}),angular.module("localStorage",[]).value("localStorage",function(){try{for(var e,t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return(e=$).localStorage.apply(e,_toConsumableArray(Array.from(n||[])))}catch(r){return console.error("localStorage exception",r),null}}),define("modules/localStorage",function(){}),define("utils/underscore",["libraries"],function(){return angular.module("underscore",[]).factory("_",function(){return window._})}),define("base",["libraries","libs/polyfills/symbol","libs/polyfills/array-fill","libs/polyfills/array-includes","modules/recursionHelper","modules/errorCatcher","modules/localStorage","utils/underscore"],function(){var e=angular.module("SharelatexApp",["ui.bootstrap","autocomplete","RecursionHelper","ng-context-menu","underscore","ngSanitize","ipCookie","ErrorCatcher","localStorage","ngTagsInput","ui.select"]).config(["$qProvider","$httpProvider","uiSelectConfig",function(e,t,n){return e.errorOnUnhandledRejections(!1),n.spinnerClass="fa fa-refresh ui-select-spin",__guard__("undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub:void 0,function(e){return e.Config({messageStyle:"none",imageFont:null,"HTML-CSS":{availableFonts:["TeX"],scale:110,matchFontHeight:!1},TeX:{equationNumbers:{autoNumber:"AMS"},useLabelIDs:!1},skipStartupTypeset:!0,tex2jax:{processEscapes:!0,inlineMath:[["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}})})}]);e.run(["$templateCache",function(e){return e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="fa fa-times" aria-hidden="true"></i></a></span></div>')}]);var t=null!=__guard__(null!=window.location?window.location.search:void 0,function(e){return e.match(/debug=true/)}),n=null;return window.sl_debugging=t,window.sl_console={log:function(){if(t){var e;n=null;for(var i=arguments.length,r=new Array(i),o=0;i>o;o++)r[o]=arguments[o];return(e=console).log.apply(e,_toConsumableArray(Array.from(r||[])))}},logOnce:function(){for(var e=arguments.length,i=new Array(e),r=0;e>r;r++)i[r]=arguments[r];if(t&&i[0]!==n){var o;return n=i[0],(o=console).log.apply(o,_toConsumableArray(Array.from(i||[])))}}},e}),define("ide/file-tree/directives/fileEntity",["base"],function(e){return e.directive("fileEntity",["RecursionHelper",function(e){return{restrict:"E",scope:{entity:"=",permissions:"="},templateUrl:"entityListItemTemplate",compile:function(t){return e.compile(t,function(e,t,n,i){return e.$originalApply=e.$apply,e.$apply=function(e){null==e&&(e=function(){});var t=this.$root.$$phase;return"$apply"===t||"$digest"===t?e():this.$originalApply(e)}})}}}])}),define("ide/file-tree/directives/draggable",["base"],function(e){return e.directive("draggable",function(){return{link:function(e,t,n){return e.$watch(n.draggable,function(i){return i?t.draggable({delay:250,opacity:.7,scroll:!0,helper:e.$eval(n.draggableHelper)}):void 0})}}})}),define("ide/file-tree/directives/droppable",["base"],function(e){return e.directive("droppable",function(){return{link:function(e,t,n){return e.$watch(n.droppable,function(i){return i?t.droppable({greedy:!0,hoverClass:"droppable-hover",tolerance:"pointer",accept:n.accept,drop:e.$eval(n.onDropCallback)}):void 0})}}})}),define("ide/file-tree/controllers/FileTreeController",["base"],function(e){return e.controller("FileTreeController",["$scope","$modal","ide","$rootScope",function(e,t,n,i){return e.openNewDocModal=function(){return t.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return n.fileTreeManager.getCurrentFolder()},projectFeatures:function(){return n.$scope.project.features},type:function(){return"doc"},userFeatures:function(){return n.$scope.user.features}}})},e.openNewFolderModal=function(){return t.open({templateUrl:"newFolderModalTemplate",controller:"NewFolderModalController",resolve:{parent_folder:function(){return n.fileTreeManager.getCurrentFolder()}}})},e.openUploadFileModal=function(){return t.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{projectFeatures:function(){return n.$scope.project.features},parent_folder:function(){return n.fileTreeManager.getCurrentFolder()},type:function(){return"upload"},userFeatures:function(){return n.$scope.user.features}}})},e.orderByFoldersFirst=function(e){return"folder"===(null!=e?e.type:void 0)?"0":"1"},e.startRenamingSelected=function(){return e.$broadcast("rename:selected")},e.openDeleteModalForSelected=function(){return e.$broadcast("delete:selected")}}]),e.controller("NewFolderModalController",["$scope","ide","$modalInstance","$timeout","parent_folder",function(e,t,n,i,r){return e.inputs={name:"name"},e.state={inflight:!1},n.opened.then(function(){return i(function(){return e.$broadcast("open")},200)}),e.create=function(){var i=e.inputs.name;if(null!=i&&0!==i.length)return e.state.inflight=!0,t.fileTreeManager.createFolder(i,e.parent_folder).then(function(){return e.state.inflight=!1,n.dismiss("done")})["catch"](function(t){var n=t.data;return e.error=n,e.state.inflight=!1})},e.cancel=function(){return n.dismiss("cancel")}}]),e.controller("NewFileModalController",["$scope","ide","type","parent_folder","$modalInstance","event_tracking","projectFeatures","userFeatures",function(e,t,n,i,r,o,s,a){e.type=n,e.parent_folder=i,e.state={inflight:!1,valid:!0},e.cancel=function(){return r.dismiss("cancel")},e.create=function(){return e.$broadcast("create")};var l=s&&s.references||s&&s.mendeley||a&&a.references||a&&a.mendeley,c=s&&s.references||s&&s.zotero||a&&a.references||a&&a.zotero;return e.$watch("type",function(){"mendeley"!==e.type||l||o.send("subscription-funnel","editor-click-feature",e.type),"zotero"!==e.type||c||o.send("subscription-funnel","editor-click-feature",e.type)}),e.$on("done",function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isBibFile=n.name&&/^.*\.bib$/.test(n.name),(n.shouldReindexReferences||isBibFile)&&t.$scope.$emit("references:should-reindex",{}),r.dismiss("done")})}]),e.controller("NewDocModalController",["$scope","ide","$timeout",function(e,t,n){e.inputs={name:"name.tex"};var i=function(){var t=e.inputs.name;e.state.valid=null!=t&&t.length>0};return e.$watch("inputs.name",i),n(function(){return e.$broadcast("open")},200),e.$on("create",function(){var n=e.inputs.name;if(null!=n&&0!==n.length)return e.state.inflight=!0,t.fileTreeManager.createDoc(n,e.parent_folder).then(function(){return e.state.inflight=!1,e.$emit("done")})["catch"](function(t){var n=t.data;e.error=n,e.state.inflight=!1})})}]),e.controller("UploadFileModalController",["$scope","$rootScope","ide","$timeout","$window",function(e,t,n,i,r){e.parent_folder_id=null!=e.parent_folder?e.parent_folder.id:void 0,e.project_id=n.project_id,e.tooManyFiles=!1,e.rateLimitHit=!1,e.secondsToRedirect=10,e.notLoggedIn=!1,e.conflicts=[],e.control={};var o=function(){e.notLoggedIn=!0;var t=function o(){return i(function(){return 0===e.secondsToRedirect?r.location.href="/login?redir=/project/".concat(n.project_id):(o(),e.secondsToRedirect=e.secondsToRedirect-1)},1e3)};return t()};e.max_files=40,e.onComplete=function(n,r,o){return i(function(){return l--,o.success&&t.$broadcast("file:upload:complete",o),0===l&&null!=o&&o.success?e.$emit("done",{name:r}):void 0},250)},e.onValidateBatch=function(t){return t.length>e.max_files?(i(function(){return e.tooManyFiles=!0},1),!1):!0},e.onError=function(t,n,i){return console.log(t,n,i),-1!==i.indexOf("429")?e.rateLimitHit=!0:-1!==i.indexOf("403")?o():void 0};var s=null,a=function(){return 0===e.conflicts.length?e.doUpload():void 0},l=0;return e.onSubmit=function(t,i){return l++,n.fileTreeManager.existsInFolder(e.parent_folder_id,i)&&(e.conflicts.push(i),e.$apply()),null==s&&(s=setTimeout(function(){return s=null,a()},0)),!0},e.onCancel=function(t,n){l--;var i=e.conflicts.indexOf(n);return i>-1&&e.conflicts.splice(i,1),e.$apply(),a()},e.doUpload=function(){return __guard__(null!=e.control?e.control.q:void 0,function(e){return e.uploadStoredFiles()})}}]),e.controller("ProjectLinkedFileModalController",["$scope","ide","$timeout",function(e,t,n){e.data={projects:null,selectedProjectId:null,projectEntities:null,projectOutputFiles:null,selectedProjectEntity:null,selectedProjectOutputFile:null,buildId:null,name:null},e.state.inFlight={projects:!1,entities:!1,compile:!1},e.state.isOutputFilesMode=!1,e.state.error=!1,e.$watch("data.selectedProjectId",function(t,n){return t?(e.data.selectedProjectEntity=null,e.data.selectedProjectOutputFile=null,e.state.isOutputFilesMode?e.compileProjectAndGetOutputFiles(e.data.selectedProjectId):e.getProjectEntities(e.data.selectedProjectId)):void 0}),e.$watch("state.isOutputFilesMode",function(t,n){return t||n?(e.data.selectedProjectOutputFile=null,t===!0?e.compileProjectAndGetOutputFiles(e.data.selectedProjectId):e.getProjectEntities(e.data.selectedProjectId)):void 0}),e.$watch("data.selectedProjectEntity",function(t,n){if(t){var i=t.split("/").reverse()[0];i&&(e.data.name=i)}}),e.$watch("data.selectedProjectOutputFile",function(t,n){if(t)if("output.pdf"===t){var i=_.find(e.data.projects,function(t){return t._id===e.data.selectedProjectId});e.data.name=null!=(null!=i?i.name:void 0)?"".concat(i.name,".pdf"):"output.pdf"}else{var r=t.split("/").reverse()[0];r&&(e.data.name=r)}});var i=function(t){return e.state.inFlight[t]=!0},r=function(t){var n=t.err===!0,i=e.state.inFlight;return i.projects=i.entities=i.compile=!1,e.state.inflight=!1,e.state.error=n};e.toggleOutputFilesMode=function(){return e.data.selectedProjectId?e.state.isOutputFilesMode=!e.state.isOutputFilesMode:void 0},e.shouldEnableProjectSelect=function(){var t=e.state,n=e.data;return!t.inFlight.projects&&n.projects},e.hasNoProjects=function(){var t=e.state,n=e.data;return!t.inFlight.projects&&(null==n.projects||0===n.projects.length)},e.shouldEnableProjectEntitySelect=function(){var t=e.state,n=e.data;return!t.inFlight.projects&&!t.inFlight.entities&&n.projects&&n.selectedProjectId},e.shouldEnableProjectOutputFileSelect=function(){var t=e.state,n=e.data;return!t.inFlight.projects&&!t.inFlight.compile&&n.projects&&n.selectedProjectId};var o=function(){var t=e.state,n=e.data;e.state.valid=!t.inFlight.projects&&!t.inFlight.entities&&n.projects&&n.selectedProjectId&&(!e.state.isOutputFilesMode&&n.projectEntities&&n.selectedProjectEntity||e.state.isOutputFilesMode&&n.projectOutputFiles&&n.selectedProjectOutputFile)&&n.name};return e.$watch("state",o,!0),e.$watch("data",o,!0),e.getUserProjects=function(){return i("projects"),t.$http.get("/user/projects",{_csrf:window.csrfToken}).then(function(n){return e.data.projectEntities=null,e.data.projects=n.data.projects.filter(function(e){return e._id!==t.project_id}),r({err:!1})})["catch"](function(e){return r({err:!0})})},e.getProjectEntities=function(n){return i("entities"),t.$http.get("/project/".concat(n,"/entities"),{_csrf:window.csrfToken}).then(function(t){return e.data.selectedProjectId===t.data.project_id?(e.data.projectEntities=t.data.entities,r({err:!1})):void 0})["catch"](function(e){return r({err:!0})})},e.compileProjectAndGetOutputFiles=function(n){return i("compile"),t.$http.post("/project/".concat(n,"/compile"),{check:"silent",draft:!1,incrementalCompilesEnabled:!1,_csrf:window.csrfToken}).then(function(t){if("success"===t.data.status){var n=t.data.outputFiles.filter(function(e){return e.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)});return e.data.projectOutputFiles=n,e.data.buildId=__guard__(null!=n?n[0]:void 0,function(e){return e.build}),console.log(">> build_id",e.data.buildId),r({err:!1})}return e.data.projectOutputFiles=null,r({err:!0})})["catch"](function(e){return console.error(e),r({err:!0})})},e.init=function(){return e.getUserProjects()},n(e.init,0),e.$on("create",function(){var n,o,s=e.data.selectedProjectId,a=e.data.name;e.state.isOutputFilesMode?(o="project_output_file",n={source_project_id:s,source_output_file_path:e.data.selectedProjectOutputFile,build_id:e.data.buildId}):(o="project_file",n={source_project_id:s,source_entity_path:e.data.selectedProjectEntity}),i("create"),t.fileTreeManager.createLinkedFile(a,e.parent_folder,o,n).then(function(){return r({err:!1}),e.$emit("done",{name:a})})["catch"](function(t){var n=t.data;e.error=n})})}]),e.controller("UrlLinkedFileModalController",["$scope","ide","$timeout",function(e,t,n){e.inputs={name:"",url:""},e.nameChangedByUser=!1,n(function(){return e.$broadcast("open")},200);var i=function(){var t=e.inputs,n=t.name,i=t.url;return null==n||0===n.length?e.state.valid=!1:null==i||0===i.length?e.state.valid=!1:e.state.valid=!0};return e.$watch("inputs.name",i),e.$watch("inputs.url",i),e.$watch("inputs.url",function(t){if(null!=t&&""!==t&&!e.nameChangedByUser){t=t.replace("://","");var n=t.split("/").reverse();if(n.length>1)return e.inputs.name=n[0]}}),e.$on("create",function(){var n=e.inputs,i=n.name,r=n.url;if(null!=i&&0!==i.length&&null!=r&&0!==r.length)return e.state.inflight=!0,t.fileTreeManager.createLinkedFile(i,e.parent_folder,"url",{url:r}).then(function(){return e.state.inflight=!1,e.$emit("done",{name:i})})["catch"](function(t){var n=t.data;return e.error=n,e.state.inflight=!1})})}])}),define("ide/file-tree/util/iconTypeFromName",[],function(){var e;return e=function(e){var t=__guard__(e.split(".").pop(),function(e){return e.toLowerCase()});return["png","pdf","jpg","jpeg","gif"].includes(t)?"image":["csv","xls","xlsx"].includes(t)?"table":["py","r"].includes(t)?"file-text":["bib"].includes(t)?"book":"file"}}),define("ide/file-tree/controllers/FileTreeEntityController",["base","ide/file-tree/util/iconTypeFromName"],function(e,t){return e.controller("FileTreeEntityController",["$scope","ide","$modal",function(e,n,i){e.select=function(t){if(!t.ctrlKey&&!t.metaKey)return n.fileTreeManager.selectEntity(e.entity),e.$emit("entity:selected",e.entity);t.stopPropagation();var i=n.fileTreeManager.multiSelectedCount();return 0===n.fileTreeManager.toggleMultiSelectEntity(e.entity),0===i?n.fileTreeManager.multiSelectSelectedEntity():void 0},e.draggableHelper=function(){return n.fileTreeManager.multiSelectedCount()>0?$("<strong style='z-index:100'>".concat(n.fileTreeManager.multiSelectedCount()," Files</strong>")):$("<strong style='z-index:100'>".concat(e.entity.name,"</strong>"))},e.inputs={name:e.entity.name},e.startRenaming=function(){return e.entity.renaming=!0};var r=!1;return e.finishRenaming=function(){if(e.entity.renaming){var t=e.inputs.name;if(null==t){if(r)return;r=!0;var o=i.open({templateUrl:"invalidFileNameModalTemplate"});return void o.result.then(function(){return r=!1})}return delete e.entity.renaming,null==t||0===t.length?void(e.inputs.name=e.entity.name):n.fileTreeManager.renameEntity(e.entity,t)}},e.$on("rename:selected",function(){return e.entity.selected?e.startRenaming():void 0}),e.openDeleteModal=function(){var t;return t=n.fileTreeManager.multiSelectedCount()>0?n.fileTreeManager.getMultiSelectedEntityChildNodes():[e.entity],i.open({templateUrl:"deleteEntityModalTemplate",controller:"DeleteEntityModalController",resolve:{entities:function(){return t}}})},e.$on("delete:selected",function(){return e.entity.selected?e.openDeleteModal():void 0}),e.iconTypeFromName=t}]),e.controller("DeleteEntityModalController",["$scope","ide","$modalInstance","entities",function(e,t,n,i){return e.state={inflight:!1},e.entities=i,e["delete"]=function(){e.state.inflight=!0;for(var i=0,r=Array.from(e.entities);i<r.length;i++){var o=r[i];t.fileTreeManager.deleteEntity(o)}return n.close()},e.cancel=function(){return n.dismiss("cancel")}}])}),define("ide/file-tree/controllers/FileTreeFolderController",["base"],function(e){return e.controller("FileTreeFolderController",["$scope","ide","$modal","localStorage",function(e,t,n,i){return e.expanded=i("folder.".concat(e.entity.id,".expanded"))||!1,e.toggleExpanded=function(){return e.expanded=!e.expanded,i("folder.".concat(e.entity.id,".expanded"),e.expanded)},e.onDrop=function(n,i){var r;r=t.fileTreeManager.multiSelectedCount()?t.fileTreeManager.getMultiSelectedEntityChildNodes():[$(i.draggable).scope().entity];for(var o=0,s=Array.from(r);o<s.length;o++){var a=s[o];t.fileTreeManager.moveEntity(a,e.entity)}return e.$digest(),$(".file-tree-inner .droppable-hover").removeClass("droppable-hover")},e.orderByFoldersFirst=function(e){return"folder"===(null!=e?e.type:void 0)?"0":"1"},e.openNewDocModal=function(){return n.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return e.entity},projectFeatures:function(){return t.$scope.project.features},type:function(){return"doc"},userFeatures:function(){return t.$scope.user.features}}})},e.openNewFolderModal=function(){return n.open({templateUrl:"newFolderModalTemplate",controller:"NewFolderModalController",resolve:{parent_folder:function(){return e.entity}}})},e.openUploadFileModal=function(){return n.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return e.entity},projectFeatures:function(){return t.$scope.project.features},type:function(){return"upload"},userFeatures:function(){return t.$scope.user.features}}})}}])}),define("ide/file-tree/controllers/FileTreeRootFolderController",["base"],function(e){return e.controller("FileTreeRootFolderController",["$scope","ide",function(e,t){var n=e.rootFolder;return e.onDrop=function(i,r){var o;o=t.fileTreeManager.multiSelectedCount()?t.fileTreeManager.getMultiSelectedEntityChildNodes():[$(r.draggable).scope().entity];for(var s=0,a=Array.from(o);s<a.length;s++){var l=a[s];t.fileTreeManager.moveEntity(l,n)}return e.$digest(),$(".file-tree-inner .droppable-hover").removeClass("droppable-hover")}}])}),define("ide/file-tree/FileTreeManager",["ide/file-tree/directives/fileEntity","ide/file-tree/directives/draggable","ide/file-tree/directives/droppable","ide/file-tree/controllers/FileTreeController","ide/file-tree/controllers/FileTreeEntityController","ide/file-tree/controllers/FileTreeFolderController","ide/file-tree/controllers/FileTreeRootFolderController"],function(){var e;return e=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.ide=t,this.$scope=n,this.$scope.$on("project:joined",function(){return i.loadRootFolder(),i.loadDeletedDocs(),i.$scope.$emit("file-tree:initialized")}),this.$scope.$watch("rootFolder",function(e){return null!=e?i.recalculateDocList():void 0}),this._bindToSocketEvents(),this.$scope.multiSelectedCount=0,$(document).on("click",function(){return i.clearMultiSelectedEntities(),i.$scope.$digest()})}return _createClass(e,[{key:"_bindToSocketEvents",value:function(){var e=this;return this.ide.socket.on("reciveNewDoc",function(t,n){var i=e.findEntityById(t)||e.$scope.rootFolder;return e.$scope.$apply(function(){return i.children.push({name:n.name,id:n._id,type:"doc"}),e.recalculateDocList()})}),this.ide.socket.on("reciveNewFile",function(t,n,i,r){var o=e.findEntityById(t)||e.$scope.rootFolder;return e.$scope.$apply(function(){return o.children.push({name:n.name,id:n._id,type:"file",linkedFileData:r,created:n.created}),e.recalculateDocList()})}),this.ide.socket.on("reciveNewFolder",function(t,n){var i=e.findEntityById(t)||e.$scope.rootFolder;return e.$scope.$apply(function(){return i.children.push({name:n.name,id:n._id,type:"folder",children:[]}),e.recalculateDocList()})}),this.ide.socket.on("reciveEntityRename",function(t,n){var i=e.findEntityById(t);if(null!=i)return e.$scope.$apply(function(){return i.name=n,e.recalculateDocList()})}),this.ide.socket.on("removeEntity",function(t){var n=e.findEntityById(t);if(null!=n)return e.$scope.$apply(function(){return e._deleteEntityFromScope(n),e.recalculateDocList()}),e.$scope.$broadcast("entity:deleted",n)}),this.ide.socket.on("reciveEntityMove",function(t,n){var i=e.findEntityById(t),r=e.findEntityById(n);return e.$scope.$apply(function(){return e._moveEntityInScope(i,r),e.recalculateDocList()})})}},{key:"selectEntity",value:function(e){return this.selected_entity_id=e.id,this.ide.fileTreeManager.forEachEntity(function(e){return e.selected=!1}),e.selected=!0}},{key:"toggleMultiSelectEntity",value:function(e){return e.multiSelected=!e.multiSelected,this.$scope.multiSelectedCount=this.multiSelectedCount()}},{key:"multiSelectedCount",value:function(){var e=0;return this.forEachEntity(function(t){return t.multiSelected?e++:void 0}),e}},{key:"getMultiSelectedEntities",value:function(){var e=[];return this.forEachEntity(function(t){return t.multiSelected?e.push(t):void 0}),e}},{key:"getMultiSelectedEntityChildNodes",value:function(){for(var e=this.getMultiSelectedEntities(),t={},n=0,i=Array.from(e);n<i.length;n++){var r=i[n];t["/"+this.getEntityPath(r)]=r}var o={};for(var s in t){r=t[s];var a=s.split("/");if(!(a.length<=2))for(var l=1,c=a.length-1,u=c>=1;u?c>=l:l>=c;u?l++:l--)o["/"+a.slice(0,l).join("/")]=!0}var d=[];for(s in t)r=t[s],null==o[s]&&d.push(r);return d}},{key:"clearMultiSelectedEntities",value:function(){return 0!==this.$scope.multiSelectedCount?(this.forEachEntity(function(e){return e.multiSelected=!1}),this.$scope.multiSelectedCount=0):void 0}},{key:"multiSelectSelectedEntity",value:function(){return __guard__(this.findSelectedEntity(),function(e){return e.multiSelected=!0})}},{key:"existsInFolder",value:function(e,t){var n=this.findEntityById(e);if(null==n)return!1;var i=this._findEntityByPathInFolder(n,t);return null!=i}},{key:"findSelectedEntity",value:function(){var e=null;return this.forEachEntity(function(t){return t.selected?e=t:void 0}),e}},{key:"findEntityById",value:function(e,t){if(null==t&&(t={}),this.$scope.rootFolder.id===e)return this.$scope.rootFolder;var n=this._findEntityByIdInFolder(this.$scope.rootFolder,e);if(null!=n)return n;if(t.includeDeleted)for(var i=0,r=Array.from(this.$scope.deletedDocs);i<r.length;i++)if(n=r[i],n.id===e)return n;return null}},{key:"_findEntityByIdInFolder",value:function(e,t){for(var n=0,i=Array.from(e.children||[]);n<i.length;n++){var r=i[n];if(r.id===t)return r;if(null!=r.children){var o=this._findEntityByIdInFolder(r,t);if(null!=o)return o}}return null}},{key:"findEntityByPath",value:function(e){return this._findEntityByPathInFolder(this.$scope.rootFolder,e)}},{key:"_findEntityByPathInFolder",value:function(e,t){if(null==t||null==e)return null;if(""===t)return e;var n=t.split("/"),i=n.shift(),r=n.join("/");if("."===i)return this._findEntityByPathInFolder(e,r);for(var o=0,s=Array.from(e.children);o<s.length;o++){var a=s[o];if(a.name===i){if(""===r)return a;if("folder"===a.type)return this._findEntityByPathInFolder(a,r)}}return null}},{key:"forEachEntity",value:function(e){var t=this;return null==e&&(e=function(e,t,n){}),this._forEachEntityInFolder(this.$scope.rootFolder,null,e),function(){for(var n=[],i=0,r=Array.from(t.$scope.deletedDocs||[]);i<r.length;i++){var o=r[i];n.push(e(o))}return n}()}},{key:"_forEachEntityInFolder",value:function(e,t,n){var i=this;return function(){for(var r=[],o=0,s=Array.from(e.children||[]);o<s.length;o++){var a,l=s[o];a=null!=t?t+"/"+l.name:l.name,n(l,e,a),null!=l.children?r.push(i._forEachEntityInFolder(l,a,n)):r.push(void 0)}return r}()}},{key:"getEntityPath",value:function(e){return this._getEntityPathInFolder(this.$scope.rootFolder,e)}},{key:"_getEntityPathInFolder",value:function(e,t){for(var n=0,i=Array.from(e.children||[]);n<i.length;n++){var r=i[n];if(r===t)return t.name;if("folder"===r.type){var o=this._getEntityPathInFolder(r,t);if(null!=o)return r.name+"/"+o}}return null}},{key:"getRootDocDirname",value:function(){var e=this.findEntityById(this.$scope.project.rootDoc_id);if(null!=e)return this._getEntityDirname(e)}},{key:"_getEntityDirname",value:function(e){var t=this.getEntityPath(e);if(null!=t)return t.split("/").slice(0,-1).join("/")}},{key:"_findParentFolder",value:function(e){var t=this._getEntityDirname(e);if(null!=t)return this.findEntityByPath(t)}},{key:"loadRootFolder",value:function(){return this.$scope.rootFolder=this._parseFolder(__guard__(null!=this.$scope?this.$scope.project:void 0,function(e){return e.rootFolder[0]}))}},{key:"_parseFolder",value:function(e){for(var t={name:e.name,id:e._id,type:"folder",children:[],selected:e._id===this.selected_entity_id},n=0,i=Array.from(e.docs||[]);n<i.length;n++){var r=i[n];t.children.push({name:r.name,id:r._id,type:"doc",selected:r._id===this.selected_entity_id})}for(var o=0,s=Array.from(e.fileRefs||[]);o<s.length;o++){var a=s[o];t.children.push({name:a.name,id:a._id,type:"file",selected:a._id===this.selected_entity_id,linkedFileData:a.linkedFileData,created:a.created})}for(var l=0,c=Array.from(e.folders||[]);l<c.length;l++){var u=c[l];t.children.push(this._parseFolder(u))}return t}},{key:"loadDeletedDocs",value:function(){var e=this;return this.$scope.deletedDocs=[],Array.from(this.$scope.project.deletedDocs||[]).map(function(t){return e.$scope.deletedDocs.push({name:t.name,id:t._id,type:"doc",deleted:!0})})}},{key:"recalculateDocList",value:function(){var e=this;return this.$scope.docs=[],this.forEachEntity(function(t,n,i){return"doc"!==t.type||t.deleted?void 0:e.$scope.docs.push({doc:t,path:i})}),this.$scope.docs.sort(function(e,t){var n=(e.path.match(/\//g)||[]).length,i=(t.path.match(/\//g)||[]).length;return n-i!==0?-(n-i):e.path<t.path?-1:1})}},{key:"getEntityPath",value:function(e){return this._getEntityPathInFolder(this.$scope.rootFolder,e)}},{key:"_getEntityPathInFolder",value:function(e,t){for(var n=0,i=Array.from(e.children||[]);n<i.length;n++){var r=i[n];if(r===t)return t.name;if("folder"===r.type){var o=this._getEntityPathInFolder(r,t);if(null!=o)return r.name+"/"+o}}return null}},{key:"getCurrentFolder",value:function(){return this._getCurrentFolder(this.$scope.rootFolder)||this.$scope.rootFolder}},{key:"_getCurrentFolder",value:function(e){null==e&&(e=this.$scope.rootFolder);for(var t=0,n=Array.from(e.children||[]);t<n.length;t++){
var i=n[t];if(i.selected)return"folder"===i.type?i:e;if("folder"===i.type){var r=this._getCurrentFolder(i);if(null!=r)return r}}return null}},{key:"projectContainsFolder",value:function(){for(var e=0,t=Array.from(this.$scope.rootFolder.children);e<t.length;e++){var n=t[e];if("folder"===n.type)return!0}return!1}},{key:"existsInThisFolder",value:function(e,t){for(var n=0,i=Array.from((null!=e?e.children:void 0)||[]);n<i.length;n++){var r=i[n];if(r.name===t)return!0}return!1}},{key:"nameExistsError",value:function(e){null==e&&(e="already exists");var t=this.ide.$q.defer();return t.reject({data:e}),t.promise}},{key:"createDoc",value:function(e,t){return null==t&&(t=this.getCurrentFolder()),this.existsInThisFolder(t,e)?this.nameExistsError():this.ide.$http.post("/project/".concat(this.ide.project_id,"/doc"),{name:e,parent_folder_id:null!=t?t.id:void 0,_csrf:window.csrfToken})}},{key:"createFolder",value:function(e,t){return null==t&&(t=this.getCurrentFolder()),this.existsInThisFolder(t,e)?this.nameExistsError():this.ide.$http.post("/project/".concat(this.ide.project_id,"/folder"),{name:e,parent_folder_id:null!=t?t.id:void 0,_csrf:window.csrfToken})}},{key:"createLinkedFile",value:function(e,t,n,i){return null==t&&(t=this.getCurrentFolder()),this.existsInThisFolder(t,e)?this.nameExistsError():this.ide.$http.post("/project/".concat(this.ide.project_id,"/linked_file"),{name:e,parent_folder_id:null!=t?t.id:void 0,provider:n,data:i,_csrf:window.csrfToken},{disableAutoLoginRedirect:!0})}},{key:"refreshLinkedFile",value:function(e){var t=(this._findParentFolder(e),null!=e.linkedFileData?e.linkedFileData.provider:void 0);return null==t?void console.warn(">> no provider for ".concat(e.name),e):this.ide.$http.post("/project/".concat(this.ide.project_id,"/linked_file/").concat(e.id,"/refresh"),{_csrf:window.csrfToken},{disableAutoLoginRedirect:!0})}},{key:"renameEntity",value:function(e,t,n){if(null==n&&(n=function(e){}),e.name!==t&&!(t.length>=150)){var i=this.getCurrentFolder();return this.existsInThisFolder(i,t)?this.nameExistsError():(e.renamingToName=t,this.ide.$http.post("/project/".concat(this.ide.project_id,"/").concat(e.type,"/").concat(e.id,"/rename"),{name:t,_csrf:window.csrfToken}).then(function(){return e.name=t})["finally"](function(){return e.renamingToName=null}))}}},{key:"deleteEntity",value:function(e,t){return null==t&&(t=function(e){}),this.ide.queuedHttp({method:"DELETE",url:"/project/".concat(this.ide.project_id,"/").concat(e.type,"/").concat(e.id),headers:{"X-Csrf-Token":window.csrfToken}})}},{key:"moveEntity",value:function(e,t,n){var i=this;return null==n&&(n=function(e){}),this._isChildFolder(e,t)?void 0:this.existsInThisFolder(t,e.name)?this.nameExistsError():this.ide.queuedHttp.post("/project/".concat(this.ide.project_id,"/").concat(e.type,"/").concat(e.id,"/move"),{folder_id:t.id,_csrf:window.csrfToken}).then(function(){return i._moveEntityInScope(e,t)})}},{key:"_isChildFolder",value:function(e,t){var n=this.getEntityPath(e)||"",i=this.getEntityPath(t)||"";return i.slice(0,n.length)===n}},{key:"_deleteEntityFromScope",value:function(e,t){if(null==t&&(t={moveToDeleted:!0}),null!=e){var n=null;if(this.forEachEntity(function(t,i){return t===e?n=i:void 0}),null!=n){var i=n.children.indexOf(e);i>-1&&n.children.splice(i,1)}return"doc"===e.type&&t.moveToDeleted?(e.deleted=!0,this.$scope.deletedDocs.push(e)):void 0}}},{key:"_moveEntityInScope",value:function(e,t){return Array.from(t.children).includes(e)?void 0:(this._deleteEntityFromScope(e,{moveToDeleted:!1}),t.children.push(e))}}]),e}()}),define("ide/connection/ConnectionManager",[],function(){var e,t=36e5;return e=function(){return e=function(){function e(n,i){var r=this;if(_classCallCheck(this,e),this.ide=n,this.$scope=i,this.wsUrl=n.wsUrl||null,"undefined"==typeof io||null===io)return console.error("Socket.io javascript not loaded. Please check that the real-time service is running and accessible."),this.ide.socket={on:function(){}},void this.$scope.$apply(function(){return r.$scope.state.error="Could not connect to websocket server :("});setInterval(function(){return r.disconnectIfInactive()},t),window.addEventListener("online",function(){return sl_console.log("[online] browser notified online"),r.connected?void 0:r.tryReconnectWithRateLimit({force:!0})}),this.userIsLeavingPage=!1,window.addEventListener("beforeunload",function(){r.userIsLeavingPage=!0}),this.connected=!1,this.userIsInactive=!1,this.gracefullyReconnecting=!1,this.$scope.connection={reconnecting:!1,forced_disconnect:!1,inactive_disconnect:!1},this.$scope.tryReconnectNow=function(){return r.tryReconnectWithRateLimit({force:!0})},this.$scope.$on("cursor:editor:update",function(){return r.lastUserAction=new Date,r.connected?void 0:r.tryReconnectWithRateLimit()}),document.querySelector("body").addEventListener("click",function(e){return r.connected||"try-reconnect-now-button"===e.target.id?void 0:r.tryReconnectWithRateLimit()}),this.ide.socket=io.connect(this.wsUrl,{reconnect:!1,"connect timeout":3e4,"force new connection":!0});var o=function(e){return sl_console.log("socket.io error",e),!r.wsUrl||window.location.href.match(/ws=fallback/)?(r.connected=!1,r.$scope.$apply(function(){return r.$scope.state.error="Unable to connect, please view the <u><a href='/learn/Kb/Connection_problems'>connection problems guide</a></u> to fix the issue."})):void(window.location=window.location.href+"?ws=fallback")};this.ide.socket.on("error",o),this.ide.socket.on("connect",function(){return r.ide.socket.removeListener("error",o),sl_console.log("[socket.io connect] Connected")}),this.ide.socket.on("connectionAccepted",function(e){return sl_console.log("[socket.io connectionAccepted] allowed to connect"),r.connected=!0,r.gracefullyReconnecting=!1,r.ide.pushEvent("connected"),r.$scope.$apply(function(){return r.$scope.connection.reconnecting=!1,r.$scope.connection.inactive_disconnect=!1,r.$scope.state.loading?r.$scope.state.load_progress=70:void 0}),setTimeout(function(){return r.joinProject()},100)}),this.ide.socket.on("connectionRejected",function(e){return sl_console.log("[socket.io connectionRejected] session not valid or other connection error"),e&&"retry"===e.message?r.tryReconnectWithRateLimit():r.reportConnectionError(e)}),this.ide.socket.on("connect_failed",function(){return r.connected=!1,r.$scope.$apply(function(){return r.$scope.state.error="Unable to connect, please view the <u><a href='/learn/Kb/Connection_problems'>connection problems guide</a></u> to fix the issue."})}),this.ide.socket.on("disconnect",function(){return sl_console.log("[socket.io disconnect] Disconnected"),r.connected=!1,r.ide.pushEvent("disconnected"),r.$scope.$apply(function(){return r.$scope.connection.reconnecting=!1}),r.$scope.connection.forced_disconnect||r.userIsInactive||r.gracefullyReconnecting?void 0:r.startAutoReconnectCountdown()}),this.ide.socket.on("forceDisconnect",function(e){return r.$scope.$apply(function(){return r.$scope.permissions.write=!1,r.$scope.connection.forced_disconnect=!0}),r.ide.socket.disconnect(),r.ide.showGenericMessageModal("Please Refresh","We're performing maintenance on Overleaf and you need to refresh the editor.\nSorry for any inconvenience.\nThe editor will refresh in automatically in 10 seconds."),setTimeout(function(){return location.reload()},1e4)}),this.ide.socket.on("reconnectGracefully",function(){return sl_console.log("Reconnect gracefully"),r.reconnectGracefully()})}return _createClass(e,null,[{key:"initClass",value:function(){this.prototype.disconnectAfterMs=24*t,this.prototype.lastUserAction=new Date,this.prototype.MIN_RETRY_INTERVAL=1e3,this.prototype.BACKGROUND_RETRY_INTERVAL=5e3,this.prototype.RECONNECT_GRACEFULLY_RETRY_INTERVAL=5e3,this.prototype.MAX_RECONNECT_GRACEFULLY_INTERVAL=3e5}}]),_createClass(e,[{key:"reportConnectionError",value:function(e){return sl_console.log("[socket.io] reporting connection error"),"not authorized"===(null!=e?e.message:void 0)||"invalid session"===(null!=e?e.message:void 0)?window.location="/login?redir=".concat(encodeURI(window.location.pathname)):(this.ide.socket.disconnect(),this.ide.showGenericMessageModal("Something went wrong connecting","Something went wrong connecting to your project. Please refresh if this continues to happen."))}},{key:"joinProject",value:function(){var e=this;sl_console.log("[joinProject] joining...");var t={project_id:this.ide.project_id};return window.anonymousAccessToken&&(t.anonymousAccessToken=window.anonymousAccessToken),this.ide.socket.emit("joinProject",t,function(t,n,i,r){return null!=t||null==n?e.reportConnectionError(t):(null!=e.$scope.protocolVersion&&e.$scope.protocolVersion!==r&&location.reload(!0),e.$scope.$apply(function(){return e.$scope.protocolVersion=r,e.$scope.project=n,e.$scope.permissionsLevel=i,e.$scope.state.load_progress=100,e.$scope.state.loading=!1,e.$scope.$broadcast("project:joined")}))})}},{key:"reconnectImmediately",value:function(){return this.disconnect(),this.tryReconnect()}},{key:"disconnect",value:function(){return this.ide.socket.socket&&!this.ide.socket.socket.connected?void sl_console.log("[socket.io] skipping disconnect because socket.io has not connected"):(sl_console.log("[socket.io] disconnecting client"),this.ide.socket.disconnect())}},{key:"startAutoReconnectCountdown",value:function(){var e,t=this;sl_console.log("[ConnectionManager] starting autoreconnect countdown");var n=12e4;return e=null!=this.lastUserAction&&new Date-this.lastUserAction>n?60+Math.floor(120*Math.random()):3+Math.floor(7*Math.random()),this.userIsLeavingPage?void 0:(this.$scope.$apply(function(){return t.$scope.connection.reconnecting=!1,t.$scope.connection.reconnection_countdown=e}),setTimeout(function(){return t.connected?void 0:t.timeoutId=setTimeout(function(){return t.decreaseCountdown()},1e3)},200))}},{key:"cancelReconnect",value:function(){return null!=this.timeoutId?(sl_console.log("[ConnectionManager] cancelling existing reconnect timer"),clearTimeout(this.timeoutId),this.timeoutId=null):void 0}},{key:"decreaseCountdown",value:function(){var e=this;return this.timeoutId=null,null!=this.$scope.connection.reconnection_countdown?(sl_console.log("[ConnectionManager] decreasing countdown",this.$scope.connection.reconnection_countdown),this.$scope.$apply(function(){return e.$scope.connection.reconnection_countdown--}),this.$scope.connection.reconnection_countdown<=0?this.$scope.$apply(function(){return e.tryReconnect()}):this.timeoutId=setTimeout(function(){return e.decreaseCountdown()},1e3)):void 0}},{key:"tryReconnect",value:function(){var e=this;return sl_console.log("[ConnectionManager] tryReconnect"),this.cancelReconnect(),delete this.$scope.connection.reconnection_countdown,this.connected?void 0:(this.$scope.connection.reconnecting=!0,this.ide.socket.socket.connect(),this.lastConnectionAttempt=new Date,setTimeout(function(){return e.connected?void 0:e.startAutoReconnectCountdown()},2e3))}},{key:"tryReconnectWithRateLimit",value:function(e){if(null!=this.$scope.connection?!this.$scope.connection.reconnecting:!0){var t=null!=(null!=this.$scope.connection?this.$scope.connection.reconnection_countdown:void 0)&&this.$scope.connection.reconnection_countdown<=5,n=null!=e?e.force:void 0;if(!t||n){var i=n?this.MIN_RETRY_INTERVAL:this.BACKGROUND_RETRY_INTERVAL;if(!(null!=this.lastConnectionAttempt&&new Date-this.lastConnectionAttempt<i))return this.tryReconnect()}}}},{key:"disconnectIfInactive",value:function(){var e=this;return this.userIsInactive=new Date-this.lastUserAction>this.disconnectAfterMs,this.userIsInactive&&this.connected?(this.disconnect(),this.$scope.$apply(function(){return e.$scope.connection.inactive_disconnect=!0})):void 0}},{key:"reconnectGracefully",value:function(){var e=this;null==this.reconnectGracefullyStarted&&(this.reconnectGracefullyStarted=new Date);var t=new Date-this.lastUserAction>this.RECONNECT_GRACEFULLY_RETRY_INTERVAL,n=new Date-this.reconnectGracefullyStarted>this.MAX_RECONNECT_GRACEFULLY_INTERVAL;return t||n?(sl_console.log("[reconnectGracefully] User didn't do anything for last 5 seconds, reconnecting"),this._reconnectGracefullyNow()):(sl_console.log("[reconnectGracefully] User is working, will try again in 5 seconds"),setTimeout(function(){return e.reconnectGracefully()},this.RECONNECT_GRACEFULLY_RETRY_INTERVAL))}},{key:"_reconnectGracefullyNow",value:function(){return this.gracefullyReconnecting=!0,this.reconnectGracefullyStarted=null,$.cookie("SERVERID","",{expires:-1,path:"/"}),this.reconnectImmediately()}}]),e}(),e.initClass(),e}()}),define("utils/EventEmitter",[],function(){var e;return e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"on",value:function(e,t){var n;this.events||(this.events={});var i=Array.from(e.split(".")),r=_slicedToArray(i,2);return e=r[0],n=r[1],this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,namespace:n})}},{key:"off",value:function(e){if(this.events||(this.events={}),null!=e){var t,n=Array.from(e.split(".")),i=_slicedToArray(n,2);if(e=i[0],t=i[1],null==t)return delete this.events[e];for(var r=[],o=0,s=Array.from(this.events[e]||[]);o<s.length;o++){var a=s[o];a.namespace!==t&&r.push(a)}return this.events[e]=r}return this.events={}}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];return this.events||(this.events={}),Array.from(this.events[e]||[]).map(function(e){return e.callback.apply(e,_toConsumableArray(Array.from(n||[])))})}},{key:"emit",value:function(){for(var e=arguments.length,t=new Array(e),n=0;e>n;n++)t[n]=arguments[n];return this.trigger.apply(this,_toConsumableArray(Array.from(t||[])))}}]),e}()}),function(){function e(e){var t=n;e&&(n[e]||(n[e]={}),t=n[e]),t.define&&t.define.packaged||(i.original=t.define,t.define=i,t.define.packaged=!0),t.require&&t.require.packaged||(o.original=t.require,t.require=o,t.require.packaged=!0)}var t="ace",n=function(){return this}();if(n||"undefined"==typeof window||(n=window),t||"undefined"==typeof requirejs){var i=function(e,t,n){return"string"!=typeof e?void(i.original?i.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace())):(2==arguments.length&&(n=t),void(i.modules[e]||(i.payloads[e]=n,i.modules[e]=null)))};i.modules={},i.payloads={};var r=function(e,t,n){if("string"==typeof t){var i=a(e,t);if(void 0!=i)return n&&n(),i}else if("[object Array]"===Object.prototype.toString.call(t)){for(var r=[],s=0,l=t.length;l>s;++s){var c=a(e,t[s]);if(void 0==c&&o.original)return;r.push(c)}return n&&n.apply(null,r)||!0}},o=function(e,t){var n=r("",e,t);return void 0==n&&o.original?o.original.apply(this,arguments):n},s=function(e,t){if(-1!==t.indexOf("!")){var n=t.split("!");return s(e,n[0])+"!"+s(e,n[1])}if("."==t.charAt(0)){var i=e.split("/").slice(0,-1).join("/");for(t=i+"/"+t;-1!==t.indexOf(".")&&r!=t;){var r=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return t},a=function(e,t){t=s(e,t);var n=i.modules[t];if(!n){if(n=i.payloads[t],"function"==typeof n){var o={},a={id:t,uri:"",exports:o,packaged:!0},l=function(e,n){return r(t,e,n)},c=n(l,o,a);o=c||a.exports,i.modules[t]=o,delete i.payloads[t]}n=i.modules[t]=o||n}return n};e(t)}}(),ace.define("ace/lib/regexp",[],function(e,t,n){"use strict";function i(e){return(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":"")}function r(e,t,n){if(Array.prototype.indexOf)return e.indexOf(t,n);for(var i=n||0;i<e.length;i++)if(e[i]===t)return i;return-1}var o={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},s=void 0===o.exec.call(/()??/,"")[1],a=function(){var e=/^/g;return o.test.call(e,""),!e.lastIndex}();a&&s||(RegExp.prototype.exec=function(e){var t,n,l=o.exec.apply(this,arguments);if("string"==typeof e&&l){if(!s&&l.length>1&&r(l,"")>-1&&(n=RegExp(this.source,o.replace.call(i(this),"g","")),o.replace.call(e.slice(l.index),n,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(l[e]=void 0)})),this._xregexp&&this._xregexp.captureNames)for(var c=1;c<l.length;c++)t=this._xregexp.captureNames[c-1],t&&(l[t]=l[c]);!a&&this.global&&!l[0].length&&this.lastIndex>l.index&&this.lastIndex--}return l},a||(RegExp.prototype.test=function(e){var t=o.exec.call(this,e);return t&&this.global&&!t[0].length&&this.lastIndex>t.index&&this.lastIndex--,!!t}))}),ace.define("ace/lib/es5-shim",[],function(e,t,n){function i(){}function r(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){}}function o(e){return e=+e,e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError("Function.prototype.bind called on incompatible "+t);var n=p.call(arguments,1),r=function(){if(this instanceof r){var i=t.apply(this,n.concat(p.call(arguments)));return Object(i)===i?i:this}return t.apply(e,n.concat(p.call(arguments)))};return t.prototype&&(i.prototype=t.prototype,r.prototype=new i,i.prototype=null),r});var s,a,l,c,u,d=Function.prototype.call,h=Array.prototype,f=Object.prototype,p=h.slice,g=d.bind(f.toString),m=d.bind(f.hasOwnProperty);if((u=m(f,"__defineGetter__"))&&(s=d.bind(f.__defineGetter__),a=d.bind(f.__defineSetter__),l=d.bind(f.__lookupGetter__),c=d.bind(f.__lookupSetter__)),2!=[1,2].splice(0).length)if(function(){function e(e){var t=new Array(e+2);return t[0]=t[1]=0,t}var t,n=[];return n.splice.apply(n,e(20)),n.splice.apply(n,e(26)),t=n.length,n.splice(5,0,"XXX"),t+1==n.length,t+1==n.length?!0:void 0}()){var v=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?v.apply(this,[void 0===e?0:e,void 0===t?this.length-e:t].concat(p.call(arguments,2))):[]}}else Array.prototype.splice=function(e,t){var n=this.length;e>0?e>n&&(e=n):void 0==e?e=0:0>e&&(e=Math.max(n+e,0)),n>e+t||(t=n-e);var i=this.slice(e,e+t),r=p.call(arguments,2),o=r.length;if(e===n)o&&this.push.apply(this,r);else{var s=Math.min(t,n-e),a=e+s,l=a+o-s,c=n-a,u=n-s;if(a>l)for(var d=0;c>d;++d)this[l+d]=this[a+d];else if(l>a)for(d=c;d--;)this[l+d]=this[a+d];if(o&&e===u)this.length=u,this.push.apply(this,r);else for(this.length=u+o,d=0;o>d;++d)this[e+d]=r[d]}return i};Array.isArray||(Array.isArray=function(e){return"[object Array]"==g(e)});var y=Object("a"),w="a"!=y[0]||!(0 in y);if(Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=arguments[1],r=-1,o=n.length>>>0;if("[object Function]"!=g(e))throw new TypeError;for(;++r<o;)r in n&&e.call(i,n[r],r,t)}),Array.prototype.map||(Array.prototype.map=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=n.length>>>0,r=Array(i),o=arguments[1];if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");for(var s=0;i>s;s++)s in n&&(r[s]=e.call(o,n[s],s,t));return r}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,n=I(this),i=w&&"[object String]"==g(this)?this.split(""):n,r=i.length>>>0,o=[],s=arguments[1];if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");for(var a=0;r>a;a++)a in i&&(t=i[a],e.call(s,t,a,n)&&o.push(t));return o}),Array.prototype.every||(Array.prototype.every=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=n.length>>>0,r=arguments[1];if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");for(var o=0;i>o;o++)if(o in n&&!e.call(r,n[o],o,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=n.length>>>0,r=arguments[1];if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");for(var o=0;i>o;o++)if(o in n&&e.call(r,n[o],o,t))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var r,o=0;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o++];break}if(++o>=i)throw new TypeError("reduce of empty array with no initial value")}for(;i>o;o++)o in n&&(r=e.call(void 0,r,n[o],o,t));return r}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(e){var t=I(this),n=w&&"[object String]"==g(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=g(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var r,o=i-1;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o--];break}if(--o<0)throw new TypeError("reduceRight of empty array with no initial value")}do o in this&&(r=e.call(void 0,r,n[o],o,t));while(o--);return r}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(e){var t=w&&"[object String]"==g(this)?this.split(""):I(this),n=t.length>>>0;if(!n)return-1;var i=0;for(arguments.length>1&&(i=o(arguments[1])),i=i>=0?i:Math.max(0,n+i);n>i;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(e){var t=w&&"[object String]"==g(this)?this.split(""):I(this),n=t.length>>>0;if(!n)return-1;var i=n-1;for(arguments.length>1&&(i=Math.min(i,o(arguments[1]))),i=i>=0?i:n-Math.abs(i);i>=0;i--)if(i in t&&e===t[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__||(e.constructor?e.constructor.prototype:f)}),!Object.getOwnPropertyDescriptor){var b="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(e,t){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(b+e);if(m(e,t)){var n,i,r;if(n={enumerable:!0,configurable:!0},u){var o=e.__proto__;e.__proto__=f;var i=l(e,t),r=c(e,t);if(e.__proto__=o,i||r)return i&&(n.get=i),r&&(n.set=r),n}return n.value=e[t],n}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){return Object.keys(e)}),!Object.create){var _;_=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var e={};for(var t in e)e[t]=null;return e.constructor=e.hasOwnProperty=e.propertyIsEnumerable=e.isPrototypeOf=e.toLocaleString=e.toString=e.valueOf=e.__proto__=null,e},Object.create=function(e,t){var n;if(null===e)n=_();else{if("object"!=typeof e)throw new TypeError("typeof prototype["+typeof e+"] != 'object'");var i=function(){};i.prototype=e,n=new i,n.__proto__=e}return void 0!==t&&Object.defineProperties(n,t),n}}if(Object.defineProperty){var C=r({}),k="undefined"==typeof document||r(document.createElement("div"));if(!C||!k)var S=Object.defineProperty}if(!Object.defineProperty||S){var $="Property description must be an object: ",x="Object.defineProperty called on non-object: ",A="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(e,t,n){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(x+e);if("object"!=typeof n&&"function"!=typeof n||null===n)throw new TypeError($+n);if(S)try{return S.call(Object,e,t,n)}catch(i){}if(m(n,"value"))if(u&&(l(e,t)||c(e,t))){var r=e.__proto__;e.__proto__=f,delete e[t],e[t]=n.value,e.__proto__=r}else e[t]=n.value;else{if(!u)throw new TypeError(A);m(n,"get")&&s(e,t,n.get),m(n,"set")&&a(e,t,n.set)}return e}}Object.defineProperties||(Object.defineProperties=function(e,t){for(var n in t)m(t,n)&&Object.defineProperty(e,n,t[n]);return e}),Object.seal||(Object.seal=function(e){return e}),Object.freeze||(Object.freeze=function(e){return e});try{Object.freeze(function(){})}catch(T){Object.freeze=function(e){return function(t){return"function"==typeof t?t:e(t)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(e){return e}),Object.isSealed||(Object.isSealed=function(e){return!1}),Object.isFrozen||(Object.isFrozen=function(e){return!1}),Object.isExtensible||(Object.isExtensible=function(e){if(Object(e)===e)throw new TypeError;for(var t="";m(e,t);)t+="?";e[t]=!0;var n=m(e,t);return delete e[t],n}),!Object.keys){var E=!0,M=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],R=M.length;for(var L in{toString:null})E=!1;Object.keys=function q(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var q=[];for(var t in e)m(e,t)&&q.push(t);if(E)for(var n=0,i=R;i>n;n++){var r=M[n];m(e,r)&&q.push(r)}return q}}Date.now||(Date.now=function(){return(new Date).getTime()});var D="	\n\x0B\f\r \u2028\u2029\ufeff";if(!String.prototype.trim||D.trim()){D="["+D+"]";var F=new RegExp("^"+D+D+"*"),P=new RegExp(D+D+"*$");String.prototype.trim=function(){return String(this).replace(F,"").replace(P,"")}}var I=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)}}),ace.define("ace/lib/fixoldbrowsers",[],function(e,t,n){"use strict";e("./regexp"),e("./es5-shim"),"undefined"==typeof Element||Element.prototype.remove||Object.defineProperty(Element.prototype,"remove",{enumerable:!1,writable:!0,configurable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})}),ace.define("ace/lib/useragent",[],function(e,t,n){"use strict";t.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};var i="object"==typeof navigator?navigator:{},r=(/mac|win|linux/i.exec(i.platform)||["other"])[0].toLowerCase(),o=i.userAgent||"",s=i.appName||"";t.isWin="win"==r,t.isMac="mac"==r,t.isLinux="linux"==r,t.isIE="Microsoft Internet Explorer"==s||s.indexOf("MSAppHost")>=0?parseFloat((o.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((o.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),t.isOldIE=t.isIE&&t.isIE<9,t.isGecko=t.isMozilla=o.match(/ Gecko\/\d+/),t.isOpera="object"==typeof opera&&"[object Opera]"==Object.prototype.toString.call(window.opera),t.isWebKit=parseFloat(o.split("WebKit/")[1])||void 0,t.isChrome=parseFloat(o.split(" Chrome/")[1])||void 0,t.isEdge=parseFloat(o.split(" Edge/")[1])||void 0,t.isAIR=o.indexOf("AdobeAIR")>=0,t.isIPad=o.indexOf("iPad")>=0,t.isAndroid=o.indexOf("Android")>=0,t.isChromeOS=o.indexOf(" CrOS ")>=0,t.isIOS=/iPad|iPhone|iPod/.test(o)&&!window.MSStream,t.isIOS&&(t.isMac=!0),t.isMobile=t.isIPad||t.isAndroid}),ace.define("ace/lib/dom",[],function(e,t,n){"use strict";var i=e("./useragent"),r="http://www.w3.org/1999/xhtml";if(t.buildDom=function s(e,t,n){if("string"==typeof e&&e){var i=document.createTextNode(e);return t&&t.appendChild(i),i}if(!Array.isArray(e))return e;if("string"!=typeof e[0]||!e[0]){for(var r=[],o=0;o<e.length;o++){var a=s(e[o],t,n);a&&r.push(a)}return r}var l=document.createElement(e[0]),c=e[1],u=1;c&&"object"==typeof c&&!Array.isArray(c)&&(u=2);for(var o=u;o<e.length;o++)s(e[o],l,n);return 2==u&&Object.keys(c).forEach(function(e){var t=c[e];"class"===e?l.className=Array.isArray(t)?t.join(" "):t:"function"==typeof t||"value"==e?l[e]=t:"ref"===e?n&&(n[t]=l):null!=t&&l.setAttribute(e,t)}),t&&t.appendChild(l),l},t.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName("head")[0]||e.documentElement},t.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||r,e):document.createElement(e)},t.removeChildren=function(e){e.innerHTML=""},t.createTextNode=function(e,t){var n=t?t.ownerDocument:document;return n.createTextNode(e)},t.createFragment=function(e){var t=e?e.ownerDocument:document;return t.createDocumentFragment()},t.hasCssClass=function(e,t){var n=(e.className+"").split(/\s+/g);return-1!==n.indexOf(t)},t.addCssClass=function(e,n){t.hasCssClass(e,n)||(e.className+=" "+n)},t.removeCssClass=function(e,t){for(var n=e.className.split(/\s+/g);;){var i=n.indexOf(t);if(-1==i)break;n.splice(i,1)}e.className=n.join(" ")},t.toggleCssClass=function(e,t){for(var n=e.className.split(/\s+/g),i=!0;;){var r=n.indexOf(t);if(-1==r)break;i=!1,n.splice(r,1)}return i&&n.push(t),e.className=n.join(" "),i},t.setCssClass=function(e,n,i){i?t.addCssClass(e,n):t.removeCssClass(e,n)},t.hasCssString=function(e,t){var n,i=0;if(t=t||document,n=t.querySelectorAll("style"))for(;i<n.length;)if(n[i++].id===e)return!0},t.importCssString=function(e,n,i){var r=i;i&&i.getRootNode?(r=i.getRootNode(),r&&r!=i||(r=document)):r=document;var o=r.ownerDocument||r;if(n&&t.hasCssString(n,r))return null;n&&(e+="\n/*# sourceURL=ace/css/"+n+" */");var s=t.createElement("style");s.appendChild(o.createTextNode(e)),n&&(s.id=n),r==o&&(r=t.getDocumentHead(o)),r.insertBefore(s,r.firstChild)},t.importCssStylsheet=function(e,n){t.buildDom(["link",{rel:"stylesheet",href:e}],t.getDocumentHead(n))},t.scrollbarWidth=function(e){var n=t.createElement("ace_inner");n.style.width="100%",n.style.minWidth="0px",n.style.height="200px",n.style.display="block";var i=t.createElement("ace_outer"),r=i.style;r.position="absolute",r.left="-10000px",r.overflow="hidden",r.width="200px",r.minWidth="0px",r.height="150px",r.display="block",i.appendChild(n);var o=e.documentElement;o.appendChild(i);var s=n.offsetWidth;r.overflow="scroll";var a=n.offsetWidth;return s==a&&(a=i.clientWidth),o.removeChild(i),s-a},"undefined"==typeof document&&(t.importCssString=function(){}),t.computedStyle=function(e,t){return window.getComputedStyle(e,"")||{}},t.setStyle=function(e,t,n){e[t]!==n&&(e[t]=n)},t.HAS_CSS_ANIMATION=!1,t.HAS_CSS_TRANSFORMS=!1,t.HI_DPI=i.isWin?"undefined"!=typeof window&&window.devicePixelRatio>=1.5:!0,"undefined"!=typeof document){var o=document.createElement("div");t.HI_DPI&&void 0!==o.style.transform&&(t.HAS_CSS_TRANSFORMS=!0),i.isEdge||"undefined"==typeof o.style.animationName||(t.HAS_CSS_ANIMATION=!0),o=null}t.HAS_CSS_TRANSFORMS?t.translate=function(e,t,n){e.style.transform="translate("+Math.round(t)+"px, "+Math.round(n)+"px)"}:t.translate=function(e,t,n){e.style.top=Math.round(n)+"px",e.style.left=Math.round(t)+"px"}}),ace.define("ace/lib/oop",[],function(e,t,n){"use strict";t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.mixin=function(e,t){for(var n in t)e[n]=t[n];return e},t.implement=function(e,n){t.mixin(e,n)}}),ace.define("ace/lib/keys",[],function(e,t,n){"use strict";var i=e("./oop"),r=function(){var e,t,n={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,"super":8,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};for(t in n.FUNCTION_KEYS)e=n.FUNCTION_KEYS[t].toLowerCase(),n[e]=parseInt(t,10);for(t in n.PRINTABLE_KEYS)e=n.PRINTABLE_KEYS[t].toLowerCase(),n[e]=parseInt(t,10);return i.mixin(n,n.MODIFIER_KEYS),i.mixin(n,n.PRINTABLE_KEYS),i.mixin(n,n.FUNCTION_KEYS),n.enter=n["return"],n.escape=n.esc,n.del=n["delete"],n[173]="-",function(){for(var e=["cmd","ctrl","alt","shift"],t=Math.pow(2,e.length);t--;)n.KEY_MODS[t]=e.filter(function(e){
return t&n.KEY_MODS[e]}).join("-")+"-"}(),n.KEY_MODS[0]="",n.KEY_MODS[-1]="input-",n}();i.mixin(t,r),t.keyCodeToString=function(e){var t=r[e];return"string"!=typeof t&&(t=String.fromCharCode(e)),t.toLowerCase()}}),ace.define("ace/lib/event",[],function(e,t,n){"use strict";function i(e,t,n){var i=c(t);if(!s.isMac&&a){if(t.getModifierState&&(t.getModifierState("OS")||t.getModifierState("Win"))&&(i|=8),a.altGr){if(3==(3&i))return;a.altGr=0}if(18===n||17===n){var r="location"in t?t.location:t.keyLocation;if(17===n&&1===r)1==a[n]&&(l=t.timeStamp);else if(18===n&&3===i&&2===r){var u=t.timeStamp-l;50>u&&(a.altGr=!0)}}}if(n in o.MODIFIER_KEYS&&(n=-1),8&i&&n>=91&&93>=n&&(n=-1),!i&&13===n){var r="location"in t?t.location:t.keyLocation;if(3===r&&(e(t,i,-n),t.defaultPrevented))return}if(s.isChromeOS&&8&i){if(e(t,i,n),t.defaultPrevented)return;i&=-9}return i||n in o.FUNCTION_KEYS||n in o.PRINTABLE_KEYS?e(t,i,n):!1}function r(){a=Object.create(null)}var o=e("./keys"),s=e("./useragent"),a=null,l=0;t.addListener=function(e,t,n){if(e.addEventListener)return e.addEventListener(t,n,!1);if(e.attachEvent){var i=function(){n.call(e,window.event)};n._wrapper=i,e.attachEvent("on"+t,i)}},t.removeListener=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):void(e.detachEvent&&e.detachEvent("on"+t,n._wrapper||n))},t.stopEvent=function(e){return t.stopPropagation(e),t.preventDefault(e),!1},t.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},t.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},t.getButton=function(e){return"dblclick"==e.type?0:"contextmenu"==e.type||s.isMac&&e.ctrlKey&&!e.altKey&&!e.shiftKey?2:e.preventDefault?e.button:{1:0,2:2,4:1}[e.button]},t.capture=function(e,n,i){function r(e){n&&n(e),i&&i(e),t.removeListener(document,"mousemove",n,!0),t.removeListener(document,"mouseup",r,!0),t.removeListener(document,"dragstart",r,!0)}return t.addListener(document,"mousemove",n,!0),t.addListener(document,"mouseup",r,!0),t.addListener(document,"dragstart",r,!0),r},t.addMouseWheelListener=function(e,n){"onmousewheel"in e?t.addListener(e,"mousewheel",function(e){var t=8;void 0!==e.wheelDeltaX?(e.wheelX=-e.wheelDeltaX/t,e.wheelY=-e.wheelDeltaY/t):(e.wheelX=0,e.wheelY=-e.wheelDelta/t),n(e)}):"onwheel"in e?t.addListener(e,"wheel",function(e){var t=.35;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=e.deltaX*t||0,e.wheelY=e.deltaY*t||0;break;case e.DOM_DELTA_LINE:case e.DOM_DELTA_PAGE:e.wheelX=5*(e.deltaX||0),e.wheelY=5*(e.deltaY||0)}n(e)}):t.addListener(e,"DOMMouseScroll",function(e){e.axis&&e.axis==e.HORIZONTAL_AXIS?(e.wheelX=5*(e.detail||0),e.wheelY=0):(e.wheelX=0,e.wheelY=5*(e.detail||0)),n(e)})},t.addMultiMouseDownListener=function(e,n,i,r){function o(e){if(0!==t.getButton(e)?d=0:e.detail>1?(d++,d>4&&(d=1)):d=1,s.isIE){var o=Math.abs(e.clientX-l)>5||Math.abs(e.clientY-c)>5;(!u||o)&&(d=1),u&&clearTimeout(u),u=setTimeout(function(){u=null},n[d-1]||600),1==d&&(l=e.clientX,c=e.clientY)}if(e._clicks=d,i[r]("mousedown",e),d>4)d=0;else if(d>1)return i[r](h[d],e)}function a(e){d=2,u&&clearTimeout(u),u=setTimeout(function(){u=null},n[d-1]||600),i[r]("mousedown",e),i[r](h[d],e)}var l,c,u,d=0,h={2:"dblclick",3:"tripleclick",4:"quadclick"};Array.isArray(e)||(e=[e]),e.forEach(function(e){t.addListener(e,"mousedown",o),s.isOldIE&&t.addListener(e,"dblclick",a)})};var c=!s.isMac||!s.isOpera||"KeyboardEvent"in window?function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)}:function(e){return 0|(e.metaKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.ctrlKey?8:0)};if(t.getModifierString=function(e){return o.KEY_MODS[c(e)]},t.addCommandKeyListener=function(e,n){var o=t.addListener;if(s.isOldGecko||s.isOpera&&!("KeyboardEvent"in window)){var l=null;o(e,"keydown",function(e){l=e.keyCode}),o(e,"keypress",function(e){return i(n,e,l)})}else{var c=null;o(e,"keydown",function(e){a[e.keyCode]=(a[e.keyCode]||0)+1;var t=i(n,e,e.keyCode);return c=e.defaultPrevented,t}),o(e,"keypress",function(e){c&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(t.stopEvent(e),c=null)}),o(e,"keyup",function(e){a[e.keyCode]=null}),a||(r(),o(window,"focus",r))}},"object"==typeof window&&window.postMessage&&!s.isOldIE){var u=1;t.nextTick=function(e,n){n=n||window;var i="zero-timeout-message-"+u++,r=function(o){o.data==i&&(t.stopPropagation(o),t.removeListener(n,"message",r),e())};t.addListener(n,"message",r),n.postMessage(i,"*")}}t.$idleBlocked=!1,t.onIdle=function(e,n){return setTimeout(function i(){t.$idleBlocked?setTimeout(i,100):e()},n)},t.$idleBlockId=null,t.blockIdle=function(e){t.$idleBlockId&&clearTimeout(t.$idleBlockId),t.$idleBlocked=!0,t.$idleBlockId=setTimeout(function(){t.$idleBlocked=!1},e||100)},t.nextFrame="object"==typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),t.nextFrame?t.nextFrame=t.nextFrame.bind(window):t.nextFrame=function(e){setTimeout(e,17)}}),ace.define("ace/range",[],function(e,t,n){"use strict";var i=function(e,t){return e.row-t.row||e.column-t.column},r=function(e,t,n,i){this.start={row:e,column:t},this.end={row:n,column:i}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(e,t){return 0==this.compare(e,t)},this.compareRange=function(e){var t,n=e.end,i=e.start;return t=this.compare(n.row,n.column),1==t?(t=this.compare(i.row,i.column),1==t?2:0==t?1:0):-1==t?-2:(t=this.compare(i.row,i.column),-1==t?-1:1==t?42:0)},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return 0==this.comparePoint(e.start)&&0==this.comparePoint(e.end)},this.intersects=function(e){var t=this.compareRange(e);return-1==t||0==t||1==t},this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t},this.isStart=function(e,t){return this.start.row==e&&this.start.column==t},this.setStart=function(e,t){"object"==typeof e?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){"object"==typeof e?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return 0==this.compare(e,t)?this.isEnd(e,t)||this.isStart(e,t)?!1:!0:!1},this.insideStart=function(e,t){return 0==this.compare(e,t)?this.isEnd(e,t)?!1:!0:!1},this.insideEnd=function(e,t){return 0==this.compare(e,t)?this.isStart(e,t)?!1:!0:!1},this.compare=function(e,t){return this.isMultiLine()||e!==this.start.row?e<this.start.row?-1:e>this.end.row?1:this.start.row===e?t>=this.start.column?0:-1:this.end.row===e?t<=this.end.column?0:1:0:t<this.start.column?-1:t>this.end.column?1:0},this.compareStart=function(e,t){return this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&&this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&&this.end.column==t?1:this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){if(this.end.row>t)var n={row:t+1,column:0};else if(this.end.row<e)var n={row:e,column:0};if(this.start.row>t)var i={row:t+1,column:0};else if(this.start.row<e)var i={row:e,column:0};return r.fromPoints(i||this.start,n||this.end)},this.extend=function(e,t){var n=this.compare(e,t);if(0==n)return this;if(-1==n)var i={row:e,column:t};else var o={row:e,column:t};return r.fromPoints(i||this.start,o||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return r.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new r(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new r(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),n=e.documentToScreenPosition(this.end);return new r(t.row,t.column,n.row,n.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(r.prototype),r.fromPoints=function(e,t){return new r(e.row,e.column,t.row,t.column)},r.comparePoints=i,r.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=r}),ace.define("ace/lib/lang",[],function(e,t,n){"use strict";t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split("").reverse().join("")},t.stringRepeat=function(e,t){for(var n="";t>0;)1&t&&(n+=e),(t>>=1)&&(e+=e);return n};var i=/^\s\s*/,r=/\s\s*$/;t.stringTrimLeft=function(e){return e.replace(i,"")},t.stringTrimRight=function(e){return e.replace(r,"")},t.copyObject=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.copyArray=function(e){for(var t=[],n=0,i=e.length;i>n;n++)e[n]&&"object"==typeof e[n]?t[n]=this.copyObject(e[n]):t[n]=e[n];return t},t.deepCopy=function o(e){if("object"!=typeof e||!e)return e;var t;if(Array.isArray(e)){t=[];for(var n=0;n<e.length;n++)t[n]=o(e[n]);return t}if("[object Object]"!==Object.prototype.toString.call(e))return e;t={};for(var n in e)t[n]=o(e[n]);return t},t.arrayToMap=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=1;return t},t.createMap=function(e){var t=Object.create(null);for(var n in e)t[n]=e[n];return t},t.arrayRemove=function(e,t){for(var n=0;n<=e.length;n++)t===e[n]&&e.splice(n,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},t.escapeHTML=function(e){return(""+e).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},t.getMatchOffsets=function(e,t){var n=[];return e.replace(t,function(e){n.push({offset:arguments[arguments.length-2],length:e.length})}),n},t.deferredCall=function(e){var t=null,n=function(){t=null,e()},i=function(e){return i.cancel(),t=setTimeout(n,e||0),i};return i.schedule=i,i.call=function(){return this.cancel(),e(),i},i.cancel=function(){return clearTimeout(t),t=null,i},i.isPending=function(){return t},i},t.delayedCall=function(e,t){var n=null,i=function(){n=null,e()},r=function(e){null==n&&(n=setTimeout(i,e||t))};return r.delay=function(e){n&&clearTimeout(n),n=setTimeout(i,e||t)},r.schedule=r,r.call=function(){this.cancel(),e()},r.cancel=function(){n&&clearTimeout(n),n=null},r.isPending=function(){return n},r}}),ace.define("ace/keyboard/textinput",[],function(e,t,n){"use strict";var i=e("../lib/event"),r=e("../lib/useragent"),o=e("../lib/dom"),s=e("../lib/lang"),a=r.isChrome<18,l=r.isIE,c=r.isChrome>63,u=400,d=e("../lib/keys"),h=d.KEY_MODS,f=r.isIOS,p=f?/\s/:/\n/,g=function(e,t){function n(){x=!0,y.blur(),y.focus(),x=!1}function g(e){27==e.keyCode&&y.value.length<y.selectionStart&&(_||(A=y.value),T=E=-1,L()),G()}function m(){clearTimeout(K),K=setTimeout(function(){k&&(y.style.cssText=k,k=""),t.renderer.$isMousePressed=!1,t.renderer.$keepTextAreaAtCursor&&t.renderer.$moveTextAreaToCursor()},0)}function v(e,t,n){var i=null,r=!1;n.addEventListener("keydown",function(e){i&&clearTimeout(i),r=!0},!0),n.addEventListener("keyup",function(e){i=setTimeout(function(){r=!1},100)},!0);var o=function(e){if(document.activeElement===n&&!(r||_||t.$mouseHandler.isMousePressed||w)){var i=n.selectionStart,o=n.selectionEnd,s=null,a=0;console.log(i,o),0==i?s=d.up:1==i?s=d.home:o>E&&"\n"==A[o]?s=d.end:T>i&&" "==A[i-1]?(s=d.left,a=h.option):T>i||i==T&&E!=T&&i==o?s=d.left:o>E&&A.slice(0,o).split("\n").length>2?s=d.down:o>E&&" "==A[o-1]?(s=d.right,a=h.option):(o>E||o==E&&E!=T&&i==o)&&(s=d.right),i!==o&&(a|=h.shift),s&&(t.onCommandKey(null,a,s),T=i,E=o,L(""))}};document.addEventListener("selectionchange",o),t.on("destroy",function(){document.removeEventListener("selectionchange",o)})}var y=o.createElement("textarea");y.className="ace_text-input",y.setAttribute("wrap","off"),y.setAttribute("autocorrect","off"),y.setAttribute("autocapitalize","off"),y.setAttribute("spellcheck",!1),y.style.opacity="0",e.insertBefore(y,e.firstChild);var w=!1,b=!1,_=!1,C=!1,k="",S=!1;r.isMobile||(y.style.fontSize="1px");var $=!1,x=!1,A="",T=0,E=0;try{var M=document.activeElement===y}catch(R){}i.addListener(y,"blur",function(e){x||(t.onBlur(e),M=!1)}),i.addListener(y,"focus",function(e){if(!x){if(M=!0,r.isEdge)try{if(!document.hasFocus())return}catch(e){}t.onFocus(e),r.isEdge?setTimeout(L):L()}}),this.$focusScroll=!1,this.focus=function(){if(k||c||"browser"==this.$focusScroll)return y.focus({preventScroll:!0});var e=y.style.top;y.style.position="fixed",y.style.top="0px";try{var t=0!=y.getBoundingClientRect().top}catch(n){return}var i=[];if(t)for(var r=y.parentElement;r&&1==r.nodeType;)i.push(r),r.setAttribute("ace_nocontext",!0),r=!r.parentElement&&r.getRootNode?r.getRootNode().host:r.parentElement;y.focus({preventScroll:!0}),t&&i.forEach(function(e){e.removeAttribute("ace_nocontext")}),setTimeout(function(){y.style.position="","0px"==y.style.top&&(y.style.top=e)},0)},this.blur=function(){y.blur()},this.isFocused=function(){return M},t.on("beforeEndOperation",function(){t.curOp&&"insertstring"==t.curOp.command.name||(_&&(A=y.value="",V()),L())});var L=f?function(e){if(M&&(!w||e)&&!C){e||(e="");var n="\n ab"+e+"cde fg\n";n!=y.value&&(y.value=A=n);var i=4,r=4+(e.length||(t.selection.isEmpty()?0:1));(T!=i||E!=r)&&y.setSelectionRange(i,r),T=i,E=r}}:function(){if(!_&&!C&&(M||I)){_=!0;var e=t.selection,n=e.getRange(),i=e.cursor.row,r=n.start.column,o=n.end.column,s=t.session.getLine(i);if(n.start.row!=i){var a=t.session.getLine(i-1);r=n.start.row<i-1?0:r,o+=a.length+1,s=a+"\n"+s}else if(n.end.row!=i){var l=t.session.getLine(i+1);o=n.end.row>i+1?l.length:o,o+=s.length+1,s=s+"\n"+l}s.length>u&&(u>r&&u>o?s=s.slice(0,u):(s="\n",r=0,o=1));var c=s+"\n\n";if(c!=A&&(y.value=A=c,T=E=c.length),I&&(T=y.selectionStart,E=y.selectionEnd),E!=o||T!=r||y.selectionEnd!=E)try{y.setSelectionRange(r,o),T=r,E=o}catch(d){}_=!1}};M&&t.onFocus();var D=function(e){return 0===e.selectionStart&&e.selectionEnd>=A.length&&e.value===A&&A&&e.selectionEnd!==E},F=function(e){_||(w?w=!1:D(y)&&(t.selectAll(),L()))},P=null;this.setInputHandler=function(e){P=e},this.getInputHandler=function(){return P};var I=!1,q=function(e,n){if(I&&(I=!1),b)return L(),e&&t.onPaste(e),b=!1,"";for(var i=y.selectionStart,r=y.selectionEnd,o=T,s=A.length-E,a=e,l=e.length-i,c=e.length-r,u=0;o>0&&A[u]==e[u];)u++,o--;for(a=a.slice(u),u=1;s>0&&A.length-u>T-1&&A[A.length-u]==e[e.length-u];)u++,s--;return l-=u-1,c-=u-1,a=a.slice(0,a.length-u+1),n||l!=a.length||o||s||c?(C=!0,a&&!o&&!s&&!l&&!c||$?t.onTextInput(a):t.onTextInput(a,{extendLeft:o,extendRight:s,restoreStart:l,restoreEnd:c}),C=!1,A=e,T=i,E=r,a):""},O=function(e){if(_)return W();var t=y.value,n=q(t,!0);(t.length>u+100||p.test(n))&&L()},B=function(e,t,n){var i=e.clipboardData||window.clipboardData;if(i&&!a){var r=l||n?"Text":"text/plain";try{return t?i.setData(r,t)!==!1:i.getData(r)}catch(e){if(!n)return B(e,t,!0)}}},H=function(e,n){var r=t.getCopyText();return r?void(B(e,r)?(f&&(L(r),w=r,setTimeout(function(){w=!1},10)),n?t.onCut():t.onCopy(),i.preventDefault(e)):(w=!0,y.value=r,y.select(),setTimeout(function(){w=!1,L(),n?t.onCut():t.onCopy()}))):i.preventDefault(e)},N=function(e){H(e,!0)},z=function(e){H(e,!1)},U=function(e){var n=B(e);"string"==typeof n?(n&&t.onPaste(n,e),r.isIE&&setTimeout(L),i.preventDefault(e)):(y.value="",b=!0)};i.addCommandKeyListener(y,t.onCommandKey.bind(t)),i.addListener(y,"select",F),i.addListener(y,"input",O),i.addListener(y,"cut",N),i.addListener(y,"copy",z),i.addListener(y,"paste",U),"oncut"in y&&"oncopy"in y&&"onpaste"in y||i.addListener(e,"keydown",function(e){if((!r.isMac||e.metaKey)&&e.ctrlKey)switch(e.keyCode){case 67:z(e);break;case 86:U(e);break;case 88:N(e)}});var j=function(e){if(!_&&t.onCompositionStart&&!t.$readOnly&&(_={},!$)){setTimeout(W,0),t.on("mousedown",n);var i=t.getSelectionRange();i.end.row=i.start.row,i.end.column=i.start.column,_.markerRange=i,_.selectionStart=T,t.onCompositionStart(_),_.useTextareaForIME?(y.value="",A="",T=0,E=0):(y.msGetInputContext&&(_.context=y.msGetInputContext()),y.getInputContext&&(_.context=y.getInputContext()))}},W=function(){if(_&&t.onCompositionUpdate&&!t.$readOnly){if($)return n();if(_.useTextareaForIME)t.onCompositionUpdate(y.value);else{var e=y.value;q(e),_.markerRange&&(_.context&&(_.markerRange.start.column=_.selectionStart=_.context.compositionStartOffset),_.markerRange.end.column=_.markerRange.start.column+E-_.selectionStart)}}},V=function(e){t.onCompositionEnd&&!t.$readOnly&&(_=!1,t.onCompositionEnd(),t.off("mousedown",n),e&&O())},G=s.delayedCall(W,50).schedule.bind(null,null);i.addListener(y,"compositionstart",j),i.addListener(y,"compositionupdate",W),i.addListener(y,"keyup",g),i.addListener(y,"keydown",G),i.addListener(y,"compositionend",V),this.getElement=function(){return y},this.setCommandMode=function(e){$=e,y.readOnly=!1},this.setReadOnly=function(e){$||(y.readOnly=e)},this.setCopyWithEmptySelection=function(e){S=e},this.onContextMenu=function(e){I=!0,L(),t._emit("nativecontextmenu",{target:t,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,n){k||(k=y.style.cssText),y.style.cssText=(n?"z-index:100000;":"")+(r.isIE?"opacity:0.1;":"")+"text-indent: -"+(T+E)*t.renderer.characterWidth*.5+"px;";var s=t.container.getBoundingClientRect(),a=o.computedStyle(t.container),l=s.top+(parseInt(a.borderTopWidth)||0),c=s.left+(parseInt(s.borderLeftWidth)||0),u=s.bottom-l-y.clientHeight-2,d=function(e){o.translate(y,e.clientX-c-2,Math.min(e.clientY-l-2,u))};d(e),"mousedown"==e.type&&(t.renderer.$isMousePressed=!0,clearTimeout(K),r.isWin&&i.capture(t.container,d,m))},this.onContextMenuClose=m;var K,Y=function(e){t.textInput.onContextMenu(e),m()};i.addListener(y,"mouseup",Y),i.addListener(y,"mousedown",function(e){e.preventDefault(),m()}),i.addListener(t.renderer.scroller,"contextmenu",Y),i.addListener(y,"contextmenu",Y),f&&v(e,t,y)};t.TextInput=g}),ace.define("ace/mouse/default_handlers",[],function(e,t,n){"use strict";function i(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e)),t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e)),t.setDefaultHandler("tripleclick",this.onTripleClick.bind(e)),t.setDefaultHandler("quadclick",this.onQuadClick.bind(e)),t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e));var n=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];n.forEach(function(t){e[t]=this[t]},this),e.selectByLines=this.extendSelectionBy.bind(e,"getLineRange"),e.selectByWords=this.extendSelectionBy.bind(e,"getWordRange")}function r(e,t,n,i){return Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))}function o(e,t){if(e.start.row==e.end.row)var n=2*t.column-e.start.column-e.end.column;else if(e.start.row!=e.end.row-1||e.start.column||e.end.column)var n=2*t.row-e.start.row-e.end.row;else var n=t.column-4;return 0>n?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}var s=e("../lib/useragent"),a=0,l=550;(function(){this.onMouseDown=function(e){var t=e.inSelection(),n=e.getDocumentPosition();this.mousedownEvent=e;var i=this.editor,r=e.getButton();if(0!==r){var o=i.getSelectionRange(),a=o.isEmpty();return(a||1==r)&&i.selection.moveToPosition(n),void(2==r&&(i.textInput.onContextMenu(e.domEvent),s.isMozilla||e.preventDefault()))}return this.mousedownEvent.time=Date.now(),!t||i.isFocused()||(i.focus(),!this.$focusTimeout||this.$clickSelection||i.inMultiSelectMode)?(this.captureMouse(e),this.startSelect(n,e.domEvent._clicks>1),e.preventDefault()):(this.setState("focusWait"),void this.captureMouse(e))},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var n=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?n.selection.selectToPosition(e):t||n.selection.moveToPosition(e),t||this.select(),n.renderer.scroller.setCapture&&n.renderer.scroller.setCapture(),n.setStyle("ace_selecting"),this.setState("select"))},this.select=function(){var e,t=this.editor,n=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var i=this.$clickSelection.comparePoint(n);if(-1==i)e=this.$clickSelection.end;else if(1==i)e=this.$clickSelection.start;else{var r=o(this.$clickSelection,n);n=r.cursor,e=r.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(n),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,n=this.editor,i=n.renderer.screenToTextCoordinates(this.x,this.y),r=n.selection[e](i.row,i.column);if(this.$clickSelection){var s=this.$clickSelection.comparePoint(r.start),a=this.$clickSelection.comparePoint(r.end);if(-1==s&&0>=a)t=this.$clickSelection.end,(r.end.row!=i.row||r.end.column!=i.column)&&(i=r.start);else if(1==a&&s>=0)t=this.$clickSelection.start,(r.start.row!=i.row||r.start.column!=i.column)&&(i=r.end);else if(-1==s&&1==a)i=r.end,t=r.start;else{var l=o(this.$clickSelection,i);i=l.cursor,t=l.anchor}n.selection.setSelectionAnchor(t.row,t.column)}n.selection.selectToPosition(i),n.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e=r(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),t=Date.now();(e>a||t-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),n=this.editor,i=n.session,r=i.getBracketRange(t);r?(r.isEmpty()&&(r.start.column--,r.end.column++),this.setState("select")):(r=n.selection.getWordRange(t.row,t.column),this.setState("selectByWords")),this.$clickSelection=r,this.select()},this.onTripleClick=function(e){var t=e.getDocumentPosition(),n=this.editor;this.setState("selectByLines");var i=n.getSelectionRange();i.isMultiLine()&&i.contains(t.row,t.column)?(this.$clickSelection=n.selection.getLineRange(i.start.row),this.$clickSelection.end=n.selection.getLineRange(i.end.row).end):this.$clickSelection=n.selection.getLineRange(t.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){if(!e.getAccelKey()){e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0);var t=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var n=this.$lastScroll,i=e.domEvent.timeStamp,r=i-n.t,o=r?e.wheelX/r:n.vx,s=r?e.wheelY/r:n.vy;l>r&&(o=(o+n.vx)/2,s=(s+n.vy)/2);var a=Math.abs(o/s),c=!1;if(a>=1&&t.renderer.isScrollableBy(e.wheelX*e.speed,0)&&(c=!0),1>=a&&t.renderer.isScrollableBy(0,e.wheelY*e.speed)&&(c=!0),c)n.allowed=i;else if(i-n.allowed<l){var u=Math.abs(o)<=1.5*Math.abs(n.vx)&&Math.abs(s)<=1.5*Math.abs(n.vy);u?(c=!0,n.allowed=i):n.allowed=0}return n.t=i,n.vx=o,n.vy=s,c?(t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()):void 0}}}).call(i.prototype),t.DefaultHandlers=i}),ace.define("ace/tooltip",[],function(e,t,n){"use strict";function i(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}var r=(e("./lib/oop"),e("./lib/dom"));(function(){this.$init=function(){return this.$element=r.createElement("div"),this.$element.className="ace_tooltip",this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){this.getElement().textContent=e},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+"px",this.getElement().style.top=t+"px"},this.setClassName=function(e){r.addCssClass(this.getElement(),e)},this.show=function(e,t,n){null!=e&&this.setText(e),null!=t&&null!=n&&this.setPosition(t,n),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth},this.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)}}).call(i.prototype),t.Tooltip=i}),ace.define("ace/mouse/default_gutter_handler",[],function(e,t,n){"use strict";function i(e){function t(){var t=d.getDocumentPosition().row,r=l.$annotations[t];if(!r)return n();var o=s.session.getLength();if(t==o){var a=s.renderer.pixelToScreenCoordinates(0,d.y).row,u=d.$pos;if(a>s.session.documentToScreenRow(u.row,u.column))return n()}if(h!=r)if(h=r.text.join("<br/>"),c.setHtml(h),c.show(),s._signal("showGutterTooltip",c),s.on("mousewheel",n),e.$tooltipFollowsMouse)i(d);else{var f=d.domEvent.target,p=f.getBoundingClientRect(),g=c.getElement().style;g.left=p.right+"px",g.top=p.bottom+"px"}}function n(){u&&(u=clearTimeout(u)),h&&(c.hide(),h=null,s._signal("hideGutterTooltip",c),s.removeEventListener("mousewheel",n))}function i(e){c.setPosition(e.x,e.y)}var s=e.editor,l=s.renderer.$gutterLayer,c=new r(s.container);e.editor.setDefaultHandler("guttermousedown",function(t){if(s.isFocused()&&0==t.getButton()){var n=l.getRegion(t);if("foldWidgets"!=n){var i=t.getDocumentPosition().row,r=s.session.selection;if(t.getShiftKey())r.selectTo(i,0);else{if(2==t.domEvent.detail)return s.selectAll(),t.preventDefault();e.$clickSelection=s.selection.getLineRange(i)}return e.setState("selectByLines"),e.captureMouse(t),t.preventDefault()}}});var u,d,h;e.editor.setDefaultHandler("guttermousemove",function(r){var s=r.domEvent.target||r.domEvent.srcElement;return o.hasCssClass(s,"ace_fold-widget")?n():(h&&e.$tooltipFollowsMouse&&i(r),d=r,void(u||(u=setTimeout(function(){u=null,d&&!e.isMousePressed?t():n()},50))))}),a.addListener(s.renderer.$gutter,"mouseout",function(e){d=null,h&&!u&&(u=setTimeout(function(){u=null,n()},50))}),s.on("changeSession",n)}function r(e){l.call(this,e)}var o=e("../lib/dom"),s=e("../lib/oop"),a=e("../lib/event"),l=e("../tooltip").Tooltip;s.inherits(r,l),function(){this.setPosition=function(e,t){var n=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight,r=this.getWidth(),o=this.getHeight();e+=15,t+=15,e+r>n&&(e-=e+r-n),t+o>i&&(t-=20+o),l.prototype.setPosition.call(this,e,t)}}.call(r.prototype),t.GutterHandler=i}),ace.define("ace/mouse/mouse_event",[],function(e,t,n){"use strict";var i=e("../lib/event"),r=e("../lib/useragent"),o=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){i.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){i.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){if(null!==this.$inSelection)return this.$inSelection;var e=this.editor,t=e.getSelectionRange();if(t.isEmpty())this.$inSelection=!1;else{var n=this.getDocumentPosition();this.$inSelection=t.contains(n.row,n.column)}return this.$inSelection},this.getButton=function(){return i.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=r.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(o.prototype)}),ace.define("ace/mouse/dragdrop_handler",[],function(e,t,n){"use strict";function i(e){function t(e,t){var n=Date.now(),i=!t||e.row!=t.row,o=!t||e.column!=t.column;if(!T||i||o)m.moveCursorToPosition(e),T=n,E={x:b,y:_};else{var s=r(E.x,E.y,b,_);s>u?T=null:n-T>=c&&(m.renderer.scrollCursorIntoView(),T=null)}}function n(e,t){var n=Date.now(),i=m.renderer.layerConfig.lineHeight,r=m.renderer.layerConfig.characterWidth,o=m.renderer.scroller.getBoundingClientRect(),s={x:{left:b-o.left,right:o.right-b},y:{top:_-o.top,bottom:o.bottom-_}},a=Math.min(s.x.left,s.x.right),c=Math.min(s.y.top,s.y.bottom),u={row:e.row,column:e.column};2>=a/r&&(u.column+=s.x.left<s.x.right?-3:2),1>=c/i&&(u.row+=s.y.top<s.y.bottom?-1:1);var d=e.row!=u.row,h=e.column!=u.column,f=!t||e.row!=t.row;d||h&&!f?A?n-A>=l&&m.renderer.scrollCursorIntoView(u):A=n:A=null}function i(){var e=S;S=m.renderer.screenToTextCoordinates(b,_),t(S,e),n(S,e)}function d(){k=m.selection.toOrientedRange(),w=m.session.addMarker(k,"ace_selection",m.getSelectionStyle()),m.clearSelection(),m.isFocused()&&m.renderer.$cursorLayer.setBlinking(!1),clearInterval(C),i(),C=setInterval(i,20),R=0,s.addListener(document,"mousemove",f)}function h(){clearInterval(C),m.session.removeMarker(w),w=null,m.selection.fromOrientedRange(k),m.isFocused()&&!x&&m.$resetCursorStyle(),k=null,S=null,R=0,A=null,T=null,s.removeListener(document,"mousemove",f)}function f(){null==L&&(L=setTimeout(function(){null!=L&&w&&h()},20))}function p(e){var t=e.types;return!t||Array.prototype.some.call(t,function(e){return"text/plain"==e||"Text"==e})}function g(e){var t=["copy","copymove","all","uninitialized"],n=["move","copymove","linkmove","all","uninitialized"],i=a.isMac?e.altKey:e.ctrlKey,r="uninitialized";try{r=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var o="none";return i&&t.indexOf(r)>=0?o="copy":n.indexOf(r)>=0?o="move":t.indexOf(r)>=0&&(o="copy"),o}var m=e.editor,v=o.createElement("img");v.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.isOpera&&(v.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;");var y=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];y.forEach(function(t){e[t]=this[t]},this),m.addEventListener("mousedown",this.onMouseDown.bind(e));var w,b,_,C,k,S,$,x,A,T,E,M=m.container,R=0;this.onDragStart=function(e){if(this.cancelDrag||!M.draggable){var t=this;return setTimeout(function(){t.startSelect(),t.captureMouse(e)},0),e.preventDefault()}k=m.getSelectionRange();var n=e.dataTransfer;n.effectAllowed=m.getReadOnly()?"copy":"copyMove",a.isOpera&&(m.container.appendChild(v),v.scrollTop=0),n.setDragImage&&n.setDragImage(v,0,0),a.isOpera&&m.container.removeChild(v),n.clearData(),n.setData("Text",m.session.getTextRange()),x=!0,this.setState("drag")},this.onDragEnd=function(e){if(M.draggable=!1,x=!1,this.setState(null),!m.getReadOnly()){var t=e.dataTransfer.dropEffect;$||"move"!=t||m.session.remove(m.getSelectionRange()),m.$resetCursorStyle()}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){return!m.getReadOnly()&&p(e.dataTransfer)?(b=e.clientX,_=e.clientY,w||d(),R++,e.dataTransfer.dropEffect=$=g(e),s.preventDefault(e)):void 0},this.onDragOver=function(e){return!m.getReadOnly()&&p(e.dataTransfer)?(b=e.clientX,_=e.clientY,w||(d(),R++),null!==L&&(L=null),e.dataTransfer.dropEffect=$=g(e),s.preventDefault(e)):void 0},this.onDragLeave=function(e){return R--,0>=R&&w?(h(),$=null,s.preventDefault(e)):void 0},this.onDrop=function(e){if(S){var t=e.dataTransfer;if(x)switch($){case"move":k=k.contains(S.row,S.column)?{start:S,end:S}:m.moveText(k,S);break;case"copy":k=m.moveText(k,S,!0)}else{var n=t.getData("Text");k={start:S,end:m.session.insert(S,n)},m.focus(),$=null}return h(),s.preventDefault(e)}},s.addListener(M,"dragstart",this.onDragStart.bind(e)),s.addListener(M,"dragend",this.onDragEnd.bind(e)),s.addListener(M,"dragenter",this.onDragEnter.bind(e)),s.addListener(M,"dragover",this.onDragOver.bind(e)),s.addListener(M,"dragleave",this.onDragLeave.bind(e)),
s.addListener(M,"drop",this.onDrop.bind(e));var L=null}function r(e,t,n,i){return Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))}var o=e("../lib/dom"),s=e("../lib/event"),a=e("../lib/useragent"),l=200,c=200,u=5;(function(){this.dragWait=function(){var e=Date.now()-this.mousedownEvent.time;e>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){var e=this.editor.container;e.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor,t=e.container;t.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle("ace_dragging");var n=a.isWin?"default":"move";e.renderer.setCursorStyle(n),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;if(a.isIE&&"dragReady"==this.state){var n=r(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>3&&t.dragDrop()}if("dragWait"===this.state){var n=r(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>0&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(e){if(this.$dragEnabled){this.mousedownEvent=e;var t=this.editor,n=e.inSelection(),i=e.getButton(),r=e.domEvent.detail||1;if(1===r&&0===i&&n){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var o=e.domEvent.target||e.domEvent.srcElement;if("unselectable"in o&&(o.unselectable="on"),t.getDragDelay()){if(a.isWebKit){this.cancelDrag=!0;var s=t.container;s.draggable=!0}this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}}).call(i.prototype),t.DragdropHandler=i}),ace.define("ace/mouse/touch_handler",[],function(e,t,n){"use strict";var i=e("./mouse_event").MouseEvent;t.addTouchListeners=function(e,t){function n(){u=null,clearTimeout(u),t.selection.isEmpty()&&t.selection.moveToPosition(h),p="wait"}function r(){u=null,clearTimeout(u),t.selection.moveToPosition(h);var e=m>=2?t.selection.getLineRange(h.row):t.session.getBracketRange(h);e&&!e.isEmpty()?t.selection.setRange(e):t.selection.selectWord(),p="wait"}function o(){g+=60,d=setInterval(function(){g--<=0&&(clearInterval(d),d=null),Math.abs(v)<.01&&(v=0),Math.abs(y)<.01&&(y=0),20>g&&(v=.9*v),20>g&&(y=.9*y),t.renderer.scrollBy(10*v,10*y)},10)}var s,a,l,c,u,d,h,f,p="scroll",g=0,m=0,v=0,y=0;e.addEventListener("contextmenu",function(e){if(f){var n=t.textInput.getElement();n.focus()}}),e.addEventListener("touchstart",function(e){var o=e.touches;if(u||o.length>1)return clearTimeout(u),u=null,void(p="zoom");f=t.$mouseHandler.isMousePressed=!0;var d=o[0];s=d.clientX,a=d.clientY,v=y=0,e.clientX=d.clientX,e.clientY=d.clientY;var w=e.timeStamp;c=w;var b=new i(e,t);if(h=b.getDocumentPosition(),500>w-l&&1==o.length&&!g)m++,e.preventDefault(),e.button=0,r();else{m=0,u=setTimeout(n,450);var _=t.selection.cursor,C=t.selection.isEmpty()?_:t.selection.anchor,k=t.renderer.$cursorLayer.getPixelPosition(_,!0),S=t.renderer.$cursorLayer.getPixelPosition(C,!0),$=t.renderer.scroller.getBoundingClientRect(),x=t.renderer.layerConfig.lineHeight,A=t.renderer.layerConfig.lineHeight,T=function(e,t){return e/=A,t=t/x-.75,e*e+t*t},E=T(e.clientX-$.left-k.left,e.clientY-$.top-k.top),M=T(e.clientX-$.left-S.left,e.clientY-$.top-S.top);3.5>E&&3.5>M&&(p=E>M?"cursor":"anchor"),p=3.5>M?"anchor":3.5>E?"cursor":"scroll"}l=w}),e.addEventListener("touchend",function(e){f=t.$mouseHandler.isMousePressed=!1,d&&clearInterval(d),"zoom"==p?(p="",g=0):u?(t.selection.moveToPosition(h),g=0):"scroll"==p&&(o(),e.preventDefault()),clearTimeout(u),u=null}),e.addEventListener("touchmove",function(e){u&&(clearTimeout(u),u=null);var n=e.touches;if(!(n.length>1||"zoom"==p)){var r=n[0],o=s-r.clientX,l=a-r.clientY;if("wait"==p){if(!(o*o+l*l>4))return e.preventDefault();p="cursor"}s=r.clientX,a=r.clientY,e.clientX=r.clientX,e.clientY=r.clientY;var d=e.timeStamp,h=d-c;if(c=d,"scroll"==p){var f=new i(e,t);f.speed=1,f.wheelX=o,f.wheelY=l,10*Math.abs(o)<Math.abs(l)&&(o=0),10*Math.abs(l)<Math.abs(o)&&(l=0),0!=h&&(v=o/h,y=l/h),t._emit("mousewheel",f),f.propagationStopped||(v=y=0)}else{var g=new i(e,t),m=g.getDocumentPosition();"cursor"==p?t.selection.moveCursorToPosition(m):"anchor"==p&&t.selection.setSelectionAnchor(m.row,m.column),t.renderer.scrollCursorIntoView(m),e.preventDefault()}}})}}),ace.define("ace/lib/net",[],function(e,t,n){"use strict";var i=e("./dom");t.get=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)},n.send(null)},t.loadScript=function(e,t){var n=i.getDocumentHead(),r=document.createElement("script");r.src=e,n.appendChild(r),r.onload=r.onreadystatechange=function(e,n){(n||!r.readyState||"loaded"==r.readyState||"complete"==r.readyState)&&(r=r.onload=r.onreadystatechange=null,n||t())}},t.qualifyURL=function(e){var t=document.createElement("a");return t.href=e,t.href}}),ace.define("ace/lib/event_emitter",[],function(e,t,n){"use strict";var i={},r=function(){this.propagationStopped=!0},o=function(){this.defaultPrevented=!0};i._emit=i._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var n=this._eventRegistry[e]||[],i=this._defaultHandlers[e];if(n.length||i){"object"==typeof t&&t||(t={}),t.type||(t.type=e),t.stopPropagation||(t.stopPropagation=r),t.preventDefault||(t.preventDefault=o),n=n.slice();for(var s=0;s<n.length&&(n[s](t,this),!t.propagationStopped);s++);return i&&!t.defaultPrevented?i(t,this):void 0}},i._signal=function(e,t){var n=(this._eventRegistry||{})[e];if(n){n=n.slice();for(var i=0;i<n.length;i++)n[i](t,this)}},i.once=function(e,t){var n=this;return this.addEventListener(e,function i(){n.removeEventListener(e,i),t.apply(null,arguments)}),t?void 0:new Promise(function(e){t=e})},i.setDefaultHandler=function(e,t){var n=this._defaultHandlers;if(n||(n=this._defaultHandlers={_disabled_:{}}),n[e]){var i=n[e],r=n._disabled_[e];r||(n._disabled_[e]=r=[]),r.push(i);var o=r.indexOf(t);-1!=o&&r.splice(o,1)}n[e]=t},i.removeDefaultHandler=function(e,t){var n=this._defaultHandlers;if(n){var i=n._disabled_[e];if(n[e]==t)i&&this.setDefaultHandler(e,i.pop());else if(i){var r=i.indexOf(t);-1!=r&&i.splice(r,1)}}},i.on=i.addEventListener=function(e,t,n){this._eventRegistry=this._eventRegistry||{};var i=this._eventRegistry[e];return i||(i=this._eventRegistry[e]=[]),-1==i.indexOf(t)&&i[n?"unshift":"push"](t),t},i.off=i.removeListener=i.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[e];if(n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}},i.removeAllListeners=function(e){this._eventRegistry&&(this._eventRegistry[e]=[])},t.EventEmitter=i}),ace.define("ace/lib/app_config",[],function(e,t,n){"no use strict";function i(e){"undefined"!=typeof console&&console.warn&&console.warn.apply(console,arguments)}function r(e,t){var n=new Error(e);n.data=t,"object"==typeof console&&console.error&&console.error(n),setTimeout(function(){throw n})}var o=e("./oop"),s=e("./event_emitter").EventEmitter,a={setOptions:function(e){Object.keys(e).forEach(function(t){this.setOption(t,e[t])},this)},getOptions:function(e){var t={};if(e)Array.isArray(e)||(t=e,e=Object.keys(t));else{var n=this.$options;e=Object.keys(n).filter(function(e){return!n[e].hidden})}return e.forEach(function(e){t[e]=this.getOption(e)},this),t},setOption:function(e,t){if(this["$"+e]!==t){var n=this.$options[e];if(!n)return i('misspelled option "'+e+'"');if(n.forwardTo)return this[n.forwardTo]&&this[n.forwardTo].setOption(e,t);n.handlesSet||(this["$"+e]=t),n&&n.set&&n.set.call(this,t)}},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&&this[t.forwardTo].getOption(e):t&&t.get?t.get.call(this):this["$"+e]:i('misspelled option "'+e+'"')}},l=function(){this.$defaultOptions={}};(function(){o.implement(this,s),this.defineOptions=function(e,t,n){return e.$options||(this.$defaultOptions[t]=e.$options={}),Object.keys(n).forEach(function(t){var i=n[t];"string"==typeof i&&(i={forwardTo:i}),i.name||(i.name=t),e.$options[i.name]=i,"initialValue"in i&&(e["$"+i.name]=i.initialValue)}),o.implement(e,a),this},this.resetOptions=function(e){Object.keys(e.$options).forEach(function(t){var n=e.$options[t];"value"in n&&e.setOption(t,n.value)})},this.setDefaultValue=function(e,t,n){if(!e){for(e in this.$defaultOptions)if(this.$defaultOptions[e][t])break;if(!this.$defaultOptions[e][t])return!1}var i=this.$defaultOptions[e]||(this.$defaultOptions[e]={});i[t]&&(i.forwardTo?this.setDefaultValue(i.forwardTo,t,n):i[t].value=n)},this.setDefaultValues=function(e,t){Object.keys(t).forEach(function(n){this.setDefaultValue(e,n,t[n])},this)},this.warn=i,this.reportError=r}).call(l.prototype),t.AppConfig=l}),ace.define("ace/config",[],function(e,t,n){"no use strict";function i(i){if(l&&l.document){c.packaged=i||e.packaged||n.packaged||l.define&&define.packaged;for(var o={},s="",a=document.currentScript||document._currentScript,u=a&&a.ownerDocument||document,d=u.getElementsByTagName("script"),h=0;h<d.length;h++){var f=d[h],p=f.src||f.getAttribute("src");if(p){for(var g=f.attributes,m=0,v=g.length;v>m;m++){var y=g[m];0===y.name.indexOf("data-ace-")&&(o[r(y.name.replace(/^data-ace-/,""))]=y.value)}var w=p.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);w&&(s=w[1])}}s&&(o.base=o.base||s,o.packaged=!0),o.basePath=o.base,o.workerPath=o.workerPath||o.base,o.modePath=o.modePath||o.base,o.themePath=o.themePath||o.base,delete o.base;for(var b in o)"undefined"!=typeof o[b]&&t.set(b,o[b])}}function r(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}var o=e("./lib/lang"),s=(e("./lib/oop"),e("./lib/net")),a=e("./lib/app_config").AppConfig;n.exports=t=new a;var l=function(){return this||"undefined"!=typeof window&&window}(),c={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1};t.get=function(e){if(!c.hasOwnProperty(e))throw new Error("Unknown config key: "+e);return c[e]},t.set=function(e,t){if(c.hasOwnProperty(e))c[e]=t;else if(0==this.setDefaultValue("",e,t))throw new Error("Unknown config key: "+e)},t.all=function(){return o.copyObject(c)},t.$modes={},t.moduleUrl=function(e,t){if(c.$moduleUrls[e])return c.$moduleUrls[e];var n=e.split("/");t=t||n[n.length-2]||"";var i="snippets"==t?"/":"-",r=n[n.length-1];if("worker"==t&&"-"==i){var o=new RegExp("^"+t+"[\\-_]|[\\-_]"+t+"$","g");r=r.replace(o,"")}(!r||r==t)&&n.length>1&&(r=n[n.length-2]);var s=c[t+"Path"];return null==s?s=c.basePath:"/"==i&&(t=i=""),s&&"/"!=s.slice(-1)&&(s+="/"),s+t+i+r+this.get("suffix")},t.setModuleUrl=function(e,t){return c.$moduleUrls[e]=t},t.$loading={},t.loadModule=function(n,i){var r,o;Array.isArray(n)&&(o=n[0],n=n[1]);try{r=e(n)}catch(a){}if(r&&!t.$loading[n])return i&&i(r);if(t.$loading[n]||(t.$loading[n]=[]),t.$loading[n].push(i),!(t.$loading[n].length>1)){var l=function(){e([n],function(e){t._emit("load.module",{name:n,module:e});var i=t.$loading[n];t.$loading[n]=null,i.forEach(function(t){t&&t(e)})})};if(!t.get("packaged"))return l();s.loadScript(t.moduleUrl(n,o),l),u()}};var u=function(){c.basePath||c.workerPath||c.modePath||c.themePath||Object.keys(c.$moduleUrls).length||(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),u=function(){})};i(!0),t.init=i,t.version="1.4.5"}),ace.define("ace/mouse/mouse_handler",[],function(e,t,n){"use strict";var i=e("../lib/event"),r=e("../lib/useragent"),o=e("./default_handlers").DefaultHandlers,s=e("./default_gutter_handler").GutterHandler,a=e("./mouse_event").MouseEvent,l=e("./dragdrop_handler").DragdropHandler,c=e("./touch_handler").addTouchListeners,u=e("../config"),d=function(e){var t=this;this.editor=e,new o(this),new s(this),new l(this);var n=function(t){var n=!document.hasFocus||!document.hasFocus()||!e.isFocused()&&document.activeElement==(e.textInput&&e.textInput.getElement());n&&window.focus(),e.focus()},a=e.renderer.getMouseEventTarget();i.addListener(a,"click",this.onMouseEvent.bind(this,"click")),i.addListener(a,"mousemove",this.onMouseMove.bind(this,"mousemove")),i.addMultiMouseDownListener([a,e.renderer.scrollBarV&&e.renderer.scrollBarV.inner,e.renderer.scrollBarH&&e.renderer.scrollBarH.inner,e.textInput&&e.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent"),i.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel")),c(e.container,e);var u=e.renderer.$gutter;i.addListener(u,"mousedown",this.onMouseEvent.bind(this,"guttermousedown")),i.addListener(u,"click",this.onMouseEvent.bind(this,"gutterclick")),i.addListener(u,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick")),i.addListener(u,"mousemove",this.onMouseEvent.bind(this,"guttermousemove")),i.addListener(a,"mousedown",n),i.addListener(u,"mousedown",n),r.isIE&&e.renderer.scrollBarV&&(i.addListener(e.renderer.scrollBarV.element,"mousedown",n),i.addListener(e.renderer.scrollBarH.element,"mousedown",n)),e.on("mousemove",function(n){if(!t.state&&!t.$dragDelay&&t.$dragEnabled){var i=e.renderer.screenToTextCoordinates(n.x,n.y),r=e.session.selection.getRange(),o=e.renderer;!r.isEmpty()&&r.insideStart(i.row,i.column)?o.setCursorStyle("default"):o.setCursorStyle("")}})};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new a(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;n&&n.length&&this.editor._emit(e,new a(t,this.editor))},this.onMouseWheel=function(e,t){var n=new a(t,this.editor);n.speed=2*this.$scrollSpeed,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var n=this.editor,o=this.editor.renderer;o.$isMousePressed=!0;var s=this,l=function(e){if(e){if(r.isWebKit&&!e.which&&s.releaseMouse)return s.releaseMouse();s.x=e.clientX,s.y=e.clientY,t&&t(e),s.mouseEvent=new a(e,s.editor),s.$mouseMoved=!0}},c=function(e){n.off("beforeEndOperation",d),clearInterval(h),u(),s[s.state+"End"]&&s[s.state+"End"](e),s.state="",s.isMousePressed=o.$isMousePressed=!1,o.$keepTextAreaAtCursor&&o.$moveTextAreaToCursor(),s.$onCaptureMouseMove=s.releaseMouse=null,e&&s.onMouseEvent("mouseup",e),n.endOperation()},u=function(){s[s.state]&&s[s.state](),s.$mouseMoved=!1};if(r.isOldIE&&"dblclick"==e.domEvent.type)return setTimeout(function(){c(e)});var d=function(e){s.releaseMouse&&n.curOp.command.name&&n.curOp.selectionChanged&&(s[s.state+"End"]&&s[s.state+"End"](),s.state="",s.releaseMouse())};n.on("beforeEndOperation",d),n.startOperation({command:{name:"mouse"}}),s.$onCaptureMouseMove=l,s.releaseMouse=i.capture(this.editor.container,l,c);var h=setInterval(u,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var e=function(t){t&&t.domEvent&&"contextmenu"!=t.domEvent.type||(this.editor.off("nativecontextmenu",e),t&&t.domEvent&&i.stopEvent(t.domEvent))}.bind(this);setTimeout(e,10),this.editor.on("nativecontextmenu",e)}}).call(d.prototype),u.defineOptions(d.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:r.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=d}),ace.define("ace/mouse/fold_handler",[],function(e,t,n){"use strict";function i(e){e.on("click",function(t){var n=t.getDocumentPosition(),i=e.session,o=i.getFoldAt(n.row,n.column,1);o&&(t.getAccelKey()?i.removeFold(o):i.expandFold(o),t.stop());var s=t.domEvent&&t.domEvent.target;s&&r.hasCssClass(s,"ace_inline_button")&&r.hasCssClass(s,"ace_toggle_wrap")&&(i.setOption("wrap",!i.getUseWrapMode()),e.renderer.scrollCursorIntoView())}),e.on("gutterclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if("foldWidgets"==n){var i=t.getDocumentPosition().row,r=e.session;r.foldWidgets&&r.foldWidgets[i]&&e.session.onFoldWidgetClick(i,t),e.isFocused()||e.focus(),t.stop()}}),e.on("gutterdblclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if("foldWidgets"==n){var i=t.getDocumentPosition().row,r=e.session,o=r.getParentFoldRangeData(i,!0),s=o.range||o.firstRange;if(s){i=s.start.row;var a=r.getFoldAt(i,r.getLine(i).length,1);a?r.removeFold(a):(r.addFold("...",s),e.renderer.scrollCursorIntoView({row:s.start.row,column:0}))}t.stop()}})}var r=e("../lib/dom");t.FoldHandler=i}),ace.define("ace/keyboard/keybinding",[],function(e,t,n){"use strict";var i=e("../lib/keys"),r=e("../lib/event"),o=function(e){this.$editor=e,this.$data={editor:e},this.$handlers=[],this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0)},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]!=e){for(;t[t.length-1]&&t[t.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)}},this.addKeyboardHandler=function(e,t){if(e){"function"!=typeof e||e.handleKeyboard||(e.handleKeyboard=e);var n=this.$handlers.indexOf(e);-1!=n&&this.$handlers.splice(n,1),void 0==t?this.$handlers.push(e):this.$handlers.splice(t,0,e),-1==n&&e.attach&&e.attach(this.$editor)}},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return-1==t?!1:(this.$handlers.splice(t,1),e.detach&&e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var e=this.$data,t=e.editor;return this.$handlers.map(function(n){return n.getStatusText&&n.getStatusText(t,e)||""}).filter(Boolean).join(" ")},this.$callKeyboardHandlers=function(e,t,n,i){for(var o,s=!1,a=this.$editor.commands,l=this.$handlers.length;l--&&(o=this.$handlers[l].handleKeyboard(this.$data,e,t,n,i),!(o&&o.command&&(s="null"==o.command?!0:a.exec(o.command,this.$editor,o.args,i),s&&i&&-1!=e&&1!=o.passEvent&&1!=o.command.passEvent&&r.stopEvent(i),s))););return s||-1!=e||(o={command:"insertstring"},s=a.exec("insertstring",this.$editor,t)),s&&this.$editor._signal&&this.$editor._signal("keyboardActivity",o),s},this.onCommandKey=function(e,t,n){var r=i.keyCodeToString(n);this.$callKeyboardHandlers(t,r,n,e)},this.onTextInput=function(e){this.$callKeyboardHandlers(-1,e)}}).call(o.prototype),t.KeyBinding=o}),ace.define("ace/lib/bidiutil",[],function(e,t,n){"use strict";function i(e,t,n,i){var r=a?p:f,g=null,m=null,v=null,y=0,w=null,b=null,_=-1,S=null,x=null,A=[];if(!i)for(S=0,i=[];n>S;S++)i[S]=s(e[S]);for(l=a,c=!1,u=!1,d=!1,h=!1,x=0;n>x;x++){if(g=y,A[x]=m=o(e,i,A,x),y=r[g][m],w=240&y,y&=15,t[x]=v=r[y][5],w>0)if(16==w){for(S=_;x>S;S++)t[S]=1;_=-1}else _=-1;if(b=r[y][6])-1==_&&(_=x);else if(_>-1){for(S=_;x>S;S++)t[S]=v;_=-1}i[x]==C&&(t[x]=0),l|=v}if(h)for(S=0;n>S;S++)if(i[S]==k){t[S]=a;for(var T=S-1;T>=0&&i[T]==$;T--)t[T]=a}}function r(e,t,n){if(!(e>l)){if(1==e&&a==m&&!d)return void n.reverse();for(var i,r,o,s,c=n.length,u=0;c>u;){if(t[u]>=e){for(i=u+1;c>i&&t[i]>=e;)i++;for(r=u,o=i-1;o>r;r++,o--)s=n[r],n[r]=n[o],n[o]=s;u=i}u++}}}function o(e,t,n,i){var r,o,s,l,f=t[i];switch(f){case v:case y:c=!1;case _:case b:return f;case w:return c?b:w;case S:return c=!0,u=!0,y;case $:return _;case x:return 1>i||i+1>=t.length||(r=n[i-1])!=w&&r!=b||(o=t[i+1])!=w&&o!=b?_:(c&&(o=b),o==r?o:_);case A:return r=i>0?n[i-1]:C,r==w&&i+1<t.length&&t[i+1]==w?w:_;case T:if(i>0&&n[i-1]==w)return w;if(c)return _;for(l=i+1,s=t.length;s>l&&t[l]==T;)l++;return s>l&&t[l]==w?w:_;case E:for(s=t.length,l=i+1;s>l&&t[l]==E;)l++;if(s>l){var p=e[i],g=p>=1425&&2303>=p||64286==p;if(r=t[l],g&&(r==y||r==S))return y}return 1>i||(r=t[i-1])==C?_:n[i-1];case C:return c=!1,d=!0,a;case k:return h=!0,_;case M:case R:case D:case F:case L:c=!1;case P:return _}}function s(e){var t=e.charCodeAt(0),n=t>>8;return 0==n?t>191?v:I[t]:5==n?/[\u0591-\u05f4]/.test(e)?y:v:6==n?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(e)?E:/[\u0660-\u0669\u066b-\u066c]/.test(e)?b:1642==t?T:/[\u06f0-\u06f9]/.test(e)?w:S:32==n&&8287>=t?q[255&t]:254==n&&t>=65136?S:_}var a=0,l=0,c=!1,u=!1,d=!1,h=!1,f=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],g=0,m=1,v=0,y=1,w=2,b=3,_=4,C=5,k=6,S=7,$=8,x=9,A=10,T=11,E=12,M=13,R=14,L=15,D=16,F=17,P=18,I=[P,P,P,P,P,P,P,P,P,k,C,k,$,C,P,P,P,P,P,P,P,P,P,P,P,P,P,P,C,C,C,k,$,_,_,T,T,T,_,_,_,_,_,A,x,A,x,x,w,w,w,w,w,w,w,w,w,w,x,_,_,_,_,_,_,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,_,_,_,_,_,_,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,_,_,_,_,P,P,P,P,P,P,C,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,x,_,T,T,T,T,_,_,_,_,v,_,_,P,_,_,T,T,w,w,_,v,_,_,_,w,v,_,_,_,_,_],q=[$,$,$,$,$,$,$,$,$,$,$,P,P,P,v,y,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,$,C,M,R,L,D,F,x,T,T,T,T,T,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,$];t.L=v,t.R=y,t.EN=w,t.ON_R=3,t.AN=4,t.R_H=5,t.B=6,t.RLE=7,t.DOT="",t.doBidiReorder=function(e,n,o){if(e.length<2)return{};var s=e.split(""),l=new Array(s.length),c=new Array(s.length),u=[];a=o?m:g,i(s,u,s.length,n);for(var d=0;d<l.length;l[d]=d,d++);r(2,u,l),r(1,u,l);for(var d=0;d<l.length-1;d++)n[d]===b?u[d]=t.AN:u[d]===y&&(n[d]>S&&n[d]<M||n[d]===_||n[d]===P)?u[d]=t.ON_R:d>0&&""===s[d-1]&&/\u0622|\u0623|\u0625|\u0627/.test(s[d])&&(u[d-1]=u[d]=t.R_H,d++);s[s.length-1]===t.DOT&&(u[s.length-1]=t.B),""===s[0]&&(u[0]=t.RLE);for(var d=0;d<l.length;d++)c[d]=u[l[d]];return{logicalFromVisual:l,bidiLevels:c}},t.hasBidiCharacters=function(e,t){for(var n=!1,i=0;i<e.length;i++)t[i]=s(e.charAt(i)),n||t[i]!=y&&t[i]!=S&&t[i]!=b||(n=!0);return n},t.getVisualFromLogicalIdx=function(e,t){for(var n=0;n<t.logicalFromVisual.length;n++)if(t.logicalFromVisual[n]==e)return n;return 0}}),ace.define("ace/bidihandler",[],function(e,t,n){"use strict";var i=e("./lib/bidiutil"),r=e("./lib/lang"),o=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/,s=function(e){this.session=e,this.bidiMap={},this.currentRow=null,this.bidiUtil=i,this.charWidths=[],this.EOL="",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="",this.RLE="",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=o.test(e.getValue())};(function(){this.isBidiRow=function(e,t,n){return this.seenBidi?(e!==this.currentRow&&(this.currentRow=e,this.updateRowLine(t,n),this.updateBidiMap()),this.bidiMap.bidiLevels):!1},this.onChange=function(e){this.seenBidi?this.currentRow=null:"insert"==e.action&&o.test(e.lines.join("\n"))&&(this.seenBidi=!0,this.currentRow=null)},this.getDocumentRow=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var n=this.session.$getRowCacheIndex(t,this.currentRow);n>=0&&(e=this.session.$docRowCache[n])}return e},this.getSplitIndex=function(){var e=0,t=this.session.$screenRowCache;if(t.length)for(var n,i=this.session.$getRowCacheIndex(t,this.currentRow);this.currentRow-e>0&&(n=this.session.$getRowCacheIndex(t,this.currentRow-e-1),n===i);)i=n,e++;else e=this.currentRow;return e},this.updateRowLine=function(e,t){void 0===e&&(e=this.getDocumentRow());var n=e===this.session.getLength()-1,o=n?this.EOF:this.EOL;if(this.wrapIndent=0,this.line=this.session.getLine(e),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE,this.session.$useWrapMode){var s=this.session.$wrapData[e];s&&(void 0===t&&(t=this.getSplitIndex()),t>0&&s.length?(this.wrapIndent=s.indent,this.wrapOffset=this.wrapIndent*this.charWidths[i.L],this.line=t<s.length?this.line.substring(s[t-1],s[t]):this.line.substring(s[s.length-1])):this.line=this.line.substring(0,s[t])),t==s.length&&(this.line+=this.showInvisibles?o:i.DOT)}else this.line+=this.showInvisibles?o:i.DOT;var a,l=this.session,c=0;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(e,t){return"	"===e||l.isFullWidth(e.charCodeAt(0))?(a="	"===e?l.getScreenTabSize(t+c):2,c+=a-1,r.stringRepeat(i.DOT,a)):e}),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==i.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},this.updateBidiMap=function(){var e=[];i.hasBidiCharacters(this.line,e)||this.isRtlDir?this.bidiMap=i.doBidiReorder(this.line,e,this.isRtlDir):this.bidiMap={}},this.markAsDirty=function(){this.currentRow=null},this.updateCharacterWidths=function(e){if(this.characterWidth!==e.$characterSize.width){this.fontMetrics=e;var t=this.characterWidth=e.$characterSize.width,n=e.$measureCharWidth("");this.charWidths[i.L]=this.charWidths[i.EN]=this.charWidths[i.ON_R]=t,this.charWidths[i.R]=this.charWidths[i.AN]=n,this.charWidths[i.R_H]=.45*n,this.charWidths[i.B]=this.charWidths[i.RLE]=0,this.currentRow=null}},this.setShowInvisibles=function(e){this.showInvisibles=e,this.currentRow=null},this.setEolChar=function(e){this.EOL=e},this.setContentWidth=function(e){this.contentWidth=e},this.isRtlLine=function(e){return this.$isRtl?!0:void 0!=e?this.session.getLine(e).charAt(0)==this.RLE:this.isRtlDir},this.setRtlDirection=function(e,t){for(var n=e.getCursorPosition(),i=e.selection.getSelectionAnchor().row;i<=n.row;i++)t||e.session.getLine(i).charAt(0)!==e.session.$bidiHandler.RLE?t&&e.session.getLine(i).charAt(0)!==e.session.$bidiHandler.RLE&&e.session.doc.insert({column:0,row:i},e.session.$bidiHandler.RLE):e.session.doc.removeInLine(i,0,1)},this.getPosLeft=function(e){e-=this.wrapIndent;var t=this.line.charAt(0)===this.RLE?1:0,n=e>t?this.session.getOverwrite()?e:e-1:t,r=i.getVisualFromLogicalIdx(n,this.bidiMap),o=this.bidiMap.bidiLevels,s=0;!this.session.getOverwrite()&&t>=e&&o[r]%2!==0&&r++;for(var a=0;r>a;a++)s+=this.charWidths[o[a]];return!this.session.getOverwrite()&&e>t&&o[r]%2===0&&(s+=this.charWidths[o[r]]),this.wrapIndent&&(s+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(s+=this.rtlLineOffset),s},this.getSelections=function(e,t){var n,i=this.bidiMap,r=i.bidiLevels,o=[],s=0,a=Math.min(e,t)-this.wrapIndent,l=Math.max(e,t)-this.wrapIndent,c=!1,u=!1,d=0;this.wrapIndent&&(s+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var h,f=0;f<r.length;f++)h=i.logicalFromVisual[f],n=r[f],c=h>=a&&l>h,c&&!u?d=s:!c&&u&&o.push({left:d,width:s-d}),s+=this.charWidths[n],u=c;if(c&&f===r.length&&o.push({left:d,width:s-d}),this.isRtlDir)for(var p=0;p<o.length;p++)o[p].left+=this.rtlLineOffset;return o},this.offsetToCol=function(e){this.isRtlDir&&(e-=this.rtlLineOffset);var t=0,e=Math.max(e,0),n=0,i=0,r=this.bidiMap.bidiLevels,o=this.charWidths[r[i]];for(this.wrapIndent&&(e-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);e>n+o/2;){if(n+=o,i===r.length-1){o=0;break}o=this.charWidths[r[++i]]}return i>0&&r[i-1]%2!==0&&r[i]%2===0?(n>e&&i--,t=this.bidiMap.logicalFromVisual[i]):i>0&&r[i-1]%2===0&&r[i]%2!==0?t=1+(e>n?this.bidiMap.logicalFromVisual[i]:this.bidiMap.logicalFromVisual[i-1]):this.isRtlDir&&i===r.length-1&&0===o&&r[i-1]%2===0||!this.isRtlDir&&0===i&&r[i]%2!==0?t=1+this.bidiMap.logicalFromVisual[i]:(i>0&&r[i-1]%2!==0&&0!==o&&i--,t=this.bidiMap.logicalFromVisual[i]),0===t&&this.isRtlDir&&t++,t+this.wrapIndent}}).call(s.prototype),t.BidiHandler=s}),ace.define("ace/selection",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/lang"),o=e("./lib/event_emitter").EventEmitter,s=e("./range").Range,a=function(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var t=this;this.cursor.on("change",function(e){t.$cursorChanged=!0,t.$silent||t._emit("changeCursor"),t.$isEmpty||t.$silent||t._emit("changeSelection"),t.$keepDesiredColumnOnChange||e.old.column==e.value.column||(t.$desiredColumn=null)}),this.anchor.on("change",function(){t.$anchorChanged=!0,t.$isEmpty||t.$silent||t._emit("changeSelection")})};(function(){i.implement(this,o),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.$isEmpty=!1,this.anchor.setPosition(e,t)},this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.$isEmpty?s.fromPoints(t,t):this.isBackwards()?s.fromPoints(t,e):s.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},this.setRange=this.setSelectionRange=function(e,t){var n=t?e.end:e.start,i=t?e.start:e.end;this.$setSelection(n.row,n.column,i.row,i.column)},this.$setSelection=function(e,t,n,i){var r=this.$isEmpty,o=this.inMultiSelectMode;this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(e,t),this.cursor.setPosition(n,i),this.$isEmpty=!s.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),(this.$cursorChanged||this.$anchorChanged||r!=this.$isEmpty||o)&&this._emit("changeSelection")},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&&this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCursorTo(e,t)})},this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCursorToPosition(e)})},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){if("undefined"==typeof t){var n=e||this.lead;e=n.row,t=n.column}return this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),t=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(t)},this.getLineRange=function(e,t){var n,i="number"==typeof e?e:this.lead.row,r=this.session.getFoldLine(i);return r?(i=r.start.row,n=r.end.row):n=i,t===!0?new s(i,0,n,this.session.getLine(n).length):new s(i,0,n+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.wouldMoveIntoSoftTab=function(e,t,n){var i=e.column,r=e.column+t;return 0>n&&(i=e.column-t,r=e.column),this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(i,r).split(" ").length-1==t},this.moveCursorLeft=function(){var e,t=this.lead.getPosition();if(e=this.session.getFoldAt(t.row,t.column,-1))this.moveCursorTo(e.start.row,e.start.column);else if(0===t.column)t.row>0&&this.moveCursorTo(t.row-1,this.doc.getLine(t.row-1).length);else{
var n=this.session.getTabSize();this.wouldMoveIntoSoftTab(t,n,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-n):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var e,t=this.lead.getPosition();if(e=this.session.getFoldAt(t.row,t.column,1))this.moveCursorTo(e.end.row,e.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var n=this.session.getTabSize(),t=this.lead;this.wouldMoveIntoSoftTab(t,n,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,n):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,n=this.session.documentToScreenRow(e,t),i=this.session.screenToDocumentPosition(n,0),r=this.session.getDisplayLine(e,null,i.row,i.column),o=r.match(/^\s*/);o[0].length==t||this.session.$useEmacsStyleLineStart||(i.column+=o[0].length),this.moveCursorToPosition(i)},this.moveCursorLineEnd=function(){var e=this.lead,t=this.session.getDocumentLastRowColumnPosition(e.row,e.column);if(this.lead.column==t.column){var n=this.session.getLine(t.row);if(t.column==n.length){var i=n.search(/\s+$/);i>0&&(t.column=i)}}this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),i=n.substring(t);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var r=this.session.getFoldAt(e,t,1);return r?void this.moveCursorTo(r.end.row,r.end.column):(this.session.nonTokenRe.exec(i)&&(t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,i=n.substring(t)),t>=n.length?(this.moveCursorTo(e,n.length),this.moveCursorRight(),void(e<this.doc.getLength()-1&&this.moveCursorWordRight())):(this.session.tokenRe.exec(i)&&(t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),void this.moveCursorTo(e,t)))},this.moveCursorLongWordLeft=function(){var e,t=this.lead.row,n=this.lead.column;if(e=this.session.getFoldAt(t,n,-1))return void this.moveCursorTo(e.start.row,e.start.column);var i=this.session.getFoldStringAt(t,n,-1);null==i&&(i=this.doc.getLine(t).substring(0,n));var o=r.stringReverse(i);return this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(o)&&(n-=this.session.nonTokenRe.lastIndex,o=o.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),0>=n?(this.moveCursorTo(t,0),this.moveCursorLeft(),void(t>0&&this.moveCursorWordLeft())):(this.session.tokenRe.exec(o)&&(n-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),void this.moveCursorTo(t,n))},this.$shortWordEndIndex=function(e){var t,n=0,i=/\s/,r=this.session.tokenRe;if(r.lastIndex=0,this.session.tokenRe.exec(e))n=this.session.tokenRe.lastIndex;else{for(;(t=e[n])&&i.test(t);)n++;if(1>n)for(r.lastIndex=0;(t=e[n])&&!r.test(t);)if(r.lastIndex=0,n++,i.test(t)){if(n>2){n--;break}for(;(t=e[n])&&i.test(t);)n++;if(n>2)break}}return r.lastIndex=0,n},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),i=n.substring(t),r=this.session.getFoldAt(e,t,1);if(r)return this.moveCursorTo(r.end.row,r.end.column);if(t==n.length){var o=this.doc.getLength();do e++,i=this.doc.getLine(e);while(o>e&&/^\s*$/.test(i));/^\s+/.test(i)||(i=""),t=0}var s=this.$shortWordEndIndex(i);this.moveCursorTo(e,t+s)},this.moveCursorShortWordLeft=function(){var e,t=this.lead.row,n=this.lead.column;if(e=this.session.getFoldAt(t,n,-1))return this.moveCursorTo(e.start.row,e.start.column);var i=this.session.getLine(t).substring(0,n);if(0===n){do t--,i=this.doc.getLine(t);while(t>0&&/^\s*$/.test(i));n=i.length,/\s+$/.test(i)||(i="")}var o=r.stringReverse(i),s=this.$shortWordEndIndex(o);return this.moveCursorTo(t,n-s)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var n,i=this.session.documentToScreenPosition(this.lead.row,this.lead.column);0===t&&(0!==e&&(this.session.$bidiHandler.isBidiRow(i.row,this.lead.row)?(n=this.session.$bidiHandler.getPosLeft(i.column),i.column=Math.round(n/this.session.$bidiHandler.charWidths[0])):n=i.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?i.column=this.$desiredColumn:this.$desiredColumn=i.column);var r=this.session.screenToDocumentPosition(i.row+e,i.column,n);0!==e&&0===t&&r.row===this.lead.row&&r.column===this.lead.column&&this.session.lineWidgets&&this.session.lineWidgets[r.row]&&(r.row>0||e>0)&&r.row++,this.moveCursorTo(r.row,r.column+t,0===t)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,n){var i=this.session.getFoldAt(e,t,1);i&&(e=i.start.row,t=i.start.column),this.$keepDesiredColumnOnChange=!0;var r=this.session.getLine(e);/[\uDC00-\uDFFF]/.test(r.charAt(t))&&r.charAt(t-1)&&(this.lead.row==e&&this.lead.column==t+1?t-=1:t+=1),this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,n||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,n){var i=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(i.row,i.column,n)},this.detach=function(){this.lead.detach(),this.anchor.detach(),this.session=this.doc=null},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.getRangeOfMovements=function(e){var t=this.getCursor();try{e(this);var n=this.getCursor();return s.fromPoints(t,n)}catch(i){return s.fromPoints(t,t)}finally{this.moveCursorToPosition(t)}},this.toJSON=function(){if(this.rangeCount)var e=this.ranges.map(function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t});else{var e=this.getRange();e.isBackwards=this.isBackwards()}return e},this.fromJSON=function(e){if(void 0==e.start){if(this.rangeList&&e.length>1){this.toSingleRange(e[0]);for(var t=e.length;t--;){var n=s.fromPoints(e[t].start,e[t].end);e[t].isBackwards&&(n.cursor=n.start),this.addRange(n,!0)}return}e=e[0]}this.rangeList&&this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&&e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(a.prototype),t.Selection=a}),ace.define("ace/tokenizer",[],function(e,t,n){"use strict";var i=e("./config"),r=2e3,o=function(e){this.states=e,this.regExps={},this.matchMappings={};for(var t in this.states){for(var n=this.states[t],i=[],r=0,o=this.matchMappings[t]={defaultToken:"text"},s="g",a=[],l=0;l<n.length;l++){var c=n[l];if(c.defaultToken&&(o.defaultToken=c.defaultToken),c.caseInsensitive&&(s="gi"),null!=c.regex){c.regex instanceof RegExp&&(c.regex=c.regex.toString().slice(1,-1));var u=c.regex,d=new RegExp("(?:("+u+")|(.))").exec("a").length-2;Array.isArray(c.token)?1==c.token.length||1==d?c.token=c.token[0]:d-1!=c.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:c,groupCount:d-1}),c.token=c.token[0]):(c.tokenArray=c.token,c.token=null,c.onMatch=this.$arrayTokens):"function"!=typeof c.token||c.onMatch||(d>1?c.onMatch=this.$applyToken:c.onMatch=c.token),d>1&&(/\\\d/.test(c.regex)?u=c.regex.replace(/\\([0-9]+)/g,function(e,t){return"\\"+(parseInt(t,10)+r+1)}):(d=1,u=this.removeCapturingGroups(c.regex)),c.splitRegex||"string"==typeof c.token||a.push(c)),o[r]=l,r+=d,i.push(u),c.onMatch||(c.onMatch=null)}}i.length||(o[0]=0,i.push("$")),a.forEach(function(e){e.splitRegex=this.createSplitterRegexp(e.regex,s)},this),this.regExps[t]=new RegExp("("+i.join(")|(")+")|($)",s)}};(function(){this.$setMaxTokenCount=function(e){r=0|e},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),n=this.token.apply(this,t);if("string"==typeof n)return[{type:n,value:e}];for(var i=[],r=0,o=n.length;o>r;r++)t[r]&&(i[i.length]={type:n[r],value:t[r]});return i},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return"text";for(var n=[],i=this.tokenArray,r=0,o=i.length;o>r;r++)t[r+1]&&(n[n.length]={type:i[r],value:t[r+1]});return n},this.removeCapturingGroups=function(e){var t=e.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!]|(\()/g,function(e,t){return t?"(?:":e});return t},this.createSplitterRegexp=function(e,t){if(-1!=e.indexOf("(?=")){var n=0,i=!1,r={};e.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(e,t,o,s,a,l){return i?i="]"!=a:a?i=!0:s?(n==r.stack&&(r.end=l+1,r.stack=-1),n--):o&&(n++,1!=o.length&&(r.stack=n,r.start=l)),e}),null!=r.end&&/^\)*$/.test(e.substr(r.end))&&(e=e.substring(0,r.start)+e.substr(r.end))}return"^"!=e.charAt(0)&&(e="^"+e),"$"!=e.charAt(e.length-1)&&(e+="$"),new RegExp(e,(t||"").replace("g",""))},this.getLineTokens=function(e,t){if(t&&"string"!=typeof t){var n=t.slice(0);t=n[0],"#tmp"===t&&(n.shift(),t=n.shift())}else var n=[];var i=t||"start",o=this.states[i];o||(i="start",o=this.states[i]);var s=this.matchMappings[i],a=this.regExps[i];a.lastIndex=0;for(var l,c=[],u=0,d=0,h={type:null,value:""};l=a.exec(e);){var f=s.defaultToken,p=null,g=l[0],m=a.lastIndex;if(m-g.length>u){var v=e.substring(u,m-g.length);h.type==f?h.value+=v:(h.type&&c.push(h),h={type:f,value:v})}for(var y=0;y<l.length-2;y++)if(void 0!==l[y+1]){p=o[s[y]],f=p.onMatch?p.onMatch(g,i,n,e):p.token,p.next&&(i="string"==typeof p.next?p.next:p.next(i,n),o=this.states[i],o||(this.reportError("state doesn't exist",i),i="start",o=this.states[i]),s=this.matchMappings[i],u=m,a=this.regExps[i],a.lastIndex=m),p.consumeLineEnd&&(u=m);break}if(g)if("string"==typeof f)p&&p.merge===!1||h.type!==f?(h.type&&c.push(h),h={type:f,value:g}):h.value+=g;else if(f){h.type&&c.push(h),h={type:null,value:""};for(var y=0;y<f.length;y++)c.push(f[y])}if(u==e.length)break;if(u=m,d++>r){for(d>2*e.length&&this.reportError("infinite loop with in ace tokenizer",{startState:t,line:e});u<e.length;)h.type&&c.push(h),h={value:e.substring(u,u+=500),type:"overflow"};i="start",n=[];break}}return h.type&&c.push(h),n.length>1&&n[0]!==i&&n.unshift("#tmp",i),{tokens:c,state:n.length?n:i}},this.reportError=i.reportError}).call(o.prototype),t.Tokenizer=o}),ace.define("ace/mode/text_highlight_rules",[],function(e,t,n){"use strict";var i=e("../lib/lang"),r=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(e,t){if(t)for(var n in e){for(var i=e[n],r=0;r<i.length;r++){var o=i[r];(o.next||o.onMatch)&&("string"==typeof o.next&&0!==o.next.indexOf(t)&&(o.next=t+o.next),o.nextState&&0!==o.nextState.indexOf(t)&&(o.nextState=t+o.nextState))}this.$rules[t+n]=i}else for(var n in e)this.$rules[n]=e[n]},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,n,r,o){var s="function"==typeof e?(new e).getRules():e;if(r)for(var a=0;a<r.length;a++)r[a]=t+r[a];else{r=[];for(var l in s)r.push(t+l)}if(this.addRules(s,t),n)for(var c=Array.prototype[o?"push":"unshift"],a=0;a<r.length;a++)c.apply(this.$rules[r[a]],i.deepCopy(n));this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};var e=function(e,t){return("start"!=e||t.length)&&t.unshift(this.nextState,e),this.nextState},t=function(e,t){return t.shift(),t.shift()||"start"};this.normalizeRules=function(){function n(o){var s=r[o];s.processed=!0;for(var a=0;a<s.length;a++){var l=s[a],c=null;Array.isArray(l)&&(c=l,l={}),!l.regex&&l.start&&(l.regex=l.start,l.next||(l.next=[]),l.next.push({defaultToken:l.token},{token:l.token+".end",regex:l.end||l.start,next:"pop"}),l.token=l.token+".start",l.push=!0);var u=l.next||l.push;if(u&&Array.isArray(u)){var d=l.stateName;d||(d=l.token,"string"!=typeof d&&(d=d[0]||""),r[d]&&(d+=i++)),r[d]=u,l.next=d,n(d)}else"pop"==u&&(l.next=t);if(l.push&&(l.nextState=l.next||l.push,l.next=e,delete l.push),l.rules)for(var h in l.rules)r[h]?r[h].push&&r[h].push.apply(r[h],l.rules[h]):r[h]=l.rules[h];var f="string"==typeof l?l:l.include;if(f&&(c=Array.isArray(f)?f.map(function(e){return r[e]}):r[f]),c){var p=[a,1].concat(c);l.noEscape&&(p=p.filter(function(e){return!e.next})),s.splice.apply(s,p),a--}l.keywordMap&&(l.token=this.createKeywordMapper(l.keywordMap,l.defaultToken||"text",l.caseInsensitive),delete l.defaultToken)}}var i=0,r=this.$rules;Object.keys(r).forEach(n,this)},this.createKeywordMapper=function(e,t,n,i){var r=Object.create(null);return Object.keys(e).forEach(function(t){var o=e[t];n&&(o=o.toLowerCase());for(var s=o.split(i||"|"),a=s.length;a--;)r[s[a]]=t}),Object.getPrototypeOf(r)&&(r.__proto__=null),this.$keywordList=Object.keys(r),e=null,n?function(e){return r[e.toLowerCase()]||t}:function(e){return r[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(r.prototype),t.TextHighlightRules=r}),ace.define("ace/mode/behaviour",[],function(e,t,n){"use strict";var i=function(){this.$behaviours={}};(function(){this.add=function(e,t,n){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=n},this.addBehaviours=function(e){for(var t in e)for(var n in e[t])this.add(t,n,e[t][n])},this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]},this.inherit=function(e,t){if("function"==typeof e)var n=(new e).getBehaviours(t);else var n=e.getBehaviours(t);this.addBehaviours(n)},this.getBehaviours=function(e){if(e){for(var t={},n=0;n<e.length;n++)this.$behaviours[e[n]]&&(t[e[n]]=this.$behaviours[e[n]]);return t}return this.$behaviours}}).call(i.prototype),t.Behaviour=i}),ace.define("ace/token_iterator",[],function(e,t,n){"use strict";var i=e("./range").Range,r=function(e,t,n){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t);var i=e.getTokenAt(t,n);this.$tokenIndex=i?i.index:-1};(function(){this.stepBackward=function(){for(this.$tokenIndex-=1;this.$tokenIndex<0;){if(this.$row-=1,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){this.$tokenIndex+=1;for(var e;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,e||(e=this.$session.getLength()),this.$row>=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,n=e[t].start;if(void 0!==n)return n;for(n=0;t>0;)t-=1,n+=e[t].value.length;return n},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},this.getCurrentTokenRange=function(){var e=this.$rowTokens[this.$tokenIndex],t=this.getCurrentTokenColumn();return new i(this.$row,t,this.$row,t+e.value.length)}}).call(r.prototype),t.TokenIterator=r}),ace.define("ace/mode/behaviour/cstyle",[],function(e,t,n){"use strict";var i,r=e("../../lib/oop"),o=e("../behaviour").Behaviour,s=e("../../token_iterator").TokenIterator,a=e("../../lib/lang"),l=["text","paren.rparen","punctuation.operator"],c=["text","paren.rparen","punctuation.operator","comment"],u={},d={'"':'"',"'":"'"},h=function(e){var t=-1;return e.multiSelect&&(t=e.selection.index,u.rangeCount!=e.multiSelect.rangeCount&&(u={rangeCount:e.multiSelect.rangeCount})),u[t]?i=u[t]:void(i=u[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""})},f=function(e,t,n,i){var r=e.end.row-e.start.row;return{text:n+t+i,selection:[0,e.start.column+1,r,e.end.column+(r?0:1)]}},p=function(e){this.add("braces","insertion",function(t,n,r,o,s){var l=r.getCursorPosition(),c=o.doc.getLine(l.row);if("{"==s){h(r);var u=r.getSelectionRange(),d=o.doc.getTextRange(u);if(""!==d&&"{"!==d&&r.getWrapBehavioursEnabled())return f(u,d,"{","}");if(p.isSaneInsertion(r,o))return/[\]\}\)]/.test(c[l.column])||r.inMultiSelectMode||e&&e.braces?(p.recordAutoInsert(r,o,"}"),{text:"{}",selection:[1,1]}):(p.recordMaybeInsert(r,o,"{"),{text:"{",selection:[1,1]})}else if("}"==s){h(r);var g=c.substring(l.column,l.column+1);if("}"==g){var m=o.$findOpeningBracket("}",{column:l.column+1,row:l.row});if(null!==m&&p.isAutoInsertedClosing(l,c,s))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else{if("\n"==s||"\r\n"==s){h(r);var v="";p.isMaybeInsertedClosing(l,c)&&(v=a.stringRepeat("}",i.maybeInsertedBrackets),p.clearMaybeInsertedClosing());var g=c.substring(l.column,l.column+1);if("}"===g){var y=o.findMatchingBracket({row:l.row,column:l.column+1},"}");if(!y)return null;var w=this.$getIndent(o.getLine(y.row))}else{if(!v)return void p.clearMaybeInsertedClosing();var w=this.$getIndent(c)}var b=w+o.getTabString();return{text:"\n"+b+"\n"+w+v,selection:[1,b.length,1,b.length]}}p.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,n,r,o){var s=r.doc.getTextRange(o);if(!o.isMultiLine()&&"{"==s){h(n);var a=r.doc.getLine(o.start.row),l=a.substring(o.end.column,o.end.column+1);if("}"==l)return o.end.column++,o;i.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,i,r){if("("==r){h(n);var o=n.getSelectionRange(),s=i.doc.getTextRange(o);if(""!==s&&n.getWrapBehavioursEnabled())return f(o,s,"(",")");if(p.isSaneInsertion(n,i))return p.recordAutoInsert(n,i,")"),{text:"()",selection:[1,1]}}else if(")"==r){h(n);var a=n.getCursorPosition(),l=i.doc.getLine(a.row),c=l.substring(a.column,a.column+1);if(")"==c){var u=i.$findOpeningBracket(")",{column:a.column+1,row:a.row});if(null!==u&&p.isAutoInsertedClosing(a,l,r))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(e,t,n,i,r){var o=i.doc.getTextRange(r);if(!r.isMultiLine()&&"("==o){h(n);var s=i.doc.getLine(r.start.row),a=s.substring(r.start.column+1,r.start.column+2);if(")"==a)return r.end.column++,r}}),this.add("brackets","insertion",function(e,t,n,i,r){if("["==r){h(n);var o=n.getSelectionRange(),s=i.doc.getTextRange(o);if(""!==s&&n.getWrapBehavioursEnabled())return f(o,s,"[","]");if(p.isSaneInsertion(n,i))return p.recordAutoInsert(n,i,"]"),{text:"[]",selection:[1,1]}}else if("]"==r){h(n);var a=n.getCursorPosition(),l=i.doc.getLine(a.row),c=l.substring(a.column,a.column+1);if("]"==c){var u=i.$findOpeningBracket("]",{column:a.column+1,row:a.row});if(null!==u&&p.isAutoInsertedClosing(a,l,r))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(e,t,n,i,r){var o=i.doc.getTextRange(r);if(!r.isMultiLine()&&"["==o){h(n);var s=i.doc.getLine(r.start.row),a=s.substring(r.start.column+1,r.start.column+2);if("]"==a)return r.end.column++,r}}),this.add("string_dquotes","insertion",function(e,t,n,i,r){var o=i.$mode.$quotes||d;if(1==r.length&&o[r]){if(this.lineCommentStart&&-1!=this.lineCommentStart.indexOf(r))return;h(n);var s=r,a=n.getSelectionRange(),l=i.doc.getTextRange(a);if(!(""===l||1==l.length&&o[l])&&n.getWrapBehavioursEnabled())return f(a,l,s,s);if(!l){var c=n.getCursorPosition(),u=i.doc.getLine(c.row),p=u.substring(c.column-1,c.column),g=u.substring(c.column,c.column+1),m=i.getTokenAt(c.row,c.column),v=i.getTokenAt(c.row,c.column+1);if("\\"==p&&m&&/escape/.test(m.type))return null;var y,w=m&&/string|escape/.test(m.type),b=!v||/string|escape/.test(v.type);if(g==s)y=w!==b,y&&/string\.end/.test(v.type)&&(y=!1);else{if(w&&!b)return null;if(w&&b)return null;var _=i.$mode.tokenRe;_.lastIndex=0;var C=_.test(p);_.lastIndex=0;var k=_.test(p);if(C||k)return null;if(g&&!/[\s;,.})\]\\]/.test(g))return null;var S=u[c.column-2];if(p==s&&(S==s||_.test(S)))return null;y=!0}return{text:y?s+s:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,i,r){var o=i.$mode.$quotes||d,s=i.doc.getTextRange(r);if(!r.isMultiLine()&&o.hasOwnProperty(s)){h(n);var a=i.doc.getLine(r.start.row),l=a.substring(r.start.column+1,r.start.column+2);if(l==s)return r.end.column++,r}})};p.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),i=new s(t,n.row,n.column);if(!this.$matchTokenType(i.getCurrentToken()||"text",l)){var r=new s(t,n.row,n.column+1);if(!this.$matchTokenType(r.getCurrentToken()||"text",l))return!1}return i.stepForward(),i.getCurrentTokenRow()!==n.row||this.$matchTokenType(i.getCurrentToken()||"text",c)},p.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},p.recordAutoInsert=function(e,t,n){var r=e.getCursorPosition(),o=t.doc.getLine(r.row);this.isAutoInsertedClosing(r,o,i.autoInsertedLineEnd[0])||(i.autoInsertedBrackets=0),i.autoInsertedRow=r.row,i.autoInsertedLineEnd=n+o.substr(r.column),i.autoInsertedBrackets++},p.recordMaybeInsert=function(e,t,n){var r=e.getCursorPosition(),o=t.doc.getLine(r.row);this.isMaybeInsertedClosing(r,o)||(i.maybeInsertedBrackets=0),i.maybeInsertedRow=r.row,i.maybeInsertedLineStart=o.substr(0,r.column)+n,i.maybeInsertedLineEnd=o.substr(r.column),i.maybeInsertedBrackets++},p.isAutoInsertedClosing=function(e,t,n){return i.autoInsertedBrackets>0&&e.row===i.autoInsertedRow&&n===i.autoInsertedLineEnd[0]&&t.substr(e.column)===i.autoInsertedLineEnd},p.isMaybeInsertedClosing=function(e,t){return i.maybeInsertedBrackets>0&&e.row===i.maybeInsertedRow&&t.substr(e.column)===i.maybeInsertedLineEnd&&t.substr(0,e.column)==i.maybeInsertedLineStart},p.popAutoInsertedClosing=function(){i.autoInsertedLineEnd=i.autoInsertedLineEnd.substr(1),i.autoInsertedBrackets--},p.clearMaybeInsertedClosing=function(){i&&(i.maybeInsertedBrackets=0,i.maybeInsertedRow=-1)},r.inherits(p,o),t.CstyleBehaviour=p}),ace.define("ace/unicode",[],function(e,t,n){"use strict";for(var i=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],r=0,o=[],s=0;s<i.length;s+=2)o.push(r+=i[s]),i[s+1]&&o.push(45,r+=i[s+1]);t.wordChars=String.fromCharCode.apply(null,o)}),ace.define("ace/mode/text",[],function(e,t,n){"use strict";var i=e("../config"),r=e("../tokenizer").Tokenizer,o=e("./text_highlight_rules").TextHighlightRules,s=e("./behaviour/cstyle").CstyleBehaviour,a=e("../unicode"),l=e("../lib/lang"),c=e("../token_iterator").TokenIterator,u=e("../range").Range,d=function(){this.HighlightRules=o};(function(){this.$defaultBehaviour=new s,this.tokenRe=new RegExp("^["+a.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+a.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new r(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,t,n,i){function r(e){for(var t=n;i>=t;t++)e(o.getLine(t),t)}var o=t.doc,s=!0,a=!0,c=1/0,u=t.getTabSize(),d=!1;if(this.lineCommentStart){if(Array.isArray(this.lineCommentStart))var h=this.lineCommentStart.map(l.escapeRegExp).join("|"),f=this.lineCommentStart[0];else var h=l.escapeRegExp(this.lineCommentStart),f=this.lineCommentStart;h=new RegExp("^(\\s*)(?:"+h+") ?"),d=t.getUseSoftTabs();var p=function(e,t){var n=e.match(h);if(n){var i=n[1].length,r=n[0].length;y(e,i,r)||" "!=n[0][r-1]||r--,o.removeInLine(t,i,r)}},g=f+" ",m=function(e,t){(!s||/\S/.test(e))&&(y(e,c,c)?o.insertInLine({row:t,column:c},g):o.insertInLine({row:t,column:c},f))},v=function(e,t){return h.test(e)},y=function(e,t,n){for(var i=0;t--&&" "==e.charAt(t);)i++;if(i%u!=0)return!1;for(var i=0;" "==e.charAt(n++);)i++;return u>2?i%u!=u-1:i%u==0}}else{if(!this.blockComment)return!1;var f=this.blockComment.start,w=this.blockComment.end,h=new RegExp("^(\\s*)(?:"+l.escapeRegExp(f)+")"),b=new RegExp("(?:"+l.escapeRegExp(w)+")\\s*$"),m=function(e,t){v(e,t)||(!s||/\S/.test(e))&&(o.insertInLine({row:t,column:e.length},w),o.insertInLine({row:t,column:c},f))},p=function(e,t){var n;(n=e.match(b))&&o.removeInLine(t,e.length-n[0].length,e.length),(n=e.match(h))&&o.removeInLine(t,n[1].length,n[0].length)},v=function(e,n){if(h.test(e))return!0;for(var i=t.getTokens(n),r=0;r<i.length;r++)if("comment"===i[r].type)return!0}}var _=1/0;r(function(e,t){var n=e.search(/\S/);-1!==n?(c>n&&(c=n),a&&!v(e,t)&&(a=!1)):_>e.length&&(_=e.length)}),c==1/0&&(c=_,s=!1,a=!1),d&&c%u!=0&&(c=Math.floor(c/u)*u),r(a?p:m)},this.toggleBlockComment=function(e,t,n,i){var r=this.blockComment;if(r){!r.start&&r[0]&&(r=r[0]);var o,s,a=new c(t,i.row,i.column),l=a.getCurrentToken(),d=(t.selection,t.selection.toOrientedRange());if(l&&/comment/.test(l.type)){for(var h,f;l&&/comment/.test(l.type);){var p=l.value.indexOf(r.start);if(-1!=p){var g=a.getCurrentTokenRow(),m=a.getCurrentTokenColumn()+p;h=new u(g,m,g,m+r.start.length);break}l=a.stepBackward()}for(var a=new c(t,i.row,i.column),l=a.getCurrentToken();l&&/comment/.test(l.type);){var p=l.value.indexOf(r.end);if(-1!=p){var g=a.getCurrentTokenRow(),m=a.getCurrentTokenColumn()+p;f=new u(g,m,g,m+r.end.length);break}l=a.stepForward()}f&&t.remove(f),h&&(t.remove(h),o=h.start.row,s=-r.start.length)}else s=r.start.length,o=n.start.row,t.insert(n.end,r.end),t.insert(n.start,r.start);d.start.row==o&&(d.start.column+=s),d.end.row==o&&(d.end.column+=s),t.selection.fromOrientedRange(d)}},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.autoOutdent=function(e,t,n){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){this.$embeds=[],this.$modes={};for(var t in e)if(e[t]){var n=e[t],r=n.prototype.$id,o=i.$modes[r];o||(i.$modes[r]=o=new n),i.$modes[t]||(i.$modes[t]=o),this.$embeds.push(t),this.$modes[t]=o}for(var s=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],t=0;t<s.length;t++)!function(e){var n=s[t],i=e[n];e[s[t]]=function(){return this.$delegator(n,arguments,i)}}(this)},this.$delegator=function(e,t,n){var i=t[0]||"start";if("string"!=typeof i){if(Array.isArray(i[2])){var r=i[2][i[2].length-1],o=this.$modes[r];if(o)return o[e].apply(o,[i[1]].concat([].slice.call(t,1)))}i=i[0]||"start"}for(var s=0;s<this.$embeds.length;s++)if(this.$modes[this.$embeds[s]]){var a=i.split(this.$embeds[s]);if(!a[0]&&a[1]){t[0]=a[1];var o=this.$modes[this.$embeds[s]];return o[e].apply(o,t)}}var l=n.apply(this,t);return n?l:void 0},this.transformAction=function(e,t,n,i,r){if(this.$behaviour){var o=this.$behaviour.getBehaviours();for(var s in o)if(o[s][t]){var a=o[s][t].apply(this,arguments);if(a)return a}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,n=[];for(var i in t)for(var r=t[i],o=0,s=r.length;s>o;o++)if("string"==typeof r[o].token)/keyword|support|storage/.test(r[o].token)&&n.push(r[o].regex);else if("object"==typeof r[o].token)for(var a=0,l=r[o].token.length;l>a;a++)if(/keyword|support|storage/.test(r[o].token[a])){var i=r[o].regex.match(/\(.+?\)/g)[a];n.push(i.substr(1,i.length-2))}this.completionKeywords=n}return e?n.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,n,i){var r=this.$keywordList||this.$createKeywordList();return r.map(function(e){return{name:e,value:e,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(d.prototype),t.Mode=d}),ace.define("ace/apply_delta",[],function(e,t,n){"use strict";t.applyDelta=function(e,t,n){var i=t.start.row,r=t.start.column,o=e[i]||"";switch(t.action){case"insert":var s=t.lines;if(1===s.length)e[i]=o.substring(0,r)+t.lines[0]+o.substring(r);else{var a=[i,1].concat(t.lines);e.splice.apply(e,a),e[i]=o.substring(0,r)+e[i],e[i+t.lines.length-1]+=o.substring(r)}break;case"remove":var l=t.end.column,c=t.end.row;i===c?e[i]=o.substring(0,r)+o.substring(l):e.splice(i,c-i+1,o.substring(0,r)+e[c].substring(l))}}}),ace.define("ace/anchor",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,o=t.Anchor=function(e,t,n){this.$onChange=this.onChange.bind(this),this.attach(e),"undefined"==typeof n?this.setPosition(t.row,t.column):this.setPosition(t,n)};(function(){function e(e,t,n){var i=n?e.column<=t.column:e.column<t.column;return e.row<t.row||e.row==t.row&&i}function t(t,n,i){var r="insert"==t.action,o=(r?1:-1)*(t.end.row-t.start.row),s=(r?1:-1)*(t.end.column-t.start.column),a=t.start,l=r?a:t.end;return e(n,a,i)?{row:n.row,column:n.column}:e(l,n,!i)?{row:n.row+o,column:n.column+(n.row==l.row?s:0)}:{row:a.row,column:a.column}}i.implement(this,r),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(e){if(!(e.start.row==e.end.row&&e.start.row!=this.row||e.start.row>this.row)){var n=t(e,{row:this.row,column:this.column},this.$insertRight);this.setPosition(n.row,n.column,!0)}},this.setPosition=function(e,t,n){var i;if(i=n?{row:e,column:t}:this.$clipPositionToDocument(e,t),this.row!=i.row||this.column!=i.column){var r={row:this.row,column:this.column};this.row=i.row,this.column=i.column,this._signal("change",{old:r,value:i})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(e,t){var n={};return e>=this.document.getLength()?(n.row=Math.max(0,this.document.getLength()-1),n.column=this.document.getLine(n.row).length):0>e?(n.row=0,
n.column=0):(n.row=e,n.column=Math.min(this.document.getLine(n.row).length,Math.max(0,t))),0>t&&(n.column=0),n}}).call(o.prototype)}),ace.define("ace/document",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./apply_delta").applyDelta,o=e("./lib/event_emitter").EventEmitter,s=e("./range").Range,a=e("./anchor").Anchor,l=function(e){this.$lines=[""],0===e.length?this.$lines=[""]:Array.isArray(e)?this.insertMergedLines({row:0,column:0},e):this.insert({row:0,column:0},e)};(function(){i.implement(this,o),this.setValue=function(e){var t=this.getLength()-1;this.remove(new s(0,0,t,this.getLine(t).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new a(this,e,t)},0==="aaa".split(/a/).length?this.$split=function(e){return e.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(e){return e.split(/\r\n|\r|\n/)},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=t?t[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(e){this.$newLineMode!==e&&(this.$newLineMode=e,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return"\r\n"==e||"\r"==e||"\n"==e},this.getLine=function(e){return this.$lines[e]||""},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){return this.getLinesForRange(e).join(this.getNewLineCharacter())},this.getLinesForRange=function(e){var t;if(e.start.row===e.end.row)t=[this.getLine(e.start.row).substring(e.start.column,e.end.column)];else{t=this.getLines(e.start.row,e.end.row),t[0]=(t[0]||"").substring(e.start.column);var n=t.length-1;e.end.row-e.start.row==n&&(t[n]=t[n].substring(0,e.end.column))}return t},this.insertLines=function(e,t){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(e,t)},this.removeLines=function(e,t){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(e,t)},this.insertNewLine=function(e){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(e,["",""])},this.insert=function(e,t){return this.getLength()<=1&&this.$detectNewLine(t),this.insertMergedLines(e,this.$split(t))},this.insertInLine=function(e,t){var n=this.clippedPos(e.row,e.column),i=this.pos(e.row,e.column+t.length);return this.applyDelta({start:n,end:i,action:"insert",lines:[t]},!0),this.clonePos(i)},this.clippedPos=function(e,t){var n=this.getLength();void 0===e?e=n:0>e?e=0:e>=n&&(e=n-1,t=void 0);var i=this.getLine(e);return void 0==t&&(t=i.length),t=Math.min(Math.max(t,0),i.length),{row:e,column:t}},this.clonePos=function(e){return{row:e.row,column:e.column}},this.pos=function(e,t){return{row:e,column:t}},this.$clipPosition=function(e){var t=this.getLength();return e.row>=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):(e.row=Math.max(0,e.row),e.column=Math.min(Math.max(e.column,0),this.getLine(e.row).length)),e},this.insertFullLines=function(e,t){e=Math.min(Math.max(e,0),this.getLength());var n=0;e<this.getLength()?(t=t.concat([""]),n=0):(t=[""].concat(t),e--,n=this.$lines[e].length),this.insertMergedLines({row:e,column:n},t)},this.insertMergedLines=function(e,t){var n=this.clippedPos(e.row,e.column),i={row:n.row+t.length-1,column:(1==t.length?n.column:0)+t[t.length-1].length};return this.applyDelta({start:n,end:i,action:"insert",lines:t}),this.clonePos(i)},this.remove=function(e){var t=this.clippedPos(e.start.row,e.start.column),n=this.clippedPos(e.end.row,e.end.column);return this.applyDelta({start:t,end:n,action:"remove",lines:this.getLinesForRange({start:t,end:n})}),this.clonePos(t)},this.removeInLine=function(e,t,n){var i=this.clippedPos(e,t),r=this.clippedPos(e,n);return this.applyDelta({start:i,end:r,action:"remove",lines:this.getLinesForRange({start:i,end:r})},!0),this.clonePos(i)},this.removeFullLines=function(e,t){e=Math.min(Math.max(0,e),this.getLength()-1),t=Math.min(Math.max(0,t),this.getLength()-1);var n=t==this.getLength()-1&&e>0,i=t<this.getLength()-1,r=n?e-1:e,o=n?this.getLine(r).length:0,a=i?t+1:t,l=i?0:this.getLine(a).length,c=new s(r,o,a,l),u=this.$lines.slice(e,t+1);return this.applyDelta({start:c.start,end:c.end,action:"remove",lines:this.getLinesForRange(c)}),u},this.removeNewLine=function(e){e<this.getLength()-1&&e>=0&&this.applyDelta({start:this.pos(e,this.getLine(e).length),end:this.pos(e+1,0),action:"remove",lines:["",""]})},this.replace=function(e,t){if(e instanceof s||(e=s.fromPoints(e.start,e.end)),0===t.length&&e.isEmpty())return e.start;if(t==this.getTextRange(e))return e.end;this.remove(e);var n;return n=t?this.insert(e.start,t):e.start},this.applyDeltas=function(e){for(var t=0;t<e.length;t++)this.applyDelta(e[t])},this.revertDeltas=function(e){for(var t=e.length-1;t>=0;t--)this.revertDelta(e[t])},this.applyDelta=function(e,t){var n="insert"==e.action;(n?e.lines.length<=1&&!e.lines[0]:!s.comparePoints(e.start,e.end))||(n&&e.lines.length>2e4?this.$splitAndapplyLargeDelta(e,2e4):(r(this.$lines,e,t),this._signal("change",e)))},this.$splitAndapplyLargeDelta=function(e,t){for(var n=e.lines,i=n.length-t+1,r=e.start.row,o=e.start.column,s=0,a=0;i>s;s=a){a+=t-1;var l=n.slice(s,a);l.push(""),this.applyDelta({start:this.pos(r+s,o),end:this.pos(r+a,o=0),action:e.action,lines:l},!0)}e.lines=n.slice(s),e.start.row=r+s,e.start.column=o,this.applyDelta(e,!0)},this.revertDelta=function(e){this.applyDelta({start:this.clonePos(e.start),end:this.clonePos(e.end),action:"insert"==e.action?"remove":"insert",lines:e.lines.slice()})},this.indexToPosition=function(e,t){for(var n=this.$lines||this.getAllLines(),i=this.getNewLineCharacter().length,r=t||0,o=n.length;o>r;r++)if(e-=n[r].length+i,0>e)return{row:r,column:e+n[r].length+i};return{row:o-1,column:e+n[o-1].length+i}},this.positionToIndex=function(e,t){for(var n=this.$lines||this.getAllLines(),i=this.getNewLineCharacter().length,r=0,o=Math.min(e.row,n.length),s=t||0;o>s;++s)r+=n[s].length+i;return r+e.column}}).call(l.prototype),t.Document=l}),ace.define("ace/background_tokenizer",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,o=function(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var n=this;this.$worker=function(){if(n.running){for(var e=new Date,t=n.currentLine,i=-1,r=n.doc,o=t;n.lines[t];)t++;var s=r.getLength(),a=0;for(n.running=!1;s>t;){n.$tokenizeRow(t),i=t;do t++;while(n.lines[t]);if(a++,a%5===0&&new Date-e>20){n.running=setTimeout(n.$worker,20);break}}n.currentLine=t,-1==i&&(i=t),i>=o&&n.fireUpdateEvent(o,i)}}};(function(){i.implement(this,r),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){var n={first:e,last:t};this._signal("update",{data:n})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.start.row,n=e.end.row-t;if(0===n)this.lines[t]=null;else if("remove"==e.action)this.lines.splice(t,n+1,null),this.states.splice(t,n+1,null);else{var i=Array(n+1);i.unshift(t,1),this.lines.splice.apply(this.lines,i),this.states.splice.apply(this.states,i)}this.currentLine=Math.min(t,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&&this.$tokenizeRow(e),this.states[e]||"start"},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),n=this.states[e-1],i=this.tokenizer.getLineTokens(t,n,e);return this.states[e]+""!=i.state+""?(this.states[e]=i.state,this.lines[e+1]=null,this.currentLine>e+1&&(this.currentLine=e+1)):this.currentLine==e&&(this.currentLine=e+1),this.lines[e]=i.tokens}}).call(o.prototype),t.BackgroundTokenizer=o}),ace.define("ace/search_highlight",[],function(e,t,n){"use strict";var i=e("./lib/lang"),r=(e("./lib/oop"),e("./range").Range),o=function(e,t,n){this.setRegexp(e),this.clazz=t,this.type=n||"text"};(function(){this.MAX_RANGES=500,this.setRegexp=function(e){this.regExp+""!=e+""&&(this.regExp=e,this.cache=[])},this.update=function(e,t,n,o){if(this.regExp)for(var s=o.firstRow,a=o.lastRow,l=s;a>=l;l++){var c=this.cache[l];null==c&&(c=i.getMatchOffsets(n.getLine(l),this.regExp),c.length>this.MAX_RANGES&&(c=c.slice(0,this.MAX_RANGES)),c=c.map(function(e){return new r(l,e.offset,l,e.offset+e.length)}),this.cache[l]=c.length?c:"");for(var u=c.length;u--;)t.drawSingleLineMarker(e,c[u].toScreenRange(n),this.clazz,o)}}}).call(o.prototype),t.SearchHighlight=o}),ace.define("ace/edit_session/fold_line",[],function(e,t,n){"use strict";function i(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];var n=t[t.length-1];this.range=new r(t[0].start.row,t[0].start.column,n.end.row,n.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(e){e.setFoldLine(this)},this)}var r=e("../range").Range;(function(){this.shiftRow=function(e){this.start.row+=e,this.end.row+=e,this.folds.forEach(function(t){t.start.row+=e,t.end.row+=e})},this.addFold=function(e){if(e.sameRow){if(e.start.row<this.startRow||e.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(e),this.folds.sort(function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)}),this.range.compareEnd(e.start.row,e.start.column)>0?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)<0&&(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e>=this.start.row&&e<=this.end.row},this.walk=function(e,t,n){var i,r,o,s=0,a=this.folds,l=!0;null==t&&(t=this.end.row,n=this.end.column);for(var c=0;c<a.length;c++){if(i=a[c],r=i.range.compareStart(t,n),-1==r)return void e(null,t,n,s,l);if(o=e(null,i.start.row,i.start.column,s,l),o=!o&&e(i.placeholder,i.start.row,i.start.column,s),o||0===r)return;l=!i.sameRow,s=i.end.column}e(null,t,n,s,l)},this.getNextFoldTo=function(e,t){for(var n,i,r=0;r<this.folds.length;r++){if(n=this.folds[r],i=n.range.compareEnd(e,t),-1==i)return{fold:n,kind:"after"};if(0===i)return{fold:n,kind:"inside"}}return null},this.addRemoveChars=function(e,t,n){var i,r,o=this.getNextFoldTo(e,t);if(o)if(i=o.fold,"inside"==o.kind&&i.start.column!=t&&i.start.row!=e)window.console&&window.console.log(e,t,i);else if(i.start.row==e){r=this.folds;var s=r.indexOf(i);for(0===s&&(this.start.column+=n),s;s<r.length;s++){if(i=r[s],i.start.column+=n,!i.sameRow)return;i.end.column+=n}this.end.column+=n}},this.split=function(e,t){var n=this.getNextFoldTo(e,t);if(!n||"inside"==n.kind)return null;var r=n.fold,o=this.folds,s=this.foldData,a=o.indexOf(r),l=o[a-1];this.end.row=l.end.row,this.end.column=l.end.column,o=o.splice(a,o.length-a);var c=new i(s,o);return s.splice(s.indexOf(this)+1,0,c),c},this.merge=function(e){for(var t=e.folds,n=0;n<t.length;n++)this.addFold(t[n]);var i=this.foldData;i.splice(i.indexOf(e),1)},this.toString=function(){var e=[this.range.toString()+": ["];return this.folds.forEach(function(t){e.push("  "+t.toString())}),e.push("]"),e.join("\n")},this.idxToPosition=function(e){for(var t=0,n=0;n<this.folds.length;n++){var i=this.folds[n];if(e-=i.start.column-t,0>e)return{row:i.start.row,column:i.start.column+e};if(e-=i.placeholder.length,0>e)return i.start;t=i.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(i.prototype),t.FoldLine=i}),ace.define("ace/range_list",[],function(e,t,n){"use strict";var i=e("./range").Range,r=i.comparePoints,o=function(){this.ranges=[]};(function(){this.comparePoints=r,this.pointIndex=function(e,t,n){for(var i=this.ranges,o=n||0;o<i.length;o++){var s=i[o],a=r(e,s.end);if(!(a>0)){var l=r(e,s.start);return 0===a?t&&0!==l?-o-2:o:l>0||0===l&&!t?o:-o-1}}return-o-1},this.add=function(e){var t=!e.isEmpty(),n=this.pointIndex(e.start,t);0>n&&(n=-n-1);var i=this.pointIndex(e.end,t,n);return 0>i?i=-i-1:i++,this.ranges.splice(n,i-n,e)},this.addList=function(e){for(var t=[],n=e.length;n--;)t.push.apply(t,this.add(e[n]));return t},this.substractPoint=function(e){var t=this.pointIndex(e);return t>=0?this.ranges.splice(t,1):void 0},this.merge=function(){var e=[],t=this.ranges;t=t.sort(function(e,t){return r(e.start,t.start)});for(var n,i=t[0],o=1;o<t.length;o++){n=i,i=t[o];var s=r(n.end,i.start);0>s||(0!=s||n.isEmpty()||i.isEmpty())&&(r(n.end,i.end)<0&&(n.end.row=i.end.row,n.end.column=i.end.column),t.splice(o,1),e.push(i),i=n,o--)}return this.ranges=t,e},this.contains=function(e,t){return this.pointIndex({row:e,column:t})>=0},this.containsPoint=function(e){return this.pointIndex(e)>=0},this.rangeAtPoint=function(e){var t=this.pointIndex(e);return t>=0?this.ranges[t]:void 0},this.clipRows=function(e,t){var n=this.ranges;if(n[0].start.row>t||n[n.length-1].start.row<e)return[];var i=this.pointIndex({row:e,column:0});0>i&&(i=-i-1);var r=this.pointIndex({row:t,column:0},i);0>r&&(r=-r-1);for(var o=[],s=i;r>s;s++)o.push(n[s]);return o},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&&this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},this.$onChange=function(e){for(var t=e.start,n=e.end,i=t.row,r=n.row,o=this.ranges,s=0,a=o.length;a>s;s++){var l=o[s];if(l.end.row>=i)break}if("insert"==e.action)for(var c=r-i,u=-t.column+n.column;a>s;s++){var l=o[s];if(l.start.row>i)break;if(l.start.row==i&&l.start.column>=t.column&&(l.start.column==t.column&&this.$insertRight||(l.start.column+=u,l.start.row+=c)),l.end.row==i&&l.end.column>=t.column){if(l.end.column==t.column&&this.$insertRight)continue;l.end.column==t.column&&u>0&&a-1>s&&l.end.column>l.start.column&&l.end.column==o[s+1].start.column&&(l.end.column-=u),l.end.column+=u,l.end.row+=c}}else for(var c=i-r,u=t.column-n.column;a>s;s++){var l=o[s];if(l.start.row>r)break;l.end.row<r&&(i<l.end.row||i==l.end.row&&t.column<l.end.column)?(l.end.row=i,l.end.column=t.column):l.end.row==r?l.end.column<=n.column?(c||l.end.column>t.column)&&(l.end.column=t.column,l.end.row=t.row):(l.end.column+=u,l.end.row+=c):l.end.row>r&&(l.end.row+=c),l.start.row<r&&(i<l.start.row||i==l.start.row&&t.column<l.start.column)?(l.start.row=i,l.start.column=t.column):l.start.row==r?l.start.column<=n.column?(c||l.start.column>t.column)&&(l.start.column=t.column,l.start.row=t.row):(l.start.column+=u,l.start.row+=c):l.start.row>r&&(l.start.row+=c)}if(0!=c&&a>s)for(;a>s;s++){var l=o[s];l.start.row+=c,l.end.row+=c}}}).call(o.prototype),t.RangeList=o}),ace.define("ace/edit_session/fold",[],function(e,t,n){"use strict";function i(e,t){e.row-=t.row,0==e.row&&(e.column-=t.column)}function r(e,t){i(e.start,t),i(e.end,t)}function o(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row}function s(e,t){o(e.start,t),o(e.end,t)}var a=e("../range_list").RangeList,l=e("../lib/oop"),c=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};l.inherits(c,a),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(e){this.foldLine=e,this.subFolds.forEach(function(t){t.setFoldLine(e)})},this.clone=function(){var e=this.range.clone(),t=new c(e,this.placeholder);return this.subFolds.forEach(function(e){t.subFolds.push(e.clone())}),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(!this.range.isEqual(e)){r(e,this.start);for(var t=e.start.row,n=e.start.column,i=0,o=-1;i<this.subFolds.length&&(o=this.subFolds[i].range.compare(t,n),1==o);i++);var s=this.subFolds[i],a=0;if(0==o){if(s.range.containsRange(e))return s.addSubFold(e);a=1}for(var t=e.range.end.row,n=e.range.end.column,l=i,o=-1;l<this.subFolds.length&&(o=this.subFolds[l].range.compare(t,n),1==o);l++);0==o&&l++;for(var c=this.subFolds.splice(i,l-i,e),u=0==o?c.length-1:c.length,d=a;u>d;d++)e.addSubFold(c[d]);return e.setFoldLine(this.foldLine),e}},this.restoreRange=function(e){return s(e,this.start)}}.call(c.prototype)}),ace.define("ace/edit_session/folding",[],function(e,t,n){"use strict";function i(){this.getFoldAt=function(e,t,n){var i=this.getFoldLine(e);if(!i)return null;for(var r=i.folds,o=0;o<r.length;o++){var s=r[o].range;if(s.contains(e,t)){if(1==n&&s.isEnd(e,t)&&!s.isEmpty())continue;if(-1==n&&s.isStart(e,t)&&!s.isEmpty())continue;return r[o]}}},this.getFoldsInRange=function(e){var t=e.start,n=e.end,i=this.$foldData,r=[];t.column+=1,n.column-=1;for(var o=0;o<i.length;o++){var s=i[o].range.compareRange(e);if(2!=s){if(-2==s)break;for(var a=i[o].folds,l=0;l<a.length;l++){var c=a[l];if(s=c.range.compareRange(e),-2==s)break;if(2!=s){if(42==s)break;r.push(c)}}}}return t.column-=1,n.column+=1,r},this.getFoldsInRangeList=function(e){if(Array.isArray(e)){var t=[];e.forEach(function(e){t=t.concat(this.getFoldsInRange(e))},this)}else var t=this.getFoldsInRange(e);return t},this.getAllFolds=function(){for(var e=[],t=this.$foldData,n=0;n<t.length;n++)for(var i=0;i<t[n].folds.length;i++)e.push(t[n].folds[i]);return e},this.getFoldStringAt=function(e,t,n,i){if(i=i||this.getFoldLine(e),!i)return null;for(var r,o,s={end:{column:0}},a=0;a<i.folds.length;a++){o=i.folds[a];var l=o.range.compareEnd(e,t);if(-1==l){r=this.getLine(o.start.row).substring(s.end.column,o.start.column);break}if(0===l)return null;s=o}return r||(r=this.getLine(o.start.row).substring(s.end.column)),-1==n?r.substring(0,t-s.end.column):1==n?r.substring(t-s.end.column):r},this.getFoldLine=function(e,t){var n=this.$foldData,i=0;for(t&&(i=n.indexOf(t)),-1==i&&(i=0),i;i<n.length;i++){var r=n[i];if(r.start.row<=e&&r.end.row>=e)return r;if(r.end.row>e)return null}return null},this.getNextFoldLine=function(e,t){var n=this.$foldData,i=0;for(t&&(i=n.indexOf(t)),-1==i&&(i=0),i;i<n.length;i++){var r=n[i];if(r.end.row>=e)return r}return null},this.getFoldedRowCount=function(e,t){for(var n=this.$foldData,i=t-e+1,r=0;r<n.length;r++){var o=n[r],s=o.end.row,a=o.start.row;if(s>=t){t>a&&(a>=e?i-=t-a:i=0);break}s>=e&&(i-=a>=e?s-a:s-e+1)}return i},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort(function(e,t){return e.start.row-t.start.row}),e},this.addFold=function(e,t){var n,i=this.$foldData,r=!1;e instanceof s?n=e:(n=new s(t,e),n.collapseChildren=t.collapseChildren),this.$clipRangeToDocument(n.range);var a=n.start.row,l=n.start.column,c=n.end.row,u=n.end.column,d=this.getFoldAt(a,l,1),h=this.getFoldAt(c,u,-1);if(d&&h==d)return d.addSubFold(n);d&&!d.range.isStart(a,l)&&this.removeFold(d),h&&!h.range.isEnd(c,u)&&this.removeFold(h);var f=this.getFoldsInRange(n.range);f.length>0&&(this.removeFolds(f),f.forEach(function(e){n.addSubFold(e)}));for(var p=0;p<i.length;p++){var g=i[p];if(c==g.start.row){g.addFold(n),r=!0;break}if(a==g.end.row){if(g.addFold(n),r=!0,!n.sameRow){var m=i[p+1];if(m&&m.start.row==c){g.merge(m);break}}break}if(c<=g.start.row)break}return r||(g=this.$addFoldLine(new o(this.$foldData,n))),this.$useWrapMode?this.$updateWrapData(g.start.row,g.start.row):this.$updateRowLengthCache(g.start.row,g.start.row),this.$modified=!0,this._signal("changeFold",{data:n,action:"add"}),n},this.addFolds=function(e){e.forEach(function(e){this.addFold(e)},this)},this.removeFold=function(e){var t=e.foldLine,n=t.start.row,i=t.end.row,r=this.$foldData,o=t.folds;if(1==o.length)r.splice(r.indexOf(t),1);else if(t.range.isEnd(e.end.row,e.end.column))o.pop(),t.end.row=o[o.length-1].end.row,t.end.column=o[o.length-1].end.column;else if(t.range.isStart(e.start.row,e.start.column))o.shift(),t.start.row=o[0].start.row,t.start.column=o[0].start.column;else if(e.sameRow)o.splice(o.indexOf(e),1);else{var s=t.split(e.start.row,e.start.column);o=s.folds,o.shift(),s.start.row=o[0].start.row,s.start.column=o[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(n,i):this.$updateRowLengthCache(n,i)),this.$modified=!0,this._signal("changeFold",{data:e,action:"remove"})},this.removeFolds=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);t.forEach(function(e){this.removeFold(e)},this),this.$modified=!0},this.expandFold=function(e){this.removeFold(e),e.subFolds.forEach(function(t){e.restoreRange(t),this.addFold(t)},this),e.collapseChildren>0&&this.foldAll(e.start.row+1,e.end.row,e.collapseChildren-1),e.subFolds=[]},this.expandFolds=function(e){e.forEach(function(e){this.expandFold(e)},this)},this.unfold=function(e,t){var n,i;if(null==e?(n=new r(0,0,this.getLength(),0),t=!0):n="number"==typeof e?new r(e,0,e,this.getLine(e).length):"row"in e?r.fromPoints(e,e):e,i=this.getFoldsInRangeList(n),t)this.removeFolds(i);else for(var o=i;o.length;)this.expandFolds(o),o=this.getFoldsInRangeList(n);return i.length?i:void 0},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){var n=this.getFoldLine(e,t);return n?n.end.row:e},this.getRowFoldStart=function(e,t){var n=this.getFoldLine(e,t);return n?n.start.row:e},this.getFoldDisplayLine=function(e,t,n,i,r){null==i&&(i=e.start.row),null==r&&(r=0),null==t&&(t=e.end.row),null==n&&(n=this.getLine(t).length);var o=this.doc,s="";return e.walk(function(e,t,n,a){if(!(i>t)){if(t==i){if(r>n)return;a=Math.max(r,a)}s+=null!=e?e:o.getLine(t).substring(a,n)}},t,n),s},this.getDisplayLine=function(e,t,n,i){var r=this.getFoldLine(e);if(r)return this.getFoldDisplayLine(r,e,t,n,i);var o;return o=this.doc.getLine(e),o.substring(i||0,t||o.length)},this.$cloneFoldData=function(){var e=[];return e=this.$foldData.map(function(t){var n=t.folds.map(function(e){return e.clone()});return new o(e,n)})},this.toggleFold=function(e){var t,n,i=this.selection,r=i.getRange();if(r.isEmpty()){var o=r.start;if(t=this.getFoldAt(o.row,o.column))return void this.expandFold(t);(n=this.findMatchingBracket(o))?1==r.comparePoint(n)?r.end=n:(r.start=n,r.start.column++,r.end.column--):(n=this.findMatchingBracket({row:o.row,column:o.column+1}))?(1==r.comparePoint(n)?r.end=n:r.start=n,r.start.column++):r=this.getCommentFoldRange(o.row,o.column)||r}else{var s=this.getFoldsInRange(r);if(e&&s.length)return void this.expandFolds(s);1==s.length&&(t=s[0])}if(t||(t=this.getFoldAt(r.start.row,r.start.column)),t&&t.range.toString()==r.toString())return void this.expandFold(t);var a="...";if(!r.isMultiLine()){if(a=this.getTextRange(r),a.length<4)return;a=a.trim().substring(0,2)+".."}this.addFold(a,r)},this.getCommentFoldRange=function(e,t,n){var i=new a(this,e,t),o=i.getCurrentToken(),s=o.type;if(o&&/^comment|string/.test(s)){s=s.match(/comment|string/)[0],"comment"==s&&(s+="|doc-start");var l=new RegExp(s),c=new r;if(1!=n){do o=i.stepBackward();while(o&&l.test(o.type));i.stepForward()}if(c.start.row=i.getCurrentTokenRow(),c.start.column=i.getCurrentTokenColumn()+2,i=new a(this,e,t),-1!=n){var u=-1;do if(o=i.stepForward(),-1==u){var d=this.getState(i.$row);l.test(d)||(u=i.$row)}else if(i.$row>u)break;while(o&&l.test(o.type));o=i.stepBackward()}else o=i.getCurrentToken();return c.end.row=i.getCurrentTokenRow(),c.end.column=i.getCurrentTokenColumn()+o.value.length-2,c}},this.foldAll=function(e,t,n){void 0==n&&(n=1e5);var i=this.foldWidgets;if(i){t=t||this.getLength(),e=e||0;for(var r=e;t>r;r++)if(null==i[r]&&(i[r]=this.getFoldWidget(r)),"start"==i[r]){var o=this.getFoldWidgetRange(r);if(o&&o.isMultiLine()&&o.end.row<=t&&o.start.row>=e){r=o.end.row;try{var s=this.addFold("...",o);s&&(s.collapseChildren=n)}catch(a){}}}}},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error("invalid fold style: "+e+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle!=e){this.$foldStyle=e,"manual"==e&&this.unfold();var t=this.$foldMode;this.$setFolding(null),this.$setFolding(t)}},this.$setFolding=function(e){if(this.$foldMode!=e){if(this.$foldMode=e,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),!e||"manual"==this.$foldStyle)return void(this.foldWidgets=null);this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)}},this.getParentFoldRangeData=function(e,t){var n=this.foldWidgets;if(!n||t&&n[e])return{};for(var i,r=e-1;r>=0;){var o=n[r];if(null==o&&(o=n[r]=this.getFoldWidget(r)),"start"==o){var s=this.getFoldWidgetRange(r);if(i||(i=s),s&&s.end.row>=e)break}r--}return{range:-1!==r&&s,firstRange:i}},this.onFoldWidgetClick=function(e,t){t=t.domEvent;var n={children:t.shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey},i=this.$toggleFoldWidget(e,n);if(!i){var r=t.target||t.srcElement;r&&/ace_fold-widget/.test(r.className)&&(r.className+=" ace_invalid")}},this.$toggleFoldWidget=function(e,t){if(this.getFoldWidget){var n=this.getFoldWidget(e),i=this.getLine(e),r="end"===n?-1:1,o=this.getFoldAt(e,-1===r?0:i.length,r);if(o)return t.children||t.all?this.removeFold(o):this.expandFold(o),o;var s=this.getFoldWidgetRange(e,!0);if(s&&!s.isMultiLine()&&(o=this.getFoldAt(s.start.row,s.start.column,1),o&&s.isEqual(o.range)))return this.removeFold(o),o;if(t.siblings){var a=this.getParentFoldRangeData(e);if(a.range)var l=a.range.start.row+1,c=a.range.end.row;this.foldAll(l,c,t.all?1e4:0)}else t.children?(c=s?s.end.row:this.getLength(),this.foldAll(e+1,c,t.all?1e4:0)):s&&(t.all&&(s.collapseChildren=1e4),this.addFold("...",s));return s}},this.toggleFoldWidget=function(e){var t=this.selection.getCursor().row;t=this.getRowFoldStart(t);var n=this.$toggleFoldWidget(t,{});if(!n){var i=this.getParentFoldRangeData(t,!0);if(n=i.range||i.firstRange){t=n.start.row;var r=this.getFoldAt(t,this.getLine(t).length,1);r?this.removeFold(r):this.addFold("...",n)}}},this.updateFoldWidgets=function(e){var t=e.start.row,n=e.end.row-t;if(0===n)this.foldWidgets[t]=null;else if("remove"==e.action)this.foldWidgets.splice(t,n+1,null);else{var i=Array(n+1);i.unshift(t,1),this.foldWidgets.splice.apply(this.foldWidgets,i)}},this.tokenizerUpdateFoldWidgets=function(e){var t=e.data;t.first!=t.last&&this.foldWidgets.length>t.first&&this.foldWidgets.splice(t.first,this.foldWidgets.length)}}var r=e("../range").Range,o=e("./fold_line").FoldLine,s=e("./fold").Fold,a=e("../token_iterator").TokenIterator;t.Folding=i}),ace.define("ace/edit_session/bracket_match",[],function(e,t,n){"use strict";function i(){this.findMatchingBracket=function(e,t){if(0==e.column)return null;var n=t||this.getLine(e.row).charAt(e.column-1);if(""==n)return null;var i=n.match(/([\(\[\{])|([\)\]\}])/);return i?i[1]?this.$findClosingBracket(i[1],e):this.$findOpeningBracket(i[2],e):null},this.getBracketRange=function(e){var t,n=this.getLine(e.row),i=!0,r=n.charAt(e.column-1),s=r&&r.match(/([\(\[\{])|([\)\]\}])/);if(s||(r=n.charAt(e.column),e={row:e.row,column:e.column+1},s=r&&r.match(/([\(\[\{])|([\)\]\}])/),i=!1),!s)return null;if(s[1]){var a=this.$findClosingBracket(s[1],e);if(!a)return null;t=o.fromPoints(e,a),i||(t.end.column++,t.start.column--),t.cursor=t.end}else{var a=this.$findOpeningBracket(s[2],e);if(!a)return null;t=o.fromPoints(a,e),i||(t.start.column++,t.end.column--),t.cursor=t.start}return t},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(e,t,n){var i=this.$brackets[e],o=1,s=new r(this,t.row,t.column),a=s.getCurrentToken();if(a||(a=s.stepForward()),a){n||(n=new RegExp("(\\.?"+a.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+"));for(var l=t.column-s.getCurrentTokenColumn()-2,c=a.value;;){for(;l>=0;){var u=c.charAt(l);if(u==i){if(o-=1,0==o)return{row:s.getCurrentTokenRow(),column:l+s.getCurrentTokenColumn()}}else u==e&&(o+=1);l-=1}do a=s.stepBackward();while(a&&!n.test(a.type));if(null==a)break;c=a.value,l=c.length-1}return null}},this.$findClosingBracket=function(e,t,n){var i=this.$brackets[e],o=1,s=new r(this,t.row,t.column),a=s.getCurrentToken();if(a||(a=s.stepForward()),a){n||(n=new RegExp("(\\.?"+a.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+"));for(var l=t.column-s.getCurrentTokenColumn();;){for(var c=a.value,u=c.length;u>l;){var d=c.charAt(l);if(d==i){if(o-=1,0==o)return{row:s.getCurrentTokenRow(),column:l+s.getCurrentTokenColumn()}}else d==e&&(o+=1);l+=1}do a=s.stepForward();while(a&&!n.test(a.type));if(null==a)break;l=0}return null}}}var r=e("../token_iterator").TokenIterator,o=e("../range").Range;t.BracketMatch=i}),ace.define("ace/edit_session",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/lang"),o=e("./bidihandler").BidiHandler,s=e("./config"),a=e("./lib/event_emitter").EventEmitter,l=e("./selection").Selection,c=e("./mode/text").Mode,u=e("./range").Range,d=e("./document").Document,h=e("./background_tokenizer").BackgroundTokenizer,f=e("./search_highlight").SearchHighlight,p=function(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++p.$uid,this.$foldData.toString=function(){return this.join("\n")},this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),"object"==typeof e&&e.getLine||(e=new d(e)),this.setDocument(e),this.selection=new l(this),this.$bidiHandler=new o(this),s.resetOptions(this),this.setMode(t),s._signal("session",this)};p.$uid=0,function(){function e(e){return 4352>e?!1:e>=4352&&4447>=e||e>=4515&&4519>=e||e>=4602&&4607>=e||e>=9001&&9002>=e||e>=11904&&11929>=e||e>=11931&&12019>=e||e>=12032&&12245>=e||e>=12272&&12283>=e||e>=12288&&12350>=e||e>=12353&&12438>=e||e>=12441&&12543>=e||e>=12549&&12589>=e||e>=12593&&12686>=e||e>=12688&&12730>=e||e>=12736&&12771>=e||e>=12784&&12830>=e||e>=12832&&12871>=e||e>=12880&&13054>=e||e>=13056&&19903>=e||e>=19968&&42124>=e||e>=42128&&42182>=e||e>=43360&&43388>=e||e>=44032&&55203>=e||e>=55216&&55238>=e||e>=55243&&55291>=e||e>=63744&&64255>=e||e>=65040&&65049>=e||e>=65072&&65106>=e||e>=65108&&65126>=e||e>=65128&&65131>=e||e>=65281&&65376>=e||e>=65504&&65510>=e}i.implement(this,a),this.setDocument=function(e){this.doc&&this.doc.removeListener("change",this.$onChange),this.doc=e,e.on("change",this.$onChange),this.bgTokenizer&&this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc;
},this.$resetRowCache=function(e){if(!e)return this.$docRowCache=[],void(this.$screenRowCache=[]);var t=this.$docRowCache.length,n=this.$getRowCacheIndex(this.$docRowCache,e)+1;t>n&&(this.$docRowCache.splice(n,t),this.$screenRowCache.splice(n,t))},this.$getRowCacheIndex=function(e,t){for(var n=0,i=e.length-1;i>=n;){var r=n+i>>1,o=e[r];if(t>o)n=r+1;else{if(!(o>t))return r;i=r-1}}return n-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.bgTokenizer&&this.bgTokenizer.start(0)},this.onChangeFold=function(e){var t=e.data;this.$resetRowCache(t.start.row)},this.onChange=function(e){this.$modified=!0,this.$bidiHandler.onChange(e),this.$resetRowCache(e.start.row);var t=this.$updateInternalDataOnChange(e);!this.$fromUndo&&this.$undoManager&&(t&&t.length&&(this.$undoManager.add({action:"removeFolds",folds:t},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(e,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer&&this.bgTokenizer.$updateOnChange(e),this._signal("change",e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var n,i=this.bgTokenizer.getTokens(e),r=0;if(null==t){var o=i.length-1;r=this.getLine(e).length}else for(var o=0;o<i.length&&(r+=i[o].value.length,!(r>=t));o++);return(n=i[o])?(n.index=o,n.start=r-n.value.length,n):null},this.setUndoManager=function(e){if(this.$undoManager=e,this.$informUndoManager&&this.$informUndoManager.cancel(),e){var t=this;e.addSession(this),this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.mergeUndoDeltas=!1},this.$informUndoManager=r.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?r.stringRepeat(" ",this.getTabSize()):"	"},this.setUseSoftTabs=function(e){this.setOption("useSoftTabs",e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption("tabSize",e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&&e.column%this.$tabSize===0},this.setNavigateWithinSoftTabs=function(e){this.setOption("navigateWithinSoftTabs",e)},this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption("overwrite",e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=""),this.$decorations[e]+=" "+t,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||"").replace(" "+t,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t<e.length;t++)this.$breakpoints[e[t]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(e,t){void 0===t&&(t="ace_breakpoint"),t?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.addMarker=function(e,t,n,i){var r=this.$markerId++,o={range:e,type:n||"line",renderer:"function"==typeof n?n:null,clazz:t,inFront:!!i,id:r};return i?(this.$frontMarkers[r]=o,this._signal("changeFrontMarker")):(this.$backMarkers[r]=o,this._signal("changeBackMarker")),r},this.addDynamicMarker=function(e,t){if(e.update){var n=this.$markerId++;return e.id=n,e.inFront=!!t,t?(this.$frontMarkers[n]=e,this._signal("changeFrontMarker")):(this.$backMarkers[n]=e,this._signal("changeBackMarker")),e}},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];if(t){var n=t.inFront?this.$frontMarkers:this.$backMarkers;delete n[e],this._signal(t.inFront?"changeFrontMarker":"changeBackMarker")}},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){if(!this.$searchHighlight){var t=new f(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(t)}this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,n,i){"number"!=typeof t&&(n=t,t=e),n||(n="ace_step");var r=new u(e,0,t,1/0);return r.id=this.addMarker(r,n,"fullLine",i),r},this.setAnnotations=function(e){this.$annotations=e,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r?\n)/m);t?this.$autoNewLine=t[1]:this.$autoNewLine="\n"},this.getWordRange=function(e,t){var n=this.getLine(e),i=!1;if(t>0&&(i=!!n.charAt(t-1).match(this.tokenRe)),i||(i=!!n.charAt(t).match(this.tokenRe)),i)var r=this.tokenRe;else if(/^\s+$/.test(n.slice(t-1,t+1)))var r=/\s/;else var r=this.nonTokenRe;var o=t;if(o>0){do o--;while(o>=0&&n.charAt(o).match(r));o++}for(var s=t;s<n.length&&n.charAt(s).match(r);)s++;return new u(e,o,e,s)},this.getAWordRange=function(e,t){for(var n=this.getWordRange(e,t),i=this.getLine(n.end.row);i.charAt(n.end.column).match(/[ \t]/);)n.end.column+=1;return n},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption("useWorker",e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal("tokenizerUpdate",e)},this.$modes=s.$modes,this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&&"object"==typeof e){if(e.getTokenizer)return this.$onChangeMode(e);var n=e,i=n.path}else i=e||"ace/mode/text";return this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new c),this.$modes[i]&&!n?(this.$onChangeMode(this.$modes[i]),void(t&&t())):(this.$modeId=i,s.loadModule(["mode",i],function(e){return this.$modeId!==i?t&&t():(this.$modes[i]&&!n?this.$onChangeMode(this.$modes[i]):e&&e.Mode&&(e=new e.Mode(n),n||(this.$modes[i]=e,e.$id=i),this.$onChangeMode(e)),void(t&&t()))}.bind(this)),void(this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)))},this.$onChangeMode=function(e,t){if(t||(this.$modeId=e.$id),this.$mode!==e){this.$mode=e,this.$stopWorker(),this.$useWorker&&this.$startWorker();var n=e.getTokenizer();if(void 0!==n.addEventListener){var i=this.onReloadTokenizer.bind(this);n.addEventListener("update",i)}if(this.bgTokenizer)this.bgTokenizer.setTokenizer(n);else{this.bgTokenizer=new h(n);var r=this;this.bgTokenizer.addEventListener("update",function(e){r._signal("tokenizerUpdate",e)})}this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(e.attachToSession&&e.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode"))}},this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){s.warn("Could not load worker",e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){this.$scrollTop===e||isNaN(e)||(this.$scrollTop=e,this._signal("changeScrollTop",e))},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){this.$scrollLeft===e||isNaN(e)||(this.$scrollLeft=e,this._signal("changeScrollLeft",e))},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(null!=this.lineWidgetsWidth)return this.lineWidgetsWidth;var e=0;return this.lineWidgets.forEach(function(t){t&&t.screenWidth>e&&(e=t.screenWidth)}),this.lineWidgetWidth=e},this.$computeWidth=function(e){if(this.$modified||e){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var t=this.doc.getAllLines(),n=this.$rowLengthCache,i=0,r=0,o=this.$foldData[r],s=o?o.start.row:1/0,a=t.length,l=0;a>l;l++){if(l>s){if(l=o.end.row+1,l>=a)break;o=this.$foldData[r++],s=o?o.start.row:1/0}null==n[l]&&(n[l]=this.$getStringScreenWidth(t[l])[0]),n[l]>i&&(i=n[l])}this.screenWidth=i}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.removeFullLines=function(e,t){return this.doc.removeFullLines(e,t)},this.undoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var n=e.length-1;-1!=n;n--){var i=e[n];"insert"==i.action||"remove"==i.action?this.doc.revertDelta(i):i.folds&&this.addFolds(i.folds)}!t&&this.$undoSelect&&(e.selectionBefore?this.selection.fromJSON(e.selectionBefore):this.selection.setRange(this.$getUndoSelection(e,!0))),this.$fromUndo=!1}},this.redoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var n=0;n<e.length;n++){var i=e[n];("insert"==i.action||"remove"==i.action)&&this.doc.applyDelta(i)}!t&&this.$undoSelect&&(e.selectionAfter?this.selection.fromJSON(e.selectionAfter):this.selection.setRange(this.$getUndoSelection(e,!1))),this.$fromUndo=!1}},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t){function n(e){return t?"insert"!==e.action:"insert"===e.action}for(var i,r,o,s=0;s<e.length;s++){var a=e[s];a.start&&(i?n(a)?(r=a.start,-1==i.compare(r.row,r.column)&&i.setStart(r),r=a.end,1==i.compare(r.row,r.column)&&i.setEnd(r),o=!0):(r=a.start,-1==i.compare(r.row,r.column)&&(i=u.fromPoints(a.start,a.start)),o=!1):n(a)?(i=u.fromPoints(a.start,a.end),o=!0):(i=u.fromPoints(a.start,a.start),o=!1))}return i},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,n){var i=this.getTextRange(e),r=this.getFoldsInRange(e),o=u.fromPoints(t,t);if(!n){this.remove(e);var s=e.start.row-e.end.row,a=s?-e.end.column:e.start.column-e.end.column;a&&(o.start.row==e.end.row&&o.start.column>e.end.column&&(o.start.column+=a),o.end.row==e.end.row&&o.end.column>e.end.column&&(o.end.column+=a)),s&&o.start.row>=e.end.row&&(o.start.row+=s,o.end.row+=s)}if(o.end=this.insert(o.start,i),r.length){var l=e.start,c=o.start,s=c.row-l.row,a=c.column-l.column;this.addFolds(r.map(function(e){return e=e.clone(),e.start.row==l.row&&(e.start.column+=a),e.end.row==l.row&&(e.end.column+=a),e.start.row+=s,e.end.row+=s,e}))}return o},this.indentRows=function(e,t,n){n=n.replace(/\t/g,this.getTabString());for(var i=e;t>=i;i++)this.doc.insertInLine({row:i,column:0},n)},this.outdentRows=function(e){for(var t=e.collapseRows(),n=new u(0,0,0,0),i=this.getTabSize(),r=t.start.row;r<=t.end.row;++r){var o=this.getLine(r);n.start.row=r,n.end.row=r;for(var s=0;i>s&&" "==o.charAt(s);++s);i>s&&"	"==o.charAt(s)?(n.start.column=s,n.end.column=s+1):(n.start.column=0,n.end.column=s),this.remove(n)}},this.$moveLines=function(e,t,n){if(e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t),0>n){var i=this.getRowFoldStart(e+n);if(0>i)return 0;var r=i-e}else if(n>0){var i=this.getRowFoldEnd(t+n);if(i>this.doc.getLength()-1)return 0;var r=i-t}else{e=this.$clipRowToDocument(e),t=this.$clipRowToDocument(t);var r=t-e+1}var o=new u(e,0,t,Number.MAX_VALUE),s=this.getFoldsInRange(o).map(function(e){return e=e.clone(),e.start.row+=r,e.end.row+=r,e}),a=0==n?this.doc.getLines(e,t):this.doc.removeFullLines(e,t);return this.doc.insertFullLines(e+r,a),s.length&&this.addFolds(s),r},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return 0>t?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){if(t=Math.max(0,t),0>e)e=0,t=0;else{var n=this.doc.getLength();e>=n?(e=n-1,t=this.doc.getLine(n-1).length):t=Math.min(this.doc.getLine(e).length,t)}return{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row<0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row>t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){if(e!=this.$useWrapMode){if(this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0),e){var t=this.getLength();this.$wrapData=Array(t),this.$updateWrapData(0,t-1)}this._signal("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){(this.$wrapLimitRange.min!==e||this.$wrapLimitRange.max!==t)&&(this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode"))},this.adjustWrapLimit=function(e,t){var n=this.$wrapLimitRange;n.max<0&&(n={min:t,max:t});var i=this.$constrainWrapLimit(e,n.min,n.max);return i!=this.$wrapLimit&&i>1?(this.$wrapLimit=i,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1},this.$constrainWrapLimit=function(e,t,n){return t&&(e=Math.max(t,e)),n&&(e=Math.min(n,e)),e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,n=e.action,i=e.start,r=e.end,o=i.row,s=r.row,a=s-o,l=null;if(this.$updating=!0,0!=a)if("remove"===n){this[t?"$wrapData":"$rowLengthCache"].splice(o,a);var c=this.$foldData;l=this.getFoldsInRange(e),this.removeFolds(l);var u=this.getFoldLine(r.row),d=0;if(u){u.addRemoveChars(r.row,r.column,i.column-r.column),u.shiftRow(-a);var h=this.getFoldLine(o);h&&h!==u&&(h.merge(u),u=h),d=c.indexOf(u)+1}for(d;d<c.length;d++){var u=c[d];u.start.row>=r.row&&u.shiftRow(-a)}s=o}else{var f=Array(a);f.unshift(o,0);var p=t?this.$wrapData:this.$rowLengthCache;p.splice.apply(p,f);var c=this.$foldData,u=this.getFoldLine(o),d=0;if(u){var g=u.range.compareInside(i.row,i.column);0==g?(u=u.split(i.row,i.column),u&&(u.shiftRow(a),u.addRemoveChars(s,0,r.column-i.column))):-1==g&&(u.addRemoveChars(o,0,r.column-i.column),u.shiftRow(a)),d=c.indexOf(u)+1}for(d;d<c.length;d++){var u=c[d];u.start.row>=o&&u.shiftRow(a)}}else{a=Math.abs(e.start.column-e.end.column),"remove"===n&&(l=this.getFoldsInRange(e),this.removeFolds(l),a=-a);var u=this.getFoldLine(o);u&&u.addRemoveChars(o,i.column,a)}return t&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,t?this.$updateWrapData(o,s):this.$updateRowLengthCache(o,s),l},this.$updateRowLengthCache=function(e,t,n){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(e,t){var n,i,r=this.doc.getAllLines(),s=this.getTabSize(),a=this.$wrapData,c=this.$wrapLimit,u=e;for(t=Math.min(t,r.length-1);t>=u;)i=this.getFoldLine(u,i),i?(n=[],i.walk(function(e,t,i,s){var a;if(null!=e){a=this.$getDisplayTokens(e,n.length),a[0]=o;for(var c=1;c<a.length;c++)a[c]=l}else a=this.$getDisplayTokens(r[t].substring(s,i),n.length);n=n.concat(a)}.bind(this),i.end.row,r[i.end.row].length+1),a[i.start.row]=this.$computeWrapSplits(n,c,s),u=i.end.row+1):(n=this.$getDisplayTokens(r[u]),a[u]=this.$computeWrapSplits(n,c,s),u++)};var t=1,n=2,o=3,l=4,d=9,p=10,g=11,m=12;this.$computeWrapSplits=function(e,t,i){function r(){var t=0;if(0===y)return t;if(v)for(var n=0;n<e.length;n++){var r=e[n];if(r==p)t+=1;else{if(r!=g){if(r==m)continue;break}t+=i}}return f&&v!==!1&&(t+=i),Math.min(t,y)}function s(t){for(var n=t-u,i=u;t>i;i++){var o=e[i];(12===o||2===o)&&(n-=1)}a.length||(w=r(),a.indent=w),h+=n,a.push(h),u=t}if(0==e.length)return[];for(var a=[],c=e.length,u=0,h=0,f=this.$wrapAsCode,v=this.$indentedSoftWrap,y=t<=Math.max(2*i,8)||v===!1?0:Math.floor(t/2),w=0;c-u>t-w;){var b=u+t-w;if(e[b-1]>=p&&e[b]>=p)s(b);else if(e[b]!=o&&e[b]!=l){for(var _=Math.max(b-(t-(t>>2)),u-1);b>_&&e[b]<o;)b--;if(f){for(;b>_&&e[b]<o;)b--;for(;b>_&&e[b]==d;)b--}else for(;b>_&&e[b]<p;)b--;b>_?s(++b):(b=u+t,e[b]==n&&b--,s(b-w))}else{for(b;b!=u-1&&e[b]!=o;b--);if(b>u){s(b);continue}for(b=u+t;b<e.length&&e[b]==l;b++);if(b==e.length)break;s(b)}}return a},this.$getDisplayTokens=function(i,r){var o,s=[];r=r||0;for(var a=0;a<i.length;a++){var l=i.charCodeAt(a);if(9==l){o=this.getScreenTabSize(s.length+r),s.push(g);for(var c=1;o>c;c++)s.push(m)}else 32==l?s.push(p):l>39&&48>l||l>57&&64>l?s.push(d):l>=4352&&e(l)?s.push(t,n):s.push(t)}return s},this.$getStringScreenWidth=function(t,n,i){if(0==n)return[0,0];null==n&&(n=1/0),i=i||0;var r,o;for(o=0;o<t.length&&(r=t.charCodeAt(o),i+=9==r?this.getScreenTabSize(i):r>=4352&&e(r)?2:1,!(i>n));o++);return[i,o]},this.lineWidgets=null,this.getRowLength=function(e){if(this.lineWidgets)var t=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0;else t=0;return this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1+t:1+t},this.getRowLineCount=function(e){return this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1:1},this.getRowWrapIndent=function(e){if(this.$useWrapMode){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE),n=this.$wrapData[t.row];return n.length&&n[0]<t.column?n.indent:0}return 0},this.getScreenLastRowColumn=function(e){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(t.row,t.column)},this.getDocumentLastRowColumn=function(e,t){var n=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(n)},this.getDocumentLastRowColumnPosition=function(e,t){var n=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(n,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:void 0},this.getScreenTabSize=function(e){return this.$tabSize-(e%this.$tabSize|0)},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t,n){if(0>e)return{row:0,column:0};var i,r,o=0,s=0,a=0,l=0,c=this.$screenRowCache,u=this.$getRowCacheIndex(c,e),d=c.length;if(d&&u>=0)var a=c[u],o=this.$docRowCache[u],h=e>c[d-1];else var h=!d;for(var f=this.getLength()-1,p=this.getNextFoldLine(o),g=p?p.start.row:1/0;e>=a&&(l=this.getRowLength(o),!(a+l>e||o>=f));)a+=l,o++,o>g&&(o=p.end.row+1,p=this.getNextFoldLine(o,p),g=p?p.start.row:1/0),h&&(this.$docRowCache.push(o),this.$screenRowCache.push(a));if(p&&p.start.row<=o)i=this.getFoldDisplayLine(p),o=p.start.row;else{if(e>=a+l||o>f)return{row:f,column:this.getLine(f).length};i=this.getLine(o),p=null}var m=0,v=Math.floor(e-a);if(this.$useWrapMode){var y=this.$wrapData[o];y&&(r=y[v],v>0&&y.length&&(m=y.indent,s=y[v-1]||y[y.length-1],i=i.substring(s)))}return void 0!==n&&this.$bidiHandler.isBidiRow(a+v,o,v)&&(t=this.$bidiHandler.offsetToCol(n)),s+=this.$getStringScreenWidth(i,t-m)[1],this.$useWrapMode&&s>=r&&(s=r-1),p?p.idxToPosition(s):{row:o,column:s}},this.documentToScreenPosition=function(e,t){if("undefined"==typeof t)var n=this.$clipPositionToDocument(e.row,e.column);else n=this.$clipPositionToDocument(e,t);e=n.row,t=n.column;var i=0,r=null,o=null;o=this.getFoldAt(e,t,1),o&&(e=o.start.row,t=o.start.column);var s,a=0,l=this.$docRowCache,c=this.$getRowCacheIndex(l,e),u=l.length;if(u&&c>=0)var a=l[c],i=this.$screenRowCache[c],d=e>l[u-1];else var d=!u;for(var h=this.getNextFoldLine(a),f=h?h.start.row:1/0;e>a;){if(a>=f){if(s=h.end.row+1,s>e)break;h=this.getNextFoldLine(s,h),f=h?h.start.row:1/0}else s=a+1;i+=this.getRowLength(a),a=s,d&&(this.$docRowCache.push(a),this.$screenRowCache.push(i))}var p="";h&&a>=f?(p=this.getFoldDisplayLine(h,e,t),r=h.start.row):(p=this.getLine(e).substring(0,t),r=e);var g=0;if(this.$useWrapMode){var m=this.$wrapData[r];if(m){for(var v=0;p.length>=m[v];)i++,v++;p=p.substring(m[v-1]||0,p.length),g=v>0?m.indent:0}}return{row:i,column:g+this.$getStringScreenWidth(p)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(this.$useWrapMode)for(var n=this.$wrapData.length,i=0,r=0,t=this.$foldData[r++],o=t?t.start.row:1/0;n>i;){var s=this.$wrapData[i];e+=s?s.length+1:1,i++,i>o&&(i=t.end.row+1,t=this.$foldData[r++],o=t?t.start.row:1/0)}else{e=this.getLength();for(var a=this.$foldData,r=0;r<a.length;r++)t=a[r],e-=t.end.row-t.start.row}return this.lineWidgets&&(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(e){this.$enableVarChar&&(this.$getStringScreenWidth=function(t,n,i){if(0===n)return[0,0];n||(n=1/0),i=i||0;var r,o;for(o=0;o<t.length&&(r=t.charAt(o),i+="	"===r?this.getScreenTabSize(i):e.getCharacterWidth(r),!(i>n));o++);return[i,o]})},this.destroy=function(){this.bgTokenizer&&(this.bgTokenizer.setDocument(null),this.bgTokenizer=null),this.$stopWorker()},this.isFullWidth=e}.call(p.prototype),e("./edit_session/folding").Folding.call(p.prototype),e("./edit_session/bracket_match").BracketMatch.call(p.prototype),s.defineOptions(p.prototype,"session",{wrap:{set:function(e){if(e&&"off"!=e?"free"==e?e=!0:"printMargin"==e?e=-1:"string"==typeof e&&(e=parseInt(e,10)||!1):e=!1,this.$wrap!=e)if(this.$wrap=e,e){var t="number"==typeof e?e:null;this.setWrapLimitRange(t,t),this.setUseWrapMode(!0)}else this.setUseWrapMode(!1)},get:function(){return this.getUseWrapMode()?-1==this.$wrap?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(e){e="auto"==e?"text"!=this.$mode.type:"text"!=e,e!=this.$wrapAsCode&&(this.$wrapAsCode=e,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){e=parseInt(e),e>0&&this.$tabSize!==e&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(e){this.setFoldStyle(e)},handlesSet:!0},overwrite:{set:function(e){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId},handlesSet:!0}}),t.EditSession=p}),ace.define("ace/search",[],function(e,t,n){"use strict";function i(e,t){function n(e){return/\w/.test(e)||t.regExp?"\\b":""}return n(e[0])+e+n(e[e.length-1])}var r=e("./lib/lang"),o=e("./lib/oop"),s=e("./range").Range,a=function(){this.$options={}};(function(){this.set=function(e){return o.mixin(this.$options,e),this},this.getOptions=function(){return r.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var t=this.$options,n=this.$matchIterator(e,t);if(!n)return!1;var i=null;return n.forEach(function(e,n,r,o){return i=new s(e,n,r,o),n==o&&t.start&&t.start.start&&0!=t.skipCurrent&&i.isEqual(t.start)?(i=null,!1):!0}),i},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var n=t.range,i=n?e.getLines(n.start.row,n.end.row):e.doc.getAllLines(),o=[],a=t.re;if(t.$isMultiLine){var l,c=a.length,u=i.length-c;e:for(var d=a.offset||0;u>=d;d++){for(var h=0;c>h;h++)if(-1==i[d+h].search(a[h]))continue e;var f=i[d],p=i[d+c-1],g=f.length-f.match(a[0])[0].length,m=p.match(a[c-1])[0].length;l&&l.end.row===d&&l.end.column>g||(o.push(l=new s(d,g,d+c-1,m)),c>2&&(d=d+c-2))}}else for(var v=0;v<i.length;v++)for(var y=r.getMatchOffsets(i[v],a),h=0;h<y.length;h++){var w=y[h];o.push(new s(v,w.offset,v,w.offset+w.length))}if(n){for(var b=n.start.column,_=n.start.column,v=0,h=o.length-1;h>v&&o[v].start.column<b&&o[v].start.row==n.start.row;)v++;for(;h>v&&o[h].end.column>_&&o[h].end.row==n.end.row;)h--;for(o=o.slice(v,h+1),v=0,h=o.length;h>v;v++)o[v].start.row+=n.start.row,o[v].end.row+=n.start.row}return o},this.replace=function(e,t){var n=this.$options,i=this.$assembleRegExp(n);if(n.$isMultiLine)return t;if(i){var r=i.exec(e);if(!r||r[0].length!=e.length)return null;if(t=e.replace(i,t),n.preserveCase){t=t.split("");for(var o=Math.min(e.length,e.length);o--;){var s=e[o];s&&s.toLowerCase()!=s?t[o]=t[o].toUpperCase():t[o]=t[o].toLowerCase()}t=t.join("")}return t}},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var n=e.needle;if(!e.needle)return e.re=!1;e.regExp||(n=r.escapeRegExp(n)),e.wholeWord&&(n=i(n,e));var o=e.caseSensitive?"gm":"gmi";if(e.$isMultiLine=!t&&/[\n\r]/.test(n),e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(n,o);try{var s=new RegExp(n,o)}catch(a){s=!1}return e.re=s},this.$assembleMultilineRegExp=function(e,t){for(var n=e.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),i=[],r=0;r<n.length;r++)try{i.push(new RegExp(n[r],t))}catch(o){return!1}return i},this.$matchIterator=function(e,t){var n=this.$assembleRegExp(t);if(!n)return!1;var i=1==t.backwards,r=0!=t.skipCurrent,o=t.range,s=t.start;s||(s=o?o[i?"end":"start"]:e.selection.getRange()),s.start&&(s=s[r!=i?"end":"start"]);var a=o?o.start.row:0,l=o?o.end.row:e.getLength()-1;if(i)var c=function(e){var n=s.row;if(!d(n,s.column,e)){for(n--;n>=a;n--)if(d(n,Number.MAX_VALUE,e))return;if(0!=t.wrap)for(n=l,a=s.row;n>=a;n--)if(d(n,Number.MAX_VALUE,e))return}};else var c=function(e){var n=s.row;if(!d(n,s.column,e)){for(n+=1;l>=n;n++)if(d(n,0,e))return;if(0!=t.wrap)for(n=a,l=s.row;l>=n;n++)if(d(n,0,e))return}};if(t.$isMultiLine)var u=n.length,d=function(t,r,o){var s=i?t-u+1:t;if(!(0>s)){var a=e.getLine(s),l=a.search(n[0]);if(!(!i&&r>l||-1===l)){for(var c=1;u>c;c++)if(a=e.getLine(s+c),-1==a.search(n[c]))return;var d=a.match(n[u-1])[0].length;if(!(i&&d>r))return o(s,l,s+u-1,d)?!0:void 0}}};else if(i)var d=function(t,i,r){var o,s=e.getLine(t),a=[],l=0;for(n.lastIndex=0;o=n.exec(s);){var c=o[0].length;if(l=o.index,!c){if(l>=s.length)break;n.lastIndex=l+=1}if(o.index+c>i)break;a.push(o.index,c)}for(var u=a.length-1;u>=0;u-=2){var d=a[u-1],c=a[u];if(r(t,d,t,d+c))return!0}};else var d=function(t,i,r){var o,s,a=e.getLine(t);for(n.lastIndex=i;s=n.exec(a);){var l=s[0].length;if(o=s.index,r(t,o,t,o+l))return!0;if(!l&&(n.lastIndex=o+=1,o>=a.length))return!1}};return{forEach:c}}}).call(a.prototype),t.Search=a}),ace.define("ace/keyboard/hash_handler",[],function(e,t,n){"use strict";function i(e,t){this.platform=t||(s.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(e),this.$singleCommand=!0}function r(e,t){i.call(this,e,t),this.$singleCommand=!1}var o=e("../lib/keys"),s=e("../lib/useragent"),a=o.KEY_MODS;r.prototype=i.prototype,function(){function e(e){return"object"==typeof e&&e.bindKey&&e.bindKey.position||(e.isDefault?-100:0)}this.addCommand=function(e){this.commands[e.name]&&this.removeCommand(e),this.commands[e.name]=e,e.bindKey&&this._buildKeyHash(e)},this.removeCommand=function(e,t){var n=e&&("string"==typeof e?e:e.name);e=this.commands[n],t||delete this.commands[n];var i=this.commandKeyBinding;for(var r in i){var o=i[r];if(o==e)delete i[r];else if(Array.isArray(o)){var s=o.indexOf(e);-1!=s&&(o.splice(s,1),1==o.length&&(i[r]=o[0]))}}},this.bindKey=function(e,t,n){return"object"==typeof e&&e&&(void 0==n&&(n=e.position),e=e[this.platform]),e?"function"==typeof t?this.addCommand({exec:t,bindKey:e,name:t.name||e}):void e.split("|").forEach(function(e){var i="";if(-1!=e.indexOf(" ")){var r=e.split(/\s+/);e=r.pop(),r.forEach(function(e){var t=this.parseKeys(e),n=a[t.hashId]+t.key;i+=(i?" ":"")+n,this._addCommandToBinding(i,"chainKeys")},this),i+=" "}var o=this.parseKeys(e),s=a[o.hashId]+o.key;this._addCommandToBinding(i+s,t,n)},this):void 0},this._addCommandToBinding=function(t,n,i){var r,o=this.commandKeyBinding;if(n)if(!o[t]||this.$singleCommand)o[t]=n;else{Array.isArray(o[t])?-1!=(r=o[t].indexOf(n))&&o[t].splice(r,1):o[t]=[o[t]],"number"!=typeof i&&(i=e(n));var s=o[t];for(r=0;r<s.length;r++){var a=s[r],l=e(a);if(l>i)break}s.splice(r,0,n)}else delete o[t]},this.addCommands=function(e){e&&Object.keys(e).forEach(function(t){var n=e[t];if(n){if("string"==typeof n)return this.bindKey(n,t);"function"==typeof n&&(n={exec:n}),"object"==typeof n&&(n.name||(n.name=t),this.addCommand(n))}},this)},this.removeCommands=function(e){Object.keys(e).forEach(function(t){this.removeCommand(e[t])},this)},this.bindKeys=function(e){Object.keys(e).forEach(function(t){this.bindKey(t,e[t])},this)},this._buildKeyHash=function(e){this.bindKey(e.bindKey,e)},this.parseKeys=function(e){var t=e.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(e){return e}),n=t.pop(),i=o[n];if(o.FUNCTION_KEYS[i])n=o.FUNCTION_KEYS[i].toLowerCase();else{if(!t.length)return{key:n,hashId:-1};if(1==t.length&&"shift"==t[0])return{key:n.toUpperCase(),hashId:-1}}for(var r=0,s=t.length;s--;){var a=o.KEY_MODS[t[s]];if(null==a)return"undefined"!=typeof console&&console.error("invalid modifier "+t[s]+" in "+e),!1;r|=a}return{key:n,hashId:r}},this.findKeyCommand=function(e,t){var n=a[e]+t;return this.commandKeyBinding[n]},this.handleKeyboard=function(e,t,n,i){if(!(0>i)){var r=a[t]+n,o=this.commandKeyBinding[r];return e.$keyChain&&(e.$keyChain+=" "+r,o=this.commandKeyBinding[e.$keyChain]||o),!o||"chainKeys"!=o&&"chainKeys"!=o[o.length-1]?(e.$keyChain&&(t&&4!=t||1!=n.length?(-1==t||i>0)&&(e.$keyChain=""):e.$keyChain=e.$keyChain.slice(0,-r.length-1)),{command:o}):(e.$keyChain=e.$keyChain||r,{command:"null"})}},this.getStatusText=function(e,t){return t.$keyChain||""}}.call(i.prototype),t.HashHandler=i,t.MultiHashHandler=r}),ace.define("ace/commands/command_manager",[],function(e,t,n){"use strict";var i=e("../lib/oop"),r=e("../keyboard/hash_handler").MultiHashHandler,o=e("../lib/event_emitter").EventEmitter,s=function(e,t){r.call(this,t,e),this.byName=this.commands,this.setDefaultHandler("exec",function(e){return e.command.exec(e.editor,e.args||{})})};i.inherits(s,r),function(){i.implement(this,o),this.exec=function(e,t,n){if(Array.isArray(e)){for(var i=e.length;i--;)if(this.exec(e[i],t,n))return!0;return!1}if("string"==typeof e&&(e=this.commands[e]),!e)return!1;if(t&&t.$readOnly&&!e.readOnly)return!1;if(0!=this.$checkCommandState&&e.isAvailable&&!e.isAvailable(t))return!1;
var r={editor:t,command:e,args:n};return r.returnValue=this._emit("exec",r),this._signal("afterExec",r),r.returnValue===!1?!1:!0},this.toggleRecording=function(e){return this.$inReplay?void 0:(e&&e._emit("changeStatus"),this.recording?(this.macro.pop(),this.removeEventListener("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0))},this.replay=function(e){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(e);try{this.$inReplay=!0,this.macro.forEach(function(t){"string"==typeof t?this.exec(t,e):this.exec(t[0],e,t[1])},this)}finally{this.$inReplay=!1}}},this.trimMacro=function(e){return e.map(function(e){return"string"!=typeof e[0]&&(e[0]=e[0].name),e[1]||(e=e[0]),e})}}.call(s.prototype),t.CommandManager=s}),ace.define("ace/commands/default_commands",[],function(e,t,n){"use strict";function i(e,t){return{win:e,mac:t}}var r=e("../lib/lang"),o=e("../config"),s=e("../range").Range;t.commands=[{name:"showSettingsMenu",bindKey:i("Ctrl-,","Command-,"),exec:function(e){o.loadModule("ace/ext/settings_menu",function(t){t.init(e),e.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",bindKey:i("Alt-E","F4"),exec:function(e){o.loadModule("./ext/error_marker",function(t){t.showErrorMarker(e,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",bindKey:i("Alt-Shift-E","Shift-F4"),exec:function(e){o.loadModule("./ext/error_marker",function(t){t.showErrorMarker(e,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:i("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:i(null,"Ctrl-L"),exec:function(e){e.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:i("Ctrl-L","Command-L"),exec:function(e,t){"number"!=typeof t||isNaN(t)||e.gotoLine(t),e.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:i("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(e){e.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:i("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(e){e.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",bindKey:i("F2","F2"),exec:function(e){e.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",bindKey:i("Alt-F2","Alt-F2"),exec:function(e){e.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:i(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:i("Alt-0","Command-Option-0"),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:i("Alt-Shift-0","Command-Option-Shift-0"),exec:function(e){e.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:i("Ctrl-K","Command-G"),exec:function(e){e.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:i("Ctrl-Shift-K","Command-Shift-G"),exec:function(e){e.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:i("Alt-K","Ctrl-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:i("Alt-Shift-K","Ctrl-Shift-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:i("Ctrl-F","Command-F"),exec:function(e){o.loadModule("ace/ext/searchbox",function(t){t.Search(e)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:i("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:i("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:i("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:i("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:i("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:i("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:i("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:i("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:i("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:i("Ctrl-Left","Option-Left"),exec:function(e){e.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:i("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:i("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:i("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:i("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:i("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:i("Ctrl-Right","Option-Right"),exec:function(e){e.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:i("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:i("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:i("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:i("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:i(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:i("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:i(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:i("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:i("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:i("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:i("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:i("Ctrl-P","Ctrl-P"),exec:function(e){e.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:i("Ctrl-Shift-P","Ctrl-Shift-P"),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:i("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(e){e.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:i(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(e){},readOnly:!0},{name:"cut",description:"Cut",exec:function(e){var t=e.$copyWithEmptySelection&&e.selection.isEmpty(),n=t?e.selection.getLineRange():e.selection.getRange();e._emit("cut",n),n.isEmpty()||e.session.remove(n),e.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(e,t){e.$handlePaste(t)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:i("Ctrl-D","Command-D"),exec:function(e){e.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:i("Ctrl-Shift-D","Command-Shift-D"),exec:function(e){e.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:i("Ctrl-Alt-S","Command-Alt-S"),exec:function(e){e.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:i("Ctrl-/","Command-/"),exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:i("Ctrl-Shift-/","Command-Shift-/"),exec:function(e){e.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:i("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(e){e.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:i("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(e){e.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:i("Ctrl-H","Command-Option-F"),exec:function(e){o.loadModule("ace/ext/searchbox",function(t){t.Search(e,!0)})}},{name:"undo",description:"Undo",bindKey:i("Ctrl-Z","Command-Z"),exec:function(e){e.undo()}},{name:"redo",description:"Redo",bindKey:i("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(e){e.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:i("Alt-Shift-Up","Command-Option-Up"),exec:function(e){e.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:i("Alt-Up","Option-Up"),exec:function(e){e.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:i("Alt-Shift-Down","Command-Option-Down"),exec:function(e){e.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:i("Alt-Down","Option-Down"),exec:function(e){e.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:i("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(e){e.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:i("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(e){e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:i("Shift-Delete",null),exec:function(e){return e.selection.isEmpty()?void e.remove("left"):!1},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:i("Alt-Backspace","Command-Backspace"),exec:function(e){e.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:i("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(e){e.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:i("Ctrl-Shift-Backspace",null),exec:function(e){var t=e.selection.getRange();t.start.column=0,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:i("Ctrl-Shift-Delete",null),exec:function(e){var t=e.selection.getRange();t.end.column=Number.MAX_VALUE,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:i("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(e){e.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:i("Ctrl-Delete","Alt-Delete"),exec:function(e){e.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:i("Shift-Tab","Shift-Tab"),exec:function(e){e.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:i("Tab","Tab"),exec:function(e){e.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:i("Ctrl-[","Ctrl-["),exec:function(e){e.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:i("Ctrl-]","Ctrl-]"),exec:function(e){e.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(e,t){e.insert(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(e,t){e.insert(r.stringRepeat(t.text||"",t.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:i(null,"Ctrl-O"),exec:function(e){e.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:i("Alt-Shift-X","Ctrl-T"),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:i("Ctrl-U","Ctrl-U"),exec:function(e){e.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:i("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(e){e.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"expandtoline",description:"Expand to line",bindKey:i("Ctrl-Shift-L","Command-Shift-L"),exec:function(e){var t=e.selection.getRange();t.start.column=t.end.column=0,t.end.row++,e.selection.setRange(t,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",description:"Join lines",bindKey:i(null,null),exec:function(e){for(var t=e.selection.isBackwards(),n=t?e.selection.getSelectionLead():e.selection.getSelectionAnchor(),i=t?e.selection.getSelectionAnchor():e.selection.getSelectionLead(),o=e.session.doc.getLine(n.row).length,a=e.session.doc.getTextRange(e.selection.getRange()),l=a.replace(/\n\s*/," ").length,c=e.session.doc.getLine(n.row),u=n.row+1;u<=i.row+1;u++){var d=r.stringTrimLeft(r.stringTrimRight(e.session.doc.getLine(u)));0!==d.length&&(d=" "+d),c+=d}i.row+1<e.session.doc.getLength()-1&&(c+=e.session.doc.getNewLineCharacter()),e.clearSelection(),e.session.doc.replace(new s(n.row,0,i.row+2,0),c),l>0?(e.selection.moveCursorTo(n.row,n.column),e.selection.selectTo(n.row,n.column+l)):(o=e.session.doc.getLine(n.row).length>o?o+1:o,e.selection.moveCursorTo(n.row,o))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:i(null,null),exec:function(e){var t=e.session.doc.getLength()-1,n=e.session.doc.getLine(t).length,i=e.selection.rangeList.ranges,r=[];i.length<1&&(i=[e.selection.getRange()]);for(var o=0;o<i.length;o++)o==i.length-1&&(i[o].end.row!==t||i[o].end.column!==n)&&r.push(new s(i[o].end.row,i[o].end.column,t,n)),0===o?(0!==i[o].start.row||0!==i[o].start.column)&&r.push(new s(0,0,i[o].start.row,i[o].start.column)):r.push(new s(i[o-1].end.row,i[o-1].end.column,i[o].start.row,i[o].start.column));e.exitMultiSelectMode(),e.clearSelection();for(var o=0;o<r.length;o++)e.selection.addRange(r[o],!1)},readOnly:!0,scrollIntoView:"none"},{name:"openCommandPallete",description:"Open command pallete",bindKey:i("F1","F1"),exec:function(e){e.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:i(null,null),exec:function(e){e.prompt({$type:"modes"})},readOnly:!0}]}),ace.define("ace/clipboard",[],function(e,t,n){"use strict";n.exports={lineMode:!1}}),ace.define("ace/editor",[],function(e,t,n){"use strict";e("./lib/fixoldbrowsers");var i=e("./lib/oop"),r=e("./lib/dom"),o=e("./lib/lang"),s=e("./lib/useragent"),a=e("./keyboard/textinput").TextInput,l=e("./mouse/mouse_handler").MouseHandler,c=e("./mouse/fold_handler").FoldHandler,u=e("./keyboard/keybinding").KeyBinding,d=e("./edit_session").EditSession,h=e("./search").Search,f=e("./range").Range,p=e("./lib/event_emitter").EventEmitter,g=e("./commands/command_manager").CommandManager,m=e("./commands/default_commands").commands,v=e("./config"),y=e("./token_iterator").TokenIterator,w=e("./clipboard"),b=function(e,t,n){var i=e.getContainerElement();this.container=i,this.renderer=e,this.id="editor"+ ++b.$uid,this.commands=new g(s.isMac?"mac":"win",m),"object"==typeof document&&(this.textInput=new a(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new l(this),new c(this)),this.keyBinding=new u(this),this.$search=(new h).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=o.delayedCall(function(){this._signal("input",{}),this.session&&this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(e,t){t._$emitInputEvent.schedule(31)}),this.setSession(t||n&&n.session||new d("")),v.resetOptions(this),n&&this.setOptions(n),v._signal("editor",this)};b.$uid=0,function(){i.implement(this,p),this.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=o.delayedCall(this.endOperation.bind(this,!0)),this.on("change",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},this.endOperation=function(e){if(this.curOp){if(e&&e.returnValue===!1)return this.curOp=null;if(1==e&&this.curOp.command&&"mouse"==this.curOp.command.name)return;if(this._signal("beforeEndOperation"),!this.curOp)return;var t=this.curOp.command,n=t&&t.scrollIntoView;if(n){switch(n){case"center-animate":n="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var i=this.selection.getRange(),r=this.renderer.layerConfig;(i.start.row>=r.lastRow||i.end.row<=r.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}"animate"==n&&this.renderer.animateScrolling(this.curOp.scrollTop)}var o=this.selection.toJSON();this.curOp.selectionAfter=o,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(o),this.prevOp=this.curOp,this.curOp=null}},this.$mergeableCommands=["backspace","del","insertstring"],this.$historyTracker=function(e){if(this.$mergeUndoDeltas){var t=this.prevOp,n=this.$mergeableCommands,i=t.command&&e.command.name==t.command.name;if("insertstring"==e.command.name){var r=e.args;void 0===this.mergeNextCommand&&(this.mergeNextCommand=!0),i=i&&this.mergeNextCommand&&(!/\s/.test(r)||/\s/.test(t.args)),this.mergeNextCommand=!0}else i=i&&-1!==n.indexOf(e.command.name);"always"!=this.$mergeUndoDeltas&&Date.now()-this.sequenceStartTime>2e3&&(i=!1),i?this.session.mergeUndoDeltas=!0:-1!==n.indexOf(e.command.name)&&(this.sequenceStartTime=Date.now())}},this.setKeyboardHandler=function(e,t){if(e&&"string"==typeof e&&"ace"!=e){this.$keybindingId=e;var n=this;v.loadModule(["keybinding",e],function(i){n.$keybindingId==e&&n.keyBinding.setKeyboardHandler(i&&i.handler),t&&t()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(e),t&&t()},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){if(this.session!=e){this.curOp&&this.endOperation(),this.curOp={};var t=this.session;if(t){this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange);var n=this.session.getSelection();n.off("changeCursor",this.$onCursorChange),n.off("changeSelection",this.$onSelectionChange)}this.session=e,e?(this.$onDocumentChange=this.onDocumentChange.bind(this),e.on("change",this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(e)),this._signal("changeSession",{session:e,oldSession:t}),this.curOp=null,t&&t._signal("changeEditor",{oldEditor:this}),e&&e._signal("changeEditor",{editor:this}),e&&e.bgTokenizer&&e.bgTokenizer.scheduleStart()}},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?1==t?this.navigateFileEnd():-1==t&&this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption("fontSize")||r.computedStyle(this.container).fontSize},this.setFontSize=function(e){this.setOption("fontSize",e)},this.$highlightBrackets=function(){if(this.session.$bracketHighlight&&(this.session.removeMarker(this.session.$bracketHighlight),this.session.$bracketHighlight=null),!this.$highlightPending){var e=this;this.$highlightPending=!0,setTimeout(function(){e.$highlightPending=!1;var t=e.session;if(t&&t.bgTokenizer){var n=t.findMatchingBracket(e.getCursorPosition());if(n)var i=new f(n.row,n.column,n.row,n.column+1);else if(t.$mode.getMatching)var i=t.$mode.getMatching(e.session);i&&(t.$bracketHighlight=t.addMarker(i,"ace_bracket","text"))}},50)}},this.$highlightTags=function(){if(!this.$highlightTagPending){var e=this;this.$highlightTagPending=!0,setTimeout(function(){e.$highlightTagPending=!1;var t=e.session;if(t&&t.bgTokenizer){var n=e.getCursorPosition(),i=new y(e.session,n.row,n.column),r=i.getCurrentToken();if(!r||!/\b(?:tag-open|tag-name)/.test(r.type))return t.removeMarker(t.$tagHighlight),void(t.$tagHighlight=null);if(-1==r.type.indexOf("tag-open")||(r=i.stepForward())){var o=r.value,s=0,a=i.stepBackward();if("<"==a.value){do a=r,r=i.stepForward(),r&&r.value===o&&-1!==r.type.indexOf("tag-name")&&("<"===a.value?s++:"</"===a.value&&s--);while(r&&s>=0)}else{do r=a,a=i.stepBackward(),r&&r.value===o&&-1!==r.type.indexOf("tag-name")&&("<"===a.value?s++:"</"===a.value&&s--);while(a&&0>=s);i.stepForward()}if(!r)return t.removeMarker(t.$tagHighlight),void(t.$tagHighlight=null);var l=i.getCurrentTokenRow(),c=i.getCurrentTokenColumn(),u=new f(l,c,l,c+r.value.length),d=t.$backMarkers[t.$tagHighlight];t.$tagHighlight&&void 0!=d&&0!==u.compareRange(d.range)&&(t.removeMarker(t.$tagHighlight),t.$tagHighlight=null),t.$tagHighlight||(t.$tagHighlight=t.addMarker(u,"ace_bracket","text"))}}},50)}},this.focus=function(){var e=this;setTimeout(function(){e.isFocused()||e.textInput.focus()}),this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",e))},this.onBlur=function(e){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",e))},this.$cursorChange=function(){this.renderer.updateCursor()},this.onDocumentChange=function(e){var t=this.session.$useWrapMode,n=e.start.row==e.end.row?e.end.row:1/0;this.renderer.updateLines(e.start.row,n,t),this._signal("change",e),this.$cursorChange(),this.$updateHighlightActiveLine()},this.onTokenizerUpdate=function(e){var t=e.data;this.renderer.updateLines(t.first,t.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var e,t=this.getSession();if(this.$highlightActiveLine&&("line"==this.$selectionStyle&&this.selection.isMultiLine()||(e=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(e=!1),!this.renderer.$maxLines||1!==this.session.getLength()||this.renderer.$minLines>1||(e=!1)),t.$highlightLineMarker&&!e)t.removeMarker(t.$highlightLineMarker.id),t.$highlightLineMarker=null;else if(!t.$highlightLineMarker&&e){var n=new f(e.row,e.column,e.row,1/0);n.id=t.addMarker(n,"ace_active-line","screenLine"),t.$highlightLineMarker=n}else e&&(t.$highlightLineMarker.start.row=e.row,t.$highlightLineMarker.end.row=e.row,t.$highlightLineMarker.start.column=e.column,t._signal("changeBackMarker"))},this.onSelectionChange=function(e){var t=this.session;if(t.$selectionMarker&&t.removeMarker(t.$selectionMarker),t.$selectionMarker=null,this.selection.isEmpty())this.$updateHighlightActiveLine();else{
var n=this.selection.getRange(),i=this.getSelectionStyle();t.$selectionMarker=t.addMarker(n,"ace_selection",i)}var r=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(r),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(!t.isEmpty()&&!t.isMultiLine()){var n=t.start.column,i=t.end.column,r=e.getLine(t.start.row),o=r.substring(n,i);if(!(o.length>5e3)&&/[\w\d]/.test(o)){var s=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:o}),a=r.substring(n-1,i+1);if(s.test(a))return s}}},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText(),t=this.session.doc.getNewLineCharacter(),n=!1;if(!e&&this.$copyWithEmptySelection){n=!0;for(var i=this.selection.getAllRanges(),r=0;r<i.length;r++){var o=i[r];r&&i[r-1].start.row==o.start.row||(e+=this.session.getLine(o.start.row)+t)}}var s={text:e};return this._signal("copy",s),w.lineMode=n?s.text:"",s.text},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(e,t){var n={text:e,event:t};this.commands.exec("paste",this,n)},this.$handlePaste=function(e){"string"==typeof e&&(e={text:e}),this._signal("paste",e);var t=e.text,n=t==w.lineMode,i=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)n?i.insert({row:this.selection.lead.row,column:0},t):this.insert(t);else if(n)this.selection.rangeList.ranges.forEach(function(e){i.insert({row:e.start.row,column:0},t)});else{var r=t.split(/\r\n|\r|\n/),o=this.selection.rangeList.ranges;if(r.length>o.length||r.length<2||!r[1])return this.commands.exec("insertstring",this,t);for(var s=o.length;s--;){var a=o[s];a.isEmpty()||i.remove(a),i.insert(a.start,r[s])}}},this.execCommand=function(e,t){return this.commands.exec(e,this,t)},this.insert=function(e,t){var n=this.session,i=n.getMode(),r=this.getCursorPosition();if(this.getBehavioursEnabled()&&!t){var o=i.transformAction(n.getState(r.row),"insertion",this,n,e);o&&(e!==o.text&&(this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1)),e=o.text)}if("	"==e&&(e=this.session.getTabString()),this.selection.isEmpty()){if(this.session.getOverwrite()&&-1==e.indexOf("\n")){var s=new f.fromPoints(r,r);s.end.column+=e.length,this.session.remove(s)}}else{var s=this.getSelectionRange();r=this.session.remove(s),this.clearSelection()}if("\n"==e||"\r\n"==e){var a=n.getLine(r.row);if(r.column>a.search(/\S|$/)){var l=a.substr(r.column).search(/\S|$/);n.doc.removeInLine(r.row,r.column,r.column+l)}}this.clearSelection();var c=r.column,u=n.getState(r.row),a=n.getLine(r.row),d=i.checkOutdent(u,a,e);n.insert(r,e);if(o&&o.selection&&(2==o.selection.length?this.selection.setSelectionRange(new f(r.row,c+o.selection[0],r.row,c+o.selection[1])):this.selection.setSelectionRange(new f(r.row+o.selection[0],o.selection[1],r.row+o.selection[2],o.selection[3]))),n.getDocument().isNewLine(e)){var h=i.getNextLineIndent(u,a.slice(0,r.column),n.getTabString());n.insert({row:r.row+1,column:0},h)}d&&i.autoOutdent(u,n,r.row)},this.onTextInput=function(e,t){if(!t)return this.keyBinding.onTextInput(e);this.startOperation({command:{name:"insertstring"}});var n=this.applyComposition.bind(this,e,t);this.selection.rangeCount?this.forEachSelection(n):n(),this.endOperation()},this.applyComposition=function(e,t){if(t.extendLeft||t.extendRight){var n=this.selection.getRange();n.start.column-=t.extendLeft,n.end.column+=t.extendRight,this.selection.setRange(n),e||n.isEmpty()||this.remove()}if((e||!this.selection.isEmpty())&&this.insert(e,!0),t.restoreStart||t.restoreEnd){var n=this.selection.getRange();n.start.column-=t.restoreStart,n.end.column-=t.restoreEnd,this.selection.setRange(n)}},this.onCommandKey=function(e,t,n){this.keyBinding.onCommandKey(e,t,n)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption("scrollSpeed",e)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(e){this.setOption("dragDelay",e)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(e){this.setOption("selectionStyle",e)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(e){this.setOption("highlightActiveLine",e)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(e){this.setOption("highlightSelectedWord",e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption("readOnly",e)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(e){this.setOption("behavioursEnabled",e)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(e){this.setOption("wrapBehavioursEnabled",e)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(e){this.setOption("showFoldWidgets",e)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(e){this.selection.isEmpty()&&("left"==e?this.selection.selectLeft():this.selection.selectRight());var t=this.getSelectionRange();if(this.getBehavioursEnabled()){var n=this.session,i=n.getState(t.start.row),r=n.getMode().transformAction(i,"deletion",this,n,t);if(0===t.end.column){var o=n.getTextRange(t);if("\n"==o[o.length-1]){var s=n.getLine(t.end.row);/^\s+$/.test(s)&&(t.end.column=s.length)}}r&&(t=r)}this.session.remove(t),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&&e.start.row==e.end.row&&(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(e)},this.transposeLetters=function(){if(this.selection.isEmpty()){var e=this.getCursorPosition(),t=e.column;if(0!==t){var n,i,r=this.session.getLine(e.row);t<r.length?(n=r.charAt(t)+r.charAt(t-1),i=new f(e.row,t-1,e.row,t+1)):(n=r.charAt(t-1)+r.charAt(t-2),i=new f(e.row,t-2,e.row,t)),this.session.replace(i,n),this.session.selection.moveToPosition(i.end)}}},this.toLowerCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(t.start.row<t.end.row){var n=this.$getSelectedRows();return void e.indentRows(n.first,n.last,"	")}if(t.start.column<t.end.column){var i=e.getTextRange(t);if(!/^\s+$/.test(i)){var n=this.$getSelectedRows();return void e.indentRows(n.first,n.last,"	")}}var r=e.getLine(t.start.row),s=t.start,a=e.getTabSize(),l=e.documentToScreenColumn(s.row,s.column);if(this.session.getUseSoftTabs())var c=a-l%a,u=o.stringRepeat(" ",c);else{for(var c=l%a;" "==r[t.start.column-1]&&c;)t.start.column--,c--;this.selection.setSelectionRange(t),u="	"}return this.insert(u)},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,"	")},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){for(var e=this.$getSelectedRows(),t=this.session,n=[],i=e.first;i<=e.last;i++)n.push(t.getLine(i));n.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});for(var r=new f(0,0,0,0),i=e.first;i<=e.last;i++){var o=t.getLine(i);r.start.row=i,r.end.row=i,r.end.column=o.length,t.replace(r,n[i-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),n=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,n,e)},this.getNumberAt=function(e,t){var n=/[\-]?[0-9]+(?:\.[0-9]+)?/g;n.lastIndex=0;for(var i=this.session.getLine(e);n.lastIndex<t;){var r=n.exec(i);if(r.index<=t&&r.index+r[0].length>=t){var o={value:r[0],start:r.index,end:r.index+r[0].length};return o}}return null},this.modifyNumber=function(e){var t=this.selection.getCursor().row,n=this.selection.getCursor().column,i=new f(t,n-1,t,n),r=this.session.getTextRange(i);if(!isNaN(parseFloat(r))&&isFinite(r)){var o=this.getNumberAt(t,n);if(o){var s=o.value.indexOf(".")>=0?o.start+o.value.indexOf(".")+1:o.end,a=o.start+o.value.length-s,l=parseFloat(o.value);l*=Math.pow(10,a),e*=s!==o.end&&s>n?Math.pow(10,o.end-n-1):Math.pow(10,o.end-n),l+=e,l/=Math.pow(10,a);var c=l.toFixed(a),u=new f(t,o.start,t,o.end);this.session.replace(u,c),this.moveCursorTo(t,Math.max(o.start+1,n+c.length-o.value.length))}}else this.toggleWord()},this.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],this.toggleWord=function(){var e=this.selection.getCursor().row,t=this.selection.getCursor().column;this.selection.selectWord();var n=this.getSelectedText(),i=this.selection.getWordRange().start.column,r=n.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),s=t-i-1;0>s&&(s=0);var a=0,l=0,c=this;n.match(/[A-Za-z0-9_]+/)&&r.forEach(function(t,r){l=a+t.length,s>=a&&l>=s&&(n=t,c.selection.clearSelection(),c.moveCursorTo(e,a+i),c.selection.selectTo(e,l+i)),a=l});for(var u,d=this.$toggleWordPairs,h=0;h<d.length;h++)for(var f=d[h],p=0;1>=p;p++){var g=+!p,m=n.match(new RegExp("^\\s?_?("+o.escapeRegExp(f[p])+")\\s?$","i"));if(m){var v=n.match(new RegExp("([_]|^|\\s)("+o.escapeRegExp(m[1])+")($|\\s)","g"));v&&(u=n.replace(new RegExp(o.escapeRegExp(f[p]),"i"),function(e){var t=f[g];return e.toUpperCase()==e?t=t.toUpperCase():e.charAt(0).toUpperCase()==e.charAt(0)&&(t=t.substr(0,0)+f[g].charAt(0).toUpperCase()+t.substr(1)),t}),this.insert(u),u="")}}},this.removeLines=function(){var e=this.$getSelectedRows();this.session.removeFullLines(e.first,e.last),this.clearSelection()},this.duplicateSelection=function(){var e=this.selection,t=this.session,n=e.getRange(),i=e.isBackwards();if(n.isEmpty()){var r=n.start.row;t.duplicateLines(r,r)}else{var o=i?n.start:n.end,s=t.insert(o,t.getTextRange(n),!1);n.start=o,n.end=s,e.setSelectionRange(n,i)}},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(e,t,n){return this.session.moveText(e,t,n)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(e,t){var n,i,r=this.selection;if(!r.inMultiSelectMode||this.inVirtualSelectionMode){var o=r.toOrientedRange();n=this.$getSelectedRows(o),i=this.session.$moveLines(n.first,n.last,t?0:e),t&&-1==e&&(i=0),o.moveBy(i,0),r.fromOrientedRange(o)}else{var s=r.rangeList.ranges;r.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;for(var a=0,l=0,c=s.length,u=0;c>u;u++){var d=u;s[u].moveBy(a,0),n=this.$getSelectedRows(s[u]);for(var h=n.first,f=n.last;++u<c;){l&&s[u].moveBy(l,0);var p=this.$getSelectedRows(s[u]);if(t&&p.first!=f)break;if(!t&&p.first>f+1)break;f=p.last}for(u--,a=this.session.$moveLines(h,f,t?0:e),t&&-1==e&&(d=u+1);u>=d;)s[d].moveBy(a,0),d++;t||(a=0),l+=a}r.fromOrientedRange(r.ranges[0]),r.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(e){return e=(e||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(e)},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var n=this.renderer,i=this.renderer.layerConfig,r=e*Math.floor(i.height/i.lineHeight);t===!0?this.selection.$moveSelection(function(){this.moveCursorBy(r,0)}):t===!1&&(this.selection.moveCursorBy(r,0),this.selection.clearSelection());var o=n.scrollTop;n.scrollBy(0,r*i.lineHeight),null!=t&&n.scrollCursorIntoView(null,.5),n.animateScrolling(o)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,n,i){this.renderer.scrollToLine(e,t,n,i)},this.centerSelection=function(){var e=this.getSelectionRange(),t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(t,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.selection.selectAll()},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e,t){var n=this.getCursorPosition(),i=new y(this.session,n.row,n.column),r=i.getCurrentToken(),o=r||i.stepForward();if(o){var s,a,l=!1,c={},u=n.column-o.start,d={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(o.value.match(/[{}()\[\]]/g)){for(;u<o.value.length&&!l;u++)if(d[o.value[u]])switch(a=d[o.value[u]]+"."+o.type.replace("rparen","lparen"),isNaN(c[a])&&(c[a]=0),o.value[u]){case"(":case"[":case"{":c[a]++;break;case")":case"]":case"}":c[a]--,-1===c[a]&&(s="bracket",l=!0)}}else-1!==o.type.indexOf("tag-name")&&(isNaN(c[o.value])&&(c[o.value]=0),"<"===r.value?c[o.value]++:"</"===r.value&&c[o.value]--,-1===c[o.value]&&(s="tag",l=!0));l||(r=o,o=i.stepForward(),u=0)}while(o&&!l);if(s){var h,p;if("bracket"===s)h=this.session.getBracketRange(n),h||(h=new f(i.getCurrentTokenRow(),i.getCurrentTokenColumn()+u-1,i.getCurrentTokenRow(),i.getCurrentTokenColumn()+u-1),p=h.start,(t||p.row===n.row&&Math.abs(p.column-n.column)<2)&&(h=this.session.getBracketRange(p)));else if("tag"===s){if(!o||-1===o.type.indexOf("tag-name"))return;var g=o.value;if(h=new f(i.getCurrentTokenRow(),i.getCurrentTokenColumn()-2,i.getCurrentTokenRow(),i.getCurrentTokenColumn()-2),0===h.compare(n.row,n.column)){l=!1;do o=r,r=i.stepBackward(),r&&(-1!==r.type.indexOf("tag-close")&&h.setEnd(i.getCurrentTokenRow(),i.getCurrentTokenColumn()+1),o.value===g&&-1!==o.type.indexOf("tag-name")&&("<"===r.value?c[g]++:"</"===r.value&&c[g]--,0===c[g]&&(l=!0)));while(r&&!l)}o&&o.type.indexOf("tag-name")&&(p=h.start,p.row==n.row&&Math.abs(p.column-n.column)<2&&(p=h.end))}p=h&&h.cursor||p,p&&(e?h&&t?this.selection.setRange(h):h&&h.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(p.row,p.column):this.selection.moveTo(p.row,p.column))}}},this.gotoLine=function(e,t,n){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,n)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorLeft();else{var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateRight=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorRight();else{var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&&this.$search.set(t);var n=this.$search.find(this.session),i=0;return n?(this.$tryReplace(n,e)&&(i=1),this.selection.setSelectionRange(n),this.renderer.scrollSelectionIntoView(n.start,n.end),i):i},this.replaceAll=function(e,t){t&&this.$search.set(t);var n=this.$search.findAll(this.session),i=0;if(!n.length)return i;var r=this.getSelectionRange();this.selection.moveTo(0,0);for(var o=n.length-1;o>=0;--o)this.$tryReplace(n[o],e)&&i++;return this.selection.setSelectionRange(r),i},this.$tryReplace=function(e,t){var n=this.session.getTextRange(e);return t=this.$search.replace(n,t),null!==t?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,n){t||(t={}),"string"==typeof e||e instanceof RegExp?t.needle=e:"object"==typeof e&&i.mixin(t,e);var r=this.selection.getRange();null==t.needle&&(e=this.session.getTextRange(r)||this.$search.$options.needle,e||(r=this.session.getWordRange(r.start.row,r.start.column),e=this.session.getTextRange(r)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:r});var o=this.$search.find(this.session);return t.preventScroll?o:o?(this.revealRange(o,n),o):(t.backwards?r.start=r.end:r.end=r.start,void this.selection.setRange(r))},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.session.unfold(e),this.selection.setSelectionRange(e);var n=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),t!==!1&&this.renderer.animateScrolling(n)},this.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy()},this.setAutoScrollEditorIntoView=function(e){if(e){var t,n=this,i=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var r=this.$scrollAnchor;r.style.cssText="position:absolute",this.container.insertBefore(r,this.container.firstChild);var o=this.on("changeSelection",function(){i=!0}),s=this.renderer.on("beforeRender",function(){i&&(t=n.renderer.container.getBoundingClientRect())}),a=this.renderer.on("afterRender",function(){if(i&&t&&(n.isFocused()||n.searchBox&&n.searchBox.isFocused())){var e=n.renderer,o=e.$cursorLayer.$pixelPos,s=e.layerConfig,a=o.top-s.offset;i=o.top>=0&&a+t.top<0?!0:o.top<s.height&&o.top+t.top+s.lineHeight>window.innerHeight?!1:null,null!=i&&(r.style.top=a+"px",r.style.left=o.left+"px",r.style.height=s.lineHeight+"px",r.scrollIntoView(i)),i=t=null}});this.setAutoScrollEditorIntoView=function(e){e||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",o),this.renderer.off("afterRender",a),this.renderer.off("beforeRender",s))}}},this.$resetCursorStyle=function(){var e=this.$cursorStyle||"ace",t=this.renderer.$cursorLayer;t&&(t.setSmoothBlinking(/smooth/.test(e)),t.isBlinking=!this.$readOnly&&"wide"!=e,r.setCssClass(t.element,"ace_slim-cursors",/slim/.test(e)))},this.prompt=function(e,t,n){var i=this;v.loadModule("./ext/prompt",function(r){r.prompt(i,e,t,n)})}}.call(b.prototype),v.defineOptions(b.prototype,"editor",{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:e})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(e){this.textInput.setCopyWithEmptySelection(e)},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},keyboardHandler:{set:function(e){this.setKeyboardHandler(e)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(e){this.session.setValue(e)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(e){this.setSession(e)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(e){this.renderer.$gutterLayer.setShowLineNumbers(e),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),e&&this.$relativeLineNumbers?_.attach(this):_.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(e){this.$showLineNumbers&&e?_.attach(this):_.detach(this)}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var _={getText:function(e,t){return(Math.abs(e.selection.lead.row-t)||t+1+(9>t?"":""))+""},getWidth:function(e,t,n){return Math.max(t.toString().length,(n.lastRow+1).toString().length,2)*n.characterWidth},update:function(e,t){t.renderer.$loop.schedule(t.renderer.CHANGE_GUTTER)},attach:function(e){e.renderer.$gutterLayer.$renderer=this,e.on("changeSelection",this.update),this.update(null,e)},detach:function(e){e.renderer.$gutterLayer.$renderer==this&&(e.renderer.$gutterLayer.$renderer=null),e.off("changeSelection",this.update),this.update(null,e)}};t.Editor=b}),ace.define("ace/undomanager",[],function(e,t,n){"use strict";function i(e,t){for(var n=t;n--;){var i=e[n];if(i&&!i[0].ignore){for(;t-1>n;){var r=c(e[n],e[n+1]);e[n]=r[0],e[n+1]=r[1],n++}return!0}}}function r(e){return{row:e.row,column:e.column}}function o(e){return{start:r(e.start),end:r(e.end),action:e.action,lines:e.lines.slice()}}function s(e){if(e=e||this,Array.isArray(e))return e.map(s).join("\n");var t="";return e.action?(t="insert"==e.action?"+":"-",t+="["+e.lines+"]"):e.value&&(t=Array.isArray(e.value)?e.value.map(a).join("\n"):a(e.value)),e.start&&(t+=a(e)),(e.id||e.rev)&&(t+="	("+(e.id||e.rev)+")"),t}function a(e){return e.start.row+":"+e.start.column+"=>"+e.end.row+":"+e.end.column}function l(e,t){var n="insert"==e.action,i="insert"==t.action;if(n&&i)if(y(t.start,e.end)>=0)d(t,e,-1);else{if(!(y(t.start,e.start)<=0))return null;d(e,t,1)}else if(n&&!i)if(y(t.start,e.end)>=0)d(t,e,-1);else{if(!(y(t.end,e.start)<=0))return null;d(e,t,-1)}else if(!n&&i)if(y(t.start,e.start)>=0)d(t,e,1);else{if(!(y(t.start,e.start)<=0))return null;d(e,t,1)}else if(!n&&!i)if(y(t.start,e.start)>=0)d(t,e,1);else{if(!(y(t.end,e.start)<=0))return null;d(e,t,-1)}return[t,e]}function c(e,t){for(var n=e.length;n--;)for(var i=0;i<t.length;i++)if(!l(e[n],t[i])){for(;n<e.length;){for(;i--;)l(t[i],e[n]);i=t.length,n++}return[e,t]}return e.selectionBefore=t.selectionBefore=e.selectionAfter=t.selectionAfter=null,[t,e]}function u(e,t){var n="insert"==e.action,i="insert"==t.action;if(n&&i)y(e.start,t.start)<0?d(t,e,1):d(e,t,1);else if(n&&!i)y(e.start,t.end)>=0?d(e,t,-1):y(e.start,t.start)<=0?d(t,e,1):(d(e,v.fromPoints(t.start,e.start),-1),d(t,e,1));else if(!n&&i)y(t.start,e.end)>=0?d(t,e,-1):y(t.start,e.start)<=0?d(e,t,1):(d(t,v.fromPoints(e.start,t.start),-1),d(e,t,1));else if(!n&&!i)if(y(t.start,e.end)>=0)d(t,e,-1);else{if(!(y(t.end,e.start)<=0)){var r,o;return y(e.start,t.start)<0&&(r=e,e=f(e,t.start)),y(e.end,t.end)>0&&(o=f(e,t.end)),h(t.end,e.start,e.end,-1),o&&!r&&(e.lines=o.lines,e.start=o.start,e.end=o.end,o=e),[t,r,o].filter(Boolean)}d(e,t,-1)}return[t,e]}function d(e,t,n){h(e.start,t.start,t.end,n),h(e.end,t.start,t.end,n)}function h(e,t,n,i){e.row==(1==i?t:n).row&&(e.column+=i*(n.column-t.column)),e.row+=i*(n.row-t.row)}function f(e,t){var n=e.lines,i=e.end;e.end=r(t);var o=e.end.row-e.start.row,s=n.splice(o,n.length),a=o?t.column:t.column-e.start.column;n.push(s[0].substring(0,a)),s[0]=s[0].substr(a);var l={start:r(t),end:i,lines:s,action:e.action};return l}function p(e,t){t=o(t);for(var n=e.length;n--;){for(var i=e[n],r=0;r<i.length;r++){var s=i[r],a=u(s,t);t=a[0],2!=a.length&&(a[2]?(i.splice(r+1,1,a[1],a[2]),r++):a[1]||(i.splice(r,1),r--))}i.length||e.splice(n,1)}return e}function g(e,t){for(var n=0;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++)p(e,i[r])}var m=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(e){this.$session=e},this.add=function(e,t,n){this.$fromUndo||e!=this.$lastDelta&&(t!==!1&&this.lastDeltas||(this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),e.id=this.$rev=++this.$maxRev),("remove"==e.action||"insert"==e.action)&&(this.$lastDelta=e),this.lastDeltas.push(e))},this.addSelection=function(e,t){this.selections.push({value:e,rev:t||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(e,t){null==t&&(t=this.$rev+1);for(var n=this.$undoStack,i=n.length;i--;){var r=n[i][0];if(r.id<=e)break;r.id<t&&(r.ignore=!0)}this.lastDeltas=null},this.getSelection=function(e,t){for(var n=this.selections,i=n.length;i--;){var r=n[i];if(r.rev<e)return t&&(r=n[i+1]),r}},this.getRevision=function(){return this.$rev},this.getDeltas=function(e,t){null==t&&(t=this.$rev+1);for(var n=this.$undoStack,i=null,r=0,o=n.length;o--;){var s=n[o][0];if(s.id<t&&!i&&(i=o+1),s.id<=e){r=o+1;break}}return n.slice(r,i)},this.getChangedRanges=function(e,t){null==t&&(t=this.$rev+1)},this.getChangedLines=function(e,t){null==t&&(t=this.$rev+1)},this.undo=function(e,t){this.lastDeltas=null;var n=this.$undoStack;if(i(n,n.length)){e||(e=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var r=n.pop(),o=null;return r&&r.length&&(o=e.undoChanges(r,t),this.$redoStack.push(r),this.$syncRev()),this.$fromUndo=!1,o}},this.redo=function(e,t){if(this.lastDeltas=null,e||(e=this.$session),this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){var n=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);g(this.$redoStack,n),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(e){e[0].id=++this.$maxRev},this)}var i=this.$redoStack.pop(),r=null;return i&&(r=e.redoChanges(i,t),this.$undoStack.push(i),this.$syncRev()),this.$fromUndo=!1,r},this.$syncRev=function(){var e=this.$undoStack,t=e[e.length-1],n=t&&t[0].id||0;this.$redoStackBaseRev=n,this.$rev=n},this.reset=function(){this.lastDeltas=null,
this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length>0},this.canRedo=function(){return this.$redoStack.length>0},this.bookmark=function(e){void 0==e&&(e=this.$rev),this.mark=e},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(e){return e?s(e):s(this.$undoStack)+"\n---\n"+s(this.$redoStack)}}).call(m.prototype);var v=e("./range").Range,y=v.comparePoints;v.comparePoints;t.UndoManager=m}),ace.define("ace/layer/lines",[],function(e,t,n){"use strict";var i=e("../lib/dom"),r=function(e,t){this.element=e,this.canvasHeight=t||5e5,this.element.style.height=2*this.canvasHeight+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0};(function(){this.moveContainer=function(e){i.translate(this.element,0,-(e.firstRowScreen*e.lineHeight%this.canvasHeight)-e.offset*this.$offsetCoefficient)},this.pageChanged=function(e,t){return Math.floor(e.firstRowScreen*e.lineHeight/this.canvasHeight)!==Math.floor(t.firstRowScreen*t.lineHeight/this.canvasHeight)},this.computeLineTop=function(e,t,n){var i=t.firstRowScreen*t.lineHeight,r=Math.floor(i/this.canvasHeight),o=n.documentToScreenRow(e,0)*t.lineHeight;return o-r*this.canvasHeight},this.computeLineHeight=function(e,t,n){return t.lineHeight*n.getRowLength(e)},this.getLength=function(){return this.cells.length},this.get=function(e){return this.cells[e]},this.shift=function(){this.$cacheCell(this.cells.shift())},this.pop=function(){this.$cacheCell(this.cells.pop())},this.push=function(e){if(Array.isArray(e)){this.cells.push.apply(this.cells,e);for(var t=i.createFragment(this.element),n=0;n<e.length;n++)t.appendChild(e[n].element);this.element.appendChild(t)}else this.cells.push(e),this.element.appendChild(e.element)},this.unshift=function(e){if(Array.isArray(e)){this.cells.unshift.apply(this.cells,e);for(var t=i.createFragment(this.element),n=0;n<e.length;n++)t.appendChild(e[n].element);this.element.firstChild?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}else this.cells.unshift(e),this.element.insertAdjacentElement("afterbegin",e.element)},this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},this.$cacheCell=function(e){e&&(e.element.remove(),this.cellCache.push(e))},this.createCell=function(e,t,n,r){var o=this.cellCache.pop();if(!o){var s=i.createElement("div");r&&r(s),this.element.appendChild(s),o={element:s,text:"",row:e}}return o.row=e,o}}).call(r.prototype),t.Lines=r}),ace.define("ace/layer/gutter",[],function(e,t,n){"use strict";function i(e){var t=document.createTextNode("");e.appendChild(t);var n=r.createElement("span");return e.appendChild(n),e}var r=e("../lib/dom"),o=e("../lib/oop"),s=e("../lib/lang"),a=e("../lib/event_emitter").EventEmitter,l=e("./lines").Lines,c=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_gutter-layer",e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new l(this.element),this.$lines.$offsetCoefficient=1};(function(){o.implement(this,a),this.setSession=function(e){this.session&&this.session.removeEventListener("change",this.$updateAnnotations),this.session=e,e&&e.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t<e.length;t++){var n=e[t],i=n.row,r=this.$annotations[i];r||(r=this.$annotations[i]={text:[]});var o=n.text;o=o?s.escapeHTML(o):n.html||"",-1===r.text.indexOf(o)&&r.text.push(o);var a=n.type;"error"==a?r.className=" ace_error":"warning"==a&&" ace_error"!=r.className?r.className=" ace_warning":"info"!=a||r.className||(r.className=" ace_info")}},this.$updateAnnotations=function(e){if(this.$annotations.length){var t=e.start.row,n=e.end.row-t;if(0===n);else if("remove"==e.action)this.$annotations.splice(t,n+1,null);else{var i=new Array(n+1);i.unshift(t,1),this.$annotations.splice.apply(this.$annotations,i)}}},this.update=function(e){this.config=e;var t=this.session,n=e.firstRow,r=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1);this.oldLastRow=r,this.config=e,this.$lines.moveContainer(e),this.$updateCursorRow();for(var o=t.getNextFoldLine(n),s=o?o.start.row:1/0,a=null,l=-1,c=n;;){if(c>s&&(c=o.end.row+1,o=t.getNextFoldLine(c,o),s=o?o.start.row:1/0),c>r){for(;this.$lines.getLength()>l+1;)this.$lines.pop();break}a=this.$lines.get(++l),a?a.row=c:(a=this.$lines.createCell(c,e,this.session,i),this.$lines.push(a)),this.$renderCell(a,e,o,c),c++}this._signal("afterRender"),this.$updateGutterWidth(e)},this.$updateGutterWidth=function(e){var t=this.session,n=t.gutterRenderer||this.$renderer,i=t.$firstLineNumber,r=this.$lines.last()?this.$lines.last().text:"";(this.$fixedWidth||t.$useWrapMode)&&(r=t.getLength()+i-1);var o=n?n.getWidth(t,r,e):r.toString().length*e.characterWidth,s=this.$padding||this.$computePadding();o+=s.left+s.right,o===this.gutterWidth||isNaN(o)||(this.gutterWidth=o,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",o))},this.$updateCursorRow=function(){if(this.$highlightGutterLine){var e=this.session.selection.getCursor();this.$cursorRow!==e.row&&(this.$cursorRow=e.row)}},this.updateLineHighlight=function(){if(this.$highlightGutterLine){var e=this.session.selection.cursor.row;if(this.$cursorRow=e,!this.$cursorCell||this.$cursorCell.row!=e){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var t=this.$lines.cells;this.$cursorCell=null;for(var n=0;n<t.length;n++){var i=t[n];if(i.row>=this.$cursorRow){if(i.row>this.$cursorRow){var r=this.session.getFoldLine(this.$cursorRow);if(!(n>0&&r&&r.start.row==t[n-1].row))break;i=t[n-1]}i.element.className="ace_gutter-active-line "+i.element.className,this.$cursorCell=i;break}}}}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$updateCursorRow(),this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=Math.min(e.lastRow+e.gutterOffset,this.session.getLength()-1),i=this.oldLastRow;if(this.oldLastRow=n,!t||i<e.firstRow)return this.update(e);if(n<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var r=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);r>0;r--)this.$lines.shift();if(i>n)for(var r=this.session.getFoldedRowCount(n+1,i);r>0;r--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLines(e,e.firstRow,t.firstRow-1)),n>i&&this.$lines.push(this.$renderLines(e,i+1,n)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(e)},this.$renderLines=function(e,t,n){for(var r=[],o=t,s=this.session.getNextFoldLine(o),a=s?s.start.row:1/0;;){if(o>a&&(o=s.end.row+1,s=this.session.getNextFoldLine(o,s),a=s?s.start.row:1/0),o>n)break;var l=this.$lines.createCell(o,e,this.session,i);this.$renderCell(l,e,s,o),r.push(l),o++}return r},this.$renderCell=function(e,t,n,i){var o=e.element,s=this.session,a=o.childNodes[0],l=o.childNodes[1],c=s.$firstLineNumber,u=s.$breakpoints,d=s.$decorations,h=s.gutterRenderer||this.$renderer,f=this.$showFoldWidgets&&s.foldWidgets,p=n?n.start.row:Number.MAX_VALUE,g="ace_gutter-cell ";if(this.$highlightGutterLine&&(i==this.$cursorRow||n&&i<this.$cursorRow&&i>=p&&this.$cursorRow<=n.end.row)&&(g+="ace_gutter-active-line ",this.$cursorCell!=e&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=e)),u[i]&&(g+=u[i]),d[i]&&(g+=d[i]),this.$annotations[i]&&(g+=this.$annotations[i].className),o.className!=g&&(o.className=g),f){var m=f[i];null==m&&(m=f[i]=s.getFoldWidget(i))}if(m){var g="ace_fold-widget ace_"+m;g+="start"==m&&i==p&&i<n.end.row?" ace_closed":" ace_open",l.className!=g&&(l.className=g);var v=t.lineHeight+"px";r.setStyle(l.style,"height",v),r.setStyle(l.style,"display","inline-block")}else l&&r.setStyle(l.style,"display","none");var y=(h?h.getText(s,i):i+c).toString();return y!==a.data&&(a.data=y),r.setStyle(e.element.style,"height",this.$lines.computeLineHeight(i,t,s)+"px"),r.setStyle(e.element.style,"top",this.$lines.computeLineTop(i,t,s)+"px"),e.text=y,e},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer="",this.setHighlightGutterLine=function(e){this.$highlightGutterLine=e},this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(e){this.$renderer=!e&&{getWidth:function(){return 0},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?r.addCssClass(this.element,"ace_folding-enabled"):r.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=r.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(e.borderLeftWidth)||0)+(parseInt(e.paddingLeft)||0)+1,this.$padding.right=(parseInt(e.borderRightWidth)||0)+(parseInt(e.paddingRight)||0),this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),n=this.element.getBoundingClientRect();return e.x<t.left+n.left?"markers":this.$showFoldWidgets&&e.x>n.right-t.right?"foldWidgets":void 0}}).call(c.prototype),t.Gutter=c}),ace.define("ace/layer/marker",[],function(e,t,n){"use strict";var i=e("../range").Range,r=e("../lib/dom"),o=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_marker-layer",e.appendChild(this.element)};(function(){function e(e,t,n,i){return(e?1:0)|(t?2:0)|(n?4:0)|(i?8:0)}this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.elt=function(e,t){var n=-1!=this.i&&this.element.childNodes[this.i];n?this.i++:(n=document.createElement("div"),this.element.appendChild(n),this.i=-1),n.style.cssText=t,n.className=e},this.update=function(e){if(e){this.config=e,this.i=0;var t;for(var n in this.markers){var i=this.markers[n];if(i.range){var r=i.range.clipRows(e.firstRow,e.lastRow);if(!r.isEmpty())if(r=r.toScreenRange(this.session),i.renderer){var o=this.$getTop(r.start.row,e),s=this.$padding+r.start.column*e.characterWidth;i.renderer(t,r,s,o,e)}else"fullLine"==i.type?this.drawFullLineMarker(t,r,i.clazz,e):"screenLine"==i.type?this.drawScreenLineMarker(t,r,i.clazz,e):r.isMultiLine()?"text"==i.type?this.drawTextMarker(t,r,i.clazz,e):this.drawMultiLineMarker(t,r,i.clazz,e):this.drawSingleLineMarker(t,r,i.clazz+" ace_start ace_br15",e)}else i.update(t,this,this.session,e)}if(-1!=this.i)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(t,n,r,o,s){for(var a=this.session,l=n.start.row,c=n.end.row,u=l,d=0,h=0,f=a.getScreenLastRowColumn(u),p=new i(u,n.start.column,u,h);c>=u;u++)p.start.row=p.end.row=u,p.start.column=u==l?n.start.column:a.getRowWrapIndent(u),p.end.column=f,d=h,h=f,f=c>u+1?a.getScreenLastRowColumn(u+1):u==c?0:n.end.column,this.drawSingleLineMarker(t,p,r+(u==l?" ace_start":"")+" ace_br"+e(u==l||u==l+1&&n.start.column,h>d,h>f,u==c),o,u==c?0:1,s)},this.drawMultiLineMarker=function(e,t,n,i,r){var o=this.$padding,s=i.lineHeight,a=this.$getTop(t.start.row,i),l=o+t.start.column*i.characterWidth;if(r=r||"",this.session.$bidiHandler.isBidiRow(t.start.row)){var c=t.clone();c.end.row=c.start.row,c.end.column=this.session.getLine(c.start.row).length,this.drawBidiSingleLineMarker(e,c,n+" ace_br1 ace_start",i,null,r)}else this.elt(n+" ace_br1 ace_start","height:"+s+"px;right:0;top:"+a+"px;left:"+l+"px;"+(r||""));if(this.session.$bidiHandler.isBidiRow(t.end.row)){var c=t.clone();c.start.row=c.end.row,c.start.column=0,this.drawBidiSingleLineMarker(e,c,n+" ace_br12",i,null,r)}else{a=this.$getTop(t.end.row,i);var u=t.end.column*i.characterWidth;this.elt(n+" ace_br12","height:"+s+"px;width:"+u+"px;top:"+a+"px;left:"+o+"px;"+(r||""))}if(s=(t.end.row-t.start.row-1)*i.lineHeight,!(0>=s)){a=this.$getTop(t.start.row+1,i);var d=(t.start.column?1:0)|(t.end.column?0:8);this.elt(n+(d?" ace_br"+d:""),"height:"+s+"px;right:0;top:"+a+"px;left:"+o+"px;"+(r||""))}},this.drawSingleLineMarker=function(e,t,n,i,r,o){if(this.session.$bidiHandler.isBidiRow(t.start.row))return this.drawBidiSingleLineMarker(e,t,n,i,r,o);var s=i.lineHeight,a=(t.end.column+(r||0)-t.start.column)*i.characterWidth,l=this.$getTop(t.start.row,i),c=this.$padding+t.start.column*i.characterWidth;this.elt(n,"height:"+s+"px;width:"+a+"px;top:"+l+"px;left:"+c+"px;"+(o||""))},this.drawBidiSingleLineMarker=function(e,t,n,i,r,o){var s=i.lineHeight,a=this.$getTop(t.start.row,i),l=this.$padding,c=this.session.$bidiHandler.getSelections(t.start.column,t.end.column);c.forEach(function(e){this.elt(n,"height:"+s+"px;width:"+e.width+(r||0)+"px;top:"+a+"px;left:"+(l+e.left)+"px;"+(o||""))},this)},this.drawFullLineMarker=function(e,t,n,i,r){var o=this.$getTop(t.start.row,i),s=i.lineHeight;t.start.row!=t.end.row&&(s+=this.$getTop(t.end.row,i)-o),this.elt(n,"height:"+s+"px;top:"+o+"px;left:0;right:0;"+(r||""))},this.drawScreenLineMarker=function(e,t,n,i,r){var o=this.$getTop(t.start.row,i),s=i.lineHeight;this.elt(n,"height:"+s+"px;top:"+o+"px;left:0;right:0;"+(r||""))}}).call(o.prototype),t.Marker=o}),ace.define("ace/layer/text",[],function(e,t,n){"use strict";var i=e("../lib/oop"),r=e("../lib/dom"),o=e("../lib/lang"),s=e("./lines").Lines,a=e("../lib/event_emitter").EventEmitter,l=function(e){this.dom=r,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new s(this.element)};(function(){i.implement(this,a),this.EOF_CHAR="",this.EOL_CHAR_LF="",this.EOL_CHAR_CRLF="",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="",this.SPACE_CHAR="",this.$padding=0,this.MAX_LINE_LENGTH=1e4,this.$updateEolChar=function(){var e=this.session.doc,t="\n"==e.getNewLineCharacter()&&"windows"!=e.getNewLineMode(),n=t?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;return this.EOL_CHAR!=n?(this.EOL_CHAR=n,!0):void 0},this.setPadding=function(e){this.$padding=e,this.element.style.margin="0 "+e+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){this.session=e,e&&this.$computeTabString()},this.showInvisibles=!1,this.setShowInvisibles=function(e){return this.showInvisibles==e?!1:(this.showInvisibles=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides==e?!1:(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var e=this.session.getTabSize();this.tabSize=e;for(var t=this.$tabStrings=[0],n=1;e+1>n;n++)if(this.showInvisibles){var i=this.dom.createElement("span");i.className="ace_invisible ace_invisible_tab",i.textContent=o.stringRepeat(this.TAB_CHAR,n),t.push(i)}else t.push(this.dom.createTextNode(o.stringRepeat(" ",n),this.element));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var r="ace_indent-guide",s="",a="";if(this.showInvisibles){r+=" ace_invisible",s=" ace_invisible_space",a=" ace_invisible_tab";var l=o.stringRepeat(this.SPACE_CHAR,this.tabSize),c=o.stringRepeat(this.TAB_CHAR,this.tabSize)}else var l=o.stringRepeat(" ",this.tabSize),c=l;var i=this.dom.createElement("span");i.className=r+s,i.textContent=l,this.$tabStrings[" "]=i;var i=this.dom.createElement("span");i.className=r+a,i.textContent=c,this.$tabStrings["	"]=i}},this.updateLines=function(e,t,n){if(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)return this.update(e);this.config=e;for(var i=Math.max(t,e.firstRow),r=Math.min(n,e.lastRow),o=this.element.childNodes,s=0,a=e.firstRow;i>a;a++){var l=this.session.getFoldLine(a);if(l){if(l.containsRow(i)){i=l.start.row;break}a=l.end.row}s++}for(var c=!1,a=i,l=this.session.getNextFoldLine(a),u=l?l.start.row:1/0;;){if(a>u&&(a=l.end.row+1,l=this.session.getNextFoldLine(a,l),u=l?l.start.row:1/0),a>r)break;var d=o[s++];if(d){this.dom.removeChildren(d),this.$renderLine(d,a,a==u?l:!1);var h=e.lineHeight*this.session.getRowLength(a)+"px";d.style.height!=h&&(c=!0,d.style.height=h)}a++}if(c)for(;s<this.$lines.cells.length;){var f=this.$lines.cells[s++];f.element.style.top=this.$lines.computeLineTop(f.row,e,this.session)+"px"}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=e.lastRow,i=t?t.lastRow:-1;if(!t||i<e.firstRow)return this.update(e);if(n<t.firstRow)return this.update(e);if(!t||t.lastRow<e.firstRow)return this.update(e);if(e.lastRow<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var r=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);r>0;r--)this.$lines.shift();if(t.lastRow>e.lastRow)for(var r=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);r>0;r--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLinesFragment(e,e.firstRow,t.firstRow-1)),e.lastRow>t.lastRow&&this.$lines.push(this.$renderLinesFragment(e,t.lastRow+1,e.lastRow))},this.$renderLinesFragment=function(e,t,n){for(var i=[],o=t,s=this.session.getNextFoldLine(o),a=s?s.start.row:1/0;;){if(o>a&&(o=s.end.row+1,s=this.session.getNextFoldLine(o,s),a=s?s.start.row:1/0),o>n)break;var l=this.$lines.createCell(o,e,this.session),c=l.element;this.dom.removeChildren(c),r.setStyle(c.style,"height",this.$lines.computeLineHeight(o,e,this.session)+"px"),r.setStyle(c.style,"top",this.$lines.computeLineTop(o,e,this.session)+"px"),this.$renderLine(c,o,o==a?s:!1),this.$useLineGroups()?c.className="ace_line_group":c.className="ace_line",i.push(l),o++}return i},this.update=function(e){this.$lines.moveContainer(e),this.config=e;for(var t=e.firstRow,n=e.lastRow,i=this.$lines;i.getLength();)i.pop();i.push(this.$renderLinesFragment(e,t,n))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,n,i){for(var r,s=this,a=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,l=this.dom.createFragment(this.element),c=0;r=a.exec(i);){var u=r[1],d=r[2],h=r[3],f=r[4],p=r[5];if(s.showInvisibles||!d){var g=c!=r.index?i.slice(c,r.index):"";if(c=r.index+r[0].length,g&&l.appendChild(this.dom.createTextNode(g,this.element)),u){var m=s.session.getScreenTabSize(t+r.index);l.appendChild(s.$tabStrings[m].cloneNode(!0)),t+=m-1}else if(d)if(s.showInvisibles){var v=this.dom.createElement("span");v.className="ace_invisible ace_invisible_space",v.textContent=o.stringRepeat(s.SPACE_CHAR,d.length),l.appendChild(v)}else l.appendChild(this.com.createTextNode(d,this.element));else if(h){var v=this.dom.createElement("span");v.className="ace_invisible ace_invisible_space ace_invalid",v.textContent=o.stringRepeat(s.SPACE_CHAR,h.length),l.appendChild(v)}else if(f){s.showInvisibles?s.SPACE_CHAR:"";t+=1;var v=this.dom.createElement("span");v.style.width=2*s.config.characterWidth+"px",v.className=s.showInvisibles?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",v.textContent=s.showInvisibles?s.SPACE_CHAR:"",l.appendChild(v)}else if(p){t+=1;var v=this.dom.createElement("span");v.style.width=2*s.config.characterWidth+"px",v.className="ace_cjk",v.textContent=p,l.appendChild(v)}}}if(l.appendChild(this.dom.createTextNode(c?i.slice(c):i,this.element)),this.$textToken[n.type])e.appendChild(l);else{var y="ace_"+n.type.replace(/\./g," ace_"),v=this.dom.createElement("span");"fold"==n.type&&(v.style.width=n.value.length*this.config.characterWidth+"px"),v.className=y,v.appendChild(l),e.appendChild(v)}return t+i.length},this.renderIndentGuide=function(e,t,n){var i=t.search(this.$indentGuideRe);if(0>=i||i>=n)return t;if(" "==t[0]){i-=i%this.tabSize;for(var r=i/this.tabSize,o=0;r>o;o++)e.appendChild(this.$tabStrings[" "].cloneNode(!0));return t.substr(i)}if("	"==t[0]){for(var o=0;i>o;o++)e.appendChild(this.$tabStrings["	"].cloneNode(!0));return t.substr(i)}return t},this.$createLineElement=function(e){var t=this.dom.createElement("div");return t.className="ace_line",t.style.height=this.config.lineHeight+"px",t},this.$renderWrappedLine=function(e,t,n){var i=0,r=0,s=n[0],a=0,l=this.$createLineElement();e.appendChild(l);for(var c=0;c<t.length;c++){var u=t[c],d=u.value;if(0==c&&this.displayIndentGuides){if(i=d.length,d=this.renderIndentGuide(l,d,s),!d)continue;i-=d.length}if(i+d.length<s)a=this.$renderToken(l,a,u,d),i+=d.length;else{for(;i+d.length>=s;)a=this.$renderToken(l,a,u,d.substring(0,s-i)),d=d.substring(s-i),i=s,l=this.$createLineElement(),e.appendChild(l),l.appendChild(this.dom.createTextNode(o.stringRepeat("",n.indent),this.element)),r++,a=0,s=n[r]||Number.MAX_VALUE;0!=d.length&&(i+=d.length,a=this.$renderToken(l,a,u,d))}}n[n.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(l,a,null,"",!0)},this.$renderSimpleLine=function(e,t){var n=0,i=t[0],r=i.value;this.displayIndentGuides&&(r=this.renderIndentGuide(e,r)),r&&(n=this.$renderToken(e,n,i,r));for(var o=1;o<t.length;o++){if(i=t[o],r=i.value,n+r.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(e,n,i,r);n=this.$renderToken(e,n,i,r)}},this.$renderOverflowMessage=function(e,t,n,i,r){n&&this.$renderToken(e,t,n,i.slice(0,this.MAX_LINE_LENGTH-t));var o=this.dom.createElement("span");o.className="ace_inline_button ace_keyword ace_toggle_wrap",o.textContent=r?"<hide>":"<click to see more...>",e.appendChild(o)},this.$renderLine=function(e,t,n){if(n||0==n||(n=this.session.getFoldLine(t)),n)var i=this.$getFoldLineTokens(t,n);else var i=this.session.getTokens(t);var r=e;if(i.length){var o=this.session.getRowSplitData(t);if(o&&o.length){this.$renderWrappedLine(e,i,o);var r=e.lastChild}else{var r=e;this.$useLineGroups()&&(r=this.$createLineElement(),e.appendChild(r)),this.$renderSimpleLine(r,i)}}else this.$useLineGroups()&&(r=this.$createLineElement(),e.appendChild(r));if(this.showInvisibles&&r){n&&(t=n.end.row);var s=this.dom.createElement("span");s.className="ace_invisible ace_invisible_eol",s.textContent=t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,r.appendChild(s)}},this.$getFoldLineTokens=function(e,t){function n(e,t,n){for(var i=0,o=0;o+e[i].value.length<t;)if(o+=e[i].value.length,i++,i==e.length)return;if(o!=t){var s=e[i].value.substring(t-o);s.length>n-t&&(s=s.substring(0,n-t)),r.push({type:e[i].type,value:s}),o=t+s.length,i+=1}for(;n>o&&i<e.length;){var s=e[i].value;s.length+o>n?r.push({type:e[i].type,value:s.substring(0,n-o)}):r.push(e[i]),o+=s.length,i+=1}}var i=this.session,r=[],o=i.getTokens(e);return t.walk(function(e,t,s,a,l){null!=e?r.push({type:"fold",value:e}):(l&&(o=i.getTokens(t)),o.length&&n(o,a,s))},t.end.row,this.session.getLine(t.end.row).length),r},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){}}).call(l.prototype),t.Text=l}),ace.define("ace/layer/cursor",[],function(e,t,n){"use strict";var i=e("../lib/dom"),r=function(e){this.element=i.createElement("div"),this.element.className="ace_layer ace_cursor-layer",e.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),i.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(e){for(var t=this.cursors,n=t.length;n--;)i.setStyle(t[n].style,"opacity",e?"":"0")},this.$startCssAnimation=function(){for(var e=this.cursors,t=e.length;t--;)e[t].style.animationDuration=this.blinkInterval+"ms";setTimeout(function(){i.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){i.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&&(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&&(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&&(this.smoothBlinking=e,i.setCssClass(this.element,"ace_smooth-blinking",e),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var e=i.createElement("div");return e.className="ace_cursor",this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){if(this.cursors.length>1){var e=this.cursors.pop();return e.parentNode.removeChild(e),e}},this.hideCursor=function(){this.isVisible=!1,i.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,i.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var e=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&i.removeCssClass(this.element,"ace_smooth-blinking"),e(!0),!this.isBlinking||!this.blinkInterval||!this.isVisible)return void this.$stopCssAnimation();if(this.smoothBlinking&&setTimeout(function(){i.addCssClass(this.element,"ace_smooth-blinking")}.bind(this)),i.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var t=function(){this.timeoutId=setTimeout(function(){e(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){e(!0),t()},this.blinkInterval),t()}},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e||(e=this.session.selection.getCursor());var n=this.session.documentToScreenPosition(e),i=this.$padding+(this.session.$bidiHandler.isBidiRow(n.row,e.row)?this.session.$bidiHandler.getPosLeft(n.column):n.column*this.config.characterWidth),r=(n.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:i,top:r}},this.isCursorInView=function(e,t){return e.top>=0&&e.top<t.maxHeight},this.update=function(e){this.config=e;var t=this.session.$selectionMarkers,n=0,r=0;(void 0===t||0===t.length)&&(t=[{cursor:null}]);for(var n=0,o=t.length;o>n;n++){var s=this.getPixelPosition(t[n].cursor,!0);if(!((s.top>e.height+e.offset||s.top<0)&&n>1)){var a=this.cursors[r++]||this.addCursor(),l=a.style;this.drawCursor?this.drawCursor(a,s,e,t[n],this.session):this.isCursorInView(s,e)?(i.setStyle(l,"display","block"),i.translate(a,s.left,s.top),i.setStyle(l,"width",Math.round(e.characterWidth)+"px"),i.setStyle(l,"height",e.lineHeight+"px")):i.setStyle(l,"display","none")}}for(;this.cursors.length>r;)this.removeCursor();var c=this.session.getOverwrite();this.$setOverwrite(c),this.$pixelPos=s,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(e){e!=this.overwrite&&(this.overwrite=e,e?i.addCssClass(this.element,"ace_overwrite-cursors"):i.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(r.prototype),t.Cursor=r}),ace.define("ace/scrollbar",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/dom"),o=e("./lib/event"),s=e("./lib/event_emitter").EventEmitter,a=32768,l=function(e){this.element=r.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=r.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent="",this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,o.addListener(this.element,"scroll",this.onScroll.bind(this)),o.addListener(this.element,"mousedown",o.preventDefault)};(function(){i.implement(this,s),this.setVisible=function(e){this.element.style.display=e?"":"none",this.isVisible=e,this.coeff=1}}).call(l.prototype);var c=function(e,t){l.call(this,e),this.scrollTop=0,this.scrollHeight=0,t.$scrollbarWidth=this.width=r.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px",this.$minWidth=0};i.inherits(c,l),function(){this.classSuffix="-v",this.onScroll=function(){if(!this.skipEvent){if(this.scrollTop=this.element.scrollTop,1!=this.coeff){var e=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-e)/(this.coeff-e)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1},this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},this.setHeight=function(e){this.element.style.height=e+"px"},this.setInnerHeight=this.setScrollHeight=function(e){this.scrollHeight=e,e>a?(this.coeff=a/e,e=a):1!=this.coeff&&(this.coeff=1),this.inner.style.height=e+"px"},this.setScrollTop=function(e){this.scrollTop!=e&&(this.skipEvent=!0,this.scrollTop=e,this.element.scrollTop=e*this.coeff)}}.call(c.prototype);var u=function(e,t){l.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};i.inherits(u,l),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+"px"},this.setInnerWidth=function(e){this.inner.style.width=e+"px"},this.setScrollWidth=function(e){this.inner.style.width=e+"px"},this.setScrollLeft=function(e){this.scrollLeft!=e&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(u.prototype),t.ScrollBar=c,t.ScrollBarV=c,t.ScrollBarH=u,t.VScrollBar=c,t.HScrollBar=u}),ace.define("ace/renderloop",[],function(e,t,n){"use strict";var i=e("./lib/event"),r=function(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=t||window;var n=this;this._flush=function(e){n.pending=!1;var t=n.changes;if(t&&(i.blockIdle(100),n.changes=0,n.onRender(t)),n.changes){if(n.$recursionLimit--<0)return;n.schedule()}else n.$recursionLimit=2}};(function(){this.schedule=function(e){this.changes=this.changes|e,this.changes&&!this.pending&&(i.nextFrame(this._flush),this.pending=!0)},this.clear=function(e){var t=this.changes;return this.changes=0,t}}).call(r.prototype),t.RenderLoop=r}),ace.define("ace/layer/font_metrics",[],function(e,t,n){var i=e("../lib/oop"),r=e("../lib/dom"),o=e("../lib/lang"),s=e("../lib/event"),a=e("../lib/useragent"),l=e("../lib/event_emitter").EventEmitter,c=256,u="function"==typeof ResizeObserver,d=200,h=t.FontMetrics=function(e){
this.el=r.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=r.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=r.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),this.$measureNode.innerHTML=o.stringRepeat("X",c),this.$characterSize={width:0,height:0},u?this.$addObserver():this.checkForSizeChanges()};(function(){i.implement(this,l),this.$characterSize={width:0,height:0},this.$setMeasureNodeStyles=function(e,t){e.width=e.height="auto",e.left=e.top="0px",e.visibility="hidden",e.position="absolute",e.whiteSpace="pre",a.isIE<8?e["font-family"]="inherit":e.font="inherit",e.overflow=t?"hidden":"visible"},this.checkForSizeChanges=function(e){if(void 0===e&&(e=this.$measureSizes()),e&&(this.$characterSize.width!==e.width||this.$characterSize.height!==e.height)){this.$measureNode.style.fontWeight="bold";var t=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&&t.width===e.width&&t.height===e.height,this._emit("changeCharacterSize",{data:e})}},this.$addObserver=function(){var e=this;this.$observer=new window.ResizeObserver(function(t){var n=t[0].contentRect;e.checkForSizeChanges({height:n.height,width:n.width/c})}),this.$observer.observe(this.$measureNode)},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var e=this;return this.$pollSizeChangesTimer=s.onIdle(function t(){e.checkForSizeChanges(),s.onIdle(t,500)},500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(e){var t={height:(e||this.$measureNode).clientHeight,width:(e||this.$measureNode).clientWidth/c};return 0===t.width||0===t.height?null:t},this.$measureCharWidth=function(e){this.$main.innerHTML=o.stringRepeat(e,c);var t=this.$main.getBoundingClientRect();return t.width/c},this.getCharacterWidth=function(e){var t=this.charSizes[e];return void 0===t&&(t=this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width),t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},this.$getZoom=function e(t){return t?(window.getComputedStyle(t).zoom||1)*e(t.parentElement):1},this.$initTransformMeasureNodes=function(){var e=function(e,t){return["div",{style:"position: absolute;top:"+e+"px;left:"+t+"px;"}]};this.els=r.buildDom([e(0,0),e(d,0),e(0,d),e(d,d)],this.el)},this.transformCoordinates=function(e,t){function n(e,t,n){var i=e[1]*t[0]-e[0]*t[1];return[(-t[1]*n[0]+t[0]*n[1])/i,(+e[1]*n[0]-e[0]*n[1])/i]}function i(e,t){return[e[0]-t[0],e[1]-t[1]]}function r(e,t){return[e[0]+t[0],e[1]+t[1]]}function o(e,t){return[e*t[0],e*t[1]]}function s(e){var t=e.getBoundingClientRect();return[t.left,t.top]}if(e){var a=this.$getZoom(this.el);e=o(1/a,e)}this.els||this.$initTransformMeasureNodes();var l=s(this.els[0]),c=s(this.els[1]),u=s(this.els[2]),h=s(this.els[3]),f=n(i(h,c),i(h,u),i(r(c,u),r(h,l))),p=o(1+f[0],i(c,l)),g=o(1+f[1],i(u,l));if(t){var m=t,v=f[0]*m[0]/d+f[1]*m[1]/d+1,y=r(o(m[0],p),o(m[1],g));return r(o(1/v/d,y),l)}var w=i(e,l),b=n(i(p,o(f[0],w)),i(g,o(f[1],w)),w);return o(d,b)}}).call(h.prototype)}),ace.define("ace/virtual_renderer",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/dom"),o=e("./config"),s=e("./layer/gutter").Gutter,a=e("./layer/marker").Marker,l=e("./layer/text").Text,c=e("./layer/cursor").Cursor,u=e("./scrollbar").HScrollBar,d=e("./scrollbar").VScrollBar,h=e("./renderloop").RenderLoop,f=e("./layer/font_metrics").FontMetrics,p=e("./lib/event_emitter").EventEmitter,g='.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;perspective: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}',m=e("./lib/useragent"),v=m.isIE;r.importCssString(g,"ace_editor.css");var y=function(e,t){var n=this;this.container=e||r.createElement("div"),r.addCssClass(this.container,"ace_editor"),r.HI_DPI&&r.addCssClass(this.container,"ace_hidpi"),this.setTheme(t),this.$gutter=r.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden",!0),this.scroller=r.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=r.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new s(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new a(this.content);var i=this.$textLayer=new l(this.content);this.canvas=i.element,this.$markerFront=new a(this.content),this.$cursorLayer=new c(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new d(this.container,this),this.scrollBarH=new u(this.container,this),this.scrollBarV.addEventListener("scroll",function(e){n.$scrollAnimation||n.session.setScrollTop(e.data-n.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(e){n.$scrollAnimation||n.session.setScrollLeft(e.data-n.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new f(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.addEventListener("changeCharacterSize",function(e){n.updateCharacterSize(),n.onResize(!0,n.gutterWidth,n.$size.width,n.$size.height),n._signal("changeCharacterSize",e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!m.isIOS,this.$loop=new h(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),o.resetOptions(this),o._signal("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,i.implement(this,p),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin()},this.setSession=function(e){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=e,e&&this.scrollMargin.top&&e.getScrollTop()<=0&&e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e),e&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},this.updateLines=function(e,t,n){if(void 0===t&&(t=1/0),this.$changedLines?(this.$changedLines.firstRow>e&&(this.$changedLines.firstRow=e),this.$changedLines.lastRow<t&&(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!n)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,n,i){if(!(this.resizing>2)){this.resizing>0?this.resizing++:this.resizing=e?1:0;var r=this.container;i||(i=r.clientHeight||r.scrollHeight),n||(n=r.clientWidth||r.scrollWidth);var o=this.$updateCachedSize(e,t,n,i);if(!this.$size.scrollerHeight||!n&&!i)return this.resizing=0;e&&(this.$gutterLayer.$padding=null),e?this.$renderChanges(o|this.$changes,!0):this.$loop.schedule(o|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null}},this.$updateCachedSize=function(e,t,n,i){i-=this.$extraHeight||0;var o=0,s=this.$size,a={width:s.width,height:s.height,scrollerHeight:s.scrollerHeight,scrollerWidth:s.scrollerWidth};if(i&&(e||s.height!=i)&&(s.height=i,o|=this.CHANGE_SIZE,s.scrollerHeight=s.height,this.$horizScroll&&(s.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",o|=this.CHANGE_SCROLL),n&&(e||s.width!=n)){o|=this.CHANGE_SIZE,s.width=n,null==t&&(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,r.setStyle(this.scrollBarH.element.style,"left",t+"px"),r.setStyle(this.scroller.style,"left",t+this.margin.left+"px"),s.scrollerWidth=Math.max(0,n-t-this.scrollBarV.getWidth()-this.margin.h),r.setStyle(this.$gutter.style,"left",this.margin.left+"px");var l=this.scrollBarV.getWidth()+"px";r.setStyle(this.scrollBarH.element.style,"right",l),r.setStyle(this.scroller.style,"right",l),r.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||e)&&(o|=this.CHANGE_FULL)}return s.$dirty=!n||!i,o&&this._signal("resize",a),o},this.onGutterResize=function(e){var t=this.$showGutter?e:0;t!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,t,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-2*this.$padding,t=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(t,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption("animatedScroll",e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption("showInvisibles",e),this.session.$bidiHandler.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(e){this.setOption("displayIndentGuides",e)},this.setShowPrintMargin=function(e){this.setOption("showPrintMargin",e)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(e){this.setOption("printMarginColumn",e)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(e){return this.setOption("showGutter",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updatePrintMargin=function(){if(this.$showPrintMargin||this.$printMarginEl){if(!this.$printMarginEl){var e=r.createElement("div");e.className="ace_layer ace_print-margin-layer",this.$printMarginEl=r.createElement("div"),this.$printMarginEl.className="ace_print-margin",e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)}var t=this.$printMarginEl.style;t.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",t.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&-1==this.session.$wrap&&this.adjustWrapLimit()}},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(!this.$isMousePressed){var e=this.textarea.style,t=this.$composition;if(!this.$keepTextAreaAtCursor&&!t)return void r.translate(this.textarea,-100,0);var n=this.$cursorLayer.$pixelPos;if(n){t&&t.markerRange&&(n=this.$cursorLayer.getPixelPosition(t.markerRange.start,!0));var i=this.layerConfig,o=n.top,s=n.left;o-=i.offset;var a=t&&t.useTextareaForIME?this.lineHeight:v?0:1;if(0>o||o>i.height-a)return void r.translate(this.textarea,0,0);var l=1;if(t)if(t.useTextareaForIME){var c=this.textarea.value;l=this.characterWidth*this.session.$getStringScreenWidth(c)[0],a+=2}else o+=this.lineHeight+2;else o+=this.lineHeight;s-=this.scrollLeft,s>this.$size.scrollerWidth-l&&(s=this.$size.scrollerWidth-l),s+=this.gutterWidth+this.margin.left,r.setStyle(e,"height",a+"px"),r.setStyle(e,"width",l+"px"),r.translate(this.textarea,Math.min(s,this.$size.scrollerWidth-l),Math.min(o,this.$size.height-a))}}},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)},this.getLastFullyVisibleRow=function(){var e=this.layerConfig,t=e.lastRow,n=this.session.documentToScreenRow(t,0)*e.lineHeight;return n-this.session.getScrollTop()>e.height-e.lineHeight?t-1:t},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,n,i){var r=this.scrollMargin;r.top=0|e,r.bottom=0|t,r.right=0|i,r.left=0|n,r.v=r.top+r.bottom,r.h=r.left+r.right,r.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-r.top),this.updateFull()},this.setMargin=function(e,t,n,i){var r=this.margin;r.top=0|e,r.bottom=0|t,r.right=0|i,r.left=0|n,r.v=r.top+r.bottom,r.h=r.left+r.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption("hScrollBarAlwaysVisible",e)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption("vScrollBarAlwaysVisible",e)},this.$updateScrollBarV=function(){var e=this.layerConfig.maxHeight,t=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(e-=(t-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>e-t&&(e=this.scrollTop+t,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(e+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){if(this.$changes&&(e|=this.$changes,this.$changes=0),!this.session||!this.container.offsetWidth||this.$frozen||!e&&!t)return void(this.$changes|=e);if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender"),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var n=this.layerConfig;if(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_TEXT||e&this.CHANGE_LINES||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL){if(e|=this.$computeLayerConfig()|this.$loop.clear(),n.firstRow!=this.layerConfig.firstRow&&n.firstRowScreen==this.layerConfig.firstRowScreen){var i=this.scrollTop+(n.firstRow-this.layerConfig.firstRow)*this.lineHeight;i>0&&(this.scrollTop=i,e|=this.CHANGE_SCROLL,e|=this.$computeLayerConfig()|this.$loop.clear())}n=this.layerConfig,this.$updateScrollBarV(),e&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),r.translate(this.content,-this.scrollLeft,-n.offset);var o=n.width+2*this.$padding+"px",s=n.minHeight+"px";r.setStyle(this.content.style,"width",o),r.setStyle(this.content.style,"height",s)}return e&this.CHANGE_H_SCROLL&&(r.translate(this.content,-this.scrollLeft,-n.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"),e&this.CHANGE_FULL?(this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),void this._signal("afterRender")):e&this.CHANGE_SCROLL?(e&this.CHANGE_TEXT||e&this.CHANGE_LINES?this.$textLayer.update(n):this.$textLayer.scrollLines(n),this.$showGutter&&(e&this.CHANGE_GUTTER||e&this.CHANGE_LINES?this.$gutterLayer.update(n):this.$gutterLayer.scrollLines(n)),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),void this._signal("afterRender")):(e&this.CHANGE_TEXT?(this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n)):e&this.CHANGE_LINES?(this.$updateLines()||e&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(n):e&this.CHANGE_TEXT||e&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(n):e&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(n),e&this.CHANGE_CURSOR&&(this.$cursorLayer.update(n),this.$moveTextAreaToCursor()),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(n),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(n),void this._signal("afterRender"))},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,n=Math.min(t,Math.max((this.$minLines||1)*this.lineHeight,e))+this.scrollMargin.v+(this.$extraHeight||0);
this.$horizScroll&&(n+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&n>this.$maxPixelHeight&&(n=this.$maxPixelHeight);var i=n<=2*this.lineHeight,r=!i&&e>t;if(n!=this.desiredHeight||this.$size.height!=this.desiredHeight||r!=this.$vScroll){r!=this.$vScroll&&(this.$vScroll=r,this.scrollBarV.setVisible(r));var o=this.container.clientWidth;this.container.style.height=n+"px",this.$updateCachedSize(!0,this.$gutterWidth,o,n),this.desiredHeight=n,this._signal("autosize")}},this.$computeLayerConfig=function(){var e=this.session,t=this.$size,n=t.height<=2*this.lineHeight,i=this.session.getScreenLength(),r=i*this.lineHeight,o=this.$getLongestLine(),s=!n&&(this.$hScrollBarAlwaysVisible||t.scrollerWidth-o-2*this.$padding<0),a=this.$horizScroll!==s;a&&(this.$horizScroll=s,this.scrollBarH.setVisible(s));var l=this.$vScroll;this.$maxLines&&this.lineHeight>1&&this.$autosize();var c=t.scrollerHeight+this.lineHeight,u=!this.$maxLines&&this.$scrollPastEnd?(t.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;r+=u;var d=this.scrollMargin;this.session.setScrollTop(Math.max(-d.top,Math.min(this.scrollTop,r-t.scrollerHeight+d.bottom))),this.session.setScrollLeft(Math.max(-d.left,Math.min(this.scrollLeft,o+2*this.$padding-t.scrollerWidth+d.right)));var h=!n&&(this.$vScrollBarAlwaysVisible||t.scrollerHeight-r+u<0||this.scrollTop>d.top),f=l!==h;f&&(this.$vScroll=h,this.scrollBarV.setVisible(h));var p,g,m=this.scrollTop%this.lineHeight,v=Math.ceil(c/this.lineHeight)-1,y=Math.max(0,Math.round((this.scrollTop-m)/this.lineHeight)),w=y+v,b=this.lineHeight;y=e.screenToDocumentRow(y,0);var _=e.getFoldLine(y);_&&(y=_.start.row),p=e.documentToScreenRow(y,0),g=e.getRowLength(y)*b,w=Math.min(e.screenToDocumentRow(w,0),e.getLength()-1),c=t.scrollerHeight+e.getRowLength(w)*b+g,m=this.scrollTop-p*b;var C=0;return(this.layerConfig.width!=o||a)&&(C=this.CHANGE_H_SCROLL),(a||f)&&(C|=this.$updateCachedSize(!0,this.gutterWidth,t.width,t.height),this._signal("scrollbarVisibilityChanged"),f&&(o=this.$getLongestLine())),this.layerConfig={width:o,padding:this.$padding,firstRow:y,firstRowScreen:p,lastRow:w,lineHeight:b,characterWidth:this.characterWidth,minHeight:c,maxHeight:r,offset:m,gutterOffset:b?Math.max(0,Math.ceil((m+t.height-t.scrollerHeight)/b)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(o-this.$padding),C},this.$updateLines=function(){if(this.$changedLines){var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow;this.$changedLines=null;var n=this.layerConfig;if(!(e>n.lastRow+1||t<n.firstRow))return t===1/0?(this.$showGutter&&this.$gutterLayer.update(n),void this.$textLayer.update(n)):(this.$textLayer.updateLines(n,e,t),!0)}},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(e+=1),this.$textLayer&&e>this.$textLayer.MAX_LINE_LENGTH&&(e=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,n){this.scrollCursorIntoView(e,n),this.scrollCursorIntoView(t,n)},this.scrollCursorIntoView=function(e,t,n){if(0!==this.$size.scrollerHeight){var i=this.$cursorLayer.getPixelPosition(e),r=i.left,o=i.top,s=n&&n.top||0,a=n&&n.bottom||0,l=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;l+s>o?(t&&l+s>o+this.lineHeight&&(o-=t*this.$size.scrollerHeight),0===o&&(o=-this.scrollMargin.top),this.session.setScrollTop(o)):l+this.$size.scrollerHeight-a<o+this.lineHeight&&(t&&l+this.$size.scrollerHeight-a<o-this.lineHeight&&(o+=t*this.$size.scrollerHeight),this.session.setScrollTop(o+this.lineHeight+a-this.$size.scrollerHeight));var c=this.scrollLeft;c>r?(r<this.$padding+2*this.layerConfig.characterWidth&&(r=-this.scrollMargin.left),this.session.setScrollLeft(r)):c+this.$size.scrollerWidth<r+this.characterWidth?this.session.setScrollLeft(Math.round(r+this.characterWidth-this.$size.scrollerWidth)):c<=this.$padding&&r-c<this.characterWidth&&this.session.setScrollLeft(0)}},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){"number"==typeof e&&(e={row:e,column:0});var n=this.$cursorLayer.getPixelPosition(e),i=this.$size.scrollerHeight-this.lineHeight,r=n.top-i*(t||0);return this.session.setScrollTop(r),r},this.STEPS=8,this.$calcSteps=function(e,t){var n=0,i=this.STEPS,r=[],o=function(e,t,n){return n*(Math.pow(e-1,3)+1)+t};for(n=0;i>n;++n)r.push(o(n/this.STEPS,e,t-e));return r},this.scrollToLine=function(e,t,n,i){var r=this.$cursorLayer.getPixelPosition({row:e,column:0}),o=r.top;t&&(o-=this.$size.scrollerHeight/2);var s=this.scrollTop;this.session.setScrollTop(o),n!==!1&&this.animateScrolling(s,i)},this.animateScrolling=function(e,t){var n=this.scrollTop;if(this.$animatedScroll){var i=this;if(e!=n){if(this.$scrollAnimation){var r=this.$scrollAnimation.steps;if(r.length&&(e=r[0],e==n))return}var o=i.$calcSteps(e,n);this.$scrollAnimation={from:e,to:n,steps:o},clearInterval(this.$timer),i.session.setScrollTop(o.shift()),i.session.$scrollTop=n,this.$timer=setInterval(function(){o.length?(i.session.setScrollTop(o.shift()),i.session.$scrollTop=n):null!=n?(i.session.$scrollTop=-1,i.session.setScrollTop(n),n=null):(i.$timer=clearInterval(i.$timer),i.$scrollAnimation=null,t&&t())},10)}}},this.scrollToY=function(e){this.scrollTop!==e&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&&(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(t)},this.scrollBy=function(e,t){t&&this.session.setScrollTop(this.session.getScrollTop()+t),e&&this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){return 0>t&&this.session.getScrollTop()>=1-this.scrollMargin.top?!0:t>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom?!0:0>e&&this.session.getScrollLeft()>=1-this.scrollMargin.left?!0:e>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right?!0:void 0},this.pixelToScreenCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var i=this.$fontMetrics.transformCoordinates([e,t]);e=i[1]-this.gutterWidth-this.margin.left,t=i[0]}else n=this.scroller.getBoundingClientRect();var r=e+this.scrollLeft-n.left-this.$padding,o=r/this.characterWidth,s=Math.floor((t+this.scrollTop-n.top)/this.lineHeight),a=this.$blockCursor?Math.floor(o):Math.round(o);return{row:s,column:a,side:o-a>0?1:-1,offsetX:r}},this.screenToTextCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var i=this.$fontMetrics.transformCoordinates([e,t]);e=i[1]-this.gutterWidth-this.margin.left,t=i[0]}else n=this.scroller.getBoundingClientRect();var r=e+this.scrollLeft-n.left-this.$padding,o=r/this.characterWidth,s=this.$blockCursor?Math.floor(o):Math.round(o),a=Math.floor((t+this.scrollTop-n.top)/this.lineHeight);return this.session.screenToDocumentPosition(a,Math.max(s,0),r)},this.textToScreenCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),i=this.session.documentToScreenPosition(e,t),r=this.$padding+(this.session.$bidiHandler.isBidiRow(i.row,e)?this.session.$bidiHandler.getPosLeft(i.column):Math.round(i.column*this.characterWidth)),o=i.row*this.lineHeight;return{pageX:n.left+r-this.scrollLeft,pageY:n.top+o-this.scrollTop}},this.visualizeFocus=function(){r.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){r.removeCssClass(this.container,"ace_focus")},this.showComposition=function(e){this.$composition=e,e.cssText||(e.cssText=this.textarea.style.cssText),e.useTextareaForIME=this.$useTextareaForIME,this.$useTextareaForIME?(r.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):e.markerId=this.session.addMarker(e.markerRange,"ace_composition_marker","text")},this.setCompositionText=function(e){var t=this.session.selection.cursor;this.addToken(e,"composition_placeholder",t.row,t.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){this.$composition&&(this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),r.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText,this.$composition=null,this.$cursorLayer.element.style.display="")},this.addToken=function(e,t,n,i){var r=this.session;r.bgTokenizer.lines[n]=null;var o={type:t,value:e},s=r.getTokens(n);if(null==i)s.push(o);else for(var a=0,l=0;l<s.length;l++){var c=s[l];if(a+=c.value.length,a>=i){var u=c.value.length-(a-i),d=c.value.slice(0,u),h=c.value.slice(u);s.splice(l,1,{type:c.type,value:d},o,{type:c.type,value:h});break}}this.updateLines(n,n)},this.setTheme=function(e,t){function n(n){if(i.$themeId!=e)return t&&t();if(!n||!n.cssClass)throw new Error("couldn't load module "+e+" or it didn't call define");n.$id&&(i.$themeId=n.$id),r.importCssString(n.cssText,n.cssClass,i.container),i.theme&&r.removeCssClass(i.container,i.theme.cssClass);var o="padding"in n?n.padding:"padding"in(i.theme||{})?4:i.$padding;i.$padding&&o!=i.$padding&&i.setPadding(o),i.$theme=n.cssClass,i.theme=n,r.addCssClass(i.container,n.cssClass),r.setCssClass(i.container,"ace_dark",n.isDark),i.$size&&(i.$size.width=0,i.$updateSizeAsync()),i._dispatchEvent("themeLoaded",{theme:n}),t&&t()}var i=this;if(this.$themeId=e,i._dispatchEvent("themeChange",{theme:e}),e&&"string"!=typeof e)n(e);else{var s=e||this.$options.theme.initialValue;o.loadModule(["theme",s],n)}},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){r.setCssClass(this.container,e,t!==!1)},this.unsetStyle=function(e){r.removeCssClass(this.container,e)},this.setCursorStyle=function(e){r.setStyle(this.scroller.style,"cursor",e)},this.setMouseCursor=function(e){r.setStyle(this.scroller.style,"cursor",e)},this.attachToShadowRoot=function(){r.importCssString(g,"ace_editor.css",this.container)},this.destroy=function(){this.$fontMetrics.destroy(),this.$cursorLayer.destroy()}}).call(y.prototype),o.defineOptions(y.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){"number"==typeof e&&(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){r.setCssClass(this.$gutter,"ace_fade-fold-widgets",e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(e){this.$gutterLayer.setHighlightGutterLine(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(e){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){"number"==typeof e&&(e+="px"),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(e){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(e){e=+e||0,this.$scrollPastEnd!=e&&(this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!m.isMobile&&!m.isIE}}),t.VirtualRenderer=y}),ace.define("ace/worker/worker_client",[],function(e,t,n){"use strict";function i(e){var t="importScripts('"+s.qualifyURL(e)+"');";try{return new Blob([t],{type:"application/javascript"})}catch(n){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,r=new i;return r.append(t),r.getBlob("application/javascript")}}function r(e){if("undefined"==typeof Worker)return{postMessage:function(){},terminate:function(){}};if(l.get("loadWorkerFromBlob")){var t=i(e),n=window.URL||window.webkitURL,r=n.createObjectURL(t);return new Worker(r)}return new Worker(e)}var o=e("../lib/oop"),s=e("../lib/net"),a=e("../lib/event_emitter").EventEmitter,l=e("../config"),c=function(e){e.postMessage||(e=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=e,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){o.implement(this,a),this.$createWorkerFromOldConfig=function(t,n,i,o,s){if(e.nameToUrl&&!e.toUrl&&(e.toUrl=e.nameToUrl),l.get("packaged")||!e.toUrl)o=o||l.moduleUrl(n,"worker");else{var a=this.$normalizePath;o=o||a(e.toUrl("ace/worker/worker.js",null,"_"));var c={};t.forEach(function(t){c[t]=a(e.toUrl(t,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}return this.$worker=r(o),s&&this.send("importScripts",s),this.$worker.postMessage({init:!0,tlns:c,module:n,classname:i}),this.$worker},this.onMessage=function(e){var t=e.data;switch(t.type){case"event":this._signal(t.name,{data:t.data});break;case"call":var n=this.callbacks[t.id];n&&(n(t.data),delete this.callbacks[t.id]);break;case"error":this.reportError(t.data);break;case"log":window.console&&console.log&&console.log.apply(console,t.data)}},this.reportError=function(e){window.console&&console.error&&console.error(e)},this.$normalizePath=function(e){return s.qualifyURL(e)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,n){if(n){var i=this.callbackId++;this.callbacks[i]=n,t.push(i)}this.send(e,t)},this.emit=function(e,t){try{t.data&&t.data.err&&(t.data.err={message:t.data.err.message,stack:t.data.err.stack,code:t.data.err.code}),this.$worker.postMessage({event:e,data:{data:t.data}})}catch(n){console.error(n.stack)}},this.attachToDocument=function(e){this.$doc&&this.terminate(),this.$doc=e,this.call("setValue",[e.getValue()]),e.on("change",this.changeListener)},this.changeListener=function(e){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),"insert"==e.action?this.deltaQueue.push(e.start,e.lines):this.deltaQueue.push(e.start,e.end)},this.$sendDeltaQueue=function(){var e=this.deltaQueue;e&&(this.deltaQueue=null,e.length>50&&e.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:e}))}}).call(c.prototype);var u=function(e,t,n){var i=null,r=!1,o=Object.create(a),s=[],u=new c({messageBuffer:s,terminate:function(){},postMessage:function(e){s.push(e),i&&(r?setTimeout(d):d())}});u.setEmitSync=function(e){r=e};var d=function(){var e=s.shift();e.command?i[e.command].apply(i,e.args):e.event&&o._signal(e.event,e.data)};return o.postMessage=function(e){u.onMessage({data:e})},o.callback=function(e,t){this.postMessage({type:"call",id:t,data:e})},o.emit=function(e,t){this.postMessage({type:"event",name:e,data:t})},l.loadModule(["worker",t],function(e){for(i=new e[n](o);s.length;)d()}),u};t.UIWorkerClient=u,t.WorkerClient=c,t.createWorker=r}),ace.define("ace/placeholder",[],function(e,t,n){"use strict";var i=e("./range").Range,r=e("./lib/event_emitter").EventEmitter,o=e("./lib/oop"),s=function(e,t,n,i,r,o){var s=this;this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=r,this.othersClass=o,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=i,this.$onCursorChange=function(){setTimeout(function(){s.onCursorChange()})},this.$pos=n;var a=e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=a.length,this.setup(),e.selection.on("changeCursor",this.$onCursorChange)};(function(){o.implement(this,r),this.setup=function(){var e=this,t=this.doc,n=this.session;this.selectionBefore=n.selection.toJSON(),n.selection.inMultiSelectMode&&n.selection.toSingleRange(),this.pos=t.createAnchor(this.$pos.row,this.$pos.column);var r=this.pos;r.$insertRight=!0,r.detach(),r.markerId=n.addMarker(new i(r.row,r.column,r.row,r.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(n){var i=t.createAnchor(n.row,n.column);i.$insertRight=!0,i.detach(),e.others.push(i)}),n.setUndoSelect(!1)},this.showOtherMarkers=function(){if(!this.othersActive){var e=this.session,t=this;this.othersActive=!0,this.others.forEach(function(n){n.markerId=e.addMarker(new i(n.row,n.column,n.row,n.column+t.length),t.othersClass,null,!1)})}},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var e=0;e<this.others.length;e++)this.session.removeMarker(this.others[e].markerId)}},this.onUpdate=function(e){if(this.$updating)return this.updateAnchors(e);var t=e;if(t.start.row===t.end.row&&t.start.row===this.pos.row){this.$updating=!0;var n="insert"===e.action?t.end.column-t.start.column:t.start.column-t.end.column,r=t.start.column>=this.pos.column&&t.start.column<=this.pos.column+this.length+1,o=t.start.column-this.pos.column;if(this.updateAnchors(e),r&&(this.length+=n),r&&!this.session.$fromUndo)if("insert"===e.action)for(var s=this.others.length-1;s>=0;s--){var a=this.others[s],l={row:a.row,column:a.column+o};this.doc.insertMergedLines(l,e.lines)}else if("remove"===e.action)for(var s=this.others.length-1;s>=0;s--){var a=this.others[s],l={row:a.row,column:a.column+o};this.doc.remove(new i(l.row,l.column,l.row,l.column-n))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(e){this.pos.onChange(e);for(var t=this.others.length;t--;)this.others[t].onChange(e);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var e=this,t=this.session,n=function(n,r){t.removeMarker(n.markerId),n.markerId=t.addMarker(new i(n.row,n.column,n.row,n.column+e.length),r,null,!1)};n(this.pos,this.mainClass);for(var r=this.others.length;r--;)n(this.others[r],this.othersClass)}},this.onCursorChange=function(e){if(!this.$updating&&this.session){var t=this.session.selection.getCursor();t.row===this.pos.row&&t.column>=this.pos.column&&t.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",e)):(this.hideOtherMarkers(),this._emit("cursorLeave",e))}},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.removeEventListener("change",this.$onUpdate),this.session.selection.removeEventListener("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth,n=0;t>n;n++)e.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(s.prototype),t.PlaceHolder=s}),ace.define("ace/mouse/multi_select_handler",[],function(e,t,n){function i(e,t){return e.row==t.row&&e.column==t.column}function r(e){var t=e.domEvent,n=t.altKey,r=t.shiftKey,a=t.ctrlKey,l=e.getAccelKey(),c=e.getButton();if(a&&s.isMac&&(c=t.button),e.editor.inMultiSelectMode&&2==c)return void e.editor.textInput.onContextMenu(e.domEvent);if(!a&&!n&&!l)return void(0===c&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode());if(0===c){var u,d=e.editor,h=d.selection,f=d.inMultiSelectMode,p=e.getDocumentPosition(),g=h.getCursor(),m=e.inSelection()||h.isEmpty()&&i(p,g),v=e.x,y=e.y,w=function(e){v=e.clientX,y=e.clientY},b=d.session,_=d.renderer.pixelToScreenCoordinates(v,y),C=_;if(d.$mouseHandler.$enableJumpToDef)a&&n||l&&n?u=r?"block":"add":n&&d.$blockSelectEnabled&&(u="block");else if(l&&!n){if(u="add",!f&&r)return}else n&&d.$blockSelectEnabled&&(u="block");if(u&&s.isMac&&t.ctrlKey&&d.$mouseHandler.cancelContextMenu(),"add"==u){if(!f&&m)return;if(!f){var k=h.toOrientedRange();d.addSelectionMarker(k)}var S=h.rangeList.rangeAtPoint(p);d.inVirtualSelectionMode=!0,r&&(S=null,k=h.ranges[0]||k,d.removeSelectionMarker(k)),d.once("mouseup",function(){var e=h.toOrientedRange();S&&e.isEmpty()&&i(S.cursor,e.cursor)?h.substractPoint(e.cursor):(r?h.substractPoint(k.cursor):k&&(d.removeSelectionMarker(k),h.addRange(k)),h.addRange(e)),d.inVirtualSelectionMode=!1})}else if("block"==u){e.stop(),d.inVirtualSelectionMode=!0;var $,x=[],A=function(){var e=d.renderer.pixelToScreenCoordinates(v,y),t=b.screenToDocumentPosition(e.row,e.column,e.offsetX);i(C,e)&&i(t,h.lead)||(C=e,d.selection.moveToPosition(t),d.renderer.scrollCursorIntoView(),d.removeSelectionMarkers(x),x=h.rectangularRangeBlock(C,_),d.$mouseHandler.$clickSelection&&1==x.length&&x[0].isEmpty()&&(x[0]=d.$mouseHandler.$clickSelection.clone()),x.forEach(d.addSelectionMarker,d),d.updateSelectionMarkers())};f&&!l?h.toSingleRange():!f&&l&&($=h.toOrientedRange(),d.addSelectionMarker($)),r?_=b.documentToScreenPosition(h.lead):h.moveToPosition(p),C={row:-1,column:-1};var T=function(e){A(),clearInterval(M),d.removeSelectionMarkers(x),x.length||(x=[h.toOrientedRange()]),$&&(d.removeSelectionMarker($),h.toSingleRange($));for(var t=0;t<x.length;t++)h.addRange(x[t]);d.inVirtualSelectionMode=!1,d.$mouseHandler.$clickSelection=null},E=A;o.capture(d.container,w,T);var M=setInterval(function(){E()},20);return e.preventDefault()}}}var o=e("../lib/event"),s=e("../lib/useragent");t.onMouseDown=r}),ace.define("ace/commands/multi_select_commands",[],function(e,t,n){t.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(e){e.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(e){e.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(e){e.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(e){e.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(e){e.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(e){e.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"splitIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(e){e.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(e){e.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],t.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(e){e.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(e){return e&&e.inMultiSelectMode}}];var i=e("../keyboard/hash_handler").HashHandler;t.keyboardHandler=new i(t.multiSelectCommands)}),ace.define("ace/multi_select",[],function(e,t,n){function i(e,t,n){return g.$options.wrap=!0,g.$options.needle=t,g.$options.backwards=-1==n,g.find(e)}function r(e,t){return e.row==t.row&&e.column==t.column}function o(e){e.$multiselectOnSessionChange||(e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=t.onSessionChange.bind(e),e.$checkMultiselectChange=e.$checkMultiselectChange.bind(e),e.$multiselectOnSessionChange(e),e.on("changeSession",e.$multiselectOnSessionChange),e.on("mousedown",u),e.commands.addCommands(f.defaultCommands),s(e))}function s(e){function t(t){i&&(e.renderer.setMouseCursor(""),i=!1)}var n=e.textInput.getElement(),i=!1;d.addListener(n,"keydown",function(n){var r=18==n.keyCode&&!(n.ctrlKey||n.shiftKey||n.metaKey);e.$blockSelectEnabled&&r?i||(e.renderer.setMouseCursor("crosshair"),i=!0):i&&t()}),d.addListener(n,"keyup",t),d.addListener(n,"blur",t)}var a=e("./range_list").RangeList,l=e("./range").Range,c=e("./selection").Selection,u=e("./mouse/multi_select_handler").onMouseDown,d=e("./lib/event"),h=e("./lib/lang"),f=e("./commands/multi_select_commands");t.commands=f.defaultCommands.concat(f.multiSelectCommands);var p=e("./search").Search,g=new p,m=e("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(m.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(e){if(!this.inMultiSelectMode&&0===this.rangeCount){var n=this.toOrientedRange();if(this.rangeList.add(n),this.rangeList.add(e),2!=this.rangeList.ranges.length)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(n),this.$onAddRange(n)}e.cursor||(e.cursor=e.end);var i=this.rangeList.add(e);return this.$onAddRange(e),i.length&&this.$onRemoveRange(i),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)}},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&&this.$onRemoveRange(t),e&&this.fromOrientedRange(e)},this.substractPoint=function(e){var t=this.rangeList.substractPoint(e);return t?(this.$onRemoveRange(t),t[0]):void 0},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length&&this.$onRemoveRange(e)},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal("addRange",{range:e})},this.$onRemoveRange=function(e){if(this.rangeCount=this.rangeList.ranges.length,1==this.rangeCount&&this.inMultiSelectMode){var t=this.rangeList.ranges.pop();e.push(t),this.rangeCount=0}for(var n=e.length;n--;){var i=this.ranges.indexOf(e[n]);this.ranges.splice(i,1)}this._signal("removeRange",{ranges:e}),0===this.rangeCount&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),t=t||this.ranges[0],t&&!t.isEqual(this.getRange())&&this.fromOrientedRange(t)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new a,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],n=l.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var n=this.getRange(),i=this.isBackwards(),r=n.start.row,o=n.end.row;if(r==o){if(i)var s=n.end,a=n.start;else var s=n.start,a=n.end;return this.addRange(l.fromPoints(a,a)),void this.addRange(l.fromPoints(s,s))}var c=[],u=this.getLineRange(r,!0);u.start.column=n.start.column,c.push(u);for(var d=r+1;o>d;d++)c.push(this.getLineRange(d,!0));u=this.getLineRange(o,!0),u.end.column=n.end.column,c.push(u),c.forEach(this.addRange,this)}},this.toggleBlockSelection=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],n=l.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var i=this.session.documentToScreenPosition(this.cursor),r=this.session.documentToScreenPosition(this.anchor),o=this.rectangularRangeBlock(i,r);o.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(e,t,n){var i=[],o=e.column<t.column;if(o)var s=e.column,a=t.column,c=e.offsetX,u=t.offsetX;else var s=t.column,a=e.column,c=t.offsetX,u=e.offsetX;var d=e.row<t.row;if(d)var h=e.row,f=t.row;else var h=t.row,f=e.row;0>s&&(s=0),0>h&&(h=0),h==f&&(n=!0);for(var p,g=h;f>=g;g++){var m=l.fromPoints(this.session.screenToDocumentPosition(g,s,c),this.session.screenToDocumentPosition(g,a,u));if(m.isEmpty()){if(p&&r(m.end,p))break;p=m.end}m.cursor=o?m.start:m.end,i.push(m)}if(d&&i.reverse(),!n){for(var v=i.length-1;i[v].isEmpty()&&v>0;)v--;if(v>0)for(var y=0;i[y].isEmpty();)y++;for(var w=v;w>=y;w--)i[w].isEmpty()&&i.splice(w,1)}return i}}.call(c.prototype);var v=e("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,"ace_selection",t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){if(e.marker){this.session.removeMarker(e.marker);var t=this.session.$selectionMarkers.indexOf(e);-1!=t&&this.session.$selectionMarkers.splice(t,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length}},this.removeSelectionMarkers=function(e){for(var t=this.session.$selectionMarkers,n=e.length;n--;){var i=e[n];if(i.marker){this.session.removeMarker(i.marker);
var r=t.indexOf(i);-1!=r&&t.splice(r,1)}}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(f.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(e){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(f.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(e){var t=e.command,n=e.editor;if(n.multiSelect){if(t.multiSelectAction)"forEach"==t.multiSelectAction?i=n.forEachSelection(t,e.args):"forEachLine"==t.multiSelectAction?i=n.forEachSelection(t,e.args,!0):"single"==t.multiSelectAction?(n.exitMultiSelectMode(),i=t.exec(n,e.args||{})):i=t.multiSelectAction(n,e.args||{});else{var i=t.exec(n,e.args||{});n.multiSelect.addRange(n.multiSelect.toOrientedRange()),n.multiSelect.mergeOverlappingRanges()}return i}},this.forEachSelection=function(e,t,n){if(!this.inVirtualSelectionMode){var i,r=n&&n.keepOrder,o=1==n||n&&n.$byLines,s=this.session,a=this.selection,l=a.rangeList,u=(r?a:l).ranges;if(!u.length)return e.exec?e.exec(this,t||{}):e(this,t||{});var d=a._eventRegistry;a._eventRegistry={};var h=new c(s);this.inVirtualSelectionMode=!0;for(var f=u.length;f--;){if(o)for(;f>0&&u[f].start.row==u[f-1].end.row;)f--;h.fromOrientedRange(u[f]),h.index=f,this.selection=s.selection=h;var p=e.exec?e.exec(this,t||{}):e(this,t||{});i||void 0===p||(i=p),h.toOrientedRange(u[f])}h.detach(),this.selection=s.selection=a,this.inVirtualSelectionMode=!1,a._eventRegistry=d,a.mergeOverlappingRanges(),a.ranges[0]&&a.fromOrientedRange(a.ranges[0]);var g=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),g&&g.from==g.to&&this.renderer.animateScrolling(g.from),i}},this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var t=this.multiSelect.rangeList.ranges,n=[],i=0;i<t.length;i++)n.push(this.session.getTextRange(t[i]));var r=this.session.getDocument().getNewLineCharacter();e=n.join(r),e.length==(n.length-1)*r.length&&(e="")}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.$checkMultiselectChange=function(e,t){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var n=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&t==this.multiSelect.anchor)return;var i=t==this.multiSelect.anchor?n.cursor==n.start?n.end:n.start:n.cursor;i.row!=t.row||this.session.$clipPositionToDocument(i.row,i.column).column!=t.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()}},this.findAll=function(e,t,n){if(t=t||{},t.needle=e||t.needle,void 0==t.needle){var i=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();t.needle=this.session.getTextRange(i)}this.$search.set(t);var r=this.$search.findAll(this.session);if(!r.length)return 0;var o=this.multiSelect;n||o.toSingleRange(r[0]);for(var s=r.length;s--;)o.addRange(r[s],!0);return i&&o.rangeList.rangeAtPoint(i.start)&&o.addRange(i,!0),r.length},this.selectMoreLines=function(e,t){var n=this.selection.toOrientedRange(),i=n.cursor==n.end,r=this.session.documentToScreenPosition(n.cursor);this.selection.$desiredColumn&&(r.column=this.selection.$desiredColumn);var o=this.session.screenToDocumentPosition(r.row+e,r.column);if(n.isEmpty())var s=o;else var a=this.session.documentToScreenPosition(i?n.end:n.start),s=this.session.screenToDocumentPosition(a.row+e,a.column);if(i){var c=l.fromPoints(o,s);c.cursor=c.start}else{var c=l.fromPoints(s,o);c.cursor=c.end}if(c.desiredColumn=r.column,this.selection.inMultiSelectMode){if(t)var u=n.cursor}else this.selection.addRange(n);this.selection.addRange(c),u&&this.selection.substractPoint(u)},this.transposeSelections=function(e){for(var t=this.session,n=t.multiSelect,i=n.ranges,r=i.length;r--;){var o=i[r];if(o.isEmpty()){var s=t.getWordRange(o.start.row,o.start.column);o.start.row=s.start.row,o.start.column=s.start.column,o.end.row=s.end.row,o.end.column=s.end.column}}n.mergeOverlappingRanges();for(var a=[],r=i.length;r--;){var o=i[r];a.unshift(t.getTextRange(o))}0>e?a.unshift(a.pop()):a.push(a.shift());for(var r=i.length;r--;){var o=i[r],s=o.clone();t.replace(o,a[r]),o.start.row=s.start.row,o.start.column=s.start.column}n.fromOrientedRange(n.ranges[0])},this.selectMore=function(e,t,n){var r=this.session,o=r.multiSelect,s=o.toOrientedRange();if(!s.isEmpty()||(s=r.getWordRange(s.start.row,s.start.column),s.cursor=-1==e?s.start:s.end,this.multiSelect.addRange(s),!n)){var a=r.getTextRange(s),l=i(r,a,e);l&&(l.cursor=-1==e?l.start:l.end,this.session.unfold(l),this.multiSelect.addRange(l),this.renderer.scrollCursorIntoView(null,.5)),t&&this.multiSelect.substractPoint(s.cursor)}},this.alignCursors=function(){var e=this.session,t=e.multiSelect,n=t.ranges,i=-1,r=n.filter(function(e){return e.cursor.row==i?!0:void(i=e.cursor.row)});if(n.length&&r.length!=n.length-1){r.forEach(function(e){t.substractPoint(e.cursor)});var o=0,s=1/0,a=n.map(function(t){var n=t.cursor,i=e.getLine(n.row),r=i.substr(n.column).search(/\S/g);return-1==r&&(r=0),n.column>o&&(o=n.column),s>r&&(s=r),r});n.forEach(function(t,n){var i=t.cursor,r=o-i.column,c=a[n]-s;r>c?e.insert(i,h.stringRepeat(" ",r-c)):e.remove(new l(i.row,i.column,i.row,i.column-r+c)),t.start.column=t.end.column=o,t.start.row=t.end.row=i.row,t.cursor=t.end}),t.fromOrientedRange(n[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}else{var c=this.selection.getRange(),u=c.start.row,d=c.end.row,f=u==d;if(f){var p,g=this.session.getLength();do p=this.session.getLine(d);while(/[=:]/.test(p)&&++d<g);do p=this.session.getLine(u);while(/[=:]/.test(p)&&--u>0);0>u&&(u=0),d>=g&&(d=g-1)}var m=this.session.removeFullLines(u,d);m=this.$reAlignText(m,f),this.session.insert({row:u,column:0},m.join("\n")+"\n"),f||(c.start.column=0,c.end.column=m[m.length-1].length),this.selection.setRange(c)}},this.$reAlignText=function(e,t){function n(e){return h.stringRepeat(" ",e)}function i(e){return e[2]?n(s)+e[2]+n(a-e[2].length+l)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function r(e){return e[2]?n(s+a-e[2].length)+e[2]+n(l)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function o(e){return e[2]?n(s)+e[2]+n(l)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}var s,a,l,c=!0,u=!0;return e.map(function(e){var t=e.match(/(\s*)(.*?)(\s*)([=:].*)/);return t?null==s?(s=t[1].length,a=t[2].length,l=t[3].length,t):(s+a+l!=t[1].length+t[2].length+t[3].length&&(u=!1),s!=t[1].length&&(c=!1),s>t[1].length&&(s=t[1].length),a<t[2].length&&(a=t[2].length),l>t[3].length&&(l=t[3].length),t):[e]}).map(t?i:c?u?r:i:o)}}).call(v.prototype),t.onSessionChange=function(e){var t=e.session;t&&!t.multiSelect&&(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t&&t.multiSelect;var n=e.oldSession;n&&(n.multiSelect.off("addRange",this.$onAddRange),n.multiSelect.off("removeRange",this.$onRemoveRange),n.multiSelect.off("multiSelect",this.$onMultiSelect),n.multiSelect.off("singleSelect",this.$onSingleSelect),n.multiSelect.lead.off("change",this.$checkMultiselectChange),n.multiSelect.anchor.off("change",this.$checkMultiselectChange)),t&&(t.multiSelect.on("addRange",this.$onAddRange),t.multiSelect.on("removeRange",this.$onRemoveRange),t.multiSelect.on("multiSelect",this.$onMultiSelect),t.multiSelect.on("singleSelect",this.$onSingleSelect),t.multiSelect.lead.on("change",this.$checkMultiselectChange),t.multiSelect.anchor.on("change",this.$checkMultiselectChange)),t&&this.inMultiSelectMode!=t.selection.inMultiSelectMode&&(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},t.MultiSelect=o,e("./config").defineOptions(v.prototype,"editor",{enableMultiselect:{set:function(e){o(this),e?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",u)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",u))},value:!0},enableBlockSelect:{set:function(e){this.$blockSelectEnabled=e},value:!0}})}),ace.define("ace/mode/folding/fold_mode",[],function(e,t,n){"use strict";var i=e("../../range").Range,r=t.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,n){var i=e.getLine(n);return this.foldingStartMarker.test(i)?"start":"markbeginend"==t&&this.foldingStopMarker&&this.foldingStopMarker.test(i)?"end":""},this.getFoldWidgetRange=function(e,t,n){return null},this.indentationBlock=function(e,t,n){var r=/\S/,o=e.getLine(t),s=o.search(r);if(-1!=s){for(var a=n||o.length,l=e.getLength(),c=t,u=t;++t<l;){var d=e.getLine(t).search(r);if(-1!=d){if(s>=d)break;u=t}}if(u>c){var h=e.getLine(u).length;return new i(c,a,u,h)}}},this.openingBracketBlock=function(e,t,n,r,o){var s={row:n,column:r+1},a=e.$findClosingBracket(t,s,o);if(a){var l=e.foldWidgets[a.row];return null==l&&(l=e.getFoldWidget(a.row)),"start"==l&&a.row>s.row&&(a.row--,a.column=e.getLine(a.row).length),i.fromPoints(s,a)}},this.closingBracketBlock=function(e,t,n,r,o){var s={row:n,column:r},a=e.$findOpeningBracket(t,s);return a?(a.column++,s.column--,i.fromPoints(a,s)):void 0}}).call(r.prototype)}),ace.define("ace/theme/textmate",[],function(e,t,n){"use strict";t.isDark=!1,t.cssClass="ace-tm",t.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',t.$id="ace/theme/textmate";var i=e("../lib/dom");i.importCssString(t.cssText,t.cssClass)}),ace.define("ace/line_widgets",[],function(e,t,n){"use strict";function i(e){this.session=e,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}var r=(e("./lib/oop"),e("./lib/dom"));e("./range").Range;(function(){this.getRowLength=function(e){var t;return t=this.lineWidgets?this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0:0,this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1+t:1+t},this.$getWidgetScreenLength=function(){var e=0;return this.lineWidgets.forEach(function(t){t&&t.rowCount&&!t.hidden&&(e+=t.rowCount)}),e},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(e){e&&e.widgetManager&&e.widgetManager!=this&&e.widgetManager.detach(),this.editor!=e&&(this.detach(),this.editor=e,e&&(e.widgetManager=this,e.renderer.on("beforeRender",this.measureWidgets),e.renderer.on("afterRender",this.renderWidgets)))},this.detach=function(e){var t=this.editor;if(t){this.editor=null,t.widgetManager=null,t.renderer.off("beforeRender",this.measureWidgets),t.renderer.off("afterRender",this.renderWidgets);var n=this.session.lineWidgets;n&&n.forEach(function(e){e&&e.el&&e.el.parentNode&&(e._inDocument=!1,e.el.parentNode.removeChild(e.el))})}},this.updateOnFold=function(e,t){var n=t.lineWidgets;if(n&&e.action){for(var i=e.data,r=i.start.row,o=i.end.row,s="add"==e.action,a=r+1;o>a;a++)n[a]&&(n[a].hidden=s);n[o]&&(s?n[r]?n[o].hidden=s:n[r]=n[o]:(n[r]==n[o]&&(n[r]=void 0),n[o].hidden=s))}},this.updateOnChange=function(e){var t=this.session.lineWidgets;if(t){var n=e.start.row,i=e.end.row-n;if(0===i);else if("remove"==e.action){var r=t.splice(n+1,i);r.forEach(function(e){e&&this.removeLineWidget(e)},this),this.$updateRows()}else{var o=new Array(i);o.unshift(n,0),t.splice.apply(t,o),this.$updateRows()}}},this.$updateRows=function(){var e=this.session.lineWidgets;if(e){var t=!0;e.forEach(function(e,n){if(e)for(t=!1,e.row=n;e.$oldWidget;)e.$oldWidget.row=n,e=e.$oldWidget}),t&&(this.session.lineWidgets=null)}},this.addLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var t=this.session.lineWidgets[e.row];t&&(e.$oldWidget=t,t.el&&t.el.parentNode&&(t.el.parentNode.removeChild(t.el),t._inDocument=!1)),this.session.lineWidgets[e.row]=e,e.session=this.session;var n=this.editor.renderer;e.html&&!e.el&&(e.el=r.createElement("div"),e.el.innerHTML=e.html),e.el&&(r.addCssClass(e.el,"ace_lineWidgetContainer"),e.el.style.position="absolute",e.el.style.zIndex=5,n.container.appendChild(e.el),e._inDocument=!0),e.coverGutter||(e.el.style.zIndex=3),null==e.pixelHeight&&(e.pixelHeight=e.el.offsetHeight),null==e.rowCount&&(e.rowCount=e.pixelHeight/n.layerConfig.lineHeight);var i=this.session.getFoldAt(e.row,0);if(e.$fold=i,i){var o=this.session.lineWidgets;e.row!=i.end.row||o[i.start.row]?e.hidden=!0:o[i.start.row]=e}return this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,n),this.onWidgetChanged(e),e},this.removeLineWidget=function(e){if(e._inDocument=!1,e.session=null,e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el),e.editor&&e.editor.destroy)try{e.editor.destroy()}catch(t){}if(this.session.lineWidgets){var n=this.session.lineWidgets[e.row];if(n==e)this.session.lineWidgets[e.row]=e.$oldWidget,e.$oldWidget&&this.onWidgetChanged(e.$oldWidget);else for(;n;){if(n.$oldWidget==e){n.$oldWidget=e.$oldWidget;break}n=n.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(e){for(var t=this.session.lineWidgets,n=t&&t[e],i=[];n;)i.push(n),n=n.$oldWidget;return i},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var n=this.session._changedWidgets,i=t.layerConfig;if(n&&n.length){for(var r=1/0,o=0;o<n.length;o++){var s=n[o];if(s&&s.el&&s.session==this.session){if(!s._inDocument){if(this.session.lineWidgets[s.row]!=s)continue;s._inDocument=!0,t.container.appendChild(s.el)}s.h=s.el.offsetHeight,s.fixedWidth||(s.w=s.el.offsetWidth,s.screenWidth=Math.ceil(s.w/i.characterWidth));var a=s.h/i.lineHeight;s.coverLine&&(a-=this.session.getRowLineCount(s.row),0>a&&(a=0)),s.rowCount!=a&&(s.rowCount=a,s.row<r&&(r=s.row))}}r!=1/0&&(this.session._emit("changeFold",{data:{start:{row:r}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},this.renderWidgets=function(e,t){var n=t.layerConfig,i=this.session.lineWidgets;if(i){for(var r=Math.min(this.firstRow,n.firstRow),o=Math.max(this.lastRow,n.lastRow,i.length);r>0&&!i[r];)r--;this.firstRow=n.firstRow,this.lastRow=n.lastRow,t.$cursorLayer.config=n;for(var s=r;o>=s;s++){var a=i[s];if(a&&a.el)if(a.hidden)a.el.style.top=-100-(a.pixelHeight||0)+"px";else{a._inDocument||(a._inDocument=!0,t.container.appendChild(a.el));var l=t.$cursorLayer.getPixelPosition({row:s,column:0},!0).top;a.coverLine||(l+=n.lineHeight*this.session.getRowLineCount(a.row)),a.el.style.top=l-n.offset+"px";var c=a.coverGutter?0:t.gutterWidth;a.fixedWidth||(c-=t.scrollLeft),a.el.style.left=c+"px",a.fullWidth&&a.screenWidth&&(a.el.style.minWidth=n.width+2*n.padding+"px"),a.fixedWidth?a.el.style.right=t.scrollBar.getWidth()+"px":a.el.style.right=""}}}}}).call(i.prototype),t.LineWidgets=i}),ace.define("ace/ext/error_marker",[],function(e,t,n){"use strict";function i(e,t,n){for(var i=0,r=e.length-1;r>=i;){var o=i+r>>1,s=n(t,e[o]);if(s>0)i=o+1;else{if(!(0>s))return o;r=o-1}}return-(i+1)}function r(e,t,n){var r=e.getAnnotations().sort(a.comparePoints);if(r.length){var o=i(r,{row:t,column:-1},a.comparePoints);0>o&&(o=-o-1),o>=r.length?o=n>0?0:r.length-1:0===o&&0>n&&(o=r.length-1);var s=r[o];if(s&&n){if(s.row===t){do s=r[o+=n];while(s&&s.row===t);if(!s)return r.slice()}var l=[];t=s.row;do l[0>n?"unshift":"push"](s),s=r[o+=n];while(s&&s.row==t);return l.length&&l}}}var o=e("../line_widgets").LineWidgets,s=e("../lib/dom"),a=e("../range").Range;t.showErrorMarker=function(e,t){var n=e.session;n.widgetManager||(n.widgetManager=new o(n),n.widgetManager.attach(e));var i=e.getCursorPosition(),a=i.row,l=n.widgetManager.getWidgetsAtRow(a).filter(function(e){return"errorMarker"==e.type})[0];l?l.destroy():a-=t;var c,u=r(n,a,t);if(u){var d=u[0];i.column=(d.pos&&"number"!=typeof d.column?d.pos.sc:d.column)||0,i.row=d.row,c=e.renderer.$gutterLayer.$annotations[i.row]}else{if(l)return;c={text:["Looks good!"],className:"ace_ok"}}e.session.unfold(i.row),e.selection.moveToPosition(i);var h={row:i.row,fixedWidth:!0,coverGutter:!0,el:s.createElement("div"),type:"errorMarker"},f=h.el.appendChild(s.createElement("div")),p=h.el.appendChild(s.createElement("div"));p.className="error_widget_arrow "+c.className;var g=e.renderer.$cursorLayer.getPixelPosition(i).left;p.style.left=g+e.renderer.gutterWidth-5+"px",h.el.className="error_widget_wrapper",f.className="error_widget "+c.className,f.innerHTML=c.text.join("<br>"),f.appendChild(s.createElement("div"));var m=function(e,t,n){return 0!==t||"esc"!==n&&"return"!==n?void 0:(h.destroy(),{command:"null"})};h.destroy=function(){e.$mouseHandler.isMousePressed||(e.keyBinding.removeKeyboardHandler(m),n.widgetManager.removeLineWidget(h),e.off("changeSelection",h.destroy),e.off("changeSession",h.destroy),e.off("mouseup",h.destroy),e.off("change",h.destroy))},e.keyBinding.addKeyboardHandler(m),e.on("changeSelection",h.destroy),e.on("changeSession",h.destroy),e.on("mouseup",h.destroy),e.on("change",h.destroy),e.session.widgetManager.addLineWidget(h),h.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:h.el.offsetHeight})},s.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","")}),ace.define("ace/ace",[],function(e,t,n){"use strict";e("./lib/fixoldbrowsers");var i=e("./lib/dom"),r=e("./lib/event"),o=e("./range").Range,s=e("./editor").Editor,a=e("./edit_session").EditSession,l=e("./undomanager").UndoManager,c=e("./virtual_renderer").VirtualRenderer;e("./worker/worker_client"),e("./keyboard/hash_handler"),e("./placeholder"),e("./multi_select"),e("./mode/folding/fold_mode"),e("./theme/textmate"),e("./ext/error_marker"),t.config=e("./config"),t.require=e,"function"==typeof define&&(t.define=define),t.edit=function(e,n){if("string"==typeof e){var o=e;if(e=document.getElementById(o),!e)throw new Error("ace.edit can't find div #"+o)}if(e&&e.env&&e.env.editor instanceof s)return e.env.editor;var a="";if(e&&/input|textarea/i.test(e.tagName)){var l=e;a=l.value,e=i.createElement("pre"),l.parentNode.replaceChild(e,l)}else e&&(a=e.textContent,e.innerHTML="");var u=t.createEditSession(a),d=new s(new c(e),u,n),h={document:u,editor:d,onResize:d.resize.bind(d,null)};return l&&(h.textarea=l),r.addListener(window,"resize",h.onResize),d.on("destroy",function(){r.removeListener(window,"resize",h.onResize),h.editor.container.env=null}),d.container.env=d.env=h,d},t.createEditSession=function(e,t){var n=new a(e,t);return n.setUndoManager(new l),n},t.Range=o,t.Editor=s,t.EditSession=a,t.UndoManager=l,t.VirtualRenderer=c,t.version=t.config.version}),function(){ace.require(["ace/ace"],function(e){e&&(e.config.init(!0),e.define=ace.define),window.ace||(window.ace=e);for(var t in e)e.hasOwnProperty(t)&&(window.ace[t]=e[t]);window.ace["default"]=window.ace,"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=window.ace)})}(),define("ace/ace",function(){});var CryptoJS=CryptoJS||function(e,t){var n={},i=n.lib={},r=function(){},o=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;e>r;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-8*(r%4)&255)<<24-8*((i+r)%4);else if(65535<n.length)for(r=0;e>r;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;t>i;i+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++){var r=t[i>>>2]>>>24-8*(i%4)&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-4*(i%8);return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-8*(i%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-8*(i%4);return new s.init(n,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(t=a*o,r=e.min(4*t,r),t){for(var l=0;t>l;l+=o)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=r}return new s.init(l,r)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(){var e=CryptoJS,t=e.lib,n=t.WordArray,i=t.Hasher,r=[],t=e.algo.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var u=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=u<<1|u>>>31}u=(i<<5|i>>>27)+l+r[c],u=20>c?u+((o&s|~o&a)+1518500249):40>c?u+((o^s^a)+1859775393):60>c?u+((o&s|o&a|s&a)-1894007588):u+((o^s^a)-899497514),l=a,a=s,s=o<<30|o>>>2,o=i,i=u}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[(i+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(i+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(t),e.HmacSHA1=i._createHmacHelper(t)}(),define("libs/sha1",function(){});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("libs/sharejs",["ace/ace","libs/sha1"],function(){var e=void 0,t=void 0,n=void 0,i=void 0,r=!0;window.sharejs=n={};var o=n.types={};n._bt=t=function(e,t,n,i){var r=void 0,o=function(e,n,i,r){return t(i,e,n,"left"),t(r,n,e,"right")};return e.transformX=e.transformX=r=function(e,t){n(e),n(t);var s=[],a=!0,l=!1,c=void 0;try{for(var u,d=Array.from(t)[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){for(var h=u.value,f=[],p=0;p<e.length;){var g,m=[];if(o(e[p],h,f,m),p++,1!==m.length){if(0===m.length){var v=!0,y=!1,w=void 0;try{for(var b,_=Array.from(e.slice(p))[Symbol.iterator]();!(v=(b=_.next()).done);v=!0)g=b.value,i(f,g)}catch(C){y=!0,w=C}finally{try{!v&&_["return"]&&_["return"]()}finally{if(y)throw w}}h=null;break}var k=Array.from(r(e.slice(p),m)),S=_slicedToArray(k,2),$=S[0],x=S[1],A=!0,T=!1,E=void 0;try{for(var M,R=Array.from($)[Symbol.iterator]();!(A=(M=R.next()).done);A=!0)g=M.value,i(f,g)}catch(C){T=!0,E=C}finally{try{!A&&R["return"]&&R["return"]()}finally{if(T)throw E}}var L=!0,D=!1,F=void 0;try{for(var P,I=Array.from(x)[Symbol.iterator]();!(L=(P=I.next()).done);L=!0){var q=P.value;i(s,q)}}catch(C){D=!0,F=C}finally{try{!L&&I["return"]&&I["return"]()}finally{if(D)throw F}}h=null;break}h=m[0]}null!=h&&i(s,h),e=f}}catch(C){l=!0,c=C}finally{try{!a&&d["return"]&&d["return"]()}finally{if(l)throw c}}return[e,s]},e.transform=e.transform=function(e,n,i){var o=void 0;if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");if(0===n.length)return e;if(1===e.length&&1===n.length)return t([],e[0],n[0],i);if("left"===i){var s=void 0,a=Array.from(r(e,n)),l=_slicedToArray(a,2);return s=l[0],o=l[1],s}var c=void 0,u=Array.from(r(n,e)),d=_slicedToArray(u,2);return o=d[0],c=d[1]}},"undefined"==typeof r&&(n.bootstrapTransform=t);var s={};s.name="text",s.create=function(){return""};var a=function(e,t,n){return e.slice(0,t)+n+e.slice(t)},l=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");var t=_typeof(e.i),n=_typeof(e.d),i=_typeof(e.c);if(!("string"===t^"string"===n^"string"===i))throw new Error("component needs an i, d or c field");if(!(e.p>=0))throw new Error("position cannot be negative")},c=function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=Array.from(e)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;l(s)}}catch(a){n=!0,i=a}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw i}}return!0};s.apply=function(e,t){c(t);var n=!0,i=!1,r=void 0;try{for(var o,s=Array.from(t)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;if(null!=l.i)e=a(e,l.p,l.i);else if(null!=l.d){var u=e.slice(l.p,l.p+l.d.length);if(l.d!==u)throw new Error("Delete component '"+l.d+"' does not match deleted text '"+u+"'");e=e.slice(0,l.p)+e.slice(l.p+l.d.length)}else{if(null==l.c)throw new Error("Unknown op type");var d=e.slice(l.p,l.p+l.c.length);if(l.c!==d)throw new Error("Comment component '"+l.c+"' does not match commented text '"+d+"'")}}}catch(h){i=!0,r=h}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw r}}return e};var u=function(e,t){var n=void 0,i={};for(var r in e)n=e[r],i[r]=n;for(r in t)n=t[r],i[r]=n;return i};s._append=e=function(e,t){if(""!==t.i&&""!==t.d){if(0===e.length)return e.push(t);var n=e[e.length-1];return null!=n.i&&null!=t.i&&n.p<=t.p&&t.p<=n.p+n.i.length&&n.u===t.u?e[e.length-1]=u(n,{i:a(n.i,t.p-n.p,t.i)}):null!=n.d&&null!=t.d&&t.p<=n.p&&n.p<=t.p+t.d.length&&n.u===t.u?e[e.length-1]=u(n,{d:a(t.d,n.p-t.p,n.d),p:t.p}):e.push(t)}},s.compose=function(t,n){c(t),c(n);var i=t.slice(),r=!0,o=!1,s=void 0;try{for(var a,l=Array.from(n)[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;e(i,u)}}catch(d){o=!0,s=d}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw s}}return i},s.compress=function(e){return s.compose([],e)},s.normalize=function(t){
var n=[];(null!=t.i||null!=t.p)&&(t=[t]);var i=!0,r=!1,o=void 0;try{for(var s,a=Array.from(t)[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value;null==l.p&&(l.p=0),e(n,l)}}catch(c){r=!0,o=c}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw o}}return n};var d=function(e,t,n){if(null!=t.i)return t.p<e||t.p===e&&n?e+t.i.length:e;if(null!=t.d)return e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length;if(null!=t.c)return e;throw new Error("unknown op type")};s.transformCursor=function(e,t,n){var i="right"===n,r=!0,o=!1,s=void 0;try{for(var a,l=Array.from(t)[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var c=a.value;e=d(e,c,i)}}catch(u){o=!0,s=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw s}}return e},s._tc=i=function(t,n,i,r){var o=void 0,s=void 0,a=void 0,l=void 0,h=void 0;if(c([n]),c([i]),null!=n.i)e(t,u(n,{p:d(n.p,i,"right"===r)}));else if(null!=n.d)if(null!=i.i){var f=n.d;n.p<i.p&&(e(t,u(n,{d:f.slice(0,i.p-n.p)})),f=f.slice(i.p-n.p)),""!==f&&e(t,u(n,{d:f,p:n.p+i.i.length}))}else if(null!=i.d)if(n.p>=i.p+i.d.length)e(t,u(n,{p:n.p-i.d.length}));else if(n.p+n.d.length<=i.p)e(t,n);else{if(l=u(n,{d:""}),n.p<i.p&&(l.d=n.d.slice(0,i.p-n.p)),n.p+n.d.length>i.p+i.d.length&&(l.d+=n.d.slice(i.p+i.d.length-n.p)),a=Math.max(n.p,i.p),s=Math.min(n.p+n.d.length,i.p+i.d.length),o=n.d.slice(a-n.p,s-n.p),h=i.d.slice(a-i.p,s-i.p),o!==h)throw new Error("Delete ops delete different text in the same region of the document");""!==l.d&&(l.p=d(l.p,i),e(t,l))}else{if(null==i.c)throw new Error("unknown op type");e(t,n)}else if(null!=n.c)if(null!=i.i)if(n.p<i.p&&i.p<n.p+n.c.length){var p=i.p-n.p,g=n.c.slice(0,+(p-1)+1||void 0)+i.i+n.c.slice(p);e(t,u(n,{c:g}))}else e(t,u(n,{p:d(n.p,i,!0)}));else if(null!=i.d)if(n.p>=i.p+i.d.length)e(t,u(n,{p:n.p-i.d.length}));else if(n.p+n.c.length<=i.p)e(t,n);else{if(l=u(n,{c:""}),n.p<i.p&&(l.c=n.c.slice(0,i.p-n.p)),n.p+n.c.length>i.p+i.d.length&&(l.c+=n.c.slice(i.p+i.d.length-n.p)),a=Math.max(n.p,i.p),s=Math.min(n.p+n.c.length,i.p+i.d.length),o=n.c.slice(a-n.p,s-n.p),h=i.d.slice(a-i.p,s-i.p),o!==h)throw new Error("Delete ops delete different text in the same region of the document");l.p=d(l.p,i),e(t,l)}else{if(null==i.c)throw new Error("unknown op type");e(t,n)}return t};var h=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}};s.invert=function(e){return Array.from(e.slice().reverse()).map(function(e){return h(e)})},null!=r?(n.types||(n.types={}),t(s,i,c,e),n.types.text=s):(module.exports=s,require("./helpers").bootstrapTransform(s,i,c,e)),"undefined"==typeof r&&(s=require("./text")),s.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,n,i){var r={p:e,i:t};return n&&(r.u=!0),r=[r],this.submitOp(r,i),r},del:function(e,t,n,i){var r={p:e,d:this.snapshot.slice(e,e+t)};return n&&(r.u=!0),r=[r],this.submitOp(r,i),r},_register:function(){return this.on("remoteop",function(e){var t=this;return function(){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=Array.from(e)[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value;void 0!==l.i?n.push(t.emit("insert",l.p,l.i)):void 0!==l.d?n.push(t.emit("delete",l.p,l.d)):n.push(void 0)}}catch(c){r=!0,o=c}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw o}}return n}()})}};var f=null!=r?function(e){return setTimeout(e,0)}:process.nextTick,p=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"on",value:function(e,t){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},{key:"removeListener",value:function(e,t){var n=this;this._events||(this._events={});for(var i=this._events[e]||(this._events[e]=[]),r=0;r<i.length;)i[r]===t&&(i[r]=void 0),r++;return f(function(){return n._events[e]=Array.from(n._events[e]).filter(function(e){return e})}),this}},{key:"emit",value:function(e){if(!(null!=this._events?this._events[e]:void 0))return this;for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];var r=!0,o=!1,s=void 0;try{for(var a,l=Array.from(this._events[e])[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var c=a.value;c&&c.apply(this,n)}}catch(u){o=!0,s=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw s}}return this}}]),e}();p.mixin=function(e){var t=e.prototype||e;return t.on=p.prototype.on,t.removeListener=p.prototype.removeListener,t.emit=p.prototype.emit,e},null==r&&(module.exports=p),null==r&&(o=require("../types")),null!=r&&(n.extendDoc=function(e,t){return g.prototype[e]=t});var g=function(){function e(t,n,i){_classCallCheck(this,e),this.flush=this.flush.bind(this),this.setFlushDelay=this.setFlushDelay.bind(this),this.shout=this.shout.bind(this),this.connection=t,this.name=n,i||(i={}),this.version=i.v,this.snapshot=i.snaphot,i.type&&this._setType(i.type),this.state="closed",this.autoOpen=!1,this._create=i.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[],this.serverOps={}}return _createClass(e,[{key:"_xf",value:function(e,t){if(this.type.transformX)return this.type.transformX(e,t);var n=this.type.transform(e,t,"left"),i=this.type.transform(t,e,"right");return[n,i]}},{key:"_otApply",value:function(e,t,n){var i=this.snapshot;return this.snapshot=this.type.apply(this.snapshot,e),this.emit("change",e,i,n),t?this.emit("remoteop",e,i,n):void 0}},{key:"_connectionStateChanged",value:function(e,t){switch(e){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(t)}return this.emit(e,t)}},{key:"_setType",value:function(e){if("string"==typeof e&&(e=o[e]),!e||!e.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=e,e.api){for(var t in e.api){var n=e.api[t];this[t]=n}return"function"==typeof this._register?this._register():void 0}return this.provides={}}},{key:"_onMessage",value:function(e){if(e.open===!0){if(this.state="open",this._create=!1,null==this.created&&(this.created=!!e.create),e.type&&this._setType(e.type),e.create?(this.created=!0,this.snapshot=this.type.create()):(this.created!==!0&&(this.created=!1),void 0!==e.snapshot&&(this.snapshot=e.snapshot)),null!=e.v&&(this.version=e.v),this.inflightOp){var t={doc:this.name,op:this.inflightOp,v:this.version};this.inflightSubmittedIds.length&&(t.dupIfSource=this.inflightSubmittedIds),this.connection.send(t)}else this.flush();return this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0}if(e.open===!1)return e.error&&("undefined"!=typeof console&&null!==console&&console.error("Could not open document: "+e.error),this.emit("error",e.error),"function"==typeof this._openCallback&&this._openCallback(e.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;if(null===e.op&&"Op already submitted"===r);else{if(void 0===e.op&&void 0!==e.v||e.op&&Array.from(this.inflightSubmittedIds).includes(e.meta.source)){var n=void 0,i=this.inflightOp;this.inflightOp=null,this.inflightSubmittedIds.length=0,null===this.pendingOp&&this.emit("saved");var r=e.error;if(r){if(this.type.invert){var o=this.type.invert(i);if(this.pendingOp){var s=Array.from(this._xf(this.pendingOp,o)),a=_slicedToArray(s,2);this.pendingOp=a[0],o=a[1]}this._otApply(o,!0,e)}else this.emit("error","Op apply failed ("+r+") and the op could not be reverted");var l=!0,c=!1,u=void 0;try{for(var d,h=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(l=(d=h.next()).done);l=!0)(n=d.value)(r)}catch(f){c=!0,u=f}finally{try{!l&&h["return"]&&h["return"]()}finally{if(c)throw u}}}else{if(e.v<this.version)return;if(e.v!==this.version)throw new Error("Invalid version from server");this.serverOps[this.version]=i,this.version++,this.emit("acknowledge",i);var p=!0,g=!1,m=void 0;try{for(var v,y=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(p=(v=y.next()).done);p=!0)(n=v.value)(null,i)}catch(f){g=!0,m=f}finally{try{!p&&y["return"]&&y["return"]()}finally{if(g)throw m}}}return this.delayedFlush()}if(e.op){if(e.v<this.version)return;if(e.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+e.doc);if(e.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+e.v);var w=e.op;this.serverOps[this.version]=w;var b=w;if(null!==this.inflightOp){var _=Array.from(this._xf(this.inflightOp,b)),C=_slicedToArray(_,2);this.inflightOp=C[0],b=C[1]}if(null!==this.pendingOp){var k=Array.from(this._xf(this.pendingOp,b)),S=_slicedToArray(k,2);this.pendingOp=S[0],b=S[1]}return this.version++,this._otApply(b,!0,e)}if(!e.meta)return"undefined"!=typeof console&&null!==console?console.warn("Unhandled document message:",e):void 0;var $=e.meta,x=$.path,A=$.value;switch(null!=x?x[0]:void 0){case"shout":return this.emit("shout",A);default:return"undefined"!=typeof console&&null!==console?console.warn("Unhandled meta op:",e):void 0}}}},{key:"flush",value:function(){if(this.flushTimeout=null,"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp){if(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.emit("flipped_pending_to_inflight"),window.useShareJsHash||window.sl_debugging){var e=Date.now(),t=this.__lastSubmitTimestamp&&e-this.__lastSubmitTimestamp,n=5e3,i=!this.__lastSubmitTimestamp||t>n||0>t;if(i||window.sl_debugging){var r=CryptoJS.SHA1("blob "+this.snapshot.length+"\x00"+this.snapshot).toString();this.__lastSubmitTimestamp=e}}var o=this.__lastVersion;return this.__lastVersion=this.version,this.connection.send({doc:this.name,op:this.inflightOp,v:this.version,lastV:o,hash:r})}}},{key:"submitOp",value:function(e,t){null!=this.type.normalize&&(e=this.type.normalize(e));var n=this.snapshot;return this.snapshot=this.type.apply(this.snapshot,e),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,e):this.pendingOp=e,t&&this.pendingCallbacks.push(t),this.emit("change",e,n),this.delayedFlush()}},{key:"delayedFlush",value:function(){return null==this.flushTimeout?this.flushTimeout=setTimeout(this.flush,this._flushDelay||0):void 0}},{key:"setFlushDelay",value:function(e){return this._flushDelay=e}},{key:"shout",value:function(e){return this.connection.send({doc:this.name,meta:{path:["shout"],value:e}})}},{key:"open",value:function(e){var t=this;if(this.autoOpen=!0,"closed"===this.state){var n={doc:this.name,open:!0};return void 0===this.snapshot&&(n.snapshot=null),this.type&&(n.type=this.type.name),null!=this.version&&(n.v=this.version),this._create&&(n.create=!0),this.connection.send(n),this.state="opening",this._openCallback=function(n){return t._openCallback=null,"function"==typeof e?e(n):void 0}}}},{key:"close",value:function(e){return this.autoOpen=!1,"closed"===this.state?"function"==typeof e?e():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=e)}}]),e}();null==r&&(p=require("./microevent")),p.mixin(g),n.Doc=g;var m=ace.require("ace/range"),v=m.Range,y=function(e,t,n,i){var r=function(t){for(var n=e.getLines(0,t.row),i=0,r=0;r<n.length;r++){var o=n[r];i+=r<t.row?o.length:t.column}return i+t.row},o=r(t.start);switch(t.action){case"insert":s=t.lines.join("\n"),n.insert(o,s,i);break;case"remove":s=t.lines.join("\n"),n.del(o,s.length,i);break;default:throw new Error("unknown action: "+t.action)}};window.sharejs.extendDoc("attach_ace",function(e,t,n){if(!this.provides.text)throw new Error("Only text documents can be attached to ace");var i=this,r=e.getSession().getDocument();r.setNewLineMode("unix");var o=function(){return window.setTimeout(function(){var e=r.getValue(),t=i.getText();return e!==t?(i.emit("error","Text does not match in ace"),console.error("Text does not match!"),console.error("editor: "+e),console.error("ot:     "+t)):void 0},0)};t?(i.del(0,i.getText().length),i.insert(0,r.getValue())):r.setValue(i.getText()),o();var s=!1,a=function(t){if(!s){if(null!=n&&r.getValue().length>n)return void i.emit("error",new Error("document length is greater than maxDocLength"));var a=!(!e.getSession().$fromUndo&&!e.getSession().$fromReject);return y(r,t,i,a),o()}};r.on("change",a);var l=function(e){var t=r.getAllLines(),n=0;for(n=0;n<t.length;n++){var i=t[n];if(e<=i.length)break;e-=t[n].length+1}return{row:n,column:e}},c=function(e,t){r.getLength()<=1&&r.$detectNewLine(t);var n=r.$split(t),i=l(e),a=r.clippedPos(i.row,i.column),c={row:a.row+n.length-1,column:(1===n.length?a.column:0)+n[n.length-1].length};return s=!0,r.applyDelta({start:a,end:c,action:"insert",lines:n,remote:!0}),s=!1,o()},u=function(e,t){var n=v.fromPoints(l(e),l(e+t.length)),i=r.clippedPos(n.start.row,n.start.column),a=r.clippedPos(n.end.row,n.end.column);return s=!0,r.applyDelta({start:i,end:a,action:"remove",lines:r.getLinesForRange({start:i,end:a}),remote:!0}),s=!1,o()};i.on("insert",c),i.on("delete",u),i.detach_ace=function(){return i.removeListener("insert",c),i.removeListener("delete",u),r.removeListener("change",a),delete i.detach_ace}});var w=function(e,t,n){for(var i=0,r=0,o=n.snapshot.split("\n",t.from.line);r<t.from.line;)i+=o[r].length+1,r++;return i+=t.from.ch,t.removed&&n.del(i,t.removed.join("\n").length),t.text?n.insert(i,t.text.join("\n")):void 0};return window.sharejs.extendDoc("attach_cm",function(e,t){if(!this.provides.text)throw new Error("Only text documents can be attached to CodeMirror2");var n=this,i=e.getDoc(),r=function(){return window.setTimeout(function(){var t=e.getValue(),i=n.getText();return t!==i?(n.emit("error","Text does not match in CodeMirror"),console.error("Text does not match!"),console.error("editor: "+t),console.error("ot:     "+i)):void 0},0)};t?(this.del(0,n.getText().length),this.insert(0,e.getValue())):e.setValue(n.getText()),r();var o=!1,s=function(e,t){return o?void 0:(w(i,t,n),r())};i.on("change",s);var a=function(t,n){return o=!0,e.replaceRange(n,e.posFromIndex(t)),e.clearHistory(),o=!1,r()},l=function(t,n){o=!0;var i=e.posFromIndex(t),s=e.posFromIndex(t+n.length);return e.replaceRange("",i,s),e.clearHistory(),o=!1,r()};this.on("insert",a),this.on("delete",l),this.detach_cm=function(){return this.removeListener("insert",a),this.removeListener("delete",l),i.off("change",s),delete this.detach_cm}}),window.sharejs}),define("ide/editor/ShareJsDoc",["utils/EventEmitter","libs/sharejs"],function(e,t){var n,i=1e3;return n=function(){return n=function(e){function n(e,r,o,s){var a;_classCallCheck(this,n),a=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this)),a.doc_id=e,a.socket=s,a.type="text",r=Array.from(r).map(function(e){return decodeURIComponent(escape(e))});var l=r.join("\n");return a.track_changes=!1,a.connection={send:function(e){return a._startInflightOpTimeout(e),null!=window.disconnectOnUpdate&&Math.random()<window.disconnectOnUpdate&&(sl_console.log("Disconnecting on update",e),window._ide.socket.socket.disconnect()),null!=window.dropUpdates&&Math.random()<window.dropUpdates?void sl_console.log("Simulating a lost update",e):(a.track_changes&&(null==e.meta&&(e.meta={}),e.meta.tc=a.track_changes_id_seeds.inflight),a.socket.emit("applyOtUpdate",a.doc_id,e,function(e){return null!=e?a._handleError(e):void 0}))},state:"ok",id:a.socket.socket.sessionid},a._doc=new t.Doc(a.connection,a.doc_id,{type:a.type}),a._doc.setFlushDelay(i),a._doc.on("change",function(){for(var e,t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return(e=a).trigger.apply(e,["change"].concat(_toConsumableArray(Array.from(n))))}),a._doc.on("acknowledge",function(){return a.lastAcked=new Date,a.trigger("acknowledge")}),a._doc.on("remoteop",function(){var e;a._doc.setFlushDelay(0);for(var t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return(e=a).trigger.apply(e,["remoteop"].concat(_toConsumableArray(Array.from(n))))}),a._doc.on("flipped_pending_to_inflight",function(){return a.trigger("flipped_pending_to_inflight")}),a._doc.on("saved",function(){return a.trigger("saved")}),a._doc.on("error",function(e){return a._handleError(e)}),a._bindToDocChanges(a._doc),a.processUpdateFromServer({open:!0,v:o,snapshot:l}),a}return _inherits(n,e),_createClass(n,null,[{key:"initClass",value:function(){this.prototype.INFLIGHT_OP_TIMEOUT=5e3,this.prototype.WAIT_FOR_CONNECTION_TIMEOUT=500,this.prototype.FATAL_OP_TIMEOUT=3e4}}]),_createClass(n,[{key:"submitOp",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return(e=this._doc).submitOp.apply(e,_toConsumableArray(Array.from(n||[])))}},{key:"_isAheadOfExpectedVersion",value:function(e){return this._doc.version>0&&e.v>this._doc.version}},{key:"_pushOntoQueue",value:function(e){var t=this;sl_console.log("[processUpdate] push onto queue ".concat(e.v)),this.queuedMessageTimer||(this.queuedMessageTimer=setTimeout(function(){sl_console.log("[processUpdate] queue timeout fired for ".concat(e.v)),t.processUpdateFromServer(e)},this.INFLIGHT_OP_TIMEOUT)),this.queuedMessages.push(e),this.queuedMessages.sort(function(e,t){return e.v-t.v})}},{key:"_clearQueue",value:function(){this.queuedMessages=[]}},{key:"_processQueue",value:function(){this.queuedMessages.length>0&&(nextAvailableVersion=this.queuedMessages[0].v,nextAvailableVersion>this._doc.version||(sl_console.log("[processUpdate] taken from queue ".concat(nextAvailableVersion)),this.processUpdateFromServerInOrder(this.queuedMessages.shift()),0===this.queuedMessages.length&&this.queuedMessageTimer&&(sl_console.log("[processUpdate] queue is empty, cleared timeout"),clearTimeout(this.queuedMessageTimer),this.queuedMessageTimer=null)))}},{key:"processUpdateFromServerInOrder",value:function(e){if(this.queuedMessages||(this.queuedMessages=[]),this._isAheadOfExpectedVersion(e))return void this._pushOntoQueue(e);var t=this.processUpdateFromServer(e);return t instanceof Error&&"Invalid version from server"===t.message?void this._clearQueue():void this._processQueue()}},{key:"processUpdateFromServer",value:function(e){try{this._doc._onMessage(e)}catch(t){return console.log(t),this._handleError(t),t}return"external"===__guard__(null!=e?e.meta:void 0,function(e){return e.type})?this.trigger("externalUpdate",e):void 0}},{key:"catchUp",value:function(e){var t=this;return function(){for(var n=[],i=0;i<e.length;i++){var r=e[i];r.v=t._doc.version,r.doc=t.doc_id,n.push(t.processUpdateFromServer(r))}return n}()}},{key:"getSnapshot",value:function(){return this._doc.snapshot}},{key:"getVersion",value:function(){return this._doc.version}},{key:"getType",value:function(){return this.type}},{key:"clearInflightAndPendingOps",value:function(){return this._doc.inflightOp=null,this._doc.inflightCallbacks=[],this._doc.pendingOp=null,this._doc.pendingCallbacks=[]}},{key:"flushPendingOps",value:function(){return this._doc.flush()}},{key:"updateConnectionState",value:function(e){return sl_console.log("[updateConnectionState] Setting state to ".concat(e)),this.connection.state=e,this.connection.id=this.socket.socket.sessionid,this._doc.autoOpen=!1,this._doc._connectionStateChanged(e),this.lastAcked=null}},{key:"hasBufferedOps",value:function(){return null!=this._doc.inflightOp||null!=this._doc.pendingOp}},{key:"getInflightOp",value:function(){return this._doc.inflightOp}},{key:"getPendingOp",value:function(){return this._doc.pendingOp}},{key:"getRecentAck",value:function(){return null!=this.lastAcked&&new Date-this.lastAcked<2*i}},{key:"getOpSize",value:function(e){for(var t=0,n=0,i=Array.from(e||[]);n<i.length;n++){var r=i[n];null!=(null!=r?r.i:void 0)&&(t+=r.i.length),null!=(null!=r?r.d:void 0)&&(t+=r.d.length)}return t}},{key:"attachToAce",value:function(e){return this._doc.attach_ace(e,!1,window.maxDocLength)}},{key:"detachFromAce",value:function(){return"function"==typeof this._doc.detach_ace?this._doc.detach_ace():void 0}},{key:"attachToCM",value:function(e){return this._doc.attach_cm(e,!1)}},{key:"detachFromCM",value:function(){return"function"==typeof this._doc.detach_cm?this._doc.detach_cm():void 0}},{key:"_startInflightOpTimeout",value:function(e){var t=this;this._startFatalTimeoutTimer(e);var n=function r(){if(sl_console.log("[inflightOpTimeout] Trying op again"),null!=t._doc.inflightOp){if(e.dupIfSource=[t.connection.id].concat(_toConsumableArray(Array.from(t._doc.inflightSubmittedIds))),"ok"!==t.connection.state){var n;return sl_console.log("[inflightOpTimeout] Not connected, retrying in 0.5s"),n=setTimeout(r,t.WAIT_FOR_CONNECTION_TIMEOUT)}return sl_console.log("[inflightOpTimeout] Sending"),t.connection.send(e)}},i=setTimeout(n,this.INFLIGHT_OP_TIMEOUT);return this._doc.inflightCallbacks.push(function(){return t._clearFatalTimeoutTimer(),clearTimeout(i)})}},{key:"_startFatalTimeoutTimer",value:function(e){var t=this;if(null==this._timeoutTimer)return this._timeoutTimer=setTimeout(function(){return t._clearFatalTimeoutTimer(),t.trigger("op:timeout",e)},this.FATAL_OP_TIMEOUT)}},{key:"_clearFatalTimeoutTimer",value:function(){return null!=this._timeoutTimer?(clearTimeout(this._timeoutTimer),this._timeoutTimer=null):void 0}},{key:"_handleError",value:function(e,t){return null==t&&(t={}),this.trigger("error",e,t)}},{key:"_bindToDocChanges",value:function(e){var t=this,n=e.submitOp;e.submitOp=function(){for(var i=arguments.length,r=new Array(i),o=0;i>o;o++)r[o]=arguments[o];return t.trigger.apply(t,["op:sent"].concat(_toConsumableArray(Array.from(r)))),e.pendingCallbacks.push(function(){return t.trigger.apply(t,["op:acknowledged"].concat(_toConsumableArray(Array.from(r))))}),n.apply(e,r)};var i=e.flush;return e.flush=function(){t.trigger("flush",e.inflightOp,e.pendingOp,e.version);for(var n=arguments.length,r=new Array(n),o=0;n>o;o++)r[o]=arguments[o];return i.apply(e,r)}}}]),n}(e),n.initClass(),n}()});var load=function(){var e;return e=function(){function e(t,n){_classCallCheck(this,e),null==t&&(t=[]),this.changes=t,null==n&&(n=[]),this.comments=n,this.setIdSeed(e.generateIdSeed()),this.resetDirtyState()}return _createClass(e,[{key:"getIdSeed",value:function(){return this.id_seed}},{key:"setIdSeed",value:function(e){return this.id_seed=e,this.id_increment=0}},{key:"newId",value:function(){this.id_increment++;var e=this.id_increment.toString(16),t=this.id_seed+"000000".substr(0,6-e.length)+e;return t}},{key:"getComment",value:function(e){for(var t=null,n=0,i=Array.from(this.comments);n<i.length;n++){var r=i[n];if(r.id===e){t=r;break}}return t}},{key:"removeCommentId",value:function(e){var t=this.getComment(e);if(null!=t)return this.comments=this.comments.filter(function(t){return t.id!==e}),this._markAsDirty(t,"comment","removed")}},{key:"moveCommentId",value:function(e,t,n){var i=this;return function(){for(var r=[],o=0,s=Array.from(i.comments);o<s.length;o++){var a=s[o];a.id===e?(a.op.p=t,a.op.c=n,r.push(i._markAsDirty(a,"comment","moved"))):r.push(void 0)}return r}()}},{key:"getChange",value:function(e){for(var t=null,n=0,i=Array.from(this.changes);n<i.length;n++){var r=i[n];if(r.id===e){t=r;break}}return t}},{key:"getChanges",value:function(e){for(var t=[],n={},i=0,r=Array.from(e);i<r.length;i++){var o=r[i];n[o]=!0}for(var s=0,a=Array.from(this.changes);s<a.length;s++){var l=a[s];n[l.id]&&(delete n[l.id],t.push(l))}return t}},{key:"removeChangeId",value:function(e){var t=this.getChange(e);if(null!=t)return this._removeChange(t)}},{key:"removeChangeIds",value:function(e){if(!(!(null!=e?e.length:void 0)>0)){for(var t=(this.changes.length,{}),n=0,i=Array.from(e);n<i.length;n++){var r=i[n];t[r]=!0}for(var o=[],s=0,a=Array.from(this.changes);s<a.length;s++){var l=a[s];t[l.id]?(delete t[l.id],this._markAsDirty(l,"change","removed")):o.push(l)}return this.changes=o}}},{key:"validate",value:function(e){for(var t,n=0,i=Array.from(this.changes);n<i.length;n++){var r=i[n];if(null!=r.op.i&&(t=e.slice(r.op.p,r.op.p+r.op.i.length),t!==r.op.i))throw new Error("Change (".concat(JSON.stringify(r),") doesn't match text (").concat(JSON.stringify(t),")"))}for(var o=0,s=Array.from(this.comments);o<s.length;o++){var a=s[o];if(t=e.slice(a.op.p,a.op.p+a.op.c.length),t!==a.op.c)throw new Error("Comment (".concat(JSON.stringify(a),") doesn't match text (").concat(JSON.stringify(t),")"))}return!0}},{key:"applyOp",value:function(e,t){if(null==t&&(t={}),null==t.ts&&(t.ts=new Date),null!=e.i)return this.applyInsertToChanges(e,t),this.applyInsertToComments(e);if(null!=e.d)return this.applyDeleteToChanges(e,t),this.applyDeleteToComments(e);if(null!=e.c)return this.addComment(e,t);throw new Error("unknown op type")}},{key:"applyOps",value:function(e,t){var n=this;return null==t&&(t={}),Array.from(e).map(function(e){return n.applyOp(e,t)})}},{key:"addComment",value:function(e,t){var n=this.getComment(e.t);if(null!=n)return this.moveCommentId(e.t,e.p,e.c),n;var i;return this.comments.push(i={id:e.t||this.newId(),op:{c:e.c,p:e.p,t:e.t},metadata:t}),this._markAsDirty(i,"comment","added"),i}},{key:"applyInsertToComments",value:function(e){var t=this;return function(){for(var n=[],i=0,r=Array.from(t.comments);i<r.length;i++){var o=r[i];if(e.p<=o.op.p)o.op.p+=e.i.length,n.push(t._markAsDirty(o,"comment","moved"));else if(e.p<o.op.p+o.op.c.length){var s=e.p-o.op.p;o.op.c=o.op.c.slice(0,+(s-1)+1||void 0)+e.i+o.op.c.slice(s),n.push(t._markAsDirty(o,"comment","moved"))}else n.push(void 0)}return n}()}},{key:"applyDeleteToComments",value:function(e){var t=this,n=e.p,i=e.d.length,r=e.p+i;return function(){for(var o=[],s=0,a=Array.from(t.comments);s<a.length;s++){var l=a[s],c=l.op.p,u=l.op.p+l.op.c.length,d=u-c;if(c>=r)l.op.p-=i,o.push(t._markAsDirty(l,"comment","moved"));else if(n>=u);else{var h,f;f=c>=n?"":l.op.c.slice(0,n-c),h=r>=u?"":l.op.c.slice(r-c);var p=l.op.c.slice(f.length,d-h.length),g=Math.max(0,c-n),m=e.d.slice(g).slice(0,p.length);if(p!==m)throw new Error("deleted content does not match comment content");l.op.p=Math.min(c,n),l.op.c=f+h,o.push(t._markAsDirty(l,"comment","moved"))}}return o}()}},{key:"applyInsertToChanges",value:function(e,t){for(var n,i=this,r=e.p,o=e.i.length,s=e.p+o,a=!!e.u,l=!1,c=null,u=[],d=[],h=[],f=0;f<this.changes.length;f++){n=this.changes[f];var p=n.op.p;if(null!=n.op.d)p>r?(n.op.p+=o,u.push(n)):r===p&&(a&&n.op.d.length>=e.i.length&&n.op.d.slice(0,e.i.length)===e.i?(n.op.d=n.op.d.slice(e.i.length),n.op.p+=e.i.length,""===n.op.d?d.push(n):u.push(n),l=!0):(n.op.p+=o,u.push(n)));else if(null!=n.op.i){var g,m=p+n.op.i.length,v=r>=p&&m>=r,y=t.user_id===n.metadata.user_id,w=this.changes[f+1],b=null!=w&&null!=w.op.d&&e.p===m&&w.op.p===e.p,_=a&&b&&w.op.d.slice(0,e.i.length)===e.i,C=null!=c&&null!=c.op.d&&c.op.p===s;if(this.track_changes&&v&&!C&&!l&&!_&&y)g=r-p,n.op.i=n.op.i.slice(0,g)+e.i+n.op.i.slice(g),n.metadata.ts=t.ts,l=!0,u.push(n);else if(p>=r)n.op.p+=o,u.push(n);else if((!y||!this.track_changes)&&r>p&&m>r){g=r-p;var k=n.op.i.slice(0,g),S=n.op.i.slice(g);n.op.i=k,u.push(n);var $={op:{i:S,p:p+g+o},metadata:{}};for(var x in n.metadata){var A=n.metadata[x];$.metadata[x]=A}h.push($)}}c=n}this.track_changes&&!l&&this._addOp(e,t);for(var T=0,E=Array.from(h);T<E.length;T++){var M=E[T];e=M.op,t=M.metadata,this._addOp(e,t)}for(var R=0,L=Array.from(d);R<L.length;R++)n=L[R],this._removeChange(n);return function(){for(var e=[],t=0,r=Array.from(u);t<r.length;t++)n=r[t],e.push(i._markAsDirty(n,"change","moved"));return e}()}},{key:"applyDeleteToChanges",value:function(e,t){for(var n=this,i=e.p,r=e.d.length,o=e.p+r,s=[],a=[],l=[],c=0,u=Array.from(this.changes);c<u.length;c++){var d,h=u[c];if(null!=h.op.i){d=h.op.p;var f=d+h.op.i.length;if(d>=o)h.op.p-=r,a.push(h);else if(i>=f);else{var p,g,m,v;i>=d?(g="",v=h.op.i.slice(0,i-d)):(g=e.d.slice(0,d-i),v=""),f>=o?(p="",m=h.op.i.slice(o-d)):(p=e.d.slice(f-i),m="");var y=v+m;y.length>0?(h.op.i=y,h.op.p=Math.min(d,i),h.metadata.ts=t.ts,a.push(h)):s.push(h);var w=e.d.length-g.length-p.length,b=g.length,_={d:e.d.slice(b,b+w),p:b};_.d.length>0&&l.push(_)}}else if(null!=h.op.d)if(d=h.op.p,d>o||!this.track_changes&&o===d)h.op.p-=r,a.push(h);else if(d>=i&&o>=d)if(this.track_changes){var C=d-i;l.push({i:h.op.d,p:C}),s.push(h)}else h.op.p=i,a.push(h)}e={p:e.p,d:this._applyOpModifications(e.d,l)};for(var k=0,S=Array.from(s);k<S.length;k++)h=S[k],e.d.length>0&&null!=h.op.d&&e.p<=h.op.p&&h.op.p<=e.p+e.d.length?(h.op.p=e.p,h.op.d=e.d,h.metadata=t,a.push(h),e.d=""):this._removeChange(h);if(this.track_changes&&e.d.length>0)this._addOp(e,t);else{var $=this._scanAndMergeAdjacentUpdates();a=a.concat($.moved_changes);for(var x=0,A=Array.from($.remove_changes);x<A.length;x++)h=A[x],this._removeChange(h),a=a.filter(function(e){return e!==h})}return function(){for(var e=[],t=0,i=Array.from(a);t<i.length;t++)h=i[t],e.push(n._markAsDirty(h,"change","moved"));return e}()}},{key:"_addOp",value:function(e,t){var n={id:this.newId(),op:this._clone(e),metadata:this._clone(t)};return this.changes.push(n),this.changes.sort(function(e,t){var n=e.op.p-t.op.p;return 0!==n?n:null!=e.op.i&&null!=t.op.d?1:-1}),this._markAsDirty(n,"change","added")}},{key:"_removeChange",value:function(e){return this.changes=this.changes.filter(function(t){return t.id!==e.id}),this._markAsDirty(e,"change","removed")}},{key:"_applyOpModifications",value:function(e,t){t.sort(function(e,t){var n=t.p-e.p;return 0!==n?n:null!=e.i&&null!=t.d?1:-1});for(var n=0,i=Array.from(t);n<i.length;n++){var r=i[n];if(null!=r.i)e=e.slice(0,r.p)+r.i+e.slice(r.p);else if(null!=r.d){if(e.slice(r.p,r.p+r.d.length)!==r.d)throw new Error("deleted content does not match. content: ".concat(JSON.stringify(e),"; modification: ").concat(JSON.stringify(r)));e=e.slice(0,r.p)+e.slice(r.p+r.d.length)}}return e}},{key:"_scanAndMergeAdjacentUpdates",value:function(){for(var e=null,t=[],n=[],i=0,r=Array.from(this.changes);i<r.length;i++){var o=r[i];if(null!=(null!=e?e.op.i:void 0)&&null!=o.op.i){var s=e.op.p+e.op.i.length,a=e.metadata.user_id,l=o.op.p,c=o.metadata.user_id;s===l&&a===c&&(t.push(o),e.op.i+=o.op.i,n.push(e))}else null!=(null!=e?e.op.d:void 0)&&null!=o.op.d&&e.op.p===o.op.p?(e.op.d+=o.op.d,t.push(o),n.push(e)):e=o}return{moved_changes:n,remove_changes:t}}},{key:"resetDirtyState",value:function(){return this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}},{key:"getDirtyState",value:function(){return this._dirtyState}},{key:"_markAsDirty",value:function(e,t,n){return this._dirtyState[t][n][e.id]=e}},{key:"_clone",value:function(e){var t={};for(var n in e){var i=e[n];t[n]=i}return t}}],[{key:"generateIdSeed",value:function(){var e=Math.floor(32767*Math.random()).toString(16),t=Math.floor(16777216*Math.random()).toString(16),n=Math.floor((new Date).valueOf()/1e3).toString(16);return"00000000".substr(0,8-n.length)+n+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-e.length)+e}},{key:"generateId",value:function(){return this.generateIdSeed()+"000001"}}]),e}()};"undefined"!=typeof define&&null!==define?define("ide/review-panel/RangesTracker",[],load):module.exports=load(),define("ide/editor/Document",["utils/EventEmitter","ide/editor/ShareJsDoc","ide/review-panel/RangesTracker"],function(e,t,n){var i;return i=function(){return i=function(e){function i(e,t){var n;return _classCallCheck(this,i),n=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this)),n.ide=e,n.doc_id=t,n.connected=n.ide.socket.socket.connected,n.joined=!1,n.wantToBeJoined=!1,n._checkAceConsistency=_.bind(n._checkConsistency,_assertThisInitialized(n),n.ace),n._checkCMConsistency=_.bind(n._checkConsistency,_assertThisInitialized(n),n.cm),n._bindToEditorEvents(),n._bindToSocketEvents(),n}return _inherits(i,e),_createClass(i,null,[{key:"initClass",value:function(){this.prototype.MAX_PENDING_OP_SIZE=64}},{key:"getDocument",value:function(e,t){return this.openDocs||(this.openDocs={}),null==this.openDocs[t]?(sl_console.log("[getDocument] Creating new document instance for ".concat(t)),this.openDocs[t]=new i(e,t)):sl_console.log("[getDocument] Returning existing document instance for ".concat(t)),
this.openDocs[t]}},{key:"hasUnsavedChanges",value:function(){var e=this.openDocs||{};for(var t in e){var n=e[t];if(n.hasBufferedOps())return!0}return!1}},{key:"flushAll",value:function(){var e=this;return function(){var t=[];for(var n in e.openDocs){var i=e.openDocs[n];t.push(i.flush())}return t}()}}]),_createClass(i,[{key:"attachToAce",value:function(e){this.ace=e,null!=this.doc&&this.doc.attachToAce(this.ace);var t=this.ace.getSession().getDocument();return t.on("change",this._checkAceConsistency),this.ide.$scope.$emit("document:opened",this.doc)}},{key:"detachFromAce",value:function(){null!=this.doc&&this.doc.detachFromAce();var e=null!=this.ace?this.ace.getSession().getDocument():void 0;return null!=e&&e.off("change",this._checkAceConsistency),this.ide.$scope.$emit("document:closed",this.doc)}},{key:"attachToCM",value:function(e){return this.cm=e,null!=this.doc&&this.doc.attachToCM(this.cm),null!=this.cm&&this.cm.on("change",this._checkCMConsistency),this.ide.$scope.$emit("document:opened",this.doc)}},{key:"detachFromCM",value:function(){return null!=this.doc&&this.doc.detachFromCM(),null!=this.cm&&this.cm.off("change",this._checkCMConsistency),this.ide.$scope.$emit("document:closed",this.doc)}},{key:"submitOp",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return null!=this.doc?(e=this.doc).submitOp.apply(e,_toConsumableArray(Array.from(n||[]))):void 0}},{key:"_checkConsistency",value:function(e){var t=this;return function(){return setTimeout(function(){var n=null!=e?e.getValue():void 0,i=null!=t.doc?t.doc.getSnapshot():void 0;return n!==i?t._onError(new Error("Editor text does not match server text")):void 0},0)}}},{key:"getSnapshot",value:function(){return null!=this.doc?this.doc.getSnapshot():void 0}},{key:"getType",value:function(){return null!=this.doc?this.doc.getType():void 0}},{key:"getInflightOp",value:function(){return null!=this.doc?this.doc.getInflightOp():void 0}},{key:"getPendingOp",value:function(){return null!=this.doc?this.doc.getPendingOp():void 0}},{key:"getRecentAck",value:function(){return null!=this.doc?this.doc.getRecentAck():void 0}},{key:"getOpSize",value:function(e){return null!=this.doc?this.doc.getOpSize(e):void 0}},{key:"hasBufferedOps",value:function(){return null!=this.doc?this.doc.hasBufferedOps():void 0}},{key:"setTrackingChanges",value:function(e){return this.doc.track_changes=e}},{key:"getTrackingChanges",value:function(){return!!this.doc.track_changes}},{key:"setTrackChangesIdSeeds",value:function(e){return this.doc.track_changes_id_seeds=e}},{key:"_bindToSocketEvents",value:function(){var e=this;return this._onUpdateAppliedHandler=function(t){return e._onUpdateApplied(t)},this.ide.socket.on("otUpdateApplied",this._onUpdateAppliedHandler),this._onErrorHandler=function(t,n){return e._onError(t,n)},this.ide.socket.on("otUpdateError",this._onErrorHandler),this._onDisconnectHandler=function(t){return e._onDisconnect(t)},this.ide.socket.on("disconnect",this._onDisconnectHandler)}},{key:"_bindToEditorEvents",value:function(){var e=this,t=function(t){return e._onReconnect(t)};return this._unsubscribeReconnectHandler=this.ide.$scope.$on("project:joined",t)}},{key:"_unBindFromEditorEvents",value:function(){return this._unsubscribeReconnectHandler()}},{key:"_unBindFromSocketEvents",value:function(){return this.ide.socket.removeListener("otUpdateApplied",this._onUpdateAppliedHandler),this.ide.socket.removeListener("otUpdateError",this._onErrorHandler),this.ide.socket.removeListener("disconnect",this._onDisconnectHandler)}},{key:"leaveAndCleanUp",value:function(){var e=this;return this.leave(function(t){return e._cleanUp()})}},{key:"join",value:function(e){return null==e&&(e=function(e){}),this.wantToBeJoined=!0,this._cancelLeave(),this.connected?this._joinDoc(e):(this._joinCallbacks||(this._joinCallbacks=[]),this._joinCallbacks.push(e))}},{key:"leave",value:function(e){return null==e&&(e=function(e){}),this.wantToBeJoined=!1,this._cancelJoin(),null!=this.doc&&this.doc.hasBufferedOps()?(sl_console.log("[leave] Doc has buffered ops, pushing callback for later"),this._leaveCallbacks||(this._leaveCallbacks=[]),this._leaveCallbacks.push(e)):this.connected?(sl_console.log("[leave] Leaving now"),this._leaveDoc(e)):(sl_console.log("[leave] Not connected, returning now"),e())}},{key:"flush",value:function(){return null!=this.doc?this.doc.flushPendingOps():void 0}},{key:"chaosMonkey",value:function(e,t){var n=this;null==e&&(e=0),null==t&&(t="a");var i=t,r=null,o=0,s=function a(){return null!=r&&r.length||(r=i.slice()+" "+new Date+"\n",e+=Math.random()>.1?1:-2,0>e&&(e=0),o=0),t=r[0],r=r.slice(1),n.ace.session.insert({row:e,column:o},t),o+=1,n._cm=setTimeout(a,100+(Math.random()<.1?1e3:0))};return this._cm=s()}},{key:"clearChaosMonkey",value:function(){return clearTimeout(this._cm)}},{key:"pollSavedStatus",value:function(){var e,t=this.getInflightOp(),n=this.getPendingOp(),i=this.getRecentAck(),r=null!=n&&this.getOpSize(n);return null==t&&null==n?(e=!0,sl_console.logOnce("[pollSavedStatus] no inflight or pending ops")):null!=t&&t===this.oldInflightOp?(e=!1,sl_console.log("[pollSavedStatus] inflight op is same as before")):null!=n&&i&&r<this.MAX_PENDING_OP_SIZE?(e=!0,sl_console.log("[pollSavedStatus] pending op (small with recent ack) assume ok",n,r)):(e=!1,sl_console.log("[pollSavedStatus] assuming not saved (inflightOp?: ".concat(null!=t,", pendingOp?: ").concat(null!=n,")"))),this.oldInflightOp=t,e}},{key:"_cancelLeave",value:function(){return null!=this._leaveCallbacks?delete this._leaveCallbacks:void 0}},{key:"_cancelJoin",value:function(){return null!=this._joinCallbacks?delete this._joinCallbacks:void 0}},{key:"_onUpdateApplied",value:function(e){return this.ide.pushEvent("received-update",{doc_id:this.doc_id,remote_doc_id:null!=e?e.doc:void 0,wantToBeJoined:this.wantToBeJoined,update:e,hasDoc:null!=this.doc}),null!=window.disconnectOnAck&&Math.random()<window.disconnectOnAck?(sl_console.log("Disconnecting on ack",e),void window._ide.socket.socket.disconnect()):null!=window.dropAcks&&Math.random()<window.dropAcks&&null==e.op?void sl_console.log("Simulating a lost ack",e):(null!=e?e.doc:void 0)!==this.doc_id||null==this.doc||(this.ide.pushEvent("received-update:processing",{update:e}),this.doc.processUpdateFromServerInOrder(e),this.wantToBeJoined)?void 0:this.leave()}},{key:"_onDisconnect",value:function(){return sl_console.log("[onDisconnect] disconnecting"),this.connected=!1,this.joined=!1,null!=this.doc?this.doc.updateConnectionState("disconnected"):void 0}},{key:"_onReconnect",value:function(){var e=this;return sl_console.log("[onReconnect] reconnected (joined project)"),this.ide.pushEvent("reconnected:afterJoinProject"),this.connected=!0,this.wantToBeJoined||(null!=this.doc?this.doc.hasBufferedOps():void 0)?(sl_console.log("[onReconnect] Rejoining (wantToBeJoined: ".concat(this.wantToBeJoined," OR hasBufferedOps: ").concat(null!=this.doc?this.doc.hasBufferedOps():void 0,")")),this._joinDoc(function(t){return null!=t?e._onError(t):(e.doc.updateConnectionState("ok"),e.doc.flushPendingOps(),e._callJoinCallbacks())})):void 0}},{key:"_callJoinCallbacks",value:function(){for(var e=0,t=Array.from(this._joinCallbacks||[]);e<t.length;e++){var n=t[e];n()}return delete this._joinCallbacks}},{key:"_joinDoc",value:function(e){var i=this;return null==e&&(e=function(e){}),null!=this.doc?(this.ide.pushEvent("joinDoc:existing",{doc_id:this.doc_id,version:this.doc.getVersion()}),this.ide.socket.emit("joinDoc",this.doc_id,this.doc.getVersion(),{encodeRanges:!0},function(t,n,r,o,s){return null!=t?e(t):(i.joined=!0,i.doc.catchUp(o),i._decodeRanges(s),i._catchUpRanges(null!=s?s.changes:void 0,null!=s?s.comments:void 0),e())})):(this.ide.pushEvent("joinDoc:new",{doc_id:this.doc_id}),this.ide.socket.emit("joinDoc",this.doc_id,{encodeRanges:!0},function(r,o,s,a,l){return null!=r?e(r):(i.joined=!0,i.ide.pushEvent("joinDoc:inited",{doc_id:i.doc_id,version:s}),i.doc=new t(i.doc_id,o,s,i.ide.socket),i._decodeRanges(l),i.ranges=new n(null!=l?l.changes:void 0,null!=l?l.comments:void 0),i._bindToShareJsDocEvents(),e())}))}},{key:"_decodeRanges",value:function(e){var t=function(e){return decodeURIComponent(escape(e))};try{for(var n=0,i=Array.from(e.changes||[]);n<i.length;n++){var r=i[n];null!=r.op.i&&(r.op.i=t(r.op.i)),null!=r.op.d&&(r.op.d=t(r.op.d))}return function(){for(var n=[],i=0,r=Array.from(e.comments||[]);i<r.length;i++){var o=r[i];null!=o.op.c?n.push(o.op.c=t(o.op.c)):n.push(void 0)}return n}()}catch(o){return console.log(o)}}},{key:"_leaveDoc",value:function(e){var t=this;return null==e&&(e=function(e){}),sl_console.log("[_leaveDoc] Sending leaveDoc request"),this.ide.socket.emit("leaveDoc",this.doc_id,function(n){if(null!=n)return e(n);t.joined=!1;for(var i=0,r=Array.from(t._leaveCallbacks||[]);i<r.length;i++)e=r[i],sl_console.log("[_leaveDoc] Calling buffered callback",e),e(n);return delete t._leaveCallbacks,e(n)})}},{key:"_cleanUp",value:function(){return i.openDocs[this.doc_id]===this?(sl_console.log("[_cleanUp] Removing self (".concat(this.doc_id,") from in openDocs")),delete i.openDocs[this.doc_id]):sl_console.log("[_cleanUp] New instance of (".concat(this.doc_id,") created. Not removing")),this._unBindFromEditorEvents(),this._unBindFromSocketEvents()}},{key:"_bindToShareJsDocEvents",value:function(){var e=this;return this.doc.on("error",function(t,n){return e._onError(t,n)}),this.doc.on("externalUpdate",function(t){return e.ide.pushEvent("externalUpdate",{doc_id:e.doc_id}),e.trigger("externalUpdate",t)}),this.doc.on("remoteop",function(){e.ide.pushEvent("remoteop",{doc_id:e.doc_id});for(var t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];return e.trigger.apply(e,["remoteop"].concat(_toConsumableArray(Array.from(n))))}),this.doc.on("op:sent",function(t){return e.ide.pushEvent("op:sent",{doc_id:e.doc_id,op:t}),e.trigger("op:sent")}),this.doc.on("op:acknowledged",function(t){return e.ide.pushEvent("op:acknowledged",{doc_id:e.doc_id,op:t}),e.ide.$scope.$emit("ide:opAcknowledged",{doc_id:e.doc_id,op:t}),e.trigger("op:acknowledged")}),this.doc.on("op:timeout",function(t){return e.ide.pushEvent("op:timeout",{doc_id:e.doc_id,op:t}),e.trigger("op:timeout"),e._onError(new Error("op timed out"),{op:t})}),this.doc.on("flush",function(t,n,i){return e.ide.pushEvent("flush",{doc_id:e.doc_id,inflightOp:t,pendingOp:n,v:i})}),this.doc.on("change",function(t,n,i){return e._applyOpsToRanges(t,n,i),e.ide.$scope.$emit("doc:changed",{doc_id:e.doc_id})}),this.doc.on("flipped_pending_to_inflight",function(){return e.trigger("flipped_pending_to_inflight")}),this.doc.on("saved",function(){return e.ide.$scope.$emit("doc:saved",{doc_id:e.doc_id})})}},{key:"_onError",value:function(e,t){if(null==t&&(t={}),t.doc_id=this.doc_id,sl_console.log("ShareJS error",e,t),"no project_id found on client"===e.message)return void sl_console.log("ignoring error, will wait to join project");if("function"==typeof ga){var n=e.message;/^Delete component/.test(n)&&(n="Delete component does not match deleted text"),ga("send","event","error","shareJsError","".concat(n," - ").concat(this.ide.socket.socket.transport.name))}return null!=this.doc&&this.doc.clearInflightAndPendingOps(),this.trigger("error",e,t),this._cleanUp()}},{key:"_applyOpsToRanges",value:function(e,t,n){var i,r=this;null==e&&(e=[]);var o=null,s=null!=n;null!=__guard__(null!=n?n.meta:void 0,function(e){return e.tc})&&(i=this.ranges.getIdSeed(),this.ranges.setIdSeed(n.meta.tc)),s&&(null!=n.meta?n.meta.tc:void 0)?o=n.meta.user_id:s||null==this.track_changes_as||(o=this.track_changes_as),this.ranges.track_changes=null!=o;for(var a=0,l=Array.from(e);a<l.length;a++){var c=l[a];this.ranges.applyOp(c,{user_id:o})}return null!=i&&this.ranges.setIdSeed(i),s?setTimeout(function(){return r.emit("ranges:dirty")}):this.emit("ranges:dirty")}},{key:"_catchUpRanges",value:function(e,t){null==e&&(e=[]),null==t&&(t=[]),this.emit("ranges:clear"),this.ranges.changes=e,this.ranges.comments=t,this.ranges.track_changes=this.doc.track_changes;for(var n=0,i=Array.from(this.doc.getInflightOp()||[]);n<i.length;n++){var r=i[n];this.ranges.setIdSeed(this.doc.track_changes_id_seeds.inflight),this.ranges.applyOp(r,{user_id:this.track_changes_as})}for(var o=0,s=Array.from(this.doc.getPendingOp()||[]);o<s.length;o++)r=s[o],this.ranges.setIdSeed(this.doc.track_changes_id_seeds.pending),this.ranges.applyOp(r,{user_id:this.track_changes_as});return this.emit("ranges:redraw")}}]),i}(e),i.initClass(),i}()}),define("ide/editor/components/spellMenu",["base"],function(e){return e.component("spellMenu",{bindings:{open:"<",top:"<",left:"<",layoutFromBottom:"<",highlight:"<",replaceWord:"&",learnWord:"&"},template:'<div\n  class="dropdown context-menu spell-check-menu"\n  ng-show="$ctrl.open"\n  ng-style="{top: $ctrl.top, left: $ctrl.left}"\n  ng-class="{open: $ctrl.open, \'spell-check-menu-from-bottom\': $ctrl.layoutFromBottom}"\n>\n  <ul class="dropdown-menu">\n    <li ng-repeat="suggestion in $ctrl.highlight.suggestions | limitTo:8">\n      <a\n        href\n        ng-click="$ctrl.replaceWord({ highlight: $ctrl.highlight, suggestion: suggestion })"\n      >\n        {{ suggestion }}\n      </a>\n    </li>\n    <li class="divider"></li>\n    <li>\n      <a href ng-click="$ctrl.learnWord({ highlight: $ctrl.highlight })">Add to Dictionary</a>\n    </li>\n  </ul>\n</div>'})}),ace.define("ace/ext/searchbox",[],function(e,t,n){"use strict";var i=e("../lib/dom"),r=e("../lib/lang"),o=e("../lib/event"),s='.ace_search {background-color: #ddd;color: #666;border: 1px solid #cbcbcb;border-top: 0 none;overflow: hidden;margin: 0;padding: 4px 6px 0 4px;position: absolute;top: 0;z-index: 99;white-space: normal;}.ace_search.left {border-left: 0 none;border-radius: 0px 0px 5px 0px;left: 0;}.ace_search.right {border-radius: 0px 0px 0px 5px;border-right: 0 none;right: 0;}.ace_search_form, .ace_replace_form {margin: 0 20px 4px 0;overflow: hidden;line-height: 1.9;}.ace_replace_form {margin-right: 0;}.ace_search_form.ace_nomatch {outline: 1px solid red;}.ace_search_field {border-radius: 3px 0 0 3px;background-color: white;color: black;border: 1px solid #cbcbcb;border-right: 0 none;outline: 0;padding: 0;font-size: inherit;margin: 0;line-height: inherit;padding: 0 6px;min-width: 17em;vertical-align: top;min-height: 1.8em;box-sizing: content-box;}.ace_searchbtn {border: 1px solid #cbcbcb;line-height: inherit;display: inline-block;padding: 0 6px;background: #fff;border-right: 0 none;border-left: 1px solid #dcdcdc;cursor: pointer;margin: 0;position: relative;color: #666;}.ace_searchbtn:last-child {border-radius: 0 3px 3px 0;border-right: 1px solid #cbcbcb;}.ace_searchbtn:disabled {background: none;cursor: default;}.ace_searchbtn:hover {background-color: #eef1f6;}.ace_searchbtn.prev, .ace_searchbtn.next {padding: 0px 0.7em}.ace_searchbtn.prev:after, .ace_searchbtn.next:after {content: "";border: solid 2px #888;width: 0.5em;height: 0.5em;border-width:  2px 0 0 2px;display:inline-block;transform: rotate(-45deg);}.ace_searchbtn.next:after {border-width: 0 2px 2px 0 ;}.ace_searchbtn_close {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;border-radius: 50%;border: 0 none;color: #656565;cursor: pointer;font: 16px/16px Arial;padding: 0;height: 14px;width: 14px;top: 9px;right: 7px;position: absolute;}.ace_searchbtn_close:hover {background-color: #656565;background-position: 50% 100%;color: white;}.ace_button {margin-left: 2px;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;overflow: hidden;opacity: 0.7;border: 1px solid rgba(100,100,100,0.23);padding: 1px;box-sizing:    border-box!important;color: black;}.ace_button:hover {background-color: #eee;opacity:1;}.ace_button:active {background-color: #ddd;}.ace_button.checked {border-color: #3399ff;opacity:1;}.ace_search_options{margin-bottom: 3px;text-align: right;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;clear: both;}.ace_search_counter {float: left;font-family: arial;padding: 0 8px;}',a=e("../keyboard/hash_handler").HashHandler,l=e("../lib/keys"),c=999;i.importCssString(s,"ace_searchbox");var u=function(e,t,n){var r=i.createElement("div");i.buildDom(["div",{"class":"ace_search right"},["span",{action:"hide","class":"ace_searchbtn_close"}],["div",{"class":"ace_search_form"},["input",{"class":"ace_search_field",placeholder:"Search for",spellcheck:"false"}],["span",{action:"findPrev","class":"ace_searchbtn prev"},""],["span",{action:"findNext","class":"ace_searchbtn next"},""],["span",{action:"findAll","class":"ace_searchbtn",title:"Alt-Enter"},"All"]],["div",{"class":"ace_replace_form"},["input",{"class":"ace_search_field",placeholder:"Replace with",spellcheck:"false"}],["span",{action:"replaceAndFindNext","class":"ace_searchbtn"},"Replace"],["span",{action:"replaceAll","class":"ace_searchbtn"},"All"]],["div",{"class":"ace_search_options"},["span",{action:"toggleReplace","class":"ace_button",title:"Toggle Replace mode",style:"float:left;margin-top:-2px;padding:0 5px;"},"+"],["span",{"class":"ace_search_counter"}],["span",{action:"toggleRegexpMode","class":"ace_button",title:"RegExp Search"},".*"],["span",{action:"toggleCaseSensitive","class":"ace_button",title:"CaseSensitive Search"},"Aa"],["span",{action:"toggleWholeWords","class":"ace_button",title:"Whole Word Search"},"\\b"],["span",{action:"searchInSelection","class":"ace_button",title:"Search In Selection"},"S"]]],r),this.element=r.firstChild,this.setSession=this.setSession.bind(this),this.$init(),this.setEditor(e)};(function(){this.setEditor=function(e){e.searchBox=this,e.renderer.scroller.appendChild(this.element),this.editor=e},this.setSession=function(e){this.searchRange=null,this.$syncOptions(!0)},this.$initElements=function(e){this.searchBox=e.querySelector(".ace_search_form"),this.replaceBox=e.querySelector(".ace_replace_form"),this.searchOption=e.querySelector("[action=searchInSelection]"),this.replaceOption=e.querySelector("[action=toggleReplace]"),this.regExpOption=e.querySelector("[action=toggleRegexpMode]"),this.caseSensitiveOption=e.querySelector("[action=toggleCaseSensitive]"),this.wholeWordOption=e.querySelector("[action=toggleWholeWords]"),this.searchInput=this.searchBox.querySelector(".ace_search_field"),this.replaceInput=this.replaceBox.querySelector(".ace_search_field"),this.searchCounter=e.querySelector(".ace_search_counter")},this.$init=function(){var e=this.element;this.$initElements(e);var t=this;o.addListener(e,"mousedown",function(e){setTimeout(function(){t.activeInput.focus()},0),o.stopPropagation(e)}),o.addListener(e,"click",function(e){var n=e.target||e.srcElement,i=n.getAttribute("action");i&&t[i]?t[i]():t.$searchBarKb.commands[i]&&t.$searchBarKb.commands[i].exec(t),o.stopPropagation(e)}),o.addCommandKeyListener(e,function(e,n,i){var r=l.keyCodeToString(i),s=t.$searchBarKb.findKeyCommand(n,r);s&&s.exec&&(s.exec(t),o.stopEvent(e))}),this.$onChange=r.delayedCall(function(){t.find(!1,!1)}),o.addListener(this.searchInput,"input",function(){t.$onChange.schedule(20)}),o.addListener(this.searchInput,"focus",function(){t.activeInput=t.searchInput,t.searchInput.value&&t.highlight()}),o.addListener(this.replaceInput,"focus",function(){t.activeInput=t.replaceInput,t.searchInput.value&&t.highlight()})},this.$closeSearchBarKb=new a([{bindKey:"Esc",name:"closeSearchBar",exec:function(e){e.searchBox.hide()}}]),this.$searchBarKb=new a,this.$searchBarKb.bindKeys({"Ctrl-f|Command-f":function(e){var t=e.isReplace=!e.isReplace;e.replaceBox.style.display=t?"":"none",e.replaceOption.checked=!1,e.$syncOptions(),e.searchInput.focus()},"Ctrl-H|Command-Option-F":function(e){e.editor.getReadOnly()||(e.replaceOption.checked=!0,e.$syncOptions(),e.replaceInput.focus())},"Ctrl-G|Command-G":function(e){e.findNext()},"Ctrl-Shift-G|Command-Shift-G":function(e){e.findPrev()},esc:function(e){setTimeout(function(){e.hide()})},Return:function(e){e.activeInput==e.replaceInput&&e.replace(),e.findNext()},"Shift-Return":function(e){e.activeInput==e.replaceInput&&e.replace(),e.findPrev()},"Alt-Return":function(e){e.activeInput==e.replaceInput&&e.replaceAll(),e.findAll()},Tab:function(e){(e.activeInput==e.replaceInput?e.searchInput:e.replaceInput).focus()}}),this.$searchBarKb.addCommands([{name:"toggleRegexpMode",bindKey:{win:"Alt-R|Alt-/",mac:"Ctrl-Alt-R|Ctrl-Alt-/"},exec:function(e){e.regExpOption.checked=!e.regExpOption.checked,e.$syncOptions()}},{name:"toggleCaseSensitive",bindKey:{win:"Alt-C|Alt-I",mac:"Ctrl-Alt-R|Ctrl-Alt-I"},exec:function(e){e.caseSensitiveOption.checked=!e.caseSensitiveOption.checked,e.$syncOptions()}},{name:"toggleWholeWords",bindKey:{win:"Alt-B|Alt-W",mac:"Ctrl-Alt-B|Ctrl-Alt-W"},exec:function(e){e.wholeWordOption.checked=!e.wholeWordOption.checked,e.$syncOptions()}},{name:"toggleReplace",exec:function(e){e.replaceOption.checked=!e.replaceOption.checked,e.$syncOptions()}},{name:"searchInSelection",exec:function(e){e.searchOption.checked=!e.searchRange,e.setSearchRange(e.searchOption.checked&&e.editor.getSelectionRange()),e.$syncOptions()}}]),this.setSearchRange=function(e){this.searchRange=e,e?this.searchRangeMarker=this.editor.session.addMarker(e,"ace_active-line"):this.searchRangeMarker&&(this.editor.session.removeMarker(this.searchRangeMarker),this.searchRangeMarker=null)},this.$syncOptions=function(e){i.setCssClass(this.replaceOption,"checked",this.searchRange),i.setCssClass(this.searchOption,"checked",this.searchOption.checked),this.replaceOption.textContent=this.replaceOption.checked?"-":"+",i.setCssClass(this.regExpOption,"checked",this.regExpOption.checked),i.setCssClass(this.wholeWordOption,"checked",this.wholeWordOption.checked),i.setCssClass(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked);var t=this.editor.getReadOnly();this.replaceOption.style.display=t?"none":"",this.replaceBox.style.display=this.replaceOption.checked&&!t?"":"none",this.find(!1,!1,e)},this.highlight=function(e){this.editor.session.highlight(e||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},this.find=function(e,t,n){var r=this.editor.find(this.searchInput.value,{skipCurrent:e,backwards:t,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked,preventScroll:n,range:this.searchRange}),o=!r&&this.searchInput.value;i.setCssClass(this.searchBox,"ace_nomatch",o),this.editor._emit("findSearchBox",{match:!o}),this.highlight(),this.updateCounter()},this.updateCounter=function(){var e=this.editor,t=e.$search.$options.re,n=0,i=0;if(t){var r=this.searchRange?e.session.getTextRange(this.searchRange):e.getValue(),o=e.session.doc.positionToIndex(e.selection.anchor);this.searchRange&&(o-=e.session.doc.positionToIndex(this.searchRange.start));for(var s,a=t.lastIndex=0;(s=t.exec(r))&&(n++,a=s.index,o>=a&&i++,!(n>c))&&(s[0]||(t.lastIndex=a+=1,!(a>=r.length))););}this.searchCounter.textContent=i+" of "+(n>c?c+"+":n)},this.findNext=function(){this.find(!0,!1)},this.findPrev=function(){this.find(!0,!0)},this.findAll=function(){var e=this.editor.findAll(this.searchInput.value,{regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked}),t=!e&&this.searchInput.value;i.setCssClass(this.searchBox,"ace_nomatch",t),this.editor._emit("findSearchBox",{match:!t}),this.highlight(),this.hide()},this.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},this.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},this.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},this.hide=function(){this.active=!1,this.setSearchRange(null),this.editor.off("changeSession",this.setSession),this.element.style.display="none",this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},this.show=function(e,t){this.active=!0,this.editor.on("changeSession",this.setSession),this.element.style.display="",this.replaceOption.checked=t,e&&(this.searchInput.value=e),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb),this.$syncOptions(!0)},this.isFocused=function(){var e=document.activeElement;return e==this.searchInput||e==this.replaceInput}}).call(u.prototype),t.SearchBox=u,t.Search=function(e,t){var n=e.searchBox||new u(e);n.show(e.session.getTextRange(),t)}}),function(){ace.require(["ace/ext/searchbox"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)})}(),define("ace/ext-searchbox",function(){}),ace.define("ace/ext/modelist",[],function(e,t,n){"use strict";function i(e){for(var t=l.text,n=e.split(/[\/\\]/).pop(),i=0;i<r.length;i++)if(r[i].supportsFile(n)){t=r[i];break}return t}var r=[],o=function(e,t,n){this.name=e,this.caption=t,this.mode="ace/mode/"+e,this.extensions=n;var i;i=/\^/.test(n)?n.replace(/\|(\^)?/g,function(e,t){return"$|"+(t?"^":"^.*\\.")})+"$":"^.*\\.("+n+")$",this.extRe=new RegExp(i,"gi")};o.prototype.supportsFile=function(e){return e.match(this.extRe)};var s={ABAP:["abap"],ABC:["abc"],ActionScript:["as"],ADA:["ada|adb"],Apache_Conf:["^htaccess|^htgroups|^htpasswd|^conf|htaccess|htgroups|htpasswd"],AsciiDoc:["asciidoc|adoc"],ASL:["dsl|asl"],Assembly_x86:["asm|a"],AutoHotKey:["ahk"],Apex:["apex|cls|trigger|tgr"],AQL:["aql"],BatchFile:["bat|cmd"],C_Cpp:["cpp|c|cc|cxx|h|hh|hpp|ino"],C9Search:["c9search_results"],Crystal:["cr"],Cirru:["cirru|cr"],Clojure:["clj|cljs"],Cobol:["CBL|COB"],coffee:["coffee|cf|cson|^Cakefile"],ColdFusion:["cfm"],CSharp:["cs"],Csound_Document:["csd"],Csound_Orchestra:["orc"],Csound_Score:["sco"],CSS:["css"],Curly:["curly"],D:["d|di"],Dart:["dart"],Diff:["diff|patch"],Dockerfile:["^Dockerfile"],Dot:["dot"],Drools:["drl"],Edifact:["edi"],Eiffel:["e|ge"],EJS:["ejs"],Elixir:["ex|exs"],Elm:["elm"],Erlang:["erl|hrl"],Forth:["frt|fs|ldr|fth|4th"],Fortran:["f|f90"],FSharp:["fsi|fs|ml|mli|fsx|fsscript"],FSL:["fsl"],FTL:["ftl"],Gcode:["gcode"],Gherkin:["feature"],Gitignore:["^.gitignore"],Glsl:["glsl|frag|vert"],Gobstones:["gbs"],golang:["go"],GraphQLSchema:["gql"],Groovy:["groovy"],HAML:["haml"],Handlebars:["hbs|handlebars|tpl|mustache"],Haskell:["hs"],Haskell_Cabal:["cabal"],haXe:["hx"],Hjson:["hjson"],HTML:["html|htm|xhtml|vue|we|wpy"],HTML_Elixir:["eex|html.eex"],HTML_Ruby:["erb|rhtml|html.erb"],INI:["ini|conf|cfg|prefs"],Io:["io"],Jack:["jack"],Jade:["jade|pug"],Java:["java"],JavaScript:["js|jsm|jsx"],JSON:["json"],JSONiq:["jq"],JSP:["jsp"],JSSM:["jssm|jssm_state"],JSX:["jsx"],Julia:["jl"],Kotlin:["kt|kts"],LaTeX:["tex|latex|ltx|bib"],LESS:["less"],Liquid:["liquid"],Lisp:["lisp"],LiveScript:["ls"],LogiQL:["logic|lql"],LSL:["lsl"],Lua:["lua"],LuaPage:["lp"],Lucene:["lucene"],Makefile:["^Makefile|^GNUmakefile|^makefile|^OCamlMakefile|make"],Markdown:["md|markdown"],Mask:["mask"],MATLAB:["matlab"],Maze:["mz"],MEL:["mel"],MIXAL:["mixal"],MUSHCode:["mc|mush"],MySQL:["mysql"],Nginx:["nginx|conf"],Nix:["nix"],Nim:["nim"],NSIS:["nsi|nsh"],ObjectiveC:["m|mm"],OCaml:["ml|mli"],Pascal:["pas|p"],Perl:["pl|pm"],Perl6:["p6|pl6|pm6"],pgSQL:["pgsql"],PHP_Laravel_blade:["blade.php"],PHP:["php|inc|phtml|shtml|php3|php4|php5|phps|phpt|aw|ctp|module"],Puppet:["epp|pp"],Pig:["pig"],Powershell:["ps1"],Praat:["praat|praatscript|psc|proc"],Prolog:["plg|prolog"],Properties:["properties"],Protobuf:["proto"],Python:["py"],R:["r"],Razor:["cshtml|asp"],RDoc:["Rd"],Red:["red|reds"],RHTML:["Rhtml"],RST:["rst"],Ruby:["rb|ru|gemspec|rake|^Guardfile|^Rakefile|^Gemfile"],Rust:["rs"],SASS:["sass"],SCAD:["scad"],Scala:["scala|sbt"],Scheme:["scm|sm|rkt|oak|scheme"],SCSS:["scss"],SH:["sh|bash|^.bashrc"],SJS:["sjs"],Slim:["slim|skim"],Smarty:["smarty|tpl"],snippets:["snippets"],Soy_Template:["soy"],Space:["space"],SQL:["sql"],SQLServer:["sqlserver"],Stylus:["styl|stylus"],SVG:["svg"],Swift:["swift"],Tcl:["tcl"],Terraform:["tf","tfvars","terragrunt"],Tex:["tex"],Text:["txt"],Textile:["textile"],Toml:["toml"],TSX:["tsx"],Twig:["latte|twig|swig"],Typescript:["ts|typescript|str"],Vala:["vala"],VBScript:["vbs|vb"],Velocity:["vm"],Verilog:["v|vh|sv|svh"],VHDL:["vhd|vhdl"],Visualforce:["vfp|component|page"],Wollok:["wlk|wpgm|wtest"],XML:["xml|rdf|rss|wsdl|xslt|atom|mathml|mml|xul|xbl|xaml"],XQuery:["xq"],YAML:["yaml|yml"],Zeek:["zeek|bro"],Django:["html"]},a={ObjectiveC:"Objective-C",CSharp:"C#",golang:"Go",C_Cpp:"C and C++",Csound_Document:"Csound Document",Csound_Orchestra:"Csound",Csound_Score:"Csound Score",coffee:"CoffeeScript",HTML_Ruby:"HTML (Ruby)",HTML_Elixir:"HTML (Elixir)",FTL:"FreeMarker",PHP_Laravel_blade:"PHP (Blade Template)",Perl6:"Perl 6",AutoHotKey:"AutoHotkey / AutoIt"},l={};for(var c in s){var u=s[c],d=(a[c]||c).replace(/_/g," "),h=c.toLowerCase(),f=new o(h,d,u[0]);l[h]=f,r.push(f)}n.exports={getModeForPath:i,modes:r,modesByName:l}}),function(){ace.require(["ace/ext/modelist"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)})}(),define("ace/ext-modelist",function(){}),ace.define("ace/keyboard/vim",[],function(e,t,n){"use strict";function i(e){return{row:e.line,column:e.ch}}function r(e){return new Lt(e.row,e.column)}function o(e){e.setOption("disableInput",!0),e.setOption("showCursorWhenSelecting",!1),At.signal(e,"vim-mode-change",{mode:"normal"}),e.on("cursorActivity",ot),$(e),At.on(e.getInputField(),"paste",d(e))}function s(e){e.setOption("disableInput",!1),e.off("cursorActivity",ot),At.off(e.getInputField(),"paste",d(e)),e.state.vim=null}function a(e,t){this==At.keyMap.vim&&At.rmClass(e.getWrapperElement(),"cm-fat-cursor"),t&&t.attach==l||s(e)}function l(e,t){this==At.keyMap.vim&&At.addClass(e.getWrapperElement(),"cm-fat-cursor"),t&&t.attach==l||o(e)}function c(e,t){if(t){if(this[e])return this[e];var n=u(e);if(!n)return!1;var i=At.Vim.findKey(t,n);return"function"==typeof i&&At.signal(t,"vim-keypress",n),i}}function u(e){if("'"==e.charAt(0))return e.charAt(1);var t=e.split(/-(?!$)/),n=t[t.length-1];if(1==t.length&&1==t[0].length)return!1;if(2==t.length&&"Shift"==t[0]&&1==n.length)return!1;for(var i=!1,r=0;r<t.length;r++){var o=t[r];o in Ft?t[r]=Ft[o]:i=!0,o in Pt&&(t[r]=Pt[o])}return i?(v(n)&&(t[t.length-1]=n.toLowerCase()),"<"+t.join("-")+">"):!1}function d(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(B(e.getCursor(),0,1)),Zt.enterInsertMode(e,{},t))}),t.onPasteFn}function h(e,t){for(var n=[],i=e;e+t>i;i++)n.push(String.fromCharCode(i));return n}function f(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function p(e){return/^[a-z]$/.test(e)}function g(e){return-1!="()[]{}".indexOf(e)}function m(e){return It.test(e)}function v(e){return/^[A-Z]$/.test(e)}function y(e){return/^\s*$/.test(e)}function w(e){return-1!=".?!".indexOf(e)}function b(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}function _(e,t,n,i,r){if(void 0===t&&!r)throw Error("defaultValue is required unless callback is provided");if(n||(n="string"),jt[e]={type:n,defaultValue:t,callback:r},i)for(var o=0;o<i.length;o++)jt[i[o]]=jt[e];t&&C(e,t)}function C(e,t,n,i){var r=jt[e];i=i||{};var o=i.scope;if(!r)return new Error("Unknown option: "+e);if("boolean"==r.type){if(t&&t!==!0)return new Error("Invalid argument: "+e+"="+t);t!==!1&&(t=!0)}r.callback?("local"!==o&&r.callback(t,void 0),"global"!==o&&n&&r.callback(t,n)):("local"!==o&&(r.value="boolean"==r.type?!!t:t),"global"!==o&&n&&(n.state.vim.options[e]={value:t}))}function k(e,t,n){var i=jt[e];n=n||{};var r=n.scope;if(!i)return new Error("Unknown option: "+e);{if(!i.callback){var o="global"!==r&&t&&t.state.vim.options[e];return(o||"local"!==r&&i||{}).value}var o=t&&i.callback(void 0,t);if("global"!==r&&void 0!==o)return o;
if("local"!==r)return i.callback()}}function S(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=Vt()}function $(e){return e.state.vim||(e.state.vim={inputState:new A,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),e.state.vim}function x(){Gt={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:Wt(),macroModeState:new S,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new R({}),searchHistoryController:new L,exCommandHistoryController:new L};for(var e in jt){var t=jt[e];t.value=t.defaultValue}}function A(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function T(e,t){e.state.vim.inputState=new A,At.signal(e,"vim-command-done",t)}function E(e,t,n){this.clear(),this.keyBuffer=[e||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!t,this.blockwise=!!n}function M(e,t){var n=Gt.registerController.registers;if(!e||1!=e.length)throw Error("Register name must be 1 character");n[e]=t,Ut.push(e)}function R(e){this.registers=e,this.unnamedRegister=e['"']=new E,e["."]=new E,e[":"]=new E,e["/"]=new E}function L(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}function D(e,t){Jt[e]=t}function F(e,t){for(var n=[],i=0;t>i;i++)n.push(e);return n}function P(e,t){Qt[e]=t}function I(e,t){Zt[e]=t}function q(e,t,n){var i=Math.min(Math.max(e.firstLine(),t.line),e.lastLine()),r=X(e,i)-1;r=n?r+1:r;var o=Math.min(Math.max(0,t.ch),r);return Lt(i,o)}function O(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function B(e,t,n){return"object"==typeof t&&(n=t.ch,t=t.line),Lt(e.line+t,e.ch+n)}function H(e,t,n,i){for(var r,o=[],s=[],a=0;a<t.length;a++){var l=t[a];"insert"==n&&"insert"!=l.context||l.context&&l.context!=n||i.operator&&"action"==l.type||!(r=N(e,l.keys))||("partial"==r&&o.push(l),"full"==r&&s.push(l))}return{partial:o.length&&o,full:s.length&&s}}function N(e,t){if("<character>"==t.slice(-11)){var n=t.length-11,i=e.slice(0,n),r=t.slice(0,n);return i==r&&e.length>n?"full":0==r.indexOf(i)?"partial":!1}return e==t?"full":0==t.indexOf(e)?"partial":!1}function z(e){var t=/^.*(<[^>]+>)$/.exec(e),n=t?t[1]:e.slice(-1);if(n.length>1)switch(n){case"<CR>":n="\n";break;case"<Space>":n=" ";break;default:n=""}return n}function U(e,t,n){return function(){for(var i=0;n>i;i++)t(e)}}function j(e){return Lt(e.line,e.ch)}function W(e,t){return e.ch==t.ch&&e.line==t.line}function V(e,t){return e.line<t.line?!0:e.line==t.line&&e.ch<t.ch?!0:!1}function G(e,t){return arguments.length>2&&(t=G.apply(void 0,Array.prototype.slice.call(arguments,1))),V(e,t)?e:t}function K(e,t){return arguments.length>2&&(t=K.apply(void 0,Array.prototype.slice.call(arguments,1))),V(e,t)?t:e}function Y(e,t,n){var i=V(e,t),r=V(t,n);return i&&r}function X(e,t){return e.getLine(t).length}function J(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Q(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function Z(e,t,n){var i=X(e,t),r=new Array(n-i+1).join(" ");e.setCursor(Lt(t,i)),e.replaceRange(r,e.getCursor())}function ee(e,t){var n=[],i=e.listSelections(),r=j(e.clipPos(t)),o=!W(t,r),s=e.getCursor("head"),a=ne(i,s),l=W(i[a].head,i[a].anchor),c=i.length-1,u=c-a>a?c:0,d=i[u].anchor,h=Math.min(d.line,r.line),f=Math.max(d.line,r.line),p=d.ch,g=r.ch,m=i[u].head.ch-p,v=g-p;m>0&&0>=v?(p++,o||g--):0>m&&v>=0?(p--,l||g++):0>m&&-1==v&&(p--,g++);for(var y=h;f>=y;y++){var w={anchor:new Lt(y,p),head:new Lt(y,g)};n.push(w)}return e.setSelections(n),t.ch=g,d.ch=p,d}function te(e,t,n){for(var i=[],r=0;n>r;r++){var o=B(t,r,0);i.push({anchor:o,head:o})}e.setSelections(i,0)}function ne(e,t,n){for(var i=0;i<e.length;i++){var r="head"!=n&&W(e[i].anchor,t),o="anchor"!=n&&W(e[i].head,t);if(r||o)return i}return-1}function ie(e,t){var n=t.lastSelection,i=function(){var t=e.listSelections(),n=t[0],i=t[t.length-1],r=V(n.anchor,n.head)?n.anchor:n.head,o=V(i.anchor,i.head)?i.head:i.anchor;return[r,o]},r=function(){var t=e.getCursor(),i=e.getCursor(),r=n.visualBlock;if(r){var o=r.width,s=r.height;i=Lt(t.line+s,t.ch+o);for(var a=[],l=t.line;l<i.line;l++){var c=Lt(l,t.ch),u=Lt(l,i.ch),d={anchor:c,head:u};a.push(d)}e.setSelections(a)}else{var h=n.anchorMark.find(),f=n.headMark.find(),p=f.line-h.line,g=f.ch-h.ch;i={line:i.line+p,ch:p?i.ch:g+i.ch},n.visualLine&&(t=Lt(t.line,0),i=Lt(i.line,X(e,i.line))),e.setSelection(t,i)}return[t,i]};return t.visualMode?i():r()}function re(e,t){var n=t.sel.anchor,i=t.sel.head;t.lastPastedText&&(i=e.posFromIndex(e.indexFromPos(n)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(n),headMark:e.setBookmark(i),anchor:j(n),head:j(i),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function oe(e,t,n){var i,r=e.state.vim.sel,o=r.head,s=r.anchor;return V(n,t)&&(i=n,n=t,t=i),V(o,s)?(o=G(t,o),s=K(s,n)):(s=G(t,s),o=K(o,n),o=B(o,0,-1),-1==o.ch&&o.line!=e.firstLine()&&(o=Lt(o.line-1,X(e,o.line-1)))),[s,o]}function se(e,t,n){var i=e.state.vim;t=t||i.sel;var n=n||i.visualLine?"line":i.visualBlock?"block":"char",r=ae(e,t,n);e.setSelections(r.ranges,r.primary),st(e)}function ae(e,t,n,i){var r=j(t.head),o=j(t.anchor);if("char"==n){var s=i||V(t.head,t.anchor)?0:1,a=V(t.head,t.anchor)?1:0;return r=B(t.head,0,s),o=B(t.anchor,0,a),{ranges:[{anchor:o,head:r}],primary:0}}if("line"==n){if(V(t.head,t.anchor))r.ch=0,o.ch=X(e,o.line);else{o.ch=0;var l=e.lastLine();r.line>l&&(r.line=l),r.ch=X(e,r.line)}return{ranges:[{anchor:o,head:r}],primary:0}}if("block"==n){for(var c=Math.min(o.line,r.line),u=Math.min(o.ch,r.ch),d=Math.max(o.line,r.line),h=Math.max(o.ch,r.ch)+1,f=d-c+1,p=r.line==c?0:f-1,g=[],m=0;f>m;m++)g.push({anchor:Lt(c+m,u),head:Lt(c+m,h)});return{ranges:g,primary:p}}}function le(e){var t=e.getCursor("head");return 1==e.getSelection().length&&(t=G(t,e.getCursor("anchor"))),t}function ce(e,t){var n=e.state.vim;t!==!1&&e.setCursor(q(e,n.sel.head)),re(e,n),n.visualMode=!1,n.visualLine=!1,n.visualBlock=!1,At.signal(e,"vim-mode-change",{mode:"normal"}),n.fakeCursor&&n.fakeCursor.clear()}function ue(e,t,n){var i=e.getRange(t,n);if(/\n\s*$/.test(i)){var r=i.split("\n");r.pop();for(var o,o=r.pop();r.length>0&&o&&y(o);o=r.pop())n.line--,n.ch=0;o?(n.line--,n.ch=X(e,n.line)):n.ch=0}}function de(e,t,n){t.ch=0,n.ch=0,n.line++}function he(e){if(!e)return 0;var t=e.search(/\S/);return-1==t?e.length:t}function fe(e,t,n,i,r){for(var o=le(e),s=e.getLine(o.line),a=o.ch,l=r?qt[0]:Ot[0];!l(s.charAt(a));)if(a++,a>=s.length)return null;i?l=Ot[0]:(l=qt[0],l(s.charAt(a))||(l=qt[1]));for(var c=a,u=a;l(s.charAt(c))&&c<s.length;)c++;for(;l(s.charAt(u))&&u>=0;)u--;if(u++,t){for(var d=c;/\s/.test(s.charAt(c))&&c<s.length;)c++;if(d==c){for(var h=u;/\s/.test(s.charAt(u-1))&&u>0;)u--;u||(u=h)}}return{start:Lt(o.line,u),end:Lt(o.line,c)}}function pe(e,t,n){W(t,n)||Gt.jumpList.add(e,t,n)}function ge(e,t){Gt.lastCharacterSearch.increment=e,Gt.lastCharacterSearch.forward=t.forward,Gt.lastCharacterSearch.selectedCharacter=t.selectedCharacter}function me(e,t,n,i){var r=j(e.getCursor()),o=n?1:-1,s=n?e.lineCount():-1,a=r.ch,l=r.line,c=e.getLine(l),u={lineText:c,nextCh:c.charAt(a),lastCh:null,index:a,symb:i,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[i],forward:n,depth:0,curMoveThrough:!1},d=en[i];if(!d)return r;var h=tn[d].init,f=tn[d].isComplete;for(h&&h(u);l!==s&&t;){if(u.index+=o,u.nextCh=u.lineText.charAt(u.index),!u.nextCh){if(l+=o,u.lineText=e.getLine(l)||"",o>0)u.index=0;else{var p=u.lineText.length;u.index=p>0?p-1:0}u.nextCh=u.lineText.charAt(u.index)}f(u)&&(r.line=l,r.ch=u.index,t--)}return u.nextCh||u.curMoveThrough?Lt(l,u.index):r}function ve(e,t,n,i,r){var o=t.line,s=t.ch,a=e.getLine(o),l=n?1:-1,c=i?Ot:qt;if(r&&""==a){if(o+=l,a=e.getLine(o),!f(e,o))return null;s=n?0:a.length}for(;;){if(r&&""==a)return{from:0,to:0,line:o};for(var u=l>0?a.length:-1,d=u,h=u;s!=u;){for(var p=!1,g=0;g<c.length&&!p;++g)if(c[g](a.charAt(s))){for(d=s;s!=u&&c[g](a.charAt(s));)s+=l;if(h=s,p=d!=h,d==t.ch&&o==t.line&&h==d+l)continue;return{from:Math.min(d,h+1),to:Math.max(d,h),line:o}}p||(s+=l)}if(o+=l,!f(e,o))return null;a=e.getLine(o),s=l>0?0:a.length}}function ye(e,t,n,i,r,o){var s=j(t),a=[];(i&&!r||!i&&r)&&n++;for(var l=!(i&&r),c=0;n>c;c++){var u=ve(e,t,i,o,l);if(!u){var d=X(e,e.lastLine());a.push(i?{line:e.lastLine(),from:d,to:d}:{line:0,from:0,to:0});break}a.push(u),t=Lt(u.line,i?u.to-1:u.from)}var h=a.length!=n,f=a[0],p=a.pop();return i&&!r?(h||f.from==s.ch&&f.line==s.line||(p=a.pop()),Lt(p.line,p.from)):i&&r?Lt(p.line,p.to-1):!i&&r?(h||f.to==s.ch&&f.line==s.line||(p=a.pop()),Lt(p.line,p.to)):Lt(p.line,p.from)}function we(e,t,n,i){for(var r,o=e.getCursor(),s=o.ch,a=0;t>a;a++){var l=e.getLine(o.line);if(r=Ce(s,l,i,n,!0),-1==r)return null;s=r}return Lt(e.getCursor().line,r)}function be(e,t){var n=e.getCursor().line;return q(e,Lt(n,t-1))}function _e(e,t,n,i){b(n,zt)&&(t.marks[n]&&t.marks[n].clear(),t.marks[n]=e.setBookmark(i))}function Ce(e,t,n,i,r){var o;return i?(o=t.indexOf(n,e+1),-1==o||r||(o-=1)):(o=t.lastIndexOf(n,e-1),-1==o||r||(o+=1)),o}function ke(e,t,n,i,r){function o(t){return!/\S/.test(e.getLine(t))}function s(e,t,n){return n?o(e)!=o(e+t):!o(e)&&o(e+t)}function a(t){i=i>0?1:-1;var n=e.ace.session.getFoldLine(t);n&&t+i>n.start.row&&t+i<n.end.row&&(i=(i>0?n.end.row:n.start.row)-t)}var l,c,u=t.line,d=e.firstLine(),h=e.lastLine(),f=u;if(i){for(;f>=d&&h>=f&&n>0;)a(f),s(f,i)&&n--,f+=i;return new Lt(f,0)}var p=e.state.vim;if(p.visualLine&&s(u,1,!0)){var g=p.sel.anchor;s(g.line,-1,!0)&&(r&&g.line==u||(u+=1))}var m=o(u);for(f=u;h>=f&&n;f++)s(f,1,!0)&&(r&&o(f)==m||n--);for(c=new Lt(f,0),f>h&&!m?m=!0:r=!1,f=u;f>d&&(r&&o(f)!=m&&f!=u||!s(f,-1,!0));f--);return l=new Lt(f,0),{start:l,end:c}}function Se(e,t,n,i){function r(e,t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){if(t.ln+=t.dir,!f(e,t.ln))return t.line=null,t.ln=null,void(t.pos=null);t.line=e.getLine(t.ln),t.pos=t.dir>0?0:t.line.length-1}else t.pos+=t.dir}function o(e,t,n,i){var o=e.getLine(t),s=""===o,a={line:o,ln:t,pos:n,dir:i},l={ln:a.ln,pos:a.pos},c=""===a.line;for(r(e,a);null!==a.line;){if(l.ln=a.ln,l.pos=a.pos,""===a.line&&!c)return{ln:a.ln,pos:a.pos};if(s&&""!==a.line&&!y(a.line[a.pos]))return{ln:a.ln,pos:a.pos};!w(a.line[a.pos])||s||a.pos!==a.line.length-1&&!y(a.line[a.pos+1])||(s=!0),r(e,a)}var o=e.getLine(l.ln);l.pos=0;for(var u=o.length-1;u>=0;--u)if(!y(o[u])){l.pos=u;break}return l}function s(e,t,n,i){var o=e.getLine(t),s={line:o,ln:t,pos:n,dir:i},a={ln:s.ln,pos:null},l=""===s.line;for(r(e,s);null!==s.line;){if(""===s.line&&!l)return null!==a.pos?a:{ln:s.ln,pos:s.pos};if(w(s.line[s.pos])&&null!==a.pos&&(s.ln!==a.ln||s.pos+1!==a.pos))return a;""===s.line||y(s.line[s.pos])||(l=!1,a={ln:s.ln,pos:s.pos}),r(e,s)}var o=e.getLine(a.ln);a.pos=0;for(var c=0;c<o.length;++c)if(!y(o[c])){a.pos=c;break}return a}for(var a={ln:t.line,pos:t.ch};n>0;)a=0>i?s(e,a.ln,a.pos,i):o(e,a.ln,a.pos,i),n--;return Lt(a.ln,a.pos)}function $e(e,t,n,i){var r,o,s=t,a={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n],l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[n],c=e.getLine(s.line).charAt(s.ch),u=c===l?1:0;if(r=e.scanForBracket(Lt(s.line,s.ch+u),-1,void 0,{bracketRegex:a}),o=e.scanForBracket(Lt(s.line,s.ch+u),1,void 0,{bracketRegex:a}),!r||!o)return{start:s,end:s};if(r=r.pos,o=o.pos,r.line==o.line&&r.ch>o.ch||r.line>o.line){var d=r;r=o,o=d}return i?o.ch+=1:r.ch+=1,{start:r,end:o}}function xe(e,t,n,i){var r,o,s,a,l=j(t),c=e.getLine(l.line),u=c.split(""),d=u.indexOf(n);if(l.ch<d?l.ch=d:d<l.ch&&u[l.ch]==n&&(o=l.ch,--l.ch),u[l.ch]!=n||o)for(s=l.ch;s>-1&&!r;s--)u[s]==n&&(r=s+1);else r=l.ch+1;if(r&&!o)for(s=r,a=u.length;a>s&&!o;s++)u[s]==n&&(o=s);return r&&o?(i&&(--r,++o),{start:Lt(l.line,r),end:Lt(l.line,o)}):{start:l,end:l}}function Ae(){}function Te(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new Ae)}function Ee(e,t,n,i,r){e.openDialog?e.openDialog(t,i,{bottom:!0,value:r.value,onKeyDown:r.onKeyDown,onKeyUp:r.onKeyUp,selectValueOnOpen:!1,onClose:function(){e.state.vim&&(e.state.vim.status="",e.ace.renderer.$loop.schedule(e.ace.renderer.CHANGE_CURSOR))}}):i(prompt(n,""))}function Me(e){return Le(e,"/")}function Re(e){return De(e,"/")}function Le(e,t){var n=De(e,t)||[];if(!n.length)return[];var i=[];if(0===n[0]){for(var r=0;r<n.length;r++)"number"==typeof n[r]&&i.push(e.substring(n[r]+1,n[r+1]));return i}}function De(e,t){t||(t="/");for(var n=!1,i=[],r=0;r<e.length;r++){var o=e.charAt(r);n||o!=t||i.push(r),n=!n&&"\\"==o}return i}function Fe(e){for(var t="|(){",n="}",i=!1,r=[],o=-1;o<e.length;o++){var s=e.charAt(o)||"",a=e.charAt(o+1)||"",l=a&&-1!=t.indexOf(a);i?("\\"===s&&l||r.push(s),i=!1):"\\"===s?(i=!0,a&&-1!=n.indexOf(a)&&(l=!0),l&&"\\"!==a||r.push(s)):(r.push(s),l&&"\\"!==a&&r.push("\\"))}return r.join("")}function Pe(e){for(var t=!1,n=[],i=-1;i<e.length;i++){var r=e.charAt(i)||"",o=e.charAt(i+1)||"";nn[r+o]?(n.push(nn[r+o]),i++):t?(n.push(r),t=!1):"\\"===r?(t=!0,m(o)||"$"===o?n.push("$"):"/"!==o&&"\\"!==o&&n.push("\\")):("$"===r&&n.push("$"),n.push(r),"/"===o&&n.push("\\"))}return n.join("")}function Ie(e){for(var t=new At.StringStream(e),n=[];!t.eol();){for(;t.peek()&&"\\"!=t.peek();)n.push(t.next());var i=!1;for(var r in rn)if(t.match(r,!0)){i=!0,n.push(rn[r]);break}i||n.push(t.next())}return n.join("")}function qe(e,t,n){var i=Gt.registerController.getRegister("/");if(i.setText(e),e instanceof RegExp)return e;var r,o,s=Re(e);if(s.length){r=e.substring(0,s[0]);var a=e.substring(s[0]);o=-1!=a.indexOf("i")}else r=e;if(!r)return null;k("pcre")||(r=Fe(r)),n&&(t=/^[^A-Z]*$/.test(r));var l=new RegExp(r,t||o?"i":void 0);return l}function Oe(e,t){e.openNotification?e.openNotification('<span style="color: red">'+t+"</span>",{bottom:!0,duration:5e3}):alert(t)}function Be(e,t){var n='<span style="font-family: monospace; white-space: pre">'+(e||"")+'<input type="text" autocorrect="off" autocapitalize="none" autocomplete="off"></span>';return t&&(n+=' <span style="color: #888">'+t+"</span>"),n}function He(e,t){var n=(t.prefix||"")+" "+(t.desc||""),i=Be(t.prefix,t.desc);Ee(e,i,n,t.onClose,t)}function Ne(e,t){if(e instanceof RegExp&&t instanceof RegExp){for(var n=["global","multiline","ignoreCase","source"],i=0;i<n.length;i++){var r=n[i];if(e[r]!==t[r])return!1}return!0}return!1}function ze(e,t,n,i){if(t){var r=Te(e),o=qe(t,!!n,!!i);if(o)return je(e,o),Ne(o,r.getQuery())?o:(r.setQuery(o),o)}}function Ue(e){if("^"==e.source.charAt(0))var t=!0;return{token:function(n){if(t&&!n.sol())return void n.skipToEnd();var i=n.match(e,!1);if(i)return 0==i[0].length?(n.next(),"searching"):n.sol()||(n.backUp(1),e.exec(n.next()+i[0]))?(n.match(e),"searching"):(n.next(),null);for(;!n.eol()&&(n.next(),!n.match(e,!1)););},query:e}}function je(e,t){var n=Te(e),i=n.getOverlay();i&&t==i.query||(i&&e.removeOverlay(i),i=Ue(t),e.addOverlay(i),e.showMatchesOnScrollbar&&(n.getScrollbarAnnotate()&&n.getScrollbarAnnotate().clear(),n.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),n.setOverlay(i))}function We(e,t,n,i){return void 0===i&&(i=1),e.operation(function(){for(var r=e.getCursor(),o=e.getSearchCursor(n,r),s=0;i>s;s++){var a=o.find(t);if(0==s&&a&&W(o.from(),r)&&(a=o.find(t)),!a&&(o=e.getSearchCursor(n,t?Lt(e.lastLine()):Lt(e.firstLine(),0)),!o.find(t)))return}return o.from()})}function Ve(e){var t=Te(e);e.removeOverlay(Te(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function Ge(e,t,n){return"number"!=typeof e&&(e=e.line),t instanceof Array?b(e,t):n?e>=t&&n>=e:e==t}function Ke(e){var t=e.ace.renderer;return{top:t.getFirstFullyVisibleRow(),bottom:t.getLastFullyVisibleRow()}}function Ye(e,t,n){var i=t.marks[n];return i&&i.find()}function Xe(e,t,n,i,r,o,s,a,l){function c(){e.operation(function(){for(;!p;)u(),d();h()})}function u(){var t=e.getRange(o.from(),o.to()),n=t.replace(s,a);o.replace(n)}function d(){for(;o.findNext()&&Ge(o.from(),i,r);)if(n||!g||o.from().line!=g.line)return e.scrollIntoView(o.from(),30),e.setSelection(o.from(),o.to()),g=o.from(),void(p=!1);p=!0}function h(t){if(t&&t(),e.focus(),g){e.setCursor(g);var n=e.state.vim;n.exMode=!1,n.lastHPos=n.lastHSPos=g.ch}l&&l()}function f(t,n,i){At.e_stop(t);var r=At.keyName(t);switch(r){case"Y":u(),d();break;case"N":d();break;case"A":var o=l;l=void 0,e.operation(c),l=o;break;case"L":u();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":h(i)}return p&&h(i),!0}e.state.vim.exMode=!0;var p=!1,g=o.from();return d(),p?void Oe(e,"No matches for "+s.source):t?void He(e,{prefix:"replace with <strong>"+a+"</strong> (y/n/a/q/l)",onKeyDown:f}):(c(),void(l&&l()))}function Je(e){var t=e.state.vim,n=Gt.macroModeState,i=Gt.registerController.getRegister("."),r=n.isPlaying,o=n.lastInsertModeChanges;r||(e.off("change",rt),At.off(e.getInputField(),"keydown",ct)),!r&&t.insertModeRepeat>1&&(ut(e,t,t.insertModeRepeat-1,!0),t.lastEditInputState.repeatOverride=t.insertModeRepeat),delete t.insertModeRepeat,t.insertMode=!1,e.setCursor(e.getCursor().line,e.getCursor().ch-1),e.setOption("keyMap","vim"),e.setOption("disableInput",!0),e.toggleOverwrite(!1),i.setText(o.changes.join("")),At.signal(e,"vim-mode-change",{mode:"normal"}),n.isRecording&&nt(n)}function Qe(e){Et.unshift(e)}function Ze(e,t,n,i,r){var o={keys:e,type:t};o[t]=n,o[t+"Args"]=i;for(var s in r)o[s]=r[s];Qe(o)}function et(e,t,n,i){var r=Gt.registerController.getRegister(i);if(":"==i)return r.keyBuffer[0]&&ln.processCommand(e,r.keyBuffer[0]),void(n.isPlaying=!1);var o=r.keyBuffer,s=0;n.isPlaying=!0,n.replaySearchQueries=r.searchQueries.slice(0);for(var a=0;a<o.length;a++)for(var l,c,u=o[a];u;)if(l=/<\w+-.+?>|<\w+>|./.exec(u),c=l[0],u=u.substring(l.index+c.length),At.Vim.handleKey(e,c,"macro"),t.insertMode){var d=r.insertModeChanges[s++].changes;Gt.macroModeState.lastInsertModeChanges.changes=d,dt(e,d,1),Je(e)}n.isPlaying=!1}function tt(e,t){if(!e.isPlaying){var n=e.latestRegister,i=Gt.registerController.getRegister(n);i&&i.pushText(t)}}function nt(e){if(!e.isPlaying){var t=e.latestRegister,n=Gt.registerController.getRegister(t);n&&n.pushInsertModeChanges&&n.pushInsertModeChanges(e.lastInsertModeChanges)}}function it(e,t){if(!e.isPlaying){var n=e.latestRegister,i=Gt.registerController.getRegister(n);i&&i.pushSearchQuery&&i.pushSearchQuery(t)}}function rt(e,t){var n=Gt.macroModeState,i=n.lastInsertModeChanges;if(!n.isPlaying)for(;t;){if(i.expectCursorActivityForChange=!0,i.ignoreCount>1)i.ignoreCount--;else if("+input"==t.origin||"paste"==t.origin||void 0===t.origin){var r=e.listSelections().length;r>1&&(i.ignoreCount=r);var o=t.text.join("\n");i.maybeReset&&(i.changes=[],i.maybeReset=!1),o&&(e.state.overwrite&&!/\n/.test(o)?i.changes.push([o]):i.changes.push(o))}t=t.next}}function ot(e){var t=e.state.vim;if(t.insertMode){var n=Gt.macroModeState;if(n.isPlaying)return;var i=n.lastInsertModeChanges;i.expectCursorActivityForChange?i.expectCursorActivityForChange=!1:i.maybeReset=!0}else e.curOp.isVimOp||at(e,t);t.visualMode&&st(e)}function st(e){var t=e.state.vim,n=q(e,j(t.sel.head)),i=B(n,0,1);t.fakeCursor&&t.fakeCursor.clear(),t.fakeCursor=e.markText(n,i,{className:"cm-animate-fat-cursor"})}function at(e,t,n){var i=e.getCursor("anchor"),r=e.getCursor("head");if(t.visualMode&&!e.somethingSelected()?ce(e,!1):t.visualMode||t.insertMode||!e.somethingSelected()||(t.visualMode=!0,t.visualLine=!1,At.signal(e,"vim-mode-change",{mode:"visual"})),t.visualMode){var o=V(r,i)?0:-1,s=V(r,i)?-1:0;r=B(r,0,o),i=B(i,0,s),t.sel={anchor:i,head:r},_e(e,t,"<",G(r,i)),_e(e,t,">",K(r,i))}else t.insertMode||n||(t.lastHPos=e.getCursor().ch)}function lt(e){this.keyName=e}function ct(e){function t(){return i.maybeReset&&(i.changes=[],i.maybeReset=!1),i.changes.push(new lt(r)),!0}var n=Gt.macroModeState,i=n.lastInsertModeChanges,r=At.keyName(e);r&&(-1!=r.indexOf("Delete")||-1!=r.indexOf("Backspace"))&&At.lookupKey(r,"vim-insert",t)}function ut(e,t,n,i){function r(){a?Xt.processAction(e,t,t.lastEditActionCommand):Xt.evalInput(e,t)}function o(n){if(s.lastInsertModeChanges.changes.length>0){n=t.lastEditActionCommand?n:1;var i=s.lastInsertModeChanges;dt(e,i.changes,n)}}var s=Gt.macroModeState;s.isPlaying=!0;var a=!!t.lastEditActionCommand,l=t.inputState;if(t.inputState=t.lastEditInputState,a&&t.lastEditActionCommand.interlaceInsertRepeat)for(var c=0;n>c;c++)r(),o(1);else i||r(),o(n);t.inputState=l,t.insertMode&&!i&&Je(e),s.isPlaying=!1}function dt(e,t,n){function i(t){return"string"==typeof t?At.commands[t](e):t(e),!0}var r=e.getCursor("head"),o=Gt.macroModeState.lastInsertModeChanges.visualBlock;o&&(te(e,r,o+1),n=e.listSelections().length,e.setCursor(r));for(var s=0;n>s;s++){o&&e.setCursor(B(r,s,0));for(var a=0;a<t.length;a++){var l=t[a];if(l instanceof lt)At.lookupKey(l.keyName,"vim-insert",i);else if("string"==typeof l){var c=e.getCursor();e.replaceRange(l,c,c)}else{var u=e.getCursor(),d=B(u,0,l[0].length);e.replaceRange(l[0],u,d)}}}o&&e.setCursor(B(r,0,1))}function ht(e,t,n){t.length>1&&"n"==t[0]&&(t=t.replace("numpad","")),t=cn[t]||t;var i="";return n.ctrlKey&&(i+="C-"),n.altKey&&(i+="A-"),(i||t.length>1)&&n.shiftKey&&(i+="S-"),i+=t,i.length>1&&(i="<"+i+">"),i}function ft(e){var t=new e.constructor;return Object.keys(e).forEach(function(n){var i=e[n];Array.isArray(i)?i=i.slice():i&&"object"==typeof i&&i.constructor!=Object&&(i=ft(i)),t[n]=i}),e.sel&&(t.sel={head:e.sel.head&&j(e.sel.head),anchor:e.sel.anchor&&j(e.sel.anchor)}),t}function pt(e,t,n){var i=!1,r=Dt.maybeInitVimState_(e),o=r.visualBlock||r.wasInVisualBlock,s=e.ace.inMultiSelectMode;if(r.wasInVisualBlock&&!s?r.wasInVisualBlock=!1:s&&r.visualBlock&&(r.wasInVisualBlock=!0),"<Esc>"!=t||r.insertMode||r.visualMode||!s)if(o||!s||e.ace.inVirtualSelectionMode)i=Dt.handleKey(e,t,n);else{var a=ft(r);e.operation(function(){e.ace.forEachSelection(function(){var r=e.ace.selection;e.state.vim.lastHPos=null==r.$desiredColumn?r.lead.column:r.$desiredColumn;var o=e.getCursor("head"),s=e.getCursor("anchor"),l=V(o,s)?0:-1,c=V(o,s)?-1:0;o=B(o,0,l),s=B(s,0,c),e.state.vim.sel.head=o,e.state.vim.sel.anchor=s,i=un(e,t,n),r.$desiredColumn=-1==e.state.vim.lastHPos?null:e.state.vim.lastHPos,e.virtualSelectionMode()&&(e.state.vim=ft(a))}),e.curOp.cursorActivity&&!i&&(e.curOp.cursorActivity=!1)},!0)}else e.ace.exitMultiSelectMode();return!i||r.visualMode||r.insert||r.visualMode==e.somethingSelected()||at(e,r,!0),i}function gt(e,t){t.off("beforeEndOperation",gt);var n=t.state.cm.vimCmd;n&&t.execCommand(n.exec?n:n.name,n.args),t.curOp=t.prevOp}var mt=e("../range").Range,vt=e("../lib/event_emitter").EventEmitter,yt=e("../lib/dom"),wt=e("../lib/oop"),bt=e("../lib/keys"),_t=e("../lib/event"),Ct=e("../search").Search,kt=e("../lib/useragent"),St=e("../search_highlight").SearchHighlight,$t=e("../commands/multi_select_commands"),xt=e("../mode/text").Mode.prototype.tokenRe;e("../multi_select");var At=function(e){this.ace=e,this.state={},this.marks={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};At.Pos=function(e,t){return this instanceof Lt?(this.line=e,void(this.ch=t)):new Lt(e,t)},At.defineOption=function(e,t,n){},At.commands={redo:function(e){e.ace.redo()},undo:function(e){e.ace.undo()},newlineAndIndent:function(e){e.ace.insert("\n")}},At.keyMap={},At.addClass=At.rmClass=function(){},At.e_stop=At.e_preventDefault=_t.stopEvent,At.keyName=function(e){var t=bt[e.keyCode]||e.key||"";return 1==t.length&&(t=t.toUpperCase()),t=_t.getModifierString(e).replace(/(^|-)\w/g,function(e){return e.toUpperCase()})+t},At.keyMap["default"]=function(e){return function(t){var n=t.ace.commands.commandKeyBinding[e.toLowerCase()];return n&&t.ace.execCommand(n)!==!1}},At.lookupKey=function hn(e,t,n){t||(t="default"),"string"==typeof t&&(t=At.keyMap[t]);var i="function"==typeof t?t(e):t[e];if(i===!1)return"nothing";if("..."===i)return"multi";if(null!=i&&n(i))return"handled";if(t.fallthrough){if(!Array.isArray(t.fallthrough))return hn(e,t.fallthrough,n);for(var r=0;r<t.fallthrough.length;r++){var o=hn(e,t.fallthrough[r],n);if(o)return o}}},At.signal=function(e,t,n){return e._signal(t,n)},At.on=_t.addListener,At.off=_t.removeListener,At.isWordChar=function(e){return"">e?/^\w$/.test(e):(xt.lastIndex=0,xt.test(e))},function(){wt.implement(At.prototype,vt),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(e){var t={text:"i"==e.action[0]?e.lines:[]},n=this.curOp=this.curOp||{};n.changeHandlers||(n.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice()),n.lastChange?n.lastChange.next=n.lastChange=t:n.lastChange=n.change=t,this.$updateMarkers(e)},this.onSelectionChange=function(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler($t.keyboardHandler)},this.operation=function(e,t){if(!t&&this.curOp||t&&this.curOp&&this.curOp.force)return e();if((t||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),!this.ace.curOp){var n=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var i=this.curOp=this.curOp||{};this.curOp.force=t;var r=e();return this.ace.curOp&&"vim"==this.ace.curOp.command.name&&(this.state.dialog&&(this.ace.curOp.command.scrollIntoView=!1),this.ace.endOperation(),i.cursorActivity||i.lastChange||!n||(this.ace.prevOp=n)),(t||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),r},this.onBeforeEndOperation=function(){var e=this.curOp;e&&(e.change&&this.signal("change",e.change,e),e&&e.cursorActivity&&this.signal("cursorActivity",null,e),this.curOp=null)},this.signal=function(e,t,n){var i=n?n[e+"Handlers"]:(this._eventRegistry||{})[e];if(i){i=i.slice();for(var r=0;r<i.length;r++)i[r](this,t)}},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(e,t){"object"==typeof e&&(t=e.ch,e=e.line),this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.session.unfold({row:e,column:t}),this.ace.selection.moveTo(e,t)},this.getCursor=function(e){var t=this.ace.selection,n="anchor"==e?t.isEmpty()?t.lead:t.anchor:"head"!=e&&e?t.getRange()[e]:t.lead;return r(n)},this.listSelections=function(e){var t=this.ace.multiSelect.rangeList.ranges;return!t.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:t.map(function(e){return{anchor:this.clipPos(r(e.cursor==e.end?e.start:e.end)),head:this.clipPos(r(e.cursor))}},this)},this.setSelections=function(e,t){var n=this.ace.multiSelect,r=e.map(function(e){var t=i(e.anchor),n=i(e.head),r=mt.comparePoints(t,n)<0?new mt.fromPoints(t,n):new mt.fromPoints(n,t);return r.cursor=mt.comparePoints(r.start,n)?r.end:r.start,r});if(this.ace.inVirtualSelectionMode)return void this.ace.selection.fromOrientedRange(r[0]);t?r[t]&&r.push(r.splice(t,1)[0]):r=r.reverse(),n.toSingleRange(r[0].clone());for(var o=this.ace.session,s=0;s<r.length;s++){var a=o.$clipRangeToDocument(r[s]);n.addRange(a)}},this.setSelection=function(e,t,n){var i=this.ace.selection;i.moveTo(e.line,e.ch),i.selectTo(t.line,t.ch),n&&"*mouse"==n.origin&&this.onBeforeEndOperation()},this.somethingSelected=function(e){return!this.ace.selection.isEmpty()},this.clipPos=function(e){var t=this.ace.session.$clipPositionToDocument(e.line,e.ch);return r(t)},this.markText=function(e){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(e){var t="insert"==e.action,n=e.start,i=e.end,r=(i.row-n.row)*(t?1:-1),o=(i.column-n.column)*(t?1:-1);t&&(i=n);for(var s in this.marks){var a=this.marks[s],l=mt.comparePoints(a,n);if(!(0>l)){if(0===l&&t){if(1!=a.bias){a.bias=-1;continue}l=1}var c=t?l:mt.comparePoints(a,i);c>0?(a.row+=r,a.column+=a.row==i.row?o:0):!t&&0>=c&&(a.row=n.row,a.column=n.column,0===c&&(a.bias=1))}}};var e=function(e,t,n,i){this.cm=e,this.id=t,this.row=n,this.column=i,e.marks[this.id]=this};e.prototype.clear=function(){delete this.cm.marks[this.id]},e.prototype.find=function(){return r(this)},this.setBookmark=function(t,n){var i=new e(this,this.$uid++,t.line,t.ch);return n&&n.insertLeft||(i.$insertRight=!0),this.marks[i.id]=i,i},this.moveH=function(e,t){if("char"==t){var n=this.ace.selection;n.clearSelection(),n.moveCursorBy(0,e)}},this.findPosV=function(e,t,n,i){if("page"==n){var o=this.ace.renderer,s=o.layerConfig;t*=Math.floor(s.height/s.lineHeight),n="line"}if("line"==n){var a=this.ace.session.documentToScreenPosition(e.line,e.ch);null!=i&&(a.column=i),a.row+=t,a.row=Math.min(Math.max(0,a.row),this.ace.session.getScreenLength()-1);var l=this.ace.session.screenToDocumentPosition(a.row,a.column);return r(l)}},this.charCoords=function(e,t){if("div"==t||!t){var n=this.ace.session.documentToScreenPosition(e.line,e.ch);return{left:n.column,top:n.row}}if("local"==t){var i=this.ace.renderer,n=this.ace.session.documentToScreenPosition(e.line,e.ch),r=i.layerConfig.lineHeight,o=i.layerConfig.characterWidth,s=r*n.row;return{left:n.column*o,top:s,bottom:s+r}}},this.coordsChar=function(e,t){var n=this.ace.renderer;if("local"==t){var i=Math.max(0,Math.floor(e.top/n.lineHeight)),o=Math.max(0,Math.floor(e.left/n.characterWidth)),s=n.session.screenToDocumentPosition(i,o);return r(s)}if("div"==t)throw"not implemented"},this.getSearchCursor=function(e,t,n){var i=!1,o=!1;e instanceof RegExp&&!e.global&&(i=!e.ignoreCase,e=e.source,o=!0);var s=new Ct;void 0==t.ch&&(t.ch=Number.MAX_VALUE);var a={row:t.line,column:t.ch},l=this,c=null;return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){s.setOptions({needle:e,caseSensitive:i,wrap:!1,backwards:t,regExp:o,start:c||a});var n=s.find(l.ace.session);return n&&n.isEmpty()&&l.getLine(n.start.row).length==n.start.column&&(s.$options.start=n,n=s.find(l.ace.session)),c=n},from:function(){return c&&r(c.start)},to:function(){return c&&r(c.end)},replace:function(e){c&&(c.end=l.ace.session.doc.replace(c,e))}}},this.scrollTo=function(e,t){var n=this.ace.renderer,i=n.layerConfig,r=i.maxHeight;r-=(n.$size.scrollerHeight-n.lineHeight)*n.$scrollPastEnd,null!=t&&this.ace.session.setScrollTop(Math.max(0,Math.min(t,r))),null!=e&&this.ace.session.setScrollLeft(Math.max(0,Math.min(e,i.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(e,t){if(e){var n=this.ace.renderer,r={top:0,bottom:t};n.scrollCursorIntoView(i(e),2*n.lineHeight/n.$size.scrollerHeight,r)}},this.getLine=function(e){return this.ace.session.getLine(e)},this.getRange=function(e,t){return this.ace.session.getTextRange(new mt(e.line,e.ch,t.line,t.ch))},this.replaceRange=function(e,t,n){return n||(n=t),this.ace.session.replace(new mt(t.line,t.ch,n.line,n.ch),e)},this.replaceSelections=function(e){var t=this.ace.selection;if(this.ace.inVirtualSelectionMode)return void this.ace.session.replace(t.getRange(),e[0]||"");t.inVirtualSelectionMode=!0;var n=t.rangeList.ranges;n.length||(n=[this.ace.multiSelect.getRange()]);for(var i=n.length;i--;)this.ace.session.replace(n[i],e[i]||"");t.inVirtualSelectionMode=!1},this.getSelection=function(){return this.ace.getSelectedText();
},this.getSelections=function(){return this.listSelections().map(function(e){return this.getRange(e.anchor,e.head)},this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.container};var t={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"};this.setOption=function(e,n){switch(this.state[e]=n,e){case"indentWithTabs":e=t[e],n=!n;break;case"keyMap":return void(this.state.$keyMap=n);default:e=t[e]}e&&this.ace.setOption(e,n)},this.getOption=function(e,n){var i=t[e];switch(i&&(n=this.ace.getOption(i)),e){case"indentWithTabs":return e=t[e],!n;case"keyMap":return this.state.$keyMap}return i?n:this.state[e]},this.toggleOverwrite=function(e){return this.state.overwrite=e,this.ace.setOverwrite(e)},this.addOverlay=function(e){if(!this.$searchHighlight||!this.$searchHighlight.session){var t=new St(null,"ace_highlight-marker","text"),n=this.ace.session.addDynamicMarker(t);t.id=n.id,t.session=this.ace.session,t.destroy=function(e){t.session.off("change",t.updateOnChange),t.session.off("changeEditor",t.destroy),t.session.removeMarker(t.id),t.session=null},t.updateOnChange=function(e){var n=e.start.row;n==e.end.row?t.cache[n]=void 0:t.cache.splice(n,t.cache.length)},t.session.on("changeEditor",t.destroy),t.session.on("change",t.updateOnChange)}var i=new RegExp(e.query.source,"gmi");this.$searchHighlight=e.highlight=t,this.$searchHighlight.setRegexp(i),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(e){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var e=this.ace.renderer,t=e.layerConfig;return{left:e.scrollLeft,top:e.scrollTop,height:t.maxHeight,width:t.width,clientHeight:t.height,clientWidth:t.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(e){return this.ace.setValue(e,-1)},this.getTokenTypeAt=function(e){var t=this.ace.session.getTokenAt(e.line,e.ch);return t&&/comment|string/.test(t.type)?"string":""},this.findMatchingBracket=function(e){var t=this.ace.session.findMatchingBracket(i(e));return{to:t&&r(t)}},this.indentLine=function(e,t){t===!0?this.ace.session.indentRows(e,e,"	"):t===!1&&this.ace.session.outdentRows(new mt(e,0,e,0))},this.indexFromPos=function(e){return this.ace.session.doc.positionToIndex(i(e))},this.posFromIndex=function(e){return r(this.ace.session.doc.indexToPosition(e))},this.focus=function(e){return this.ace.textInput.focus()},this.blur=function(e){return this.ace.blur()},this.defaultTextHeight=function(e){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(e,t,n,o){var s=o.bracketRegex.source,a=/paren|text|operator|tag/;if(1==t)var l=this.ace.session.$findClosingBracket(s.slice(1,2),i(e),a);else var l=this.ace.session.$findOpeningBracket(s.slice(-2,-1),{row:e.line,column:e.ch+1},a);return l&&{pos:r(l)}},this.refresh=function(){return this.ace.resize(!0)},this.getMode=function(){return{name:this.getOption("mode")}},this.execCommand=function(){}}.call(At.prototype);var Tt=At.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Tt.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else var n=t&&(e.test?e.test(t):e(t));return n?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(e,t,n){if("string"!=typeof e){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&t!==!1&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);return r(o)==r(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}},At.defineExtension=function(e,t){At.prototype[e]=t},yt.importCssString(".normal-mode .ace_cursor{    border: none;    background-color: rgba(255,0,0,0.5);}.normal-mode .ace_hidden-cursors .ace_cursor{  background-color: transparent;  border: 1px solid red;  opacity: 0.7}.ace_dialog {  position: absolute;  left: 0; right: 0;  background: inherit;  z-index: 15;  padding: .1em .8em;  overflow: hidden;  color: inherit;}.ace_dialog-top {  border-bottom: 1px solid #444;  top: 0;}.ace_dialog-bottom {  border-top: 1px solid #444;  bottom: 0;}.ace_dialog input {  border: none;  outline: none;  background: transparent;  width: 20em;  color: inherit;  font-family: monospace;}","vimMode"),function(){function e(e,t,n){var i,r=e.ace.container;return i=r.appendChild(document.createElement("div")),n?i.className="ace_dialog ace_dialog-bottom":i.className="ace_dialog ace_dialog-top","string"==typeof t?i.innerHTML=t:i.appendChild(t),i}function t(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}At.defineExtension("openDialog",function(n,i,r){function o(e){if("string"==typeof e)u.value=e;else{if(a)return;if(e&&"blur"==e.type&&document.activeElement===u)return;l.state.dialog=null,a=!0,s.parentNode.removeChild(s),l.focus(),r.onClose&&r.onClose(s)}}if(!this.virtualSelectionMode()){r||(r={}),t(this,null);var s=e(this,n,r.bottom),a=!1,l=this;this.state.dialog=s;var c,u=s.getElementsByTagName("input")[0];return u?(r.value&&(u.value=r.value,r.selectValueOnOpen!==!1&&u.select()),r.onInput&&At.on(u,"input",function(e){r.onInput(e,u.value,o)}),r.onKeyUp&&At.on(u,"keyup",function(e){r.onKeyUp(e,u.value,o)}),At.on(u,"keydown",function(e){r&&r.onKeyDown&&r.onKeyDown(e,u.value,o)||(13==e.keyCode&&i(u.value),(27==e.keyCode||r.closeOnEnter!==!1&&13==e.keyCode)&&(u.blur(),At.e_stop(e),o()))}),r.closeOnBlur!==!1&&At.on(u,"blur",o),u.focus()):(c=s.getElementsByTagName("button")[0])&&(At.on(c,"click",function(){o(),l.focus()}),r.closeOnBlur!==!1&&At.on(c,"blur",o),c.focus()),o}}),At.defineExtension("openNotification",function(n,i){function r(){a||(a=!0,clearTimeout(o),s.parentNode.removeChild(s))}if(!this.virtualSelectionMode()){t(this,r);var o,s=e(this,n,i&&i.bottom),a=!1,l=i&&"undefined"!=typeof i.duration?i.duration:5e3;return At.on(s,"click",function(e){At.e_preventDefault(e),r()}),l&&(o=setTimeout(r,l)),r}})}();var Et=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],Mt=Et.length,Rt=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],Lt=At.Pos,Dt=function(){return Yt};At.defineOption("vimMode",!1,function(e,t,n){t&&"vim"!=e.getOption("keyMap")?e.setOption("keyMap","vim"):!t&&n!=At.Init&&/^vim/.test(e.getOption("keyMap"))&&e.setOption("keyMap","default")});var Ft={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"},Pt={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"},It=/[\d]/,qt=[At.isWordChar,function(e){return e&&!At.isWordChar(e)&&!/\s/.test(e)}],Ot=[function(e){return/\S/.test(e)}],Bt=h(65,26),Ht=h(97,26),Nt=h(48,10),zt=[].concat(Bt,Ht,Nt,["<",">"]),Ut=[].concat(Bt,Ht,Nt,["-",'"',".",":","/"]),jt={};_("filetype",void 0,"string",["ft"],function(e,t){if(void 0!==t){if(void 0===e){var n=t.getOption("mode");return"null"==n?"":n}var n=""==e?"null":e;t.setOption("mode",n)}});var Wt=function(){function e(e,t,a){function l(t){var r=++i%n,o=s[r];o&&o.clear(),s[r]=e.setBookmark(t)}var c=i%n,u=s[c];if(u){var d=u.find();d&&!W(d,t)&&l(t)}else l(t);l(a),r=i,o=i-n+1,0>o&&(o=0)}function t(e,t){i+=t,i>r?i=r:o>i&&(i=o);var a=s[(n+i)%n];if(a&&!a.find()){var l,c=t>0?1:-1,u=e.getCursor();do if(i+=c,a=s[(n+i)%n],a&&(l=a.find())&&!W(u,l))break;while(r>i&&i>o)}return a}var n=100,i=-1,r=0,o=0,s=new Array(n);return{cachedCursor:void 0,add:e,move:t}},Vt=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};S.prototype={exitMacroRecordMode:function(){var e=Gt.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var n=Gt.registerController.getRegister(t);n&&(n.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog("(recording)["+t+"]",null,{bottom:!0})),this.isRecording=!0)}};var Gt,Kt,Yt={buildKeyMap:function(){},getRegisterController:function(){return Gt.registerController},resetVimGlobalState_:x,getVimGlobalState_:function(){return Gt},maybeInitVimState_:$,suppressErrorLogging:!1,InsertModeKey:lt,map:function(e,t,n){ln.map(e,t,n)},unmap:function(e,t){ln.unmap(e,t)},noremap:function(e,t,n){function i(e){return e?[e]:["normal","insert","visual"]}for(var r=i(n),o=Et.length,s=Mt,a=o-s;o>a&&r.length;a++){var l=Et[a];if(!(l.keys!=t||n&&l.context&&l.context!==n||"ex"===l.type.substr(0,2)||"key"===l.type.substr(0,3))){var c={};for(var u in l)c[u]=l[u];c.keys=e,n&&!c.context&&(c.context=n),this._mapCommand(c);var d=i(l.context);r=r.filter(function(e){return-1===d.indexOf(e)})}}},mapclear:function(e){var t=Et.length,n=Mt,i=Et.slice(0,t-n);if(Et=Et.slice(t-n),e)for(var r=i.length-1;r>=0;r--){var o=i[r];if(e!==o.context)if(o.context)this._mapCommand(o);else{var s=["normal","insert","visual"];for(var a in s)if(s[a]!==e){var l={};for(var c in o)l[c]=o[c];l.context=s[a],this._mapCommand(l)}}}},setOption:C,getOption:k,defineOption:_,defineEx:function(e,t,n){if(t){if(0!==e.indexOf(t))throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;an[e]=n,ln.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,n){var i=this.findKey(e,t,n);return"function"==typeof i?i():void 0},findKey:function(e,t,n){function i(){var i=Gt.macroModeState;if(i.isRecording){if("q"==t)return i.exitMacroRecordMode(),T(e),!0;"mapping"!=n&&tt(i,t)}}function r(){return"<Esc>"==t?(T(e),c.visualMode?ce(e):c.insertMode&&Je(e),!0):void 0}function o(n){for(var i;n;)i=/<\w+-.+?>|<\w+>|./.exec(n),t=i[0],n=n.substring(i.index+t.length),At.Vim.handleKey(e,t,"mapping")}function s(){if(r())return!0;for(var n=c.inputState.keyBuffer=c.inputState.keyBuffer+t,i=1==t.length,o=Xt.matchCommand(n,Et,c.inputState,"insert");n.length>1&&"full"!=o.type;){var n=c.inputState.keyBuffer=n.slice(1),s=Xt.matchCommand(n,Et,c.inputState,"insert");"none"!=s.type&&(o=s)}if("none"==o.type)return T(e),!1;if("partial"==o.type)return Kt&&window.clearTimeout(Kt),Kt=window.setTimeout(function(){c.insertMode&&c.inputState.keyBuffer&&T(e)},k("insertModeEscKeysTimeout")),!i;if(Kt&&window.clearTimeout(Kt),i){for(var a=e.listSelections(),l=0;l<a.length;l++){var u=a[l].head;e.replaceRange("",B(u,0,-(n.length-1)),u,"+input")}Gt.macroModeState.lastInsertModeChanges.changes.pop()}return T(e),o.command}function a(){if(i()||r())return!0;var n=c.inputState.keyBuffer=c.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(n))return!0;var o=/^(\d*)(.*)$/.exec(n);if(!o)return T(e),!1;var s=c.visualMode?"visual":"normal",a=Xt.matchCommand(o[2]||o[1],Et,c.inputState,s);if("none"==a.type)return T(e),!1;if("partial"==a.type)return!0;c.inputState.keyBuffer="";var o=/^(\d*)(.*)$/.exec(n);return o[1]&&"0"!=o[1]&&c.inputState.pushRepeatDigit(o[1]),a.command}var l,c=$(e);return l=c.insertMode?s():a(),l===!1?void 0:l===!0?function(){return!0}:function(){return(l.operator||l.isEdit)&&e.getOption("readOnly")?void 0:e.operation(function(){e.curOp.isVimOp=!0;try{"keyToKey"==l.type?o(l.toKeys):Xt.processCommand(e,c,l)}catch(t){throw e.state.vim=void 0,$(e),At.Vim.suppressErrorLogging||console.log(t),t}return!0})}},handleEx:function(e,t){ln.processCommand(e,t)},defineMotion:D,defineAction:I,defineOperator:P,mapCommand:Ze,_mapCommand:Qe,defineRegister:M,exitVisualMode:ce,exitInsertMode:Je};A.prototype.pushRepeatDigit=function(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)},A.prototype.getRepeat=function(){var e=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(e=1,this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))),e},E.prototype={setText:function(e,t,n){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!n},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(Vt(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},R.prototype={pushText:function(e,t,n,i,r){i&&"\n"!==n.charAt(n.length-1)&&(n+="\n");var o=this.isValidRegister(e)?this.getRegister(e):null;if(!o){switch(t){case"yank":this.registers[0]=new E(n,i,r);break;case"delete":case"change":-1==n.indexOf("\n")?this.registers["-"]=new E(n,i):(this.shiftNumericRegisters_(),this.registers[1]=new E(n,i))}return void this.unnamedRegister.setText(n,i,r)}var s=v(e);s?o.pushText(n,i):o.setText(n,i,r),this.unnamedRegister.setText(o.toString(),i)},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new E),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&b(e,Ut)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}},L.prototype={nextMatch:function(e,t){var n=this.historyBuffer,i=t?-1:1;null===this.initialPrefix&&(this.initialPrefix=e);for(var r=this.iterator+i;t?r>=0:r<n.length;r+=i)for(var o=n[r],s=0;s<=o.length;s++)if(this.initialPrefix==o.substring(0,s))return this.iterator=r,o;return r>=n.length?(this.iterator=n.length,this.initialPrefix):0>r?e:void 0},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Xt={matchCommand:function(e,t,n,i){var r=H(e,t,i,n);if(!r.full&&!r.partial)return{type:"none"};if(!r.full&&r.partial)return{type:"partial"};for(var o,s=0;s<r.full.length;s++){var a=r.full[s];o||(o=a)}if("<character>"==o.keys.slice(-11)){var l=z(e);if(/<C-.>/.test(l)||!l)return{type:"none"};n.selectedCharacter=l}return{type:"full",command:o}},processCommand:function(e,t,n){switch(t.inputState.repeatOverride=n.repeatOverride,n.type){case"motion":this.processMotion(e,t,n);break;case"operator":this.processOperator(e,t,n);break;case"operatorMotion":this.processOperatorMotion(e,t,n);break;case"action":this.processAction(e,t,n);break;case"search":this.processSearch(e,t,n);break;case"ex":case"keyToEx":this.processEx(e,t,n)}},processMotion:function(e,t,n){t.inputState.motion=n.motion,t.inputState.motionArgs=O(n.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,n){var i=t.inputState;if(i.operator){if(i.operator==n.operator)return i.motion="expandToLine",i.motionArgs={linewise:!0},void this.evalInput(e,t);T(e)}i.operator=n.operator,i.operatorArgs=O(n.operatorArgs),n.exitVisualBlock&&(t.visualBlock=!1,se(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,n){var i=t.visualMode,r=O(n.operatorMotionArgs);r&&i&&r.visualLine&&(t.visualLine=!0),this.processOperator(e,t,n),i||this.processMotion(e,t,n)},processAction:function(e,t,n){var i=t.inputState,r=i.getRepeat(),o=!!r,s=O(n.actionArgs)||{};i.selectedCharacter&&(s.selectedCharacter=i.selectedCharacter),n.operator&&this.processOperator(e,t,n),n.motion&&this.processMotion(e,t,n),(n.motion||n.operator)&&this.evalInput(e,t),s.repeat=r||1,s.repeatIsExplicit=o,s.registerName=i.registerName,T(e),t.lastMotion=null,n.isEdit&&this.recordLastEdit(t,i,n),Zt[n.action](e,s,t)},processSearch:function(e,t,n){function i(i,r,o){Gt.searchHistoryController.pushInput(i),Gt.searchHistoryController.reset();try{ze(e,i,r,o)}catch(s){return Oe(e,"Invalid regex: "+i),void T(e)}Xt.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:n.searchArgs.toJumplist}})}function r(e){i(e,!0,!0);var t=Gt.macroModeState;t.isRecording&&it(t,e)}function o(t,n,i){var r,o,s=At.keyName(t);"Up"==s||"Down"==s?(r="Up"==s?!0:!1,o=t.target?t.target.selectionEnd:0,n=Gt.searchHistoryController.nextMatch(n,r)||"",i(n),o&&t.target&&(t.target.selectionEnd=t.target.selectionStart=Math.min(o,t.target.value.length))):"Left"!=s&&"Right"!=s&&"Ctrl"!=s&&"Alt"!=s&&"Shift"!=s&&Gt.searchHistoryController.reset();var l;try{l=ze(e,n,!0,!0)}catch(t){}l?e.scrollIntoView(We(e,!a,l),30):(Ve(e),e.scrollTo(d.left,d.top))}function s(t,n,i){var r=At.keyName(t);"Esc"==r||"Ctrl-C"==r||"Ctrl-["==r||"Backspace"==r&&""==n?(Gt.searchHistoryController.pushInput(n),Gt.searchHistoryController.reset(),ze(e,u),Ve(e),e.scrollTo(d.left,d.top),At.e_stop(t),T(e),i(),e.focus()):"Up"==r||"Down"==r?At.e_stop(t):"Ctrl-U"==r&&(At.e_stop(t),i(""))}if(e.getSearchCursor){var a=n.searchArgs.forward,l=n.searchArgs.wholeWordOnly;Te(e).setReversed(!a);var c=a?"/":"?",u=Te(e).getQuery(),d=e.getScrollInfo();switch(n.searchArgs.querySrc){case"prompt":var h=Gt.macroModeState;if(h.isPlaying){var f=h.replaySearchQueries.shift();i(f,!0,!1)}else He(e,{onClose:r,prefix:c,desc:on,onKeyUp:o,onKeyDown:s});break;case"wordUnderCursor":var p=fe(e,!1,!0,!1,!0),g=!0;if(p||(p=fe(e,!1,!0,!1,!1),g=!1),!p)return;var f=e.getLine(p.start.line).substring(p.start.ch,p.end.ch);f=g&&l?"\\b"+f+"\\b":Q(f),Gt.jumpList.cachedCursor=e.getCursor(),e.setCursor(p.start),i(f,!0,!1)}}},processEx:function(e,t,n){function i(t){Gt.exCommandHistoryController.pushInput(t),Gt.exCommandHistoryController.reset(),ln.processCommand(e,t)}function r(t,n,i){var r,o,s=At.keyName(t);("Esc"==s||"Ctrl-C"==s||"Ctrl-["==s||"Backspace"==s&&""==n)&&(Gt.exCommandHistoryController.pushInput(n),Gt.exCommandHistoryController.reset(),At.e_stop(t),T(e),i(),e.focus()),"Up"==s||"Down"==s?(At.e_stop(t),r="Up"==s?!0:!1,o=t.target?t.target.selectionEnd:0,n=Gt.exCommandHistoryController.nextMatch(n,r)||"",i(n),o&&t.target&&(t.target.selectionEnd=t.target.selectionStart=Math.min(o,t.target.value.length))):"Ctrl-U"==s?(At.e_stop(t),i("")):"Left"!=s&&"Right"!=s&&"Ctrl"!=s&&"Alt"!=s&&"Shift"!=s&&Gt.exCommandHistoryController.reset()}"keyToEx"==n.type?ln.processCommand(e,n.exArgs.input):t.visualMode?He(e,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:r,selectValueOnOpen:!1}):He(e,{onClose:i,prefix:":",onKeyDown:r})},evalInput:function(e,t){var n,i,r,o=t.inputState,s=o.motion,a=o.motionArgs||{},l=o.operator,c=o.operatorArgs||{},u=o.registerName,d=t.sel,h=j(t.visualMode?q(e,d.head):e.getCursor("head")),f=j(t.visualMode?q(e,d.anchor):e.getCursor("anchor")),p=j(h),g=j(f);
if(l&&this.recordLastEdit(t,o),r=void 0!==o.repeatOverride?o.repeatOverride:o.getRepeat(),r>0&&a.explicitRepeat?a.repeatIsExplicit=!0:(a.noRepeat||!a.explicitRepeat&&0===r)&&(r=1,a.repeatIsExplicit=!1),o.selectedCharacter&&(a.selectedCharacter=c.selectedCharacter=o.selectedCharacter),a.repeat=r,T(e),s){var m=Jt[s](e,h,a,t);if(t.lastMotion=Jt[s],!m)return;if(a.toJumplist){l||null==e.ace.curOp||(e.ace.curOp.command.scrollIntoView="center-animate");var v=Gt.jumpList,y=v.cachedCursor;y?(pe(e,y,m),delete v.cachedCursor):pe(e,h,m)}m instanceof Array?(i=m[0],n=m[1]):n=m,n||(n=j(h)),t.visualMode?(t.visualBlock&&n.ch===1/0||(n=q(e,n,t.visualBlock)),i&&(i=q(e,i,!0)),i=i||g,d.anchor=i,d.head=n,se(e),_e(e,t,"<",V(i,n)?i:n),_e(e,t,">",V(i,n)?n:i)):l||(n=q(e,n),e.setCursor(n.line,n.ch))}if(l){if(c.lastSel){i=g;var w=c.lastSel,b=Math.abs(w.head.line-w.anchor.line),_=Math.abs(w.head.ch-w.anchor.ch);n=w.visualLine?Lt(g.line+b,g.ch):w.visualBlock?Lt(g.line+b,g.ch+_):w.head.line==w.anchor.line?Lt(g.line,g.ch+_):Lt(g.line+b,g.ch),t.visualMode=!0,t.visualLine=w.visualLine,t.visualBlock=w.visualBlock,d=t.sel={anchor:i,head:n},se(e)}else t.visualMode&&(c.lastSel={anchor:j(d.anchor),head:j(d.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var C,k,S,$,x;if(t.visualMode){if(C=G(d.head,d.anchor),k=K(d.head,d.anchor),S=t.visualLine||c.linewise,$=t.visualBlock?"block":S?"line":"char",x=ae(e,{anchor:C,head:k},$),S){var A=x.ranges;if("block"==$)for(var E=0;E<A.length;E++)A[E].head.ch=X(e,A[E].head.line);else"line"==$&&(A[0].head=Lt(A[0].head.line+1,0))}}else{if(C=j(i||g),k=j(n||p),V(k,C)){var M=C;C=k,k=M}S=a.linewise||c.linewise,S?de(e,C,k):a.forward&&ue(e,C,k),$="char";var R=!a.inclusive||S;x=ae(e,{anchor:C,head:k},$,R)}e.setSelections(x.ranges,x.primary),t.lastMotion=null,c.repeat=r,c.registerName=u,c.linewise=S;var L=Qt[l](e,c,x.ranges,g,n);t.visualMode&&ce(e,null!=L),L&&e.setCursor(L)}},recordLastEdit:function(e,t,n){var i=Gt.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=n,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1,i.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},Jt={moveToTopLine:function(e,t,n){var i=Ke(e).top+n.repeat-1;return Lt(i,he(e.getLine(i)))},moveToMiddleLine:function(e){var t=Ke(e),n=Math.floor(.5*(t.top+t.bottom));return Lt(n,he(e.getLine(n)))},moveToBottomLine:function(e,t,n){var i=Ke(e).bottom-n.repeat+1;return Lt(i,he(e.getLine(i)))},expandToLine:function(e,t,n){var i=t;return Lt(i.line+n.repeat-1,1/0)},findNext:function(e,t,n){var i=Te(e),r=i.getQuery();if(r){var o=!n.forward;return o=i.isReversed()?!o:o,je(e,r),We(e,o,r,n.repeat)}},goToMark:function(e,t,n,i){var r=Ye(e,i,n.selectedCharacter);return r?n.linewise?{line:r.line,ch:he(e.getLine(r.line))}:r:null},moveToOtherHighlightedEnd:function(e,t,n,i){if(i.visualBlock&&n.sameLine){var r=i.sel;return[q(e,Lt(r.anchor.line,r.head.ch)),q(e,Lt(r.head.line,r.anchor.ch))]}return[i.sel.head,i.sel.anchor]},jumpToMark:function(e,t,n,i){for(var r=t,o=0;o<n.repeat;o++){var s=r;for(var a in i.marks)if(p(a)){var l=i.marks[a].find(),c=n.forward?V(l,s):V(s,l);if(!(c||n.linewise&&l.line==s.line)){var u=W(s,r),d=n.forward?Y(s,l,r):Y(r,l,s);(u||d)&&(r=l)}}}return n.linewise&&(r=Lt(r.line,he(e.getLine(r.line)))),r},moveByCharacters:function(e,t,n){var i=t,r=n.repeat,o=n.forward?i.ch+r:i.ch-r;return Lt(i.line,o)},moveByLines:function(e,t,n,i){var r=t,o=r.ch;switch(i.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:o=i.lastHPos;break;default:i.lastHPos=o}var s=n.repeat+(n.repeatOffset||0),a=n.forward?r.line+s:r.line-s,l=e.firstLine(),c=e.lastLine();if(l>a&&r.line==l)return this.moveToStartOfLine(e,t,n,i);if(a>c&&r.line==c)return this.moveToEol(e,t,n,i,!0);var u=e.ace.session.getFoldLine(a);return u&&(n.forward?a>u.start.row&&(a=u.end.row+1):a=u.start.row),n.toFirstChar&&(o=he(e.getLine(a)),i.lastHPos=o),i.lastHSPos=e.charCoords(Lt(a,o),"div").left,Lt(a,o)},moveByDisplayLines:function(e,t,n,i){var r=t;switch(i.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:i.lastHSPos=e.charCoords(r,"div").left}var o=n.repeat,s=e.findPosV(r,n.forward?o:-o,"line",i.lastHSPos);if(s.hitSide)if(n.forward)var a=e.charCoords(s,"div"),l={top:a.top+8,left:i.lastHSPos},s=e.coordsChar(l,"div");else{var c=e.charCoords(Lt(e.firstLine(),0),"div");c.left=i.lastHSPos,s=e.coordsChar(c,"div")}return i.lastHPos=s.ch,s},moveByPage:function(e,t,n){var i=t,r=n.repeat;return e.findPosV(i,n.forward?r:-r,"page")},moveByParagraph:function(e,t,n){var i=n.forward?1:-1;return ke(e,t,n.repeat,i)},moveBySentence:function(e,t,n){var i=n.forward?1:-1;return Se(e,t,n.repeat,i)},moveByScroll:function(e,t,n,i){var r=e.getScrollInfo(),o=null,s=n.repeat;s||(s=r.clientHeight/(2*e.defaultTextHeight()));var a=e.charCoords(t,"local");n.repeat=s;var o=Jt.moveByDisplayLines(e,t,n,i);if(!o)return null;var l=e.charCoords(o,"local");return e.scrollTo(null,r.top+l.top-a.top),o},moveByWords:function(e,t,n){return ye(e,t,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(e,t,n){var i=n.repeat,r=we(e,i,n.forward,n.selectedCharacter),o=n.forward?-1:1;return ge(o,n),r?(r.ch+=o,r):null},moveToCharacter:function(e,t,n){var i=n.repeat;return ge(0,n),we(e,i,n.forward,n.selectedCharacter)||t},moveToSymbol:function(e,t,n){var i=n.repeat;return me(e,i,n.forward,n.selectedCharacter)||t},moveToColumn:function(e,t,n,i){var r=n.repeat;return i.lastHPos=r-1,i.lastHSPos=e.charCoords(t,"div").left,be(e,r)},moveToEol:function(e,t,n,i,r){var o=t,s=Lt(o.line+n.repeat-1,1/0),a=e.clipPos(s);return a.ch--,r||(i.lastHPos=1/0,i.lastHSPos=e.charCoords(a,"div").left),s},moveToFirstNonWhiteSpaceCharacter:function(e,t){var n=t;return Lt(n.line,he(e.getLine(n.line)))},moveToMatchedSymbol:function(e,t){for(var n,i=t,r=i.line,o=i.ch,s=e.getLine(r);o<s.length;o++)if(n=s.charAt(o),n&&g(n)){var a=e.getTokenTypeAt(Lt(r,o+1));if("string"!==a&&"comment"!==a)break}if(o<s.length){var l=/[<>]/.test(s[o])?/[(){}[\]<>]/:/[(){}[\]]/,c=e.findMatchingBracket(Lt(r,o+1),{bracketRegex:l});return c.to}return i},moveToStartOfLine:function(e,t){return Lt(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,n){var i=n.forward?e.lastLine():e.firstLine();return n.repeatIsExplicit&&(i=n.repeat-e.getOption("firstLineNumber")),Lt(i,he(e.getLine(i)))},textObjectManipulation:function(e,t,n,i){var r={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},o={"'":!0,'"':!0,"`":!0},s=n.selectedCharacter;"b"==s?s="(":"B"==s&&(s="{");var a,l=!n.textObjectInner;if(r[s])a=$e(e,t,s,l);else if(o[s])a=xe(e,t,s,l);else if("W"===s)a=fe(e,l,!0,!0);else if("w"===s)a=fe(e,l,!0,!1);else{if("p"!==s)return null;if(a=ke(e,t,n.repeat,0,l),n.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var c=i.inputState.operatorArgs;c&&(c.linewise=!0),a.end.line--}}return e.state.vim.visualMode?oe(e,a.start,a.end):[a.start,a.end]},repeatLastCharacterSearch:function(e,t,n){var i=Gt.lastCharacterSearch,r=n.repeat,o=n.forward===i.forward,s=(i.increment?1:0)*(o?-1:1);e.moveH(-s,"char"),n.inclusive=o?!0:!1;var a=we(e,r,o,i.selectedCharacter);return a?(a.ch+=s,a):(e.moveH(s,"char"),t)}},Qt={change:function(e,t,n){var i,r,o=e.state.vim,s=n[0].anchor,a=n[0].head;if(o.visualMode)if(t.fullLine)a.ch=Number.MAX_VALUE,a.line--,e.setSelection(s,a),r=e.getSelection(),e.replaceSelections(""),i=s;else{r=e.getSelection();var l=F("",n.length);e.replaceSelections(l),i=G(n[0].head,n[0].anchor)}else{r=e.getRange(s,a);var c=o.lastEditInputState||{};if("moveByWords"==c.motion&&!y(r)){var u=/\s+$/.exec(r);u&&c.motionArgs&&c.motionArgs.forward&&(a=B(a,0,-u[0].length),r=r.slice(0,-u[0].length))}var d=new Lt(s.line-1,Number.MAX_VALUE),h=e.firstLine()==e.lastLine();a.line>e.lastLine()&&t.linewise&&!h?e.replaceRange("",d,a):e.replaceRange("",s,a),t.linewise&&(h||(e.setCursor(d),At.commands.newlineAndIndent(e)),s.ch=Number.MAX_VALUE),i=s}Gt.registerController.pushText(t.registerName,"change",r,t.linewise,n.length>1),Zt.enterInsertMode(e,{head:i},e.state.vim)},"delete":function(e,t,n){var i,r,o=e.state.vim;if(o.visualBlock){r=e.getSelection();var s=F("",n.length);e.replaceSelections(s),i=n[0].anchor}else{var a=n[0].anchor,l=n[0].head;t.linewise&&l.line!=e.firstLine()&&a.line==e.lastLine()&&a.line==l.line-1&&(a.line==e.firstLine()?a.ch=0:a=Lt(a.line-1,X(e,a.line-1))),r=e.getRange(a,l),e.replaceRange("",a,l),i=a,t.linewise&&(i=Jt.moveToFirstNonWhiteSpaceCharacter(e,a))}Gt.registerController.pushText(t.registerName,"delete",r,t.linewise,o.visualBlock);var c=o.insertMode;return q(e,i,c)},indent:function(e,t,n){var i=e.state.vim,r=n[0].anchor.line,o=i.visualBlock?n[n.length-1].anchor.line:n[0].head.line,s=i.visualMode?t.repeat:1;t.linewise&&o--;for(var a=r;o>=a;a++)for(var l=0;s>l;l++)e.indentLine(a,t.indentRight);return Jt.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},indentAuto:function(e,t,n){return e.execCommand("indentAuto"),Jt.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},changeCase:function(e,t,n,i,r){for(var o=e.getSelections(),s=[],a=t.toLower,l=0;l<o.length;l++){var c=o[l],u="";if(a===!0)u=c.toLowerCase();else if(a===!1)u=c.toUpperCase();else for(var d=0;d<c.length;d++){var h=c.charAt(d);u+=v(h)?h.toLowerCase():h.toUpperCase()}s.push(u)}return e.replaceSelections(s),t.shouldMoveCursor?r:!e.state.vim.visualMode&&t.linewise&&n[0].anchor.line+1==n[0].head.line?Jt.moveToFirstNonWhiteSpaceCharacter(e,i):t.linewise?i:G(n[0].anchor,n[0].head)},yank:function(e,t,n,i){var r=e.state.vim,o=e.getSelection(),s=r.visualMode?G(r.sel.anchor,r.sel.head,n[0].head,n[0].anchor):i;return Gt.registerController.pushText(t.registerName,"yank",o,t.linewise,r.visualBlock),s}},Zt={jumpListWalk:function(e,t,n){if(!n.visualMode){var i=t.repeat,r=t.forward,o=Gt.jumpList,s=o.move(e,r?i:-i),a=s?s.find():void 0;a=a?a:e.getCursor(),e.setCursor(a),e.ace.curOp.command.scrollIntoView="center-animate"}},scroll:function(e,t,n){if(!n.visualMode){var i=t.repeat||1,r=e.defaultTextHeight(),o=e.getScrollInfo().top,s=r*i,a=t.forward?o+s:o-s,l=j(e.getCursor()),c=e.charCoords(l,"local");if(t.forward)a>c.top?(l.line+=(a-c.top)/r,l.line=Math.ceil(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,a);else{var u=a+e.getScrollInfo().clientHeight;u<c.bottom?(l.line-=(c.bottom-u)/r,l.line=Math.floor(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,a)}}},scrollToCursor:function(e,t){var n=e.getCursor().line,i=e.charCoords(Lt(n,0),"local"),r=e.getScrollInfo().clientHeight,o=i.top,s=i.bottom-o;switch(t.position){case"center":o=o-r/2+s;break;case"bottom":o=o-r+s}e.scrollTo(null,o)},replayMacro:function(e,t,n){var i=t.selectedCharacter,r=t.repeat,o=Gt.macroModeState;for("@"==i?i=o.latestRegister:o.latestRegister=i;r--;)et(e,n,o,i)},enterMacroRecordMode:function(e,t){var n=Gt.macroModeState,i=t.selectedCharacter;Gt.registerController.isValidRegister(i)&&n.enterMacroRecordMode(e,i)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),At.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),At.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,n){if(!e.getOption("readOnly")){n.insertMode=!0,n.insertModeRepeat=t&&t.repeat||1;var i=t?t.insertAt:null,r=n.sel,o=t.head||e.getCursor("head"),s=e.listSelections().length;if("eol"==i)o=Lt(o.line,X(e,o.line));else if("charAfter"==i)o=B(o,0,1);else if("firstNonBlank"==i)o=Jt.moveToFirstNonWhiteSpaceCharacter(e,o);else if("startOfSelectedArea"==i){if(!n.visualMode)return;n.visualBlock?(o=Lt(Math.min(r.head.line,r.anchor.line),Math.min(r.head.ch,r.anchor.ch)),s=Math.abs(r.head.line-r.anchor.line)+1):o=r.head.line<r.anchor.line?r.head:Lt(r.anchor.line,0)}else if("endOfSelectedArea"==i){if(!n.visualMode)return;n.visualBlock?(o=Lt(Math.min(r.head.line,r.anchor.line),Math.max(r.head.ch+1,r.anchor.ch)),s=Math.abs(r.head.line-r.anchor.line)+1):o=r.head.line>=r.anchor.line?B(r.head,0,1):Lt(r.anchor.line,0)}else if("inplace"==i&&n.visualMode)return;e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),At.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),At.signal(e,"vim-mode-change",{mode:"insert"})),Gt.macroModeState.isPlaying||(e.on("change",rt),At.on(e.getInputField(),"keydown",ct)),n.visualMode&&ce(e),te(e,o,s)}},toggleVisualMode:function(e,t,n){var i,r=t.repeat,o=e.getCursor();n.visualMode?n.visualLine^t.linewise||n.visualBlock^t.blockwise?(n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,At.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),se(e)):ce(e):(n.visualMode=!0,n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,i=q(e,Lt(o.line,o.ch+r-1),!0),n.sel={anchor:o,head:i},At.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),se(e),_e(e,n,"<",G(o,i)),_e(e,n,">",K(o,i)))},reselectLastSelection:function(e,t,n){var i=n.lastSelection;if(n.visualMode&&re(e,n),i){var r=i.anchorMark.find(),o=i.headMark.find();if(!r||!o)return;n.sel={anchor:r,head:o},n.visualMode=!0,n.visualLine=i.visualLine,n.visualBlock=i.visualBlock,se(e),_e(e,n,"<",G(r,o)),_e(e,n,">",K(r,o)),At.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(e,t,n){var i,r;if(n.visualMode){if(i=e.getCursor("anchor"),r=e.getCursor("head"),V(r,i)){var o=r;r=i,i=o}r.ch=X(e,r.line)-1}else{var s=Math.max(t.repeat,2);i=e.getCursor(),r=q(e,Lt(i.line+s-1,1/0))}for(var a=0,l=i.line;l<r.line;l++){a=X(e,i.line);var o=Lt(i.line+1,X(e,i.line+1)),c=e.getRange(i,o);c=c.replace(/\n\s*/g," "),e.replaceRange(c,i,o)}var u=Lt(i.line,a);n.visualMode&&ce(e,!1),e.setCursor(u)},newLineAndEnterInsertMode:function(e,t,n){n.insertMode=!0;var i=j(e.getCursor());if(i.line!==e.firstLine()||t.after){i.line=t.after?i.line:i.line-1,i.ch=X(e,i.line),e.setCursor(i);var r=At.commands.newlineAndIndentContinueComment||At.commands.newlineAndIndent;r(e)}else e.replaceRange("\n",Lt(e.firstLine(),0)),e.setCursor(e.firstLine(),0);this.enterInsertMode(e,{repeat:t.repeat},n)},paste:function(e,t,n){var i=j(e.getCursor()),r=Gt.registerController.getRegister(t.registerName),o=r.toString();if(o){if(t.matchIndent){var s=e.getOption("tabSize"),a=function(e){var t=e.split("	").length-1,n=e.split(" ").length-1;return t*s+1*n},l=e.getLine(e.getCursor().line),c=a(l.match(/^\s*/)[0]),u=o.replace(/\n$/,""),d=o!==u,h=a(o.match(/^\s*/)[0]),o=u.replace(/^\s*/gm,function(t){var n=c+(a(t)-h);if(0>n)return"";if(e.getOption("indentWithTabs")){var i=Math.floor(n/s);return Array(i+1).join("	")}return Array(n+1).join(" ")});o+=d?"\n":""}if(t.repeat>1)var o=Array(t.repeat+1).join(o);var f=r.linewise,p=r.blockwise;if(p){o=o.split("\n"),f&&o.pop();for(var g=0;g<o.length;g++)o[g]=""==o[g]?" ":o[g];i.ch+=t.after?1:0,i.ch=Math.min(X(e,i.line),i.ch)}else f?n.visualMode?o=n.visualLine?o.slice(0,-1):"\n"+o.slice(0,o.length-1)+"\n":t.after?(o="\n"+o.slice(0,o.length-1),i.ch=X(e,i.line)):i.ch=0:i.ch+=t.after?1:0;var m,v;if(n.visualMode){n.lastPastedText=o;var y,w=ie(e,n),b=w[0],_=w[1],C=e.getSelection(),k=e.listSelections(),S=new Array(k.length).join("1").split("1");n.lastSelection&&(y=n.lastSelection.headMark.find()),Gt.registerController.unnamedRegister.setText(C),p?(e.replaceSelections(S),_=Lt(b.line+o.length-1,b.ch),e.setCursor(b),ee(e,_),e.replaceSelections(o),m=b):n.visualBlock?(e.replaceSelections(S),e.setCursor(b),e.replaceRange(o,b,b),m=b):(e.replaceRange(o,b,_),m=e.posFromIndex(e.indexFromPos(b)+o.length-1)),y&&(n.lastSelection.headMark=e.setBookmark(y)),f&&(m.ch=0)}else if(p){e.setCursor(i);for(var g=0;g<o.length;g++){var $=i.line+g;$>e.lastLine()&&e.replaceRange("\n",Lt($,0));var x=X(e,$);x<i.ch&&Z(e,$,i.ch)}e.setCursor(i),ee(e,Lt(i.line+o.length-1,i.ch)),e.replaceSelections(o),m=i}else e.replaceRange(o,i),f&&t.after?m=Lt(i.line+1,he(e.getLine(i.line+1))):f&&!t.after?m=Lt(i.line,he(e.getLine(i.line))):!f&&t.after?(v=e.indexFromPos(i),m=e.posFromIndex(v+o.length-1)):(v=e.indexFromPos(i),m=e.posFromIndex(v+o.length));n.visualMode&&ce(e,!1),e.setCursor(m)}},undo:function(e,t){e.operation(function(){U(e,At.commands.undo,t.repeat)(),e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){U(e,At.commands.redo,t.repeat)()},setRegister:function(e,t,n){n.inputState.registerName=t.selectedCharacter},setMark:function(e,t,n){var i=t.selectedCharacter;_e(e,n,i,e.getCursor())},replace:function(e,t,n){var i,r,o=t.selectedCharacter,s=e.getCursor(),a=e.listSelections();if(n.visualMode)s=e.getCursor("start"),r=e.getCursor("end");else{var l=e.getLine(s.line);i=s.ch+t.repeat,i>l.length&&(i=l.length),r=Lt(s.line,i)}if("\n"==o)n.visualMode||e.replaceRange("",s,r),(At.commands.newlineAndIndentContinueComment||At.commands.newlineAndIndent)(e);else{var c=e.getRange(s,r);if(c=c.replace(/[^\n]/g,o),n.visualBlock){var u=new Array(e.getOption("tabSize")+1).join(" ");c=e.getSelection(),c=c.replace(/\t/g,u).replace(/[^\n]/g,o).split("\n"),e.replaceSelections(c)}else e.replaceRange(c,s,r);n.visualMode?(s=V(a[0].anchor,a[0].head)?a[0].anchor:a[0].head,e.setCursor(s),ce(e,!1)):e.setCursor(B(r,0,-1))}},incrementNumberToken:function(e,t){for(var n,i,r,o,s=e.getCursor(),a=e.getLine(s.line),l=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;null!==(n=l.exec(a))&&(i=n.index,r=i+n[0].length,!(s.ch<r)););if((t.backtrack||!(r<=s.ch))&&n){var c=n[2]||n[4],u=n[3]||n[5],d=t.increase?1:-1,h={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()],f=parseInt(n[1]+u,h)+d*t.repeat;o=f.toString(h);var p=c?new Array(u.length-o.length+1+n[1].length).join("0"):"";o="-"===o.charAt(0)?"-"+c+p+o.substr(1):c+p+o;var g=Lt(s.line,i),m=Lt(s.line,r);e.replaceRange(o,g,m),e.setCursor(Lt(s.line,i+o.length-1))}},repeatLastEdit:function(e,t,n){var i=n.lastEditInputState;if(i){var r=t.repeat;r&&t.repeatIsExplicit?n.lastEditInputState.repeatOverride=r:r=n.lastEditInputState.repeatOverride||r,ut(e,n,r,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:Je},en={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},tn={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return 0===e.index&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t="*"===e.lastCh&&"/"===e.nextCh;return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb="m"===e.symb?"{":"}",e.reverseSymb="{"===e.symb?"}":"{"},isComplete:function(e){return e.nextCh===e.symb?!0:!1}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if("#"===e.nextCh){var t=e.lineText.match(/#(\w+)/)[1];if("endif"===t){if(e.forward&&0===e.depth)return!0;e.depth++}else if("if"===t){if(!e.forward&&0===e.depth)return!0;e.depth--}if("else"===t&&0===e.depth)return!0}return!1}}};_("pcre",!0,"boolean"),Ae.prototype={getQuery:function(){return Gt.query},setQuery:function(e){Gt.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return Gt.isReversed},setReversed:function(e){Gt.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};var nn={"\\n":"\n","\\r":"\r","\\t":"	"},rn={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	"},on="(Javascript regexp)",sn=function(){this.buildCommandMap_()};sn.prototype={processCommand:function(e,t,n){var i=this;e.operation(function(){e.curOp.isVimOp=!0,i._processCommand(e,t,n)})},_processCommand:function(e,t,n){var i=e.state.vim,r=Gt.registerController.getRegister(":"),o=r.toString();i.visualMode&&ce(e);var s=new At.StringStream(t);r.setText(t);var a=n||{};a.input=t;try{this.parseInput_(e,s,a)}catch(l){throw Oe(e,l),l}var c,u;if(a.commandName){if(c=this.matchCommand_(a.commandName)){if(u=c.name,c.excludeFromCommandHistory&&r.setText(o),this.parseCommandArgs_(s,a,c),"exToKey"==c.type){for(var d=0;d<c.toKeys.length;d++)At.Vim.handleKey(e,c.toKeys[d],"mapping");return}if("exToEx"==c.type)return void this.processCommand(e,c.toInput)}}else void 0!==a.line&&(u="move");if(!u)return void Oe(e,'Not an editor command ":'+t+'"');try{an[u](e,a),c&&c.possiblyAsync||!a.callback||a.callback()}catch(l){throw Oe(e,l),l}},parseInput_:function(e,t,n){t.eatWhile(":"),t.eat("%")?(n.line=e.firstLine(),n.lineEnd=e.lastLine()):(n.line=this.parseLineSpec_(e,t),void 0!==n.line&&t.eat(",")&&(n.lineEnd=this.parseLineSpec_(e,t)));var i=t.match(/^(\w+)/);return i?n.commandName=i[1]:n.commandName=t.match(/.*/)[0],n},parseLineSpec_:function(e,t){var n=t.match(/^(\d+)/);if(n)return parseInt(n[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var i=t.next(),r=Ye(e,e.state.vim,i);if(!r)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,r.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:return void t.backUp(1)}},parseLineSpecOffset_:function(e,t){var n=e.match(/^([+-])?(\d+)/);if(n){var i=parseInt(n[2],10);"-"==n[1]?t-=i:t+=i}return t},parseCommandArgs_:function(e,t,n){if(!e.eol()){t.argString=e.match(/.*/)[0];var i=n.argDelimiter||/\s+/,r=J(t.argString).split(i);r.length&&r[0]&&(t.args=r)}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var n=e.substring(0,t);if(this.commandMap_[n]){var i=this.commandMap_[n];if(0===i.name.indexOf(e))return i}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<Rt.length;e++){var t=Rt[e],n=t.shortName||t.name;this.commandMap_[n]=t}},map:function(e,t,n){if(":"!=e&&":"==e.charAt(0)){if(n)throw Error("Mode not supported for ex mappings");var i=e.substring(1);":"!=t&&":"==t.charAt(0)?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else if(":"!=t&&":"==t.charAt(0)){var r={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};n&&(r.context=n),Et.unshift(r)}else{var r={keys:e,type:"keyToKey",toKeys:t};n&&(r.context=n),Et.unshift(r)}},unmap:function(e,t){if(":"!=e&&":"==e.charAt(0)){if(t)throw Error("Mode not supported for ex mappings");var n=e.substring(1);if(this.commandMap_[n]&&this.commandMap_[n].user)return void delete this.commandMap_[n]}else for(var i=e,r=0;r<Et.length;r++)if(i==Et[r].keys&&Et[r].context===t)return void Et.splice(r,1)}};var an={colorscheme:function(e,t){return!t.args||t.args.length<1?void Oe(e,e.getOption("theme")):void e.setOption("theme",t.args[0])},map:function(e,t,n){var i=t.args;return!i||i.length<2?void(e&&Oe(e,"Invalid mapping: "+t.input)):void ln.map(i[0],i[1],n)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,n){var i=t.args;return!i||i.length<1?void(e&&Oe(e,"No such mapping: "+t.input)):void ln.unmap(i[0],n)},move:function(e,t){Xt.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var n=t.args,i=t.setCfg||{};if(!n||n.length<1)return void(e&&Oe(e,"Invalid mapping: "+t.input));var r=n[0].split("="),o=r[0],s=r[1],a=!1;if("?"==o.charAt(o.length-1)){if(s)throw Error("Trailing characters: "+t.argString);o=o.substring(0,o.length-1),a=!0}void 0===s&&"no"==o.substring(0,2)&&(o=o.substring(2),s=!1);var l=jt[o]&&"boolean"==jt[o].type;if(l&&void 0==s&&(s=!0),!l&&void 0===s||a){var c=k(o,e,i);c instanceof Error?Oe(e,c.message):c===!0||c===!1?Oe(e," "+(c?"":"no")+o):Oe(e,"  "+o+"="+c)}else{var u=C(o,s,e,i);u instanceof Error&&Oe(e,u.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var n=t.args,i=Gt.registerController.registers,r="----------Registers----------<br><br>";if(n){var o;n=n.join("");for(var s=0;s<n.length;s++)if(o=n.charAt(s),Gt.registerController.isValidRegister(o)){var a=i[o]||new E;r+='"'+o+"    "+a.toString()+"<br>"}}else for(var o in i){var l=i[o].toString();l.length&&(r+='"'+o+"    "+l+"<br>")}Oe(e,r)},sort:function(e,t){function n(){if(t.argString){var e=new At.StringStream(t.argString);if(e.eat("!")&&(o=!0),e.eol())return;if(!e.eatSpace())return"Invalid arguments";var n=e.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!n&&!e.eol())return"Invalid arguments";if(n[1]){s=-1!=n[1].indexOf("i"),a=-1!=n[1].indexOf("u");var i=-1!=n[1].indexOf("d")||-1!=n[1].indexOf("n")&&1,r=-1!=n[1].indexOf("x")&&1,u=-1!=n[1].indexOf("o")&&1;if(i+r+u>1)return"Invalid arguments";l=i&&"decimal"||r&&"hex"||u&&"octal"}n[2]&&(c=new RegExp(n[2].substr(1,n[2].length-2),s?"i":""))}}function i(e,t){if(o){var n;n=e,e=t,t=n}s&&(e=e.toLowerCase(),t=t.toLowerCase());var i=l&&m.exec(e),r=l&&m.exec(t);return i?(i=parseInt((i[1]+i[2]).toLowerCase(),v),r=parseInt((r[1]+r[2]).toLowerCase(),v),i-r):t>e?-1:1}function r(e,t){if(o){var n;n=e,e=t,t=n}return s&&(e[0]=e[0].toLowerCase(),t[0]=t[0].toLowerCase()),e[0]<t[0]?-1:1}var o,s,a,l,c,u=n();if(u)return void Oe(e,u+": "+t.argString);var d=t.line||e.firstLine(),h=t.lineEnd||t.line||e.lastLine();if(d!=h){var f=Lt(d,0),p=Lt(h,X(e,h)),g=e.getRange(f,p).split("\n"),m=c?c:"decimal"==l?/(-?)([\d]+)/:"hex"==l?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==l?/([0-7]+)/:null,v="decimal"==l?10:"hex"==l?16:"octal"==l?8:null,y=[],w=[];if(l||c)for(var b=0;b<g.length;b++){var _=c?g[b].match(c):null;_&&""!=_[0]?y.push(_):!c&&m.exec(g[b])?y.push(g[b]):w.push(g[b])}else w=g;if(y.sort(c?r:i),c)for(var b=0;b<y.length;b++)y[b]=y[b].input;else l||w.sort(i);if(g=o?y.concat(w):w.concat(y),a){var C,k=g;g=[];for(var b=0;b<k.length;b++)k[b]!=C&&g.push(k[b]),C=k[b]}e.replaceRange(g.join("\n"),f,p)}},global:function(e,t){var n=t.argString;if(!n)return void Oe(e,"Regular Expression missing from global");var i,r=void 0!==t.line?t.line:e.firstLine(),o=t.lineEnd||t.line||e.lastLine(),s=Me(n),a=n;if(s.length&&(a=s[0],i=s.slice(1,s.length).join("/")),a)try{ze(e,a,!0,!0)}catch(l){return void Oe(e,"Invalid regex: "+a)}for(var c=Te(e).getQuery(),u=[],d="",h=r;o>=h;h++){var f=c.test(e.getLine(h));f&&(u.push(h+1),d+=e.getLine(h)+"<br>")}if(!i)return void Oe(e,d);var p=0,g=function(){if(p<u.length){var t=u[p]+i;ln.processCommand(e,t,{callback:g})}p++};g()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var n,i,r,o,s=t.argString,a=s?Le(s,s[0]):[],l="",c=!1,u=!1;if(a.length)n=a[0],l=a[1],n&&"$"===n[n.length-1]&&(n=n.slice(0,n.length-1)+"\\n",l=l?l+"\n":"\n"),void 0!==l&&(l=k("pcre")?Ie(l):Pe(l),Gt.lastSubstituteReplacePart=l),i=a[2]?a[2].split(" "):[];else if(s&&s.length)return void Oe(e,"Substitutions should be of the form :s/pattern/replace/");if(i&&(r=i[0],o=parseInt(i[1]),r&&(-1!=r.indexOf("c")&&(c=!0,r.replace("c","")),-1!=r.indexOf("g")&&(u=!0,r.replace("g","")),n=n.replace(/\//g,"\\/")+"/"+r)),n)try{ze(e,n,!0,!0)}catch(d){return void Oe(e,"Invalid regex: "+n)}if(l=l||Gt.lastSubstituteReplacePart,void 0===l)return void Oe(e,"No previous substitute regular expression");var h=Te(e),f=h.getQuery(),p=void 0!==t.line?t.line:e.getCursor().line,g=t.lineEnd||p;p==e.firstLine()&&g==e.lastLine()&&(g=1/0),o&&(p=g,g=p+o-1);var m=q(e,Lt(p,0)),v=e.getSearchCursor(f,m);Xe(e,c,u,p,g,v,f,l,t.callback)},redo:At.commands.redo,undo:At.commands.undo,write:function(e){At.commands.save?At.commands.save(e):e.save&&e.save()},nohlsearch:function(e){Ve(e)},yank:function(e){var t=j(e.getCursor()),n=t.line,i=e.getLine(n);Gt.registerController.pushText("0","yank",i,!0,!0)},delmarks:function(e,t){if(!t.argString||!J(t.argString))return void Oe(e,"Argument required");for(var n=e.state.vim,i=new At.StringStream(J(t.argString));!i.eol();){i.eatSpace();var r=i.pos;if(!i.match(/[a-zA-Z]/,!1))return void Oe(e,"Invalid argument: "+t.argString.substring(r));var o=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1))return void Oe(e,"Invalid argument: "+t.argString.substring(r));var s=o,a=i.next();if(!(p(s)&&p(a)||v(s)&&v(a)))return void Oe(e,"Invalid argument: "+s+"-");var l=s.charCodeAt(0),c=a.charCodeAt(0);if(l>=c)return void Oe(e,"Invalid argument: "+t.argString.substring(r));for(var u=0;c-l>=u;u++){var d=String.fromCharCode(l+u);delete n.marks[d]}}else delete n.marks[o]}}},ln=new sn;At.keyMap.vim={attach:l,detach:a,call:c},_("insertModeEscKeysTimeout",200,"number"),At.keyMap["vim-insert"]={fallthrough:["default"],attach:l,detach:a,call:c},At.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:l,detach:a,call:c},x(),At.Vim=Dt(),Dt=At.Vim;var cn={"return":"CR",backspace:"BS","delete":"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"},un=Dt.handleKey.bind(Dt);Dt.handleKey=function(e,t,n){return e.operation(function(){return un(e,t,n)},!0)},t.CodeMirror=At;var dn=Dt.maybeInitVimState_;t.handler={$id:"ace/keyboard/vim",drawCursor:function(e,t,n,i,r){var o=this.state.vim||{},s=n.characterWidth,a=n.lineHeight,l=t.top,c=t.left;if(!o.insertMode){var u=i.cursor?mt.comparePoints(i.cursor,i.start)<=0:r.selection.isBackwards()||r.selection.isEmpty();!u&&c>s&&(c-=s)}!o.insertMode&&o.status&&(a/=2,l+=a),yt.translate(e,c,l),yt.setStyle(e.style,"width",s+"px"),yt.setStyle(e.style,"height",a+"px")},handleKeyboard:function(e,t,n,i,r){var o=e.editor,s=o.state.cm,a=dn(s);if(-1!=i){if(a.insertMode||(-1==t?(n.charCodeAt(0)>255&&e.inputKey&&(n=e.inputKey,n&&4==e.inputHash&&(n=n.toUpperCase())),e.inputChar=n):4==t||0==t?e.inputKey==n&&e.inputHash==t&&e.inputChar?(n=e.inputChar,t=-1):(e.inputChar=null,e.inputKey=n,e.inputHash=t):e.inputChar=e.inputKey=null),"c"==n&&1==t&&!kt.isMac&&o.getCopyText())return o.once("copy",function(){o.selection.clearSelection()}),{command:"null",passEvent:!0};if("esc"==n&&!a.insertMode&&!a.visualMode&&!s.ace.inMultiSelectMode){var l=Te(s),c=l.getOverlay();c&&s.removeOverlay(c)}if(-1==t||1&t||0===t&&n.length>1){var u=a.insertMode,d=ht(t,n,r||{});null==a.status&&(a.status="");var h=pt(s,d,"user");if(a=dn(s),h&&null!=a.status?a.status+=d:null==a.status&&(a.status=""),s._signal("changeStatus"),!h&&(-1!=t||u))return;return{command:"null",passEvent:!h}}}},attach:function(e){function t(){var t=dn(n).insertMode;n.ace.renderer.setStyle("normal-mode",!t),e.textInput.setCommandMode(!t),e.renderer.$keepTextAreaAtCursor=t,e.renderer.$blockCursor=!t}e.state||(e.state={});var n=new At(e);e.state.cm=n,e.$vimModeHandler=this,At.keyMap.vim.attach(n),dn(n).status=null,n.on("vim-command-done",function(){n.virtualSelectionMode()||(dn(n).status=null,n.ace._signal("changeStatus"),n.ace.session.markUndoGroup())}),n.on("changeStatus",function(){n.ace.renderer.updateCursor(),n.ace._signal("changeStatus")}),n.on("vim-mode-change",function(){n.virtualSelectionMode()||(t(),n._signal("changeStatus"))}),t(),e.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(n)},detach:function(e){var t=e.state.cm;At.keyMap.vim.detach(t),t.destroy(),e.state.cm=null,e.$vimModeHandler=null,e.renderer.$cursorLayer.drawCursor=null,e.renderer.setStyle("normal-mode",!1),e.textInput.setCommandMode(!1),e.renderer.$keepTextAreaAtCursor=!0},getStatusText:function(e){var t=e.state.cm,n=dn(t);if(n.insertMode)return"INSERT";var i="";return n.visualMode&&(i+="VISUAL",n.visualLine&&(i+=" LINE"),n.visualBlock&&(i+=" BLOCK")),n.status&&(i+=(i?" ":"")+n.status),i}},Dt.defineOption({name:"wrap",set:function(e,t){
t&&t.ace.setOption("wrap",e)},type:"boolean"},!1),Dt.defineEx("write","w",function(){console.log(":write is not implemented")}),Et.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),Zt.aceCommand=function(e,t,n){e.vimCmd=t,e.ace.inVirtualSelectionMode?e.ace.on("beforeEndOperation",gt):gt(null,e.ace)},Zt.fold=function(e,t,n){e.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(t.all?2:0)+(t.open?1:0)])},t.handler.defaultKeymap=Et,t.handler.actions=Zt,t.Vim=Dt}),function(){ace.require(["ace/keyboard/vim"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)})}(),define("ace/keybinding-vim",function(){}),define("ide/editor/directives/aceEditor/undo/UndoManager",["ace/ace"],function(){var e=ace.require("ace/undomanager").UndoManager,t=function(){function t(e){_classCallCheck(this,t),this.editor=e,this.onChangeSession=this.onChangeSession.bind(this),this.onChange=this.onChange.bind(this)}return _createClass(t,[{key:"onChangeSession",value:function(t){t.setUndoManager(new e)}},{key:"onChange",value:function(e){var t=this;e.remote&&setTimeout(function(){t.editor.getSession().getUndoManager().reset()})}}]),t}();return t}),define("ide/editor/directives/aceEditor/auto-complete/snippets/TopHundredSnippets",[],function(){return[{caption:"\\begin{}",snippet:"\\begin{$1}",meta:"env",score:7.849662248028187},{caption:"\\begin{}[]",snippet:"\\begin{$1}[$2]",meta:"env",score:7.849662248028187},{caption:"\\begin{}{}",snippet:"\\begin{$1}{$2}",meta:"env",score:7.849662248028187},{caption:"\\end{}",snippet:"\\end{$1}",meta:"env",score:7.847906405228455},{caption:"\\usepackage[]{}",snippet:"\\usepackage[$1]{$2}",meta:"pkg",score:5.427890758130527},{caption:"\\item",snippet:"\\item",meta:"cmd",score:3.800886892251021},{caption:"\\item[]",snippet:"\\item[$1]",meta:"cmd",score:3.800886892251021},{caption:"\\section{}",snippet:"\\section{$1}",meta:"cmd",score:3.0952612541683835},{caption:"\\textbf{}",snippet:"\\textbf{$1}",meta:"cmd",score:2.627755982816738},{caption:"\\cite{}",snippet:"\\cite{$1}",meta:"cmd",score:2.341195220791228},{caption:"\\label{}",snippet:"\\label{$1}",meta:"cmd",score:1.897791904799601},{caption:"\\textit{}",snippet:"\\textit{$1}",meta:"cmd",score:1.6842996195493385},{caption:"\\includegraphics[]{}",snippet:"\\includegraphics[$1]{$2}",meta:"cmd",score:1.4595731795525781},{caption:"\\documentclass[]{}",snippet:"\\documentclass[$1]{$2}",meta:"cmd",score:1.4425339817971206},{caption:"\\documentclass{}",snippet:"\\documentclass{$1}",meta:"cmd",score:1.4425339817971206},{caption:"\\ref{}",snippet:"\\ref{$1}",meta:"cross-reference",score:.014379554883991673},{caption:"\\frac{}{}",snippet:"\\frac{$1}{$2}",meta:"cmd",score:1.4341091141105058},{caption:"\\subsection{}",snippet:"\\subsection{$1}",meta:"cmd",score:1.3890912739512353},{caption:"\\hline",snippet:"\\hline",meta:"cmd",score:1.3209538327406387},{caption:"\\caption{}",snippet:"\\caption{$1}",meta:"cmd",score:1.2569477427490174},{caption:"\\centering",snippet:"\\centering",meta:"cmd",score:1.1642881814937829},{caption:"\\vspace{}",snippet:"\\vspace{$1}",meta:"cmd",score:.9533807826673939},{caption:"\\title{}",snippet:"\\title{$1}",meta:"cmd",score:.9202908262245683},{caption:"\\author{}",snippet:"\\author{$1}",meta:"cmd",score:.8973590434087177},{caption:"\\author[]{}",snippet:"\\author[$1]{$2}",meta:"cmd",score:.8973590434087177},{caption:"\\maketitle",snippet:"\\maketitle",meta:"cmd",score:.7504160124360846},{caption:"\\textwidth",snippet:"\\textwidth",meta:"cmd",score:.7355328080889112},{caption:"\\newcommand{}{}",snippet:"\\newcommand{$1}{$2}",meta:"cmd",score:.7264891987129375},{caption:"\\newcommand{}[]{}",snippet:"\\newcommand{$1}[$2]{$3}",meta:"cmd",score:.7264891987129375},{caption:"\\date{}",snippet:"\\date{$1}",meta:"cmd",score:.7225518453076786},{caption:"\\emph{}",snippet:"\\emph{$1}",meta:"cmd",score:.7060308784832261},{caption:"\\textsc{}",snippet:"\\textsc{$1}",meta:"cmd",score:.6926466355384758},{caption:"\\multicolumn{}{}{}",snippet:"\\multicolumn{$1}{$2}{$3}",meta:"cmd",score:.5473606021405326},{caption:"\\input{}",snippet:"\\input{$1}",meta:"cmd",score:.4966021927742672},{caption:"\\alpha",snippet:"\\alpha",meta:"cmd",score:.49520006391384913},{caption:"\\in",snippet:"\\in",meta:"cmd",score:.4716039670146658},{caption:"\\mathbf{}",snippet:"\\mathbf{$1}",meta:"cmd",score:.4682018419466319},{caption:"\\right",snippet:"\\right",meta:"cmd",score:.4299239459457309},{caption:"\\left",snippet:"\\left",meta:"cmd",score:.42937815279867964},{caption:"\\left[]",snippet:"\\left[$1]",meta:"cmd",score:.42937815279867964},{caption:"\\sum",snippet:"\\sum",meta:"cmd",score:.42607994509619934},{caption:"\\noindent",snippet:"\\noindent",meta:"cmd",score:.42355747798114207},{caption:"\\chapter{}",snippet:"\\chapter{$1}",meta:"cmd",score:.422097569591803},{caption:"\\par",snippet:"\\par",meta:"cmd",score:.413853376001159},{caption:"\\lambda",snippet:"\\lambda",meta:"cmd",score:.39389600578684125},{caption:"\\subsubsection{}",snippet:"\\subsubsection{$1}",meta:"cmd",score:.3727781330132016},{caption:"\\bibitem{}",snippet:"\\bibitem{$1}",meta:"cmd",score:.3689547570562042},{caption:"\\bibitem[]{}",snippet:"\\bibitem[$1]{$2}",meta:"cmd",score:.3689547570562042},{caption:"\\text{}",snippet:"\\text{$1}",meta:"cmd",score:.3608680734736821},{caption:"\\setlength{}{}",snippet:"\\setlength{$1}{$2}",meta:"cmd",score:.354445763583904},{caption:"\\setlength",snippet:"\\setlength",meta:"cmd",score:.354445763583904},{caption:"\\mathcal{}",snippet:"\\mathcal{$1}",meta:"cmd",score:.35084018920966636},{caption:"\\newline",snippet:"\\newline",meta:"cmd",score:.3311721696201715},{caption:"\\newpage",snippet:"\\newpage",meta:"cmd",score:.3277033727934986},{caption:"\\renewcommand{}{}",snippet:"\\renewcommand{$1}{$2}",meta:"cmd",score:.3267437011085663},{caption:"\\renewcommand",snippet:"\\renewcommand",meta:"cmd",score:.3267437011085663},{caption:"\\theta",snippet:"\\theta",meta:"cmd",score:.3210417159232142},{caption:"\\hspace{}",snippet:"\\hspace{$1}",meta:"cmd",score:.3147206476372336},{caption:"\\beta",snippet:"\\beta",meta:"cmd",score:.3061799530337638},{caption:"\\texttt{}",snippet:"\\texttt{$1}",meta:"cmd",score:.3019066753744355},{caption:"\\times",snippet:"\\times",meta:"cmd",score:.2957960629411553},{caption:"\\citep{}",snippet:"\\citep{$1}",meta:"cmd",score:.2941882834697057},{caption:"\\color[]{}",snippet:"\\color[$1]{$2}",meta:"cmd",score:.2864294797053033},{caption:"\\color{}",snippet:"\\color{$1}",meta:"cmd",score:.2864294797053033},{caption:"\\mu",snippet:"\\mu",meta:"cmd",score:.27635652476799255},{caption:"\\bibliography{}",snippet:"\\bibliography{$1}",meta:"cmd",score:.2659628337907604},{caption:"\\linewidth",snippet:"\\linewidth",meta:"cmd",score:.2639498312518439},{caption:"\\delta",snippet:"\\delta",meta:"cmd",score:.2620578600722735},{caption:"\\sigma",snippet:"\\sigma",meta:"cmd",score:.25940147926344487},{caption:"\\pi",snippet:"\\pi",meta:"cmd",score:.25920934567729714},{caption:"\\hat{}",snippet:"\\hat{$1}",meta:"cmd",score:.25264309033778715},{caption:"\\hat",snippet:"\\hat",meta:"cmd",score:.25264309033778715},{caption:"\\bibliographystyle{}",snippet:"\\bibliographystyle{$1}",meta:"cmd",score:.25122317941387773},{caption:"\\small",snippet:"\\small",meta:"cmd",score:.2447632045426295},{caption:"\\small{}",snippet:"\\small{$1}",meta:"cmd",score:.2447632045426295},{caption:"\\LaTeX",snippet:"\\LaTeX",meta:"cmd",score:.2334089308452787},{caption:"\\LaTeX{}",snippet:"\\LaTeX{$1}",meta:"cmd",score:.2334089308452787},{caption:"\\cdot",snippet:"\\cdot",meta:"cmd",score:.23029085545522762},{caption:"\\footnote{}",snippet:"\\footnote{$1}",meta:"cmd",score:.2253056071787701},{caption:"\\newtheorem{}[]{}",snippet:"\\newtheorem{$1}[$2]{$3}",meta:"cmd",score:.215689795055434},{caption:"\\newtheorem{}{}",snippet:"\\newtheorem{$1}{$2}",meta:"cmd",score:.215689795055434},{caption:"\\newtheorem{}{}[]",snippet:"\\newtheorem{$1}{$2}[$3]",meta:"cmd",score:.215689795055434},{caption:"\\Delta",snippet:"\\Delta",meta:"cmd",score:.21386475063892618},{caption:"\\tau",snippet:"\\tau",meta:"cmd",score:.21236188205859796},{caption:"\\hfill",snippet:"\\hfill",meta:"cmd",score:.2058248088519886},{caption:"\\leq",snippet:"\\leq",meta:"cmd",score:.20498894440637172},{caption:"\\footnotesize",snippet:"\\footnotesize",meta:"cmd",score:.2038592081252624},{caption:"\\footnotesize{}",snippet:"\\footnotesize{$1}",meta:"cmd",score:.2038592081252624},{caption:"\\large",snippet:"\\large",meta:"cmd",score:.20377416734108866},{caption:"\\large{}",snippet:"\\large{$1}",meta:"cmd",score:.20377416734108866},{caption:"\\sqrt{}",snippet:"\\sqrt{$1}",meta:"cmd",score:.20240160977404634},{caption:"\\epsilon",snippet:"\\epsilon",meta:"cmd",score:.2005136761359043},{caption:"\\Large",snippet:"\\Large",meta:"cmd",score:.1987771081149759},{caption:"\\Large{}",snippet:"\\Large{$1}",meta:"cmd",score:.1987771081149759},{caption:"\\cvitem{}{}",snippet:"\\cvitem{$1}{$2}",meta:"cmd",score:.19605476980016281},{caption:"\\rho",snippet:"\\rho",meta:"cmd",score:.1959287380541684},{caption:"\\omega",snippet:"\\omega",meta:"cmd",score:.19326783415115262},{caption:"\\mathrm{}",snippet:"\\mathrm{$1}",meta:"cmd",score:.19117752976172653},{caption:"\\boldsymbol{}",snippet:"\\boldsymbol{$1}",meta:"cmd",score:.18137737738638837},{caption:"\\boldsymbol",snippet:"\\boldsymbol",meta:"cmd",score:.18137737738638837},{caption:"\\gamma",snippet:"\\gamma",meta:"cmd",score:.17940276535431304},{caption:"\\clearpage",snippet:"\\clearpage",meta:"cmd",score:.1789117552185788},{caption:"\\infty",snippet:"\\infty",meta:"cmd",score:.17837290019711305},{caption:"\\phi",snippet:"\\phi",meta:"cmd",score:.17405809173097808},{caption:"\\partial",snippet:"\\partial",meta:"cmd",score:.17168102367966637},{caption:"\\include{}",snippet:"\\include{$1}",meta:"cmd",score:.1547080054979312},{caption:"\\address{}",snippet:"\\address{$1}",meta:"cmd",score:.1525055392611109},{caption:"\\address[]{}",snippet:"\\address[$1]{$2}",meta:"cmd",score:.1525055392611109},{caption:"\\address{}{}{}",snippet:"\\address{$1}{$2}{$3}",meta:"cmd",score:.1525055392611109},{caption:"\\quad",snippet:"\\quad",meta:"cmd",score:.15242755832392743},{caption:"\\email{}",snippet:"\\email{$1}",meta:"cmd",score:.1522294670109857},{caption:"\\paragraph{}",snippet:"\\paragraph{$1}",meta:"cmd",score:.152074250347974},{caption:"\\varepsilon",snippet:"\\varepsilon",meta:"cmd",score:.05411564201390573},{caption:"\\zeta",snippet:"\\zeta",meta:"cmd",score:.023330249803752954},{caption:"\\eta",snippet:"\\eta",meta:"cmd",score:.11088718379889091},{caption:"\\vartheta",snippet:"\\vartheta",meta:"cmd",score:.0025822992078068712},{caption:"\\iota",snippet:"\\iota",meta:"cmd",score:.0024774003791525486},{caption:"\\kappa",snippet:"\\kappa",meta:"cmd",score:.04887876299369008},{caption:"\\nu",snippet:"\\nu",meta:"cmd",score:.09206962821059342},{caption:"\\xi",snippet:"\\xi",meta:"cmd",score:.06496042899265699},{caption:"\\varpi",snippet:"\\varpi",meta:"cmd",score:.0007039358167790341},{caption:"\\varrho",snippet:"\\varrho",meta:"cmd",score:.0011279491613898612},{caption:"\\varsigma",snippet:"\\varsigma",meta:"cmd",score:.0010424880711234978},{caption:"\\varsigma{}",snippet:"\\varsigma{$1}",meta:"cmd",score:.0010424880711234978},{caption:"\\upsilon",snippet:"\\upsilon",meta:"cmd",score:.00420715572598688},{caption:"\\varphi",snippet:"\\varphi",meta:"cmd",score:.03351251516668212},{caption:"\\chi",snippet:"\\chi",meta:"cmd",score:.043373492287805675},{caption:"\\psi",snippet:"\\psi",meta:"cmd",score:.09994508706163642},{caption:"\\Gamma",snippet:"\\Gamma",meta:"cmd",score:.04801549269801977},{caption:"\\Theta",snippet:"\\Theta",meta:"cmd",score:.038090902146599444},{caption:"\\Lambda",snippet:"\\Lambda",meta:"cmd",score:.032206594305977686},{caption:"\\Xi",snippet:"\\Xi",meta:"cmd",score:.01060997225400494},{caption:"\\Pi",snippet:"\\Pi",meta:"cmd",score:.021264671817473237},{caption:"\\Sigma",snippet:"\\Sigma",meta:"cmd",score:.05769642802079917},{caption:"\\Upsilon",snippet:"\\Upsilon",meta:"cmd",score:.00032875192955749566},{caption:"\\Phi",snippet:"\\Phi",meta:"cmd",score:.0538724950042562},{caption:"\\Psi",snippet:"\\Psi",meta:"cmd",score:.03056589143021648},{caption:"\\Omega",snippet:"\\Omega",meta:"cmd",score:.09490387997853639}]}),define("ide/editor/directives/aceEditor/auto-complete/CommandManager",["./snippets/TopHundredSnippets"],function(e){var t,n=function(){function e(t,n){_classCallCheck(this,e),this.doc=t,this.prefix=n}return _createClass(e,null,[{key:"initClass",value:function(){this.prototype.commandRegex=/\\([a-zA-Z]{2,})/}}]),_createClass(e,[{key:"parse",value:function(){var e,t=null;__guard__("undefined"!=typeof window&&null!==window?window._ide:void 0,function(e){return e.browserIsSafari})&&(t=5e3);for(var n=[],i=[],r={},o=0;e=this.nextCommand();){if(o+=1,t&&o>t)return n;for(var s=this.doc,a=0;this.consumeArgument("[","]");)a++;for(var l=0;this.consumeArgument("{","}");)l++;var c="".concat(e,"\\").concat(a,"\\").concat(l);null!=this.prefix&&"\\".concat(e)===this.prefix?i.push([e,a,l]):null==r[c]&&(r[c]=!0,n.push([e,a,l])),this.doc=s}if(i.length>1){var u=i.sort(function(e,t){return e[1]+e[2]<t[1]+t[2]})[0];n.push(u)}return n}},{key:"nextCommand",value:function(){var e=this.doc.search(this.commandRegex);if(-1===e)return!1;var t=this.doc.match(this.commandRegex)[1];return this.doc=this.doc.substr(e+t.length+1),t}},{key:"consumeWhitespace",value:function(){var e=this.doc.match(/^[ \t\n]*/m)[0];return this.doc=this.doc.substr(e.length)}},{key:"consumeArgument",value:function(e,t){if(this.consumeWhitespace(),this.doc[0]===e){for(var n=1,i=1;i>0&&n<this.doc.length;)this.doc[n]===e?i++:this.doc[n]===t&&i--,n++;return 0===i?(this.doc=this.doc.substr(n),!0):!1}return!1}}]),e}();return n.initClass(),t=function(){function t(e){_classCallCheck(this,t),this.metadataManager=e}return _createClass(t,[{key:"getCompletions",value:function(t,i,r,o,s){for(var a={},l=0,c=Array.from(e);l<c.length;l++){var u=c[l];a[u.caption.match(/\w+/)[0]]=!0}var d=this.metadataManager.getAllPackages(),h=[];for(var f in d)for(var p=d[f],g=0,m=Array.from(p);g<m.length;g++)u=m[g],h.push(u),a[u.caption.match(/\w+/)[0]]=!0;for(var v=i.getValue(),y=new n(v,o),w=y.parse(),b=[],C=0,k=Array.from(w);C<k.length;C++){var S=k[C];if(!a[S[0]]){var $="\\".concat(S[0]),x=$===o?99:50;u=$;var A=1;_.times(S[1],function(){return u+="[${".concat(A,"}]"),$+="[]",A++}),_.times(S[2],function(){return u+="{${".concat(A,"}}"),$+="{}",A++}),b.push({caption:$,snippet:u,meta:"cmd",score:x})}}return b=b.concat(e,h),s(null,b)}},{key:"loadCommandsFromDoc",value:function(e){var t=new n(e);return this.commands=t.parse()}},{key:"getSuggestions",value:function(e){var t=_.filter(this.commands,function(t){return t[0].slice(0,e.length)===e});return _.map(t,function(t){var n,i,r="\\".concat(e),o="";_.times(t[1],function(){return o+="[]"}),_.times(t[2],function(){return o+="{}"});var s=t[0].slice(e.length),a=t[1],l=t[2],c=a+l;return 0===c?(i=s,n=""):(i=s+o[0],n=o.slice(1)),{base:r,completion:s+o,completionBeforeCursor:i,completionAfterCursor:n}})}}]),t}()}),define("ide/editor/directives/aceEditor/auto-complete/snippets/Environments",[],function(){var e=["abstract","align","align*","equation","equation*","gather","gather*","multline","multline*","split","verbatim","quote","center"],t=["array","figure","tabular","table","list","enumerate","itemize","frame","thebibliography"];return{all:e.concat(t),withoutSnippets:e}}),define("ide/editor/directives/aceEditor/auto-complete/EnvironmentManager",["ide/editor/directives/aceEditor/auto-complete/snippets/Environments"],function(e){var t=Array.from(e.withoutSnippets).map(function(e){return{caption:"\\begin{".concat(e,"}..."),snippet:"\\begin{".concat(e,"}\n	$1\n\\end{").concat(e,"}"),meta:"env"}});t=t.concat([{caption:"\\begin{array}...",snippet:"\\begin{array}{${1:cc}}\n	$2 & $3 \\\\\\\\\n	$4 & $5\n\\end{array}",meta:"env"},{caption:"\\begin{figure}...",snippet:"\\begin{figure}\n	\\centering\n	\\includegraphics{$1}\n	\\caption{${2:Caption}}\n	\\label{${3:fig:my_label}}\n\\end{figure}",meta:"env"},{caption:"\\begin{tabular}...",snippet:"\\begin{tabular}{${1:c|c}}\n	$2 & $3 \\\\\\\\\n	$4 & $5\n\\end{tabular}",meta:"env"},{caption:"\\begin{table}...",snippet:"\\begin{table}[$1]\n	\\centering\n	\\begin{tabular}{${2:c|c}}\n		$3 & $4 \\\\\\\\\n		$5 & $6\n	\\end{tabular}\n	\\caption{${7:Caption}}\n	\\label{${8:tab:my_label}}\n\\end{table}",meta:"env"},{caption:"\\begin{list}...",snippet:"\\begin{list}\n	\\item $1\n\\end{list}",meta:"env"},{caption:"\\begin{enumerate}...",snippet:"\\begin{enumerate}\n	\\item $1\n\\end{enumerate}",meta:"env"},{caption:"\\begin{itemize}...",snippet:"\\begin{itemize}\n	\\item $1\n\\end{itemize}",meta:"env"},{caption:"\\begin{frame}...",snippet:"\\begin{frame}{${1:Frame Title}}\n	$2\n\\end{frame}",meta:"env"}]);var n={caption:"\\begin{document}...",snippet:"\\begin{document}\n$1\n\\end{document}",meta:"env"},i={caption:"\\begin{thebibliography}...",snippet:"\\begin{thebibliography}{$1}\n\\bibitem{$2}\n$3\n\\end{thebibliography}",meta:"env"};t.push(n);var r=function(e){for(var t,n=/^\\newenvironment{(\w+)}.*$/gm,i=[],r=0;t=n.exec(e);)if(i.push({name:t[1],whitespace:null}),r+=1,r>=1e3)return i;return i},o=function(t){for(var n,i=/^\\begin{(\w+)}.*\n([\t ]*).*$/gm,r=[],o=0;n=i.exec(t);)if(!Array.from(e.all).includes(n[1])&&"document"!==n[1]&&(r.push({name:n[1],whitespace:n[2]}),o+=1,o>=1e3))return r;return r},s=function(e){var t=/^\\begin{document}/m;return null!==t.exec(e)},a=function(e){var t=/^\\begin{thebibliography}/m;return null!==t.exec(e)},l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getCompletions",value:function(e,l,c,u,d){var h,f=l.getValue(),p=r(f),g=o(f);s(f)?(h=t.indexOf(n),-1!==h&&t.splice(h,1)):t.push(n),a(f)?(h=t.indexOf(i),-1!==h&&t.splice(h,1)):t.push(i);for(var m={},v=0,y=Array.from(p);v<y.length;v++){var w=y[v];m[w.name]=w}for(var b=0,C=Array.from(g);b<C.length;b++){var k=C[b];m[k.name]=k}var S=_.values(m),$=t.concat(S.map(function(e){return{caption:"\\begin{".concat(e.name,"}..."),snippet:"\\begin{".concat(e.name,"}\n").concat(e.whitespace||"","$0\n\\end{").concat(e.name,"}"),meta:"env"}})).concat(S.map(function(e){return{caption:"\\end{".concat(e.name,"}"),value:"\\end{".concat(e.name,"}"),meta:"env"}}));return d(null,$)}}]),e}();return l}),define("ide/editor/directives/aceEditor/auto-complete/PackageManager",[],function(){var e=["inputenc","graphicx","amsmath","geometry","amssymb","hyperref","babel","color","xcolor","url","natbib","fontenc","fancyhdr","amsfonts","booktabs","amsthm","float","tikz","caption","setspace","multirow","array","multicol","titlesec","enumitem","ifthen","listings","blindtext","subcaption","times","bm","subfigure","algorithm","fontspec","biblatex","tabularx","microtype","etoolbox","parskip","calc","verbatim","mathtools","epsfig","wrapfig","lipsum","cite","textcomp","longtable","textpos","algpseudocode","enumerate","subfig","pdfpages","epstopdf","latexsym","lmodern","pifont","ragged2e","rotating","dcolumn","xltxtra","marvosym","indentfirst","xspace","csquotes","xparse","changepage","soul","xunicode","comment","mathrsfs","tocbibind","lastpage","algorithm2e","pgfplots","lineno","graphics","algorithmic","fullpage","mathptmx","todonotes","ulem","tweaklist","moderncvstyleclassic","collection","moderncvcompatibility","gensymb","helvet","siunitx","adjustbox","placeins","colortbl","appendix","makeidx","supertabular","ifpdf","framed","aliascnt","layaureo","authblk"],t=function(){function t(e){_classCallCheck(this,t),this.metadataManager=e}return _createClass(t,[{key:"getCompletions",value:function(t,n,i,r,o){for(var s=Object.keys(this.metadataManager.getAllPackages()),a=[],l=0,c=Array.from(e);l<c.length;l++){var u=c[l];Array.from(s).includes(u)||a.push({caption:"\\usepackage{".concat(u,"}"),snippet:"\\usepackage{".concat(u,"}"),meta:"pkg"})}return a.push({caption:"\\usepackage{}",snippet:"\\usepackage{$1}",meta:"pkg",score:70}),o(null,a)}}]),t}();return t}),ace.define("ace/snippets",[],function(e,t,n){"use strict";var i=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,o=e("./lib/lang"),s=e("./range").Range,a=e("./anchor").Anchor,l=e("./keyboard/hash_handler").HashHandler,c=e("./tokenizer").Tokenizer,u=s.comparePoints,d=function(){this.snippetMap={},this.snippetNameMap={}};(function(){i.implement(this,r),this.getTokenizer=function(){function e(e,t,n){return e=e.substr(1),/^\d+$/.test(e)&&!n.inFormatString?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return"(?:[^\\\\"+e+"]|\\\\.)"}return d.$tokenizer=new c({start:[{regex:/:/,onMatch:function(e,t,n){return n.length&&n[0].expectIf?(n[0].expectIf=!1,n[0].elseBranch=n[0],[n[0]]):":"}},{regex:/\\./,onMatch:function(e,t,n){var i=e[1];return"}"==i&&n.length?e=i:-1!="`$\\".indexOf(i)?e=i:n.inFormatString&&("n"==i?e="\n":"t"==i?e="\n":-1!="ulULE".indexOf(i)&&(e={changeCase:i,local:i>"a"})),[e]}},{regex:/}/,onMatch:function(e,t,n){return[n.length?n.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:e},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(t,n,i){var r=e(t.substr(1),n,i);return i.unshift(r[0]),r},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+t("\\|")+"*\\|",onMatch:function(e,t,n){n[0].choices=e.slice(1,-1).split(",")},next:"start"},{regex:"/("+t("/")+"+)/(?:("+t("/")+"*)/)(\\w*):?",onMatch:function(e,t,n){var i=n[0];return i.fmtString=e,e=this.splitRegex.exec(e),i.guard=e[1],i.fmt=e[2],i.flag=e[3],""},next:"start"},{regex:"`"+t("`")+"*`",onMatch:function(e,t,n){return n[0].code=e.splice(1,-1),""},next:"start"},{regex:"\\?",onMatch:function(e,t,n){n[0]&&(n[0].expectIf=!0)},next:"start"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:"/("+t("/")+"+)/",token:"regex"},{regex:"",onMatch:function(e,t,n){n.inFormatString=!0},next:"start"}]}),d.prototype.getTokenizer=function(){return d.$tokenizer},d.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.$getDefaultValue=function(e,t){if(/^[A-Z]\d+$/.test(t)){var n=t.substr(1);return(this.variables[t[0]+"__"]||{})[n]}if(/^\d+$/.test(t))return(this.variables.__||{})[t];if(t=t.replace(/^TM_/,""),e){var i=e.session;switch(t){case"CURRENT_WORD":var r=i.getWordRange();case"SELECTION":case"SELECTED_TEXT":return i.getTextRange(r);case"CURRENT_LINE":return i.getLine(e.getCursorPosition().row);case"PREV_LINE":return i.getLine(e.getCursorPosition().row-1);case"LINE_INDEX":return e.getCursorPosition().column;case"LINE_NUMBER":return e.getCursorPosition().row+1;case"SOFT_TABS":return i.getUseSoftTabs()?"YES":"NO";case"TAB_SIZE":return i.getTabSize();case"FILENAME":case"FILEPATH":return"";case"FULLNAME":return"Ace"}}},this.variables={},this.getVariableValue=function(e,t){return this.variables.hasOwnProperty(t)?this.variables[t](e,t)||"":this.$getDefaultValue(e,t)||""},this.tmStrFormat=function(e,t,n){var i=t.flag||"",r=t.guard;r=new RegExp(r,i.replace(/[^gi]/,""));var o=this.tokenizeTmSnippet(t.fmt,"formatString"),s=this,a=e.replace(r,function(){s.variables.__=arguments;for(var e=s.resolveVariables(o,n),t="E",i=0;i<e.length;i++){var r=e[i];if("object"==typeof r)if(e[i]="",r.changeCase&&r.local){var a=e[i+1];a&&"string"==typeof a&&("u"==r.changeCase?e[i]=a[0].toUpperCase():e[i]=a[0].toLowerCase(),e[i+1]=a.substr(1))}else r.changeCase&&(t=r.changeCase);else"U"==t?e[i]=r.toUpperCase():"L"==t&&(e[i]=r.toLowerCase())}return e.join("")});return this.variables.__=null,a},this.resolveVariables=function(e,t){function n(t){var n=e.indexOf(t,r+1);-1!=n&&(r=n)}for(var i=[],r=0;r<e.length;r++){var o=e[r];if("string"==typeof o)i.push(o);else{if("object"!=typeof o)continue;if(o.skip)n(o);else{if(o.processed<r)continue;if(o.text){var s=this.getVariableValue(t,o.text);s&&o.fmtString&&(s=this.tmStrFormat(s,o)),o.processed=r,null==o.expectIf?s&&(i.push(s),n(o)):s?o.skip=o.elseBranch:n(o)}else null!=o.tabstopId?i.push(o):null!=o.changeCase&&i.push(o)}}}return i},this.insertSnippetForSelection=function(e,t){function n(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if("object"==typeof i){if(c[i.tabstopId])continue;var r=e.lastIndexOf(i,n-1);i=t[r]||{tabstopId:i.tabstopId}}t[n]=i}return t}var i=e.getCursorPosition(),r=e.session.getLine(i.row),o=e.session.getTabString(),s=r.match(/^\s*/)[0];i.column<s.length&&(s=s.slice(0,i.column)),t=t.replace(/\r/g,"");var a=this.tokenizeTmSnippet(t);a=this.resolveVariables(a,e),a=a.map(function(e){return"\n"==e?e+s:"string"==typeof e?e.replace(/\t/g,o):e});var l=[];a.forEach(function(e,t){if("object"==typeof e){var n=e.tabstopId,i=l[n];if(i||(i=l[n]=[],i.index=n,i.value=""),-1===i.indexOf(e)){i.push(e);var r=a.indexOf(e,t+1);if(-1!==r){var o=a.slice(t+1,r),s=o.some(function(e){return"object"==typeof e});s&&!i.value?i.value=o:!o.length||i.value&&"string"==typeof i.value||(i.value=o.join(""))}}}}),l.forEach(function(e){e.length=0});for(var c={},u=0;u<a.length;u++){var d=a[u];if("object"==typeof d){var f=d.tabstopId,p=a.indexOf(d,u+1);if(c[f])c[f]===d&&(c[f]=null);else{var g=l[f],m="string"==typeof g.value?[g.value]:n(g.value);m.unshift(u+1,Math.max(0,p-u)),m.push(d),c[f]=d,a.splice.apply(a,m),-1===g.indexOf(d)&&g.push(d)}}}var v=0,y=0,w="";a.forEach(function(e){if("string"==typeof e){var t=e.split("\n");t.length>1?(y=t[t.length-1].length,v+=t.length-1):y+=e.length,w+=e}else e.start?e.end={row:v,column:y}:e.start={row:v,column:y}});var b=e.getSelectionRange(),_=e.session.replace(b,w),C=new h(e),k=e.inVirtualSelectionMode&&e.selection.index;C.addTabstops(l,b.start,_,k)},this.insertSnippet=function(e,t){var n=this;return e.inVirtualSelectionMode?n.insertSnippetForSelection(e,t):(e.forEachSelection(function(){n.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),void(e.tabstopManager&&e.tabstopManager.tabNext()))},this.$getScope=function(e){var t=e.session.$mode.$id||"";if(t=t.split("/").pop(),"html"===t||"php"===t){"php"!==t||e.session.$mode.inlinePhp||(t="html");var n=e.getCursorPosition(),i=e.session.getState(n.row);"object"==typeof i&&(i=i[0]),i.substring&&("js-"==i.substring(0,3)?t="javascript":"css-"==i.substring(0,4)?t="css":"php-"==i.substring(0,4)&&(t="php"))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),n=[t],i=this.snippetMap;return i[t]&&i[t].includeScopes&&n.push.apply(n,i[t].includeScopes),n.push("_"),n},this.expandWithTab=function(e,t){var n=this,i=e.forEachSelection(function(){return n.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return i&&e.tabstopManager&&e.tabstopManager.tabNext(),i},this.expandSnippetForSelection=function(e,t){var n,i=e.getCursorPosition(),r=e.session.getLine(i.row),o=r.substring(0,i.column),s=r.substr(i.column),a=this.snippetMap;return this.getActiveScopes(e).some(function(e){var t=a[e];return t&&(n=this.findMatchingSnippet(t,o,s)),!!n},this),n?t&&t.dryRun?!0:(e.session.doc.removeInLine(i.row,i.column-n.replaceBefore.length,i.column+n.replaceAfter.length),this.variables.M__=n.matchBefore,this.variables.T__=n.matchAfter,this.insertSnippetForSelection(e,n.content),this.variables.M__=this.variables.T__=null,!0):!1},this.findMatchingSnippet=function(e,t,n){for(var i=e.length;i--;){var r=e[i];if((!r.startRe||r.startRe.test(t))&&(!r.endRe||r.endRe.test(n))&&(r.startRe||r.endRe))return r.matchBefore=r.startRe?r.startRe.exec(t):[""],r.matchAfter=r.endRe?r.endRe.exec(n):[""],r.replaceBefore=r.triggerRe?r.triggerRe.exec(t)[0]:"",r.replaceAfter=r.endTriggerRe?r.endTriggerRe.exec(n)[0]:"",r}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){function n(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function i(e,t,i){return e=n(e),t=n(t),i?(e=t+e,e&&"$"!=e[e.length-1]&&(e+="$")):(e+=t,e&&"^"!=e[0]&&(e="^"+e)),new RegExp(e)}function r(e){e.scope||(e.scope=t||"_"),t=e.scope,s[t]||(s[t]=[],a[t]={});var n=a[t];if(e.name){var r=n[e.name];r&&l.unregister(r),n[e.name]=e}s[t].push(e),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=o.escapeRegExp(e.tabTrigger)),(e.trigger||e.guard||e.endTrigger||e.endGuard)&&(e.startRe=i(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=i(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger))}var s=this.snippetMap,a=this.snippetNameMap,l=this;e||(e=[]),e&&e.content?r(e):Array.isArray(e)&&e.forEach(r),this._signal("registerSnippets",{scope:t})},this.unregister=function(e,t){function n(e){var n=r[e.scope||t];if(n&&n[e.name]){delete n[e.name];var o=i[e.scope||t],s=o&&o.indexOf(e);s>=0&&o.splice(s,1)}}var i=this.snippetMap,r=this.snippetNameMap;e.content?n(e):Array.isArray(e)&&e.forEach(n)},this.parseSnippetFile=function(e){e=e.replace(/\r/g,"");for(var t,n=[],i={},r=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;t=r.exec(e);){if(t[1])try{i=JSON.parse(t[1]),n.push(i)}catch(o){}if(t[4])i.content=t[4].replace(/^\t/gm,""),n.push(i),i={};else{var s=t[2],a=t[3];if("regex"==s){var l=/\/((?:[^\/\\]|\\.)*)|$/g;i.guard=l.exec(a)[1],i.trigger=l.exec(a)[1],i.endTrigger=l.exec(a)[1],i.endGuard=l.exec(a)[1]}else"snippet"==s?(i.tabTrigger=a.match(/^\S*/)[0],i.name||(i.name=a)):i[s]=a}}return n},this.getSnippetByName=function(e,t){var n,i=this.snippetNameMap;return this.getActiveScopes(t).some(function(t){var r=i[t];return r&&(n=r[e]),!!n},this),n}}).call(d.prototype);var h=function(e){return e.tabstopManager?e.tabstopManager:(e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=o.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),void this.attach(e))};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){var t="r"==e.action[0],n=e.start,i=e.end,r=n.row,o=i.row,s=o-r,a=i.column-n.column;if(t&&(s=-s,a=-a),!this.$inChange&&t){
var l=this.selectedTabstop,c=l&&!l.some(function(e){return u(e.start,n)<=0&&u(e.end,i)>=0});if(c)return this.detach()}for(var d=this.ranges,h=0;h<d.length;h++){var f=d[h];f.end.row<n.row||(t&&u(n,f.start)<0&&u(i,f.end)>0?(this.removeRange(f),h--):(f.start.row==r&&f.start.column>n.column&&(f.start.column+=a),f.end.row==r&&f.end.column>=n.column&&(f.end.column+=a),f.start.row>=r&&(f.start.row+=s),f.end.row>=r&&(f.end.row+=s),u(f.start,f.end)>0&&this.removeRange(f)))}d.length||this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(e&&e.hasLinkedRanges){this.$inChange=!0;for(var n=this.editor.session,i=n.getTextRange(e.firstNonLinked),r=e.length;r--;){var o=e[r];if(o.linked){var s=t.snippetManager.tmStrFormat(i,o.original);n.replace(o,s)}}this.$inChange=!1}},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(this.editor){for(var e=this.editor.selection.lead,t=this.editor.selection.anchor,n=this.editor.selection.isEmpty(),i=this.ranges.length;i--;)if(!this.ranges[i].linked){var r=this.ranges[i].contains(e.row,e.column),o=n||this.ranges[i].contains(t.row,t.column);if(r&&o)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,n=this.index+(e||1);n=Math.min(Math.max(n,1),t),n==t&&(n=0),this.selectTabstop(n),0===n&&this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];if(t&&this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index],t&&t.length){if(this.selectedTabstop=t,this.editor.inVirtualSelectionMode)this.editor.selection.setRange(t.firstNonLinked);else{var n=this.editor.multiSelect;n.toSingleRange(t.firstNonLinked.clone());for(var i=t.length;i--;)t.hasLinkedRanges&&t[i].linked||n.addRange(t[i].clone(),!0);n.ranges[0]&&n.addRange(n.ranges[0].clone())}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)}},this.addTabstops=function(e,t,n){if(this.$openTabstops||(this.$openTabstops=[]),!e[0]){var i=s.fromPoints(n,n);g(i.start,t),g(i.end,t),e[0]=[i],e[0].index=0}var r=this.index,o=[r+1,0],a=this.ranges;e.forEach(function(e,n){for(var i=this.$openTabstops[n]||e,r=e.length;r--;){var l=e[r],c=s.fromPoints(l.start,l.end||l.start);p(c.start,t),p(c.end,t),c.original=l,c.tabstop=i,a.push(c),i!=e?i.unshift(c):i[r]=c,l.fmtString?(c.linked=!0,i.hasLinkedRanges=!0):i.firstNonLinked||(i.firstNonLinked=c)}i.firstNonLinked||(i.hasLinkedRanges=!1),i===e&&(o.push(i),this.$openTabstops[n]=i),this.addTabstopMarkers(i)},this),o.length>2&&(this.tabstops.length&&o.push(o.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,o))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);e.tabstop.splice(t,1),t=this.ranges.indexOf(e),this.ranges.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),-1!=t&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new l,this.keyboardHandler.bindKeys({Tab:function(e){t.snippetManager&&t.snippetManager.expandWithTab(e)||e.tabstopManager.tabNext(1)},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1)},Esc:function(e){e.tabstopManager.detach()},Return:function(e){return!1}})}).call(h.prototype);var f={};f.onChange=a.prototype.onChange,f.setPosition=function(e,t){this.pos.row=e,this.pos.column=t},f.update=function(e,t,n){this.$insertRight=n,this.pos=e,this.onChange(t)};var p=function(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row},g=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};e("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),t.snippetManager=new d;var m=e("./editor").Editor;(function(){this.insertSnippet=function(e,n){return t.snippetManager.insertSnippet(this,e,n)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(m.prototype)}),ace.define("ace/autocomplete/popup",[],function(e,t,n){"use strict";var i=e("../virtual_renderer").VirtualRenderer,r=e("../editor").Editor,o=e("../range").Range,s=e("../lib/event"),a=e("../lib/lang"),l=e("../lib/dom"),c=function(e){var t=new i(e);t.$maxLines=4;var n=new r(t);return n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),n.renderer.setHighlightGutterLine(!1),n.$mouseHandler.$focusTimeout=0,n.$highlightTagPending=!0,n},u=function(e){var t=l.createElement("div"),n=new c(t);e&&e.appendChild(t),t.style.display="none",n.renderer.content.style.cursor="default",n.renderer.setStyle("ace_autocomplete"),n.setOption("displayIndentGuides",!1),n.setOption("dragDelay",150);var i=function(){};n.focus=i,n.$isFocused=!0,n.renderer.$cursorLayer.restartTimer=i,n.renderer.$cursorLayer.element.style.opacity=0,n.renderer.$maxLines=8,n.renderer.$keepTextAreaAtCursor=!1,n.setHighlightActiveLine(!1),n.session.highlight(""),n.session.$searchHighlight.clazz="ace_highlight-marker",n.on("mousedown",function(e){var t=e.getDocumentPosition();n.selection.moveToPosition(t),d.start.row=d.end.row=t.row,e.stop()});var r,u=new o(-1,0,-1,1/0),d=new o(-1,0,-1,1/0);d.id=n.session.addMarker(d,"ace_active-line","fullLine"),n.setSelectOnHover=function(e){e?u.id&&(n.session.removeMarker(u.id),u.id=null):u.id=n.session.addMarker(u,"ace_line-hover","fullLine")},n.setSelectOnHover(!1),n.on("mousemove",function(e){if(!r)return void(r=e);if(r.x!=e.x||r.y!=e.y){r=e,r.scrollTop=n.renderer.scrollTop;var t=r.getDocumentPosition().row;u.start.row!=t&&(u.id||n.setRow(t),f(t))}}),n.renderer.on("beforeRender",function(){if(r&&-1!=u.start.row){r.$pos=null;var e=r.getDocumentPosition().row;u.id||n.setRow(e),f(e,!0)}}),n.renderer.on("afterRender",function(){var e=n.getRow(),t=n.renderer.$textLayer,i=t.element.childNodes[e-t.config.firstRow];i!==t.selectedNode&&t.selectedNode&&l.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=i,i&&l.addCssClass(i,"ace_selected")});var h=function(){f(-1)},f=function(e,t){e!==u.start.row&&(u.start.row=u.end.row=e,t||n.session._emit("changeBackMarker"),n._emit("changeHoverMarker"))};n.getHoveredRow=function(){return u.start.row},s.addListener(n.container,"mouseout",h),n.on("hide",h),n.on("changeSelection",h),n.session.doc.getLength=function(){return n.data.length},n.session.doc.getLine=function(e){var t=n.data[e];return"string"==typeof t?t:t&&t.value||""};var p=n.session.bgTokenizer;return p.$tokenizeRow=function(e){function t(e,t){e&&r.push({type:(i.className||"")+(t||""),value:e})}var i=n.data[e],r=[];if(!i)return r;"string"==typeof i&&(i={value:i});for(var o=i.caption||i.value||i.name,s=o.toLowerCase(),a=(n.filterText||"").toLowerCase(),l=0,c=0,u=0;u<=a.length;u++)if(u!=c&&(i.matchMask&1<<u||u==a.length)){var d=a.slice(c,u);c=u;var h=s.indexOf(d,l);if(-1==h)continue;t(o.slice(l,h),""),l=h+d.length,t(o.slice(h,l),"completion-highlight")}return t(o.slice(l,o.length),""),i.meta&&r.push({type:"completion-meta",value:i.meta}),i.message&&r.push({type:"completion-message",value:i.message}),r},p.$updateOnChange=i,p.start=i,n.session.$computeWidth=function(){return this.screenWidth=0},n.isOpen=!1,n.isTopdown=!1,n.autoSelect=!0,n.filterText="",n.data=[],n.setData=function(e,t){n.filterText=t||"",n.setValue(a.stringRepeat("\n",e.length),-1),n.data=e||[],n.setRow(0)},n.getData=function(e){return n.data[e]},n.getRow=function(){return d.start.row},n.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),d.start.row!=e&&(n.selection.clearSelection(),d.start.row=d.end.row=e||0,n.session._emit("changeBackMarker"),n.moveCursorTo(e||0,0),n.isOpen&&n._signal("select"))},n.on("changeSelection",function(){n.isOpen&&n.setRow(n.selection.lead.row),n.renderer.scrollCursorIntoView()}),n.hide=function(){this.container.style.display="none",this._signal("hide"),n.isOpen=!1},n.show=function(e,t,i){var o=this.container,s=window.innerHeight,a=window.innerWidth,l=this.renderer,c=l.$maxLines*t*1.4,u=e.top+this.$borderSize,d=u>s/2&&!i;d&&u+t+c>s?(l.$maxPixelHeight=u-2*this.$borderSize,o.style.top="",o.style.bottom=s-u+"px",n.isTopdown=!1):(u+=t,l.$maxPixelHeight=s-u-.2*t,o.style.top=u+"px",o.style.bottom="",n.isTopdown=!0),o.style.display="";var h=e.left;h+o.offsetWidth>a&&(h=a-o.offsetWidth),o.style.left=h+"px",this._signal("show"),r=null,n.isOpen=!0},n.goTo=function(e){var t=this.getRow(),n=this.session.getLength()-1;switch(e){case"up":t=0>=t?n:t-1;break;case"down":t=t>=n?-1:t+1;break;case"start":t=0;break;case"end":t=n}this.setRow(t)},n.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},n.$imageSize=0,n.$borderSize=1,n};l.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}","autocompletion.css"),t.AcePopup=u,t.$singleLineEditor=c}),ace.define("ace/autocomplete/util",[],function(e,t,n){"use strict";t.parForEach=function(e,t,n){var i=0,r=e.length;0===r&&n();for(var o=0;r>o;o++)t(e[o],function(e,t){i++,i===r&&n(e,t)})};var i=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,n){n=n||i;for(var r=[],o=t-1;o>=0&&n.test(e[o]);o--)r.push(e[o]);return r.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,n){n=n||i;for(var r=[],o=t;o<e.length&&n.test(e[o]);o++)r.push(e[o]);return r},t.getCompletionPrefix=function(e){var t,n=e.getCursorPosition(),i=e.session.getLine(n.row);return e.completers.forEach(function(e){e.identifierRegexps&&e.identifierRegexps.forEach(function(e){!t&&e&&(t=this.retrievePrecedingIdentifier(i,n.column,e))}.bind(this))}.bind(this)),t||this.retrievePrecedingIdentifier(i,n.column)}}),ace.define("ace/autocomplete",[],function(e,t,n){"use strict";var i=e("./keyboard/hash_handler").HashHandler,r=e("./autocomplete/popup").AcePopup,o=e("./autocomplete/util"),s=(e("./lib/event"),e("./lib/lang")),a=e("./lib/dom"),l=e("./snippets").snippetManager,c=e("./config"),u=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new i,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=s.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=s.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new r(document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,n){this.popup||this.$init(),this.popup.autoSelect=this.autoSelect,this.popup.setData(this.completions.filtered,this.completions.filterText),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var i=e.renderer;if(this.popup.setRow(this.autoSelect?0:-1),n)n&&!t&&this.detach();else{this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var r=i.layerConfig.lineHeight,o=i.$cursorLayer.getPixelPosition(this.base,!0);o.left-=this.popup.getTextLeftOffset();var s=e.container.getBoundingClientRect();o.top+=s.top-i.layerConfig.offset,o.left+=s.left-e.renderer.scrollLeft,o.left+=i.gutterWidth,this.popup.show(o,r)}},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,n=this.editor.textInput.getElement(),i=e.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(e.relatedTarget),r=this.popup&&this.popup.container;t==n||t.parentNode==r||i||t==this.tooltipNode||e.relatedTarget==n||this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){this.popup.goTo(e)},this.insertMatch=function(e,t){if(e||(e=this.popup.getData(this.popup.getRow())),!e)return!1;if(e.completer&&e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(this.completions.filterText)for(var n,i=this.editor.selection.getAllRanges(),r=0;n=i[r];r++)n.start.column-=this.completions.filterText.length,this.editor.session.remove(n);e.snippet?l.insertSnippet(this.editor,e.snippet):this.editor.execCommand("insertstring",e.value||e)}this.detach()},this.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();return t||e.tabstopManager?t:void e.completer.goTo("down")},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var n=e.getSession(),i=e.getCursorPosition(),r=o.getCompletionPrefix(e);this.base=n.doc.createAnchor(i.row,i.column-r.length),this.base.$insertRight=!0;var s=[],a=e.completers.length;return e.completers.forEach(function(l,c){l.getCompletions(e,n,i,r,function(n,i){!n&&i&&(s=s.concat(i)),t(null,{prefix:o.getCompletionPrefix(e),matches:s,finished:0===--a})})}),!0},this.showPopup=function(e){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions()},this.updateCompletions=function(e){if(e&&this.base&&this.completions){var t=this.editor.getCursorPosition(),n=this.editor.session.getTextRange({start:this.base,end:t});if(n==this.completions.filterText)return;return this.completions.setFilter(n),this.completions.filtered.length&&(1!=this.completions.filtered.length||this.completions.filtered[0].value!=n||this.completions.filtered[0].snippet)?void this.openPopup(this.editor,n,e):this.detach()}var i=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(t,n){var r=function(){return n.finished?this.detach():void 0}.bind(this),o=n.prefix,s=n&&n.matches;if(!s||!s.length)return r();if(0===o.indexOf(n.prefix)&&i==this.gatherCompletionsId){this.completions=new d(s),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(o);var a=this.completions.filtered;return a.length&&(1!=a.length||a[0].value!=o||a[0].snippet)?this.autoInsert&&1==a.length&&n.finished?this.insertMatch(a[0]):void this.openPopup(this.editor,o,e):r()}}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,n=t&&(t[e.getHoveredRow()]||t[e.getRow()]),i=null;return n&&this.editor&&this.popup.isOpen?(this.editor.completers.some(function(e){return e.getDocTooltip&&(i=e.getDocTooltip(n)),i}),i||(i=n),"string"==typeof i&&(i={docText:i}),i&&(i.docHTML||i.docText)?void this.showDocTooltip(i):this.hideDocTooltip()):this.hideDocTooltip()},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=a.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&&(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var n=this.popup,i=n.container.getBoundingClientRect();t.style.top=n.container.style.top,t.style.bottom=n.container.style.bottom,t.style.display="block",window.innerWidth-i.right<320?i.left<320?n.isTopdown?(t.style.top=i.bottom+"px",t.style.left=i.left+"px",t.style.right="",t.style.bottom=""):(t.style.top=n.container.offsetTop-t.offsetHeight+"px",t.style.left=i.left+"px",t.style.right="",t.style.bottom=""):(t.style.right=window.innerWidth-i.left+"px",t.style.left=""):(t.style.left=i.right+1+"px",t.style.right="")},this.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var e=this.tooltipNode;this.editor.isFocused()||document.activeElement!=e||this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)}},this.onTooltipClick=function(e){for(var t=e.target;t&&t!=this.tooltipNode;){if("A"==t.nodeName&&t.href){t.rel="noreferrer",t.target="_blank";break}t=t.parentNode}},this.destroy=function(){this.detach(),this.popup&&this.popup.destroy();var e=this.popup.container;e&&e.parentNode&&e.parentNode.removeChild(e),this.editor&&this.editor.completer==this&&null==this.editor.completer,this.popup=null}}).call(u.prototype),u["for"]=function(e){return e.completer?e.completer:(c.get("sharedPopups")?(u.$shared||(u.$sharedInstance=new u),e.completer=u.$sharedInstance):(e.completer=new u,e.once("destroy",function(e,t){t.completer.destroy()})),e.completer)},u.startCommand={name:"startAutocomplete",exec:function(e){var t=u["for"](e);t.autoInsert=!1,t.autoSelect=!0,t.showPopup(e),t.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var d=function(e,t){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0))var t=this.filtered;else var t=this.all;this.filterText=e,t=this.filterCompletions(t,this.filterText),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value)<(t.caption||t.value)});var n=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t===n?!1:(n=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var n=[],i=t.toUpperCase(),r=t.toLowerCase();e:for(var o,s=0;o=e[s];s++){var a=o.caption||o.value||o.snippet;if(a){var l,c,u=-1,d=0,h=0;if(this.exactMatch){if(t!==a.substr(0,t.length))continue e}else{var f=a.toLowerCase().indexOf(r);if(f>-1)h=f;else for(var p=0;p<t.length;p++){var g=a.indexOf(r[p],u+1),m=a.indexOf(i[p],u+1);if(l=g>=0&&(0>m||m>g)?g:m,0>l)continue e;c=l-u-1,c>0&&(-1===u&&(h+=10),h+=c,d|=1<<p),u=l}}o.matchMask=d,o.exactMatch=h?0:1,o.$score=(o.score||0)-h,n.push(o)}}return n}}).call(d.prototype),t.Autocomplete=u,t.FilteredList=d}),ace.define("ace/autocomplete/text_completer",[],function(e,t,n){function i(e,t){var n=e.getTextRange(o.fromPoints({row:0,column:0},t));return n.split(s).length-1}function r(e,t){var n=i(e,t),r=e.getValue().split(s),o=Object.create(null),a=r[n];return r.forEach(function(e,t){if(e&&e!==a){var i=Math.abs(n-t),s=r.length-i;o[e]?o[e]=Math.max(s,o[e]):o[e]=s}}),o}var o=e("../range").Range,s=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;t.getCompletions=function(e,t,n,i,o){var s=r(t,n),a=Object.keys(s);o(null,a.map(function(e){return{caption:e,value:e,score:s[e],meta:"local"}}))}}),ace.define("ace/ext/language_tools",[],function(e,t,n){"use strict";var i=e("../snippets").snippetManager,r=e("../autocomplete").Autocomplete,o=e("../config"),s=e("../lib/lang"),a=e("../autocomplete/util"),l=e("../autocomplete/text_completer"),c={getCompletions:function(e,t,n,i,r){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,n,i,r);var o=e.session.getState(n.row),s=t.$mode.getCompletions(o,t,n,i);r(null,s)}},u={getCompletions:function(e,t,n,r,o){var s=[],a=t.getTokenAt(n.row,n.column);a&&a.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?s.push("html-tag"):s=i.getActiveScopes(e);var l=i.snippetMap,c=[];s.forEach(function(e){for(var t=l[e]||[],n=t.length;n--;){var i=t[n],r=i.name||i.tabTrigger;r&&c.push({caption:r,snippet:i.content,meta:i.tabTrigger&&!i.name?i.tabTrigger+" ":"snippet",type:"snippet"})}},this),o(null,c)},getDocTooltip:function(e){"snippet"!=e.type||e.docHTML||(e.docHTML=["<b>",s.escapeHTML(e.caption),"</b>","<hr></hr>",s.escapeHTML(e.snippet)].join(""))}},d=[u,l,c];t.setCompleters=function(e){d.length=0,e&&d.push.apply(d,e)},t.addCompleter=function(e){d.push(e)},t.textCompleter=l,t.keyWordCompleter=c,t.snippetCompleter=u;var h={name:"expandSnippet",exec:function(e){return i.expandWithTab(e)},bindKey:"Tab"},f=function(e,t){p(t.session.$mode)},p=function(e){var t=e.$id;i.files||(i.files={}),g(t),e.modes&&e.modes.forEach(p)},g=function(e){if(e&&!i.files[e]){var t=e.replace("mode","snippets");i.files[e]={},o.loadModule(t,function(t){t&&(i.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=i.parseSnippetFile(t.snippetText)),i.register(t.snippets||[],t.scope),t.includeScopes&&(i.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){g("ace/mode/"+e)})))})}},m=function(e){var t=e.editor,n=t.completer&&t.completer.activated;if("backspace"===e.command.name)n&&!a.getCompletionPrefix(t)&&t.completer.detach();else if("insertstring"===e.command.name){var i=a.getCompletionPrefix(t);if(i&&!n){var o=r["for"](t);o.autoInsert=!1,o.showPopup(t)}}},v=e("../editor").Editor;e("../config").defineOptions(v.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:d),this.commands.addCommand(r.startCommand)):this.commands.removeCommand(r.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:d),this.commands.on("afterExec",m)):this.commands.removeListener("afterExec",m)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(h),this.on("changeMode",f),f(null,this)):(this.commands.removeCommand(h),this.off("changeMode",f))},value:!1}})}),function(){ace.require(["ace/ext/language_tools"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)})}(),define("ace/ext-language_tools",function(){}),define("ide/editor/directives/aceEditor/auto-complete/Helpers",["ace/ace","ace/ext-language_tools"],function(){var e=ace.require("ace/range"),t=e.Range,n={getLastCommandFragment:function(e){var t;return(t=n.getLastCommandFragmentIndex(e))>-1?e.slice(t):null},getLastCommandFragmentIndex:function(e){var t,n=e.replace(/\[([^\]]*)\]/g,function(e){return Array(e.length+1).join(".")});return(t=n.match(/(\\[^\\]*)$/))?t.index:-1},getCommandNameFromFragment:function(e){return __guard__(null!=e?e.match(/\\(\w+)\{/):void 0,function(e){return e[1]})},getContext:function(e,i){var r=new t(i.row,0,i.row,i.column),o=e.getSession().getTextRange(r),s=n.getLastCommandFragment(o),a=n.getCommandNameFromFragment(s),l=new t(i.row,i.column,i.row,99999),c=e.getSession().getTextRange(l);return{lineUpToCursor:o,commandFragment:s,commandName:a,lineBeyondCursor:c}}};return n}),define("ide/editor/directives/aceEditor/auto-complete/AutoCompleteManager",["ide/editor/directives/aceEditor/auto-complete/CommandManager","ide/editor/directives/aceEditor/auto-complete/EnvironmentManager","ide/editor/directives/aceEditor/auto-complete/PackageManager","ide/editor/directives/aceEditor/auto-complete/Helpers","ace/ace","ace/ext-language_tools"],function(e,t,n,i){var r=ace.require("ace/range"),o=r.Range,s=ace.require("ace/snippets").snippetManager,a=function(){function r(e,t,n,i,o,s,a){var l=this;_classCallCheck(this,r),this.$scope=e,this.editor=t,this.element=n,this.metadataManager=i,this.graphics=o,this.preamble=s,this.files=a,this.monkeyPatchAutocomplete(),this.$scope.$watch("autoComplete",function(e){e?l.enable():l.disable()});var c=function(e){l.onChange(e)};this.editor.on("changeSession",function(e){e.oldSession.off("change",c),e.session.on("change",c)})}return _createClass(r,[{key:"enable",value:function(){var r=this;this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1});var o=new e(this.metadataManager),s=new t,a=new n(this.metadataManager,i),l=this.graphics,c=this.preamble,u=this.files,d={getCompletions:function(e,t,n,r,o){var s=i.getContext(e,n),a=s.commandFragment;if(a){var u=a.match(/^~?\\(includegraphics(?:\[.*])?){([^}]*, *)?(\w*)/);if(u){var d=u[1],h=c.getGraphicsPaths(),f=[],p=!0,g=!1,m=void 0;try{for(var v,y=l.getGraphicsFiles()[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var w=v.value,b=w.path,_=!0,C=!1,k=void 0;try{for(var S,$=h[Symbol.iterator]();!(_=(S=$.next()).done);_=!0){var x=S.value;if(0===b.indexOf(x)){b=b.slice(x.length);break}}}catch(A){C=!0,k=A}finally{try{_||null==$["return"]||$["return"]()}finally{if(C)throw k}}f.push({caption:"\\".concat(d,"{").concat(b,"}"),value:"\\".concat(d,"{").concat(b,"}"),meta:"graphic",score:50})}}catch(A){g=!0,m=A}finally{try{p||null==y["return"]||y["return"]()}finally{if(g)throw m}}o(null,f)}}}},h=this.metadataManager,f={getCompletions:function(e,t,n,o,s){var a=i.getContext(e,n),l=a.commandFragment;if(l){var c=l.match(/^\\(input|include){(\w*)/);if(c){var d=c[1],h=[],f=!0,p=!1,g=void 0;try{for(var m,v=u.getTeXFiles()[Symbol.iterator]();!(f=(m=v.next()).done);f=!0){var y=m.value;if(y.id!==r.$scope.docId){var w=y.path;h.push({caption:"\\".concat(d,"{").concat(w,"}"),value:"\\".concat(d,"{").concat(w,"}"),meta:"file",score:50})}}}catch(b){p=!0,g=b}finally{try{f||null==v["return"]||v["return"]()}finally{if(p)throw g}}s(null,h)}}}},p={getCompletions:function(e,t,n,r,o){var s=i.getContext(e,n),a=s.commandFragment;if(a){var l=a.match(/^~?\\([a-zA-Z]*ref){([^}]*, *)?(\w*)/);if(l){var c=l[1],u=[];"ref"!==c&&u.push({caption:"\\".concat(c,"{}"),snippet:"\\".concat(c,"{}"),meta:"cross-reference",score:60});var d=!0,f=!1,p=void 0;try{for(var g,m=h.getAllLabels()[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var v=g.value;u.push({caption:"\\".concat(c,"{").concat(v,"}"),value:"\\".concat(c,"{").concat(v,"}"),meta:"cross-reference",score:50})}}catch(y){f=!0,p=y}finally{try{d||null==m["return"]||m["return"]()}finally{if(f)throw p}}o(null,u)}}}},g=this.$scope.$root._references,m={getCompletions:function(e,t,n,r,o){var s=i.getContext(e,n),a=s.commandFragment;if(a){var l=a.match(/^~?\\([a-z]*cite[a-z]*(?:\[.*])?){([^}]*, *)?(\w*)/);if(l){var c=_slicedToArray(l,3),u=(c[0],c[1]),d=c[2];null==d&&(d="");var h=[];h.push({caption:"\\".concat(u,"{}"),snippet:"\\".concat(u,"{}"),meta:"reference",score:60}),g.keys&&g.keys.length>0?(g.keys.forEach(function(e){null!=e&&h.push({caption:"\\".concat(u,"{").concat(d).concat(e,"}"),value:"\\".concat(u,"{").concat(d).concat(e,"}"),meta:"reference",score:50})}),o(null,h)):o(null,h)}}}};this.editor.completers=[o,s,a,m,p,d,f]}},{key:"disable",value:function(){return this.editor.setOptions({enableBasicAutocompletion:!1,enableSnippets:!1})}},{key:"onChange",value:function(e){var t,n=this,r=this.editor.getCursorPosition(),o=e.end,s=i.getContext(this.editor,o),a=s.lineUpToCursor,l=s.commandFragment;if(!((t=a.indexOf("%"))>-1&&"\\"!==a[t-1])){var c="\\"===a.slice(-1),u=a.slice(-2);if(/^\\[^a-zA-Z]$/.test(u))return void(this.editor.completer&&this.editor.completer.detach());"insert"===e.action&&o.row===r.row&&o.column===r.column+1&&((null!=l?l.length:void 0)>2||c)&&setTimeout(function(){n.editor.execCommand("startAutocomplete")},0);var d=e.lines[0].match(/\\(\w+){}/);return"insert"===e.action&&d&&d[1]&&/(begin|end|[a-zA-Z]*ref|usepackage|[a-z]*cite[a-z]*|input|include)/.test(d[1])?setTimeout(function(){n.editor.execCommand("startAutocomplete")},0):void 0}}},{key:"monkeyPatchAutocomplete",value:function(){var e=this,t=ace.require("ace/autocomplete"),n=t.Autocomplete,r=ace.require("ace/autocomplete/util");null==n.prototype._insertMatch&&(n.prototype._insertMatch=n.prototype.insertMatch,n.prototype.insertMatch=function(e){var t=this.editor,r=t.getCursorPosition(),a=new o(r.row,r.column,r.row,r.column+1),l=t.session.getTextRange(a);if(/^\\\w+(\[[\w\\,=. ]*\])?{/.test(this.completions.filterText)&&"}"===l&&t.session.remove(a),null==e){var c=this.completions,u=this.popup;e=u.getData(u.getRow()),e.completer={insertMatch:function(e,t){var n=!0,r=!1,l=void 0;try{for(var u,d=e.selection.getAllRanges()[Symbol.iterator]();!(n=(u=d.next()).done);n=!0){a=u.value;var h=_.clone(a),f=_.clone(a),p=e.getSession().getTextRange(new o(a.start.row,0,a.start.row,a.start.column)),g=i.getLastCommandFragmentIndex(p);-1!==g?h.start.column=g:h.start.column-=c.filterText.length,e.session.remove(h);var m=e.getSession().getTextRange(new o(f.start.row,f.start.column,f.end.row,99999));if(m){var v=m.match(/^([a-zA-Z0-9]+)\{/);if(v){var y=v[1];f.end.column+=y.length-c.filterText.length,e.session.remove(f),null!=t.snippet&&(t.snippet=t.snippet.replace(/[{[].*[}\]]/,"")),null!=t.caption&&(t.caption=t.caption.replace(/[{[].*[}\]]/,"")),null!=t.value&&(t.value=t.value.replace(/[{[].*[}\]]/,""))}var w=m.match(/^([\w._-]+)\}(.*)/);if(w){var b=w[1],C=w[2];C&&(f.end.column=f.start.column+b.length+1),e.session.remove(f)}}}}catch(k){r=!0,l=k}finally{try{n||null==d["return"]||d["return"]()}finally{if(r)throw l}}t.snippet?s.insertSnippet(e,t.snippet):e.execCommand("insertstring",t.value||t)}}}n.prototype._insertMatch.call(this,e)},n.startCommand={name:"startAutocomplete",exec:function(t){var i;t.completer||(t.completer=new n),t.completer.autoInsert=!1,t.completer.autoSelect=!0,t.completer.showPopup(t),t.completer.cancelContextMenu();var r=$(null!=t.completer.popup?t.completer.popup.container:void 0);if(r.css({"font-size":e.$scope.fontSize+"px"}),i=t.completer.completions&&t.completer.completions.filtered){var o=_.max(i.map(function(e){return e.caption.length})),s=_.max(i.map(function(e){return e.meta.length})),a=t.renderer.characterWidth,l=Math.max(Math.min(Math.round(o*a+s*a+5*a),700),280);r.css({width:"".concat(l,"px")})}0===i.length&&t.completer.detach()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"}),r.retrievePrecedingIdentifier=function(e,t,n){
for(var r=0,o=t-1;0>=o;o++)if("\n"===e[o]){r=o+1;break}var s=e.slice(r,t),a=i.getLastCommandFragment(s)||"";return a}}}]),r}();return a}),define("ide/editor/directives/aceEditor/spell-check/SpellCheckManager",[],function(){var e;return e=function(){return e=function(){function e(t,n,i,r,o){var s=this;_classCallCheck(this,e),this.onChange=this.onChange.bind(this),this.onSessionChange=this.onSessionChange.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onScroll=this.onScroll.bind(this),this.learnWord=this.learnWord.bind(this),this.$scope=t,this.cache=n,this.$http=i,this.$q=r,this.adapter=o,this.$scope.spellMenu={open:!1,top:"0px",left:"0px",suggestions:[]},this.inProgressRequest=null,this.updatedLines=[],this.$scope.$watch("spellCheckLanguage",function(e,t){return e!==t&&null!=t?s.runFullCheck():void 0}),this.$scope.replaceWord=this.adapter.replaceWord,this.$scope.learnWord=this.learnWord,$(document).on("click",function(e){return 3!==e.which&&s.closeContextMenu(),!0})}return _createClass(e,null,[{key:"initClass",value:function(){this.prototype.blacklistedCommandRegex=new RegExp("\\\\(label|[a-z]{0,16}ref|usepackage|begin|end|[a-z]{0,16}cite|input|include|includegraphics)(\\[[^\\]]*\\])?\\{[^}]*\\}","g")}}]),_createClass(e,[{key:"init",value:function(){return this.updatedLines=Array(this.adapter.getLines().length).fill(!0),this.isSpellCheckEnabled()?this.runSpellCheckSoon(200):void 0}},{key:"isSpellCheckEnabled",value:function(){return!(!this.$scope.spellCheck||!this.$scope.spellCheckLanguage||""===this.$scope.spellCheckLanguage)}},{key:"onChange",value:function(e){return this.isSpellCheckEnabled()?(this.markLinesAsUpdated(this.adapter.normalizeChangeEvent(e)),this.adapter.highlightedWordManager.clearHighlightTouchingRange(e),this.runSpellCheckSoon()):void 0}},{key:"onSessionChange",value:function(){return this.adapter.highlightedWordManager.reset(),null!=this.inProgressRequest&&this.inProgressRequest.abort(),this.isSpellCheckEnabled()?this.runSpellCheckSoon(200):void 0}},{key:"onContextMenu",value:function(e){return this.closeContextMenu(),this.openContextMenu(e)}},{key:"onScroll",value:function(){return this.closeContextMenu()}},{key:"openContextMenu",value:function(e){var t=this,n=this.adapter.getCoordsFromContextMenuEvent(e),i=this.adapter.getHighlightFromCoords(n),r=this.adapter.isContextMenuEventOnBottomHalf(e);return i?(this.adapter.preventContextMenuEventDefault(e),this.adapter.selectHighlightedWord(i),this.$scope.$apply(function(){return t.$scope.spellMenu={open:!0,top:n.y+"px",left:n.x+"px",layoutFromBottom:r,highlight:i}}),!1):void 0}},{key:"closeContextMenu",value:function(){var e=this;return(null!=this.$scope?this.$scope.spellMenu:void 0)&&this.$scope.spellMenu.open!==!1?this.$scope.$apply(function(){return e.$scope.spellMenu.open=!1}):void 0}},{key:"learnWord",value:function(e){this.apiRequest("/learn",{word:e.word}),this.adapter.highlightedWordManager.removeWord(e.word);var t=this.$scope.spellCheckLanguage;return null!=this.cache?this.cache.put("".concat(t,":").concat(e.word),!0):void 0}},{key:"runFullCheck",value:function(){return this.adapter.highlightedWordManager.reset(),this.isSpellCheckEnabled()?this.runSpellCheck():void 0}},{key:"markLinesAsUpdated",value:function(e){var t=this,n=e.start,i=e.end,r=function(){var e=i.row-n.row;return function(){for(var i=[];e--;)i.push(t.updatedLines.splice(n.row,0,!0));return i}()},o=function(){var e=i.row-n.row;return function(){for(var i=[];e--;)i.push(t.updatedLines.splice(n.row+1,1));return i}()};return"insert"===e.action?(this.updatedLines[n.row]=!0,r()):"remove"===e.action?(this.updatedLines[n.row]=!0,o()):void 0}},{key:"runSpellCheckSoon",value:function(e){var t=this;null==e&&(e=1e3);var n=function(){return delete t.timeoutId,t.runSpellCheck(t.updatedLines),t.updatedLines=[]};return null!=this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(n,e)}},{key:"runSpellCheck",value:function(e){var t,n,i,r,o=this,s=this.getWords(e),a=s.words,l=s.positions,c=this.$scope.spellCheckLanguage,u=[],d={},h=[],f=[];for(t=0,n=t;t<a.length;t++,n=t){r=a[n],i="".concat(c,":").concat(r),null==d[i]&&(d[i]=this.cache.get(i));var p=d[i];null==p?(h.push(a[n]),f.push(l[n])):p===!0||u.push({column:l[n].column,row:l[n].row,word:r,suggestions:p})}a=h,l=f;var g=function(t){if(null!=e)for(var n=0;n<e.length;n++){var i=e[n];i&&o.adapter.highlightedWordManager.clearRow(n)}else o.adapter.highlightedWordManager.reset();return Array.from(t).map(function(e){return o.adapter.highlightedWordManager.addHighlight(e)})};return a.length?this.inProgressRequest=this.apiRequest("/check",{language:c,words:a},function(e,t){if(delete o.inProgressRequest,null!=e||null==t||null==t.misspellings)return null;for(var s=[],h=0,f=Array.from(t.misspellings);h<f.length;h++){var p=f[h];r=a[p.index];var m=l[p.index];s[p.index]=!0,u.push({column:m.column,row:m.row,word:r,suggestions:p.suggestions}),i="".concat(c,":").concat(r),d[i]||(o.cache.put(i,p.suggestions),d[i]=!0)}for(n=0;n<a.length;n++)r=a[n],s[n]||(i="".concat(c,":").concat(r),d[i]||(o.cache.put(i,!0),d[i]=!0));return g(u)}):g(u)}},{key:"apiRequest",value:function(e,t,n){null==n&&(n=function(e,t){}),t.token=window.user.id,t._csrf=window.csrfToken;var i=this.$q.defer(),r={timeout:i.promise},o=(this.$http.post("/spelling".concat(e),t,r).then(function(e){return n(null,e.data)})["catch"](function(e){return n(new Error("api failure"))}),function(){return i.resolve()});return{abort:o}}},{key:"getWords",value:function(e){for(var t=this.adapter.getLines(),n=[],i=[],r=0;r<t.length;r++){var o=t[r];if(o=this.blankOutBlacklistedCommands(o),null==e||e[r])for(var s,a=/\\?(?:['A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])+/g;s=a.exec(o);){var l=s[0];"'"===l[0]&&(l=l.slice(1)),"'"===l[l.length-1]&&(l=l.slice(0,-1)),i.push({row:r,column:s.index}),n.push(l)}}return{words:n,positions:i}}},{key:"blankOutBlacklistedCommands",value:function(e){return e.replace(this.blacklistedCommandRegex,function(e){return Array(e.length+1).join(".")})}}]),e}(),e.initClass(),e}()}),define("ide/editor/directives/aceEditor/spell-check/HighlightedWordManager",["ace/ace"],function(){var e,t=ace.require("ace/range"),n=t.Range,i=function r(e,t,n){_classCallCheck(this,r),this.markerId=e,this.range=t,this.word=n.word,this.suggestions=n.suggestions};return e=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.reset()}return _createClass(e,[{key:"reset",value:function(){var e=this;return null!=this.highlights&&this.highlights.forEach(function(t){return e.editor.getSession().removeMarker(t.markerId)}),this.highlights=[]}},{key:"addHighlight",value:function(e){var t=this.editor.getSession(),r=t.getDocument(),o=new n;o.start=r.createAnchor({row:e.row,column:e.column}),o.end=r.createAnchor({row:e.row,column:e.column+e.word.length}),o.end.$insertRight=!0;var s=t.addMarker(o,"spelling-highlight","text",!1);return this.highlights.push(new i(s,o,e))}},{key:"removeHighlight",value:function(e){return this.editor.getSession().removeMarker(e.markerId),this.highlights=this.highlights.filter(function(t){return t!==e})}},{key:"removeWord",value:function(e){var t=this;return this.highlights.filter(function(t){return t.word===e}).forEach(function(e){return t.removeHighlight(e)})}},{key:"clearRow",value:function(e){var t=this;return this.highlights.filter(function(t){return t.range.start.row===e}).forEach(function(e){return t.removeHighlight(e)})}},{key:"findHighlightWithinRange",value:function(e){var t=this;return _.find(this.highlights,function(n){return t._doesHighlightOverlapRange(n,e.start,e.end)})}},{key:"_doesHighlightOverlapRange",value:function(e,t,n){var i=e.range.start.row,r=e.range.start.column,o=e.range.end.column,s=i<t.row||i===t.row&&o<=t.column,a=i>n.row||i===n.row&&r>=n.column;return!(s||a)}},{key:"clearHighlightTouchingRange",value:function(e){var t=this,n=_.find(this.highlights,function(n){return t._doesHighlightTouchRange(n,e.start,e.end)});return n?this.removeHighlight(n):void 0}},{key:"_doesHighlightTouchRange",value:function(e,t,n){var i=e.range.start.row,r=e.range.start.column,o=e.range.end.column,s=r<=t.column&&o>=t.column,a=r<=n.column&&o>=n.column;return i===t.row&&(s||a)}}]),e}()}),define("ide/editor/directives/aceEditor/spell-check/SpellCheckAdapter",["ace/ace","ide/editor/directives/aceEditor/spell-check/HighlightedWordManager"],function(e,t){var n,i=ace.require("ace/range"),r=i.Range;return n=function(){function e(n){_classCallCheck(this,e),this.replaceWord=this.replaceWord.bind(this),this.editor=n,this.highlightedWordManager=new t(this.editor)}return _createClass(e,[{key:"getLines",value:function(){return this.editor.getValue().split("\n")}},{key:"normalizeChangeEvent",value:function(e){return e}},{key:"getCoordsFromContextMenuEvent",value:function(e){return e.domEvent.stopPropagation(),{x:e.domEvent.clientX,y:e.domEvent.clientY}}},{key:"preventContextMenuEventDefault",value:function(e){return e.domEvent.preventDefault()}},{key:"getHighlightFromCoords",value:function(e){var t=this.editor.renderer.screenToTextCoordinates(e.x,e.y);return this.highlightedWordManager.findHighlightWithinRange({start:t,end:t})}},{key:"isContextMenuEventOnBottomHalf",value:function(e){var t=e.domEvent.clientY,n=e.target.container.getBoundingClientRect(),i=(t-n.top)/n.height;return i>.5}},{key:"selectHighlightedWord",value:function(e){var t=e.range.start.row,n=e.range.start.column,i=e.range.end.column;return this.editor.getSession().getSelection().setSelectionRange(new r(t,n,t,i))}},{key:"replaceWord",value:function(e,t){var n=e.range.start.row,i=e.range.start.column,o=e.range.end.column;return this.editor.getSession().replace(new r(n,i,n,o),t),this.editor.focus()}}]),e}()}),define("ide/colors/ColorManager",[],function(){var e;return e={getColorScheme:function(e,t){return this.isDarkTheme(t)?{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 100%, 28%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 100%, 20%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 100%, 60%);")}:{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 70%, 85%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 70%, 95%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 70%, 40%);")}},isDarkTheme:function(e){var t=e.find(".ace_editor").css("background-color"),n=Array.from(t.match(/rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)/)),i=_slicedToArray(n,4),r=(i[0],i[1]),o=i[2],s=i[3];return r=parseInt(r,10),o=parseInt(o,10),s=parseInt(s,10),384>r+o+s},OWN_HUE:200,ANONYMOUS_HUE:100,getHueForUserId:function(e){return null==e||"anonymous-user"===e?this.ANONYMOUS_HUE:window.user.id===e?this.OWN_HUE:(hue=this.getHueForId(e),hue>this.OWNER_HUE-20&&(hue+=40),hue)},getHueForTagId:function(e){return this.getHueForId(e)},getHueForId:function(e){var t=CryptoJS.MD5(e),n=parseInt(t.toString().slice(0,8),16)%320;return n}}}),define("ide/editor/directives/aceEditor/highlights/HighlightsManager",["ace/ace","ide/colors/ColorManager"],function(e,t){var n,i=ace.require("ace/range"),r=i.Range;return n=function(){function e(t,n,i){var r=this;_classCallCheck(this,e),this.$scope=t,this.editor=n,this.element=i,this.markerIds=[],this.labels=[],this.$scope.annotationLabel={show:!1,right:"auto",left:"auto",top:"auto",bottom:"auto",backgroundColor:"black",text:""},this.$scope.updateLabels={updatesAbove:0,updatesBelow:0},this.$scope.$watch("highlights",function(e){return r.redrawAnnotations()}),this.$scope.$watch("theme",function(e){return r.redrawAnnotations()}),this.editor.on("mousemove",function(e){var t=r.editor.renderer.screenToTextCoordinates(e.clientX,e.clientY);return e.position=t,r.showAnnotationLabels(t)});var o=function(){return r.updateShowMoreLabels()};this.editor.getSession().on("changeScrollTop",o),this.$scope.$watch("text",function(){return r.$scope.navigateHighlights?setTimeout(function(){return r.scrollToFirstHighlight()},0):void 0}),this.editor.on("changeSession",function(e){return null!=e.oldSession&&e.oldSession.off("changeScrollTop",o),e.session.on("changeScrollTop",o),r.redrawAnnotations()}),this.$scope.gotoHighlightBelow=function(){return null!=r.firstHiddenHighlightAfter?r.editor.scrollToLine(r.firstHiddenHighlightAfter.end.row,!0,!1):void 0},this.$scope.gotoHighlightAbove=function(){return null!=r.lastHiddenHighlightBefore?r.editor.scrollToLine(r.lastHiddenHighlightBefore.start.row,!0,!1):void 0}}return _createClass(e,[{key:"redrawAnnotations",value:function(){var e=this;this._clearMarkers(),this._clearLabels();for(var n=0,i=Array.from(this.$scope.highlights||[]);n<i.length;n++){var o=i[n];!function(n){var i=t.getColorScheme(n.hue,e.element);return null!=n.cursor?(e.labels.push({text:n.label,range:new r(n.cursor.row,n.cursor.column,n.cursor.row,n.cursor.column+1),colorScheme:i,snapToStartOfRange:!0}),e._drawCursor(n,i)):null!=n.highlight?(e.labels.push({text:n.label,range:new r(n.highlight.start.row,n.highlight.start.column,n.highlight.end.row,n.highlight.end.column),colorScheme:i}),e._drawHighlight(n,i)):null!=n.strikeThrough?(e.labels.push({text:n.label,range:new r(n.strikeThrough.start.row,n.strikeThrough.start.column,n.strikeThrough.end.row,n.strikeThrough.end.column),colorScheme:i}),e._drawStrikeThrough(n,i)):void 0}(o)}return this.updateShowMoreLabels()}},{key:"showAnnotationLabels",value:function(e){for(var t=this,n=null,i=0,r=Array.from(this.labels||[]);i<r.length;i++){var o=r[i];o.range.contains(e.row,e.column)&&(n=o)}if(null!=n){var s,a,l,c,u,d=$(this.editor.renderer.container).find(".ace_scroller");d.append(this.element.find(".annotation-label")),a=n.snapToStartOfRange?this.editor.renderer.textToScreenCoordinates(n.range.start.row,n.range.start.column):this.editor.renderer.textToScreenCoordinates(e.row,e.column);var h=d.offset(),f=d.height();a.pageX=a.pageX-h.left,a.pageY=a.pageY-h.top,a.pageY>2*this.editor.renderer.lineHeight?(u="auto",s=f-a.pageY):(u=a.pageY+this.editor.renderer.lineHeight,s="auto"),this.$scope.$apply(function(){return t.$scope.annotationLabel.text=n.text,t.$scope.annotationLabel.show=!0});var p=this.element.find(".annotation-label");return a.pageX+p.outerWidth()<d.width()?(l=a.pageX,c="auto"):(c=0,l="auto"),this.$scope.$apply(function(){return t.$scope.annotationLabel={show:!0,left:l,right:c,bottom:s,top:u,backgroundColor:n.colorScheme.labelBackgroundColor,text:n.text}})}return __guard__(null!=this.$scope?this.$scope.annotationLabel:void 0,function(e){return e.show})!==!1?this.$scope.$apply(function(){return t.$scope.annotationLabel.show=!1}):void 0}},{key:"updateShowMoreLabels",value:function(){var e=this;if(this.$scope.navigateHighlights)return setTimeout(function(){var t=e.editor.getFirstVisibleRow(),n=e.editor.getLastVisibleRow(),i=0,r=0;e.lastHiddenHighlightBefore=null,e.firstHiddenHighlightAfter=null;for(var o=0,s=Array.from(e.$scope.highlights||[]);o<s.length;o++){var a=s[o],l=a.highlight||a.strikeThrough;null!=l&&(l.start.row<t&&(i+=1,e.lastHiddenHighlightBefore=l),l.end.row>n&&(r+=1,e.firstHiddenHighlightAfter||(e.firstHiddenHighlightAfter=l)))}return e.$scope.$apply(function(){return e.$scope.updateLabels={highlightsBefore:i,highlightsAfter:r}})},100)}},{key:"scrollToFirstHighlight",value:function(){var e=this;return function(){for(var t=[],n=0,i=Array.from(e.$scope.highlights||[]);n<i.length;n++){var r=i[n],o=r.highlight||r.strikeThrough;if(null!=o){e.editor.scrollToLine(o.start.row,!0,!1);break}}return t}()}},{key:"_clearMarkers",value:function(){for(var e=0,t=Array.from(this.markerIds);e<t.length;e++){var n=t[e];this.editor.getSession().removeMarker(n)}return this.markerIds=[]}},{key:"_clearLabels",value:function(){return this.labels=[]}},{key:"_drawCursor",value:function(e,t){return this._addMarkerWithCustomStyle(new r(e.cursor.row,e.cursor.column,e.cursor.row,e.cursor.column+1),"annotation remote-cursor",!1,"border-color: ".concat(t.cursor,";"))}},{key:"_drawHighlight",value:function(e,t){return this._addMarkerWithCustomStyle(new r(e.highlight.start.row,e.highlight.start.column,e.highlight.end.row,e.highlight.end.column),"annotation highlight",!1,"background-color: ".concat(t.highlightBackgroundColor))}},{key:"_drawStrikeThrough",value:function(e,t){return this._addMarkerWithCustomStyle(new r(e.strikeThrough.start.row,e.strikeThrough.start.column,e.strikeThrough.end.row,e.strikeThrough.end.column),"annotation strike-through-background",!1,"background-color: ".concat(t.strikeThroughBackgroundColor)),this._addMarkerWithCustomStyle(new r(e.strikeThrough.start.row,e.strikeThrough.start.column,e.strikeThrough.end.row,e.strikeThrough.end.column),"annotation strike-through-foreground",!0,"color: ".concat(t.strikeThroughForegroundColor,";"))}},{key:"_addMarkerWithCustomStyle",value:function(e,t,n,i){var r;return r=n?this.editor.renderer.$markerFront:this.editor.renderer.$markerBack,this.markerIds.push(this.editor.getSession().addMarker(e,t,function(e,n,o,s,a){return n.isMultiLine()?r.drawTextMarker(e,n,t,a,i):r.drawSingleLineMarker(e,n,"".concat(t," ace_start"),a,0,i)},n))}}]),e}()}),define("ide/editor/directives/aceEditor/cursor-position/CursorPositionManager",[],function(){var e;return e=function(){function e(t,n,i){var r=this;_classCallCheck(this,e),this.storePositionAndLine=this.storePositionAndLine.bind(this),this.jumpToPositionInNewDoc=this.jumpToPositionInNewDoc.bind(this),this.onUnload=this.onUnload.bind(this),this.onCursorChange=this.onCursorChange.bind(this),this.onSyncToPdf=this.onSyncToPdf.bind(this),this.$scope=t,this.adapter=n,this.localStorage=i,this.$scope.$on("editorInit",this.jumpToPositionInNewDoc),this.$scope.$on("beforeChangeDocument",this.storePositionAndLine),this.$scope.$on("afterChangeDocument",this.jumpToPositionInNewDoc),this.$scope.$on("changeEditor",this.storePositionAndLine),this.$scope.$on("".concat(this.$scope.name,":gotoLine"),function(e,t,n){return null!=t?setTimeout(function(){return r.adapter.gotoLine(t,n)},10):void 0}),this.$scope.$on("".concat(this.$scope.name,":gotoOffset"),function(e,t){return null!=t?setTimeout(function(){return r.adapter.gotoOffset(t)},10):void 0}),this.$scope.$on("".concat(this.$scope.name,":clearSelection"),function(e){return r.adapter.clearSelection()})}return _createClass(e,[{key:"storePositionAndLine",value:function(){return this.storeCursorPosition(),this.storeFirstVisibleLine()}},{key:"jumpToPositionInNewDoc",value:function(){var e=this;return this.doc_id=null!=this.$scope.sharejsDoc?this.$scope.sharejsDoc.doc_id:void 0,setTimeout(function(){return e.gotoStoredPosition()},0)}},{key:"onUnload",value:function(){return this.storeCursorPosition(),this.storeFirstVisibleLine()}},{key:"onCursorChange",value:function(){return this.emitCursorUpdateEvent()}},{key:"onSyncToPdf",value:function(){return this.$scope.$emit("cursor:".concat(this.$scope.name,":syncToPdf"))}},{key:"storeFirstVisibleLine",value:function(){if(null!=this.doc_id){var e=this.localStorage("doc.position.".concat(this.doc_id))||{};return e.firstVisibleLine=this.adapter.getEditorScrollPosition(),this.localStorage("doc.position.".concat(this.doc_id),e)}}},{key:"storeCursorPosition",value:function(){if(null!=this.doc_id){var e=this.localStorage("doc.position.".concat(this.doc_id))||{};return e.cursorPosition=this.adapter.getCursor(),this.localStorage("doc.position.".concat(this.doc_id),e)}}},{key:"emitCursorUpdateEvent",value:function(){var e=this.adapter.getCursor();return this.$scope.$emit("cursor:".concat(this.$scope.name,":update"),e)}},{key:"gotoStoredPosition",value:function(){if(null!=this.doc_id){var e=this.localStorage("doc.position.".concat(this.doc_id))||{};return this.adapter.setCursor(e),this.adapter.setEditorScrollPosition(e)}}}]),e}()}),define("ide/editor/EditorShareJsCodec",[],function(){var e;return e={rangeToShareJs:function(e,t){for(var n=0,i=0;i<t.length;i++){var r=t[i];n+=i<e.row?r.length:e.column}return n+=e.row},changeToShareJs:function(t,n){var i=e.rangeToShareJs(t.start,n),r=t.lines.join("\n");switch(t.action){case"insert":return{i:r,p:i};case"remove":return{d:r,p:i};default:throw new Error("unknown action: ".concat(t.action))}},shareJsOffsetToRowColumn:function(e,t){var n=0;for(n=0;n<t.length;n++){var i=t[n];if(e<=i.length)break;e-=t[n].length+1}return{row:n,column:e}}}}),define("ide/editor/directives/aceEditor/cursor-position/CursorPositionAdapter",["ide/editor/EditorShareJsCodec"],function(e){var t;return t=function(){function t(e){_classCallCheck(this,t),this.editor=e}return _createClass(t,[{key:"getCursor",value:function(){return this.editor.getCursorPosition()}},{key:"getEditorScrollPosition",value:function(){return this.editor.getFirstVisibleRow()}},{key:"setCursor",value:function(e){return e=e.cursorPosition||{row:0,column:0},this.editor.moveCursorToPosition(e)}},{key:"setEditorScrollPosition",value:function(e){return e=e.firstVisibleLine||0,this.editor.scrollToLine(e)}},{key:"clearSelection",value:function(){return this.editor.selection.clearSelection()}},{key:"gotoLine",value:function(e,t){return this.editor.gotoLine(e,t),this.editor.scrollToLine(e,!0,!0),this.editor.focus()}},{key:"gotoOffset",value:function(t){var n=this.editor.getSession().getDocument().getAllLines(),i=e.shareJsOffsetToRowColumn(t,n);return this.gotoLine(i.row+1,i.column)}}]),t}()}),define("ide/editor/directives/aceEditor/track-changes/TrackChangesManager",["ace/ace","utils/EventEmitter","ide/colors/ColorManager","ide/editor/EditorShareJsCodec"],function(e,t,n,i){var r=ace.require("ace/range"),o=r.Range,s=function(){function e(t,n,i,r){var o=this;_classCallCheck(this,e),this._doneUpdateThisLoop=!1,this._pendingUpdates=!1,this.onChangeSession=this.onChangeSession.bind(this),this.onChangeSelection=this.onChangeSelection.bind(this),this.onCut=this.onCut.bind(this),this.onPaste=this.onPaste.bind(this),this.onResize=this.onResize.bind(this),this.tearDown=this.tearDown.bind(this),this.$scope=t,this.editor=n,this.element=i,this.adapter=r,this._scrollTimeout=null,this.changingSelection=!1,null==window.trackChangesManager&&(window.trackChangesManager=this),this.$scope.$watch("trackChanges",function(e){null!=e&&o.setTrackChanges(e)}),this.$scope.$watch("sharejsDoc",function(e,t){null!=e&&(null!=t&&o.disconnectFromDoc(t),o.setTrackChanges(o.$scope.trackChanges),o.connectToDoc(e))}),this.$scope.$on("comment:add",function(e,t,n,i){o.addCommentToSelection(t,n,i)}),this.$scope.$on("comment:select_line",function(e){o.selectLineIfNoSelection()}),this.$scope.$on("changes:accept",function(e,t){o.acceptChangeIds(t)}),this.$scope.$on("changes:reject",function(e,t){o.rejectChangeIds(t)}),this.$scope.$on("comment:remove",function(e,t){o.removeCommentId(t)}),this.$scope.$on("comment:resolve_threads",function(e,t){o.hideCommentsByThreadIds(t)}),this.$scope.$on("comment:unresolve_thread",function(e,t){o.showCommentByThreadId(t)}),this.$scope.$on("review-panel:recalculate-screen-positions",function(){o.recalculateReviewEntriesScreenPositions()}),this._resetCutState()}return _createClass(e,[{key:"onChangeSession",value:function(e){this.clearAnnotations(),this.redrawAnnotations(),this.editor&&this.editor.session.on("changeScrollTop",this.onChangeScroll.bind(this))}},{key:"onChangeScroll",value:function(){var e=this;return null==this._scrollTimeout?this._scrollTimeout=setTimeout(function(){return e.recalculateVisibleEntries(),e.$scope.$apply(),e._scrollTimeout=null},200):void 0}},{key:"onChangeSelection",value:function(){var e=this;return this.changingSelection?void 0:(this.changingSelection=!0,this.$scope.$evalAsync(function(){return e.changingSelection=!1,e.updateFocus()}))}},{key:"onResize",value:function(){this.recalculateReviewEntriesScreenPositions()}},{key:"connectToDoc",value:function(e){var t=this;this.rangesTracker=e.ranges,this.setTrackChanges(this.$scope.trackChanges),e.on("ranges:dirty",function(){t.updateAnnotations()}),e.on("ranges:clear",function(){t.clearAnnotations()}),e.on("ranges:redraw",function(){t.redrawAnnotations()})}},{key:"disconnectFromDoc",value:function(e){e.off("ranges:clear"),e.off("ranges:redraw"),e.off("ranges:dirty")}},{key:"tearDown",value:function(){this.adapter.tearDown()}},{key:"setTrackChanges",value:function(e){e?null!=this.$scope.sharejsDoc&&(this.$scope.sharejsDoc.track_changes_as=window.user.id||"anonymous"):null!=this.$scope.sharejsDoc&&(this.$scope.sharejsDoc.track_changes_as=null)}},{key:"clearAnnotations",value:function(){this.adapter.clearAnnotations()}},{key:"redrawAnnotations",value:function(){for(var e=this,t=0,n=Array.from(this.rangesTracker.changes);t<n.length;t++){var i=n[t];null!=i.op.i?this.adapter.onInsertAdded(i):null!=i.op.d&&this.adapter.onDeleteAdded(i)}Array.from(this.rangesTracker.comments).map(function(t){e.isCommentResolved(t)||e.adapter.onCommentAdded(t)}),this.broadcastChange()}},{key:"updateAnnotations",value:function(){var e=this;return this._doneUpdateThisLoop?void(this._pendingUpdates=!0):(this._doUpdateAnnotations(),this._doneUpdateThisLoop=!0,setTimeout(function(){e._pendingUpdates&&e._doUpdateAnnotations(),e._doneUpdateThisLoop=!1,e._pendingUpdates=!1}))}},{key:"_doUpdateAnnotations",value:function(){var e,t,n=this.rangesTracker.getDirtyState(),i=!1;
for(var r in n.change.added)e=n.change.added[r],null!=e.op.i?this.adapter.onInsertAdded(e):null!=e.op.d&&this.adapter.onDeleteAdded(e);for(r in n.change.removed)e=n.change.removed[r],null!=e.op.i?this.adapter.onInsertRemoved(e):null!=e.op.d&&this.adapter.onDeleteRemoved(e);for(r in n.change.moved)e=n.change.moved[r],i=!0,this.adapter.onChangeMoved(e);for(r in n.comment.added)t=n.comment.added[r],this.isCommentResolved(t)||this.adapter.onCommentAdded(t);for(r in n.comment.removed)t=n.comment.removed[r],this.isCommentResolved(t)||this.adapter.onCommentRemoved(t);for(r in n.comment.moved)t=n.comment.moved[r],this.adapter.onCommentMoved&&!this.isCommentResolved(t)&&(i=!0,this.adapter.onCommentMoved(t));this.editor||(i=!1),this.rangesTracker.resetDirtyState(),i&&this.editor.renderer.updateBackMarkers(),this.broadcastChange()}},{key:"addComment",value:function(e,t,n){var i={c:t,p:e,t:n};this.$scope.sharejsDoc.submitOp(i)}},{key:"addCommentToSelection",value:function(e,t,n){var i=this.adapter.shareJsOffsetToRowColumn(t),r=this.adapter.shareJsOffsetToRowColumn(t+n),s=new o(i.row,i.column,r.row,r.column),a=this.editor.session.getTextRange(s);this.addComment(t,a,e)}},{key:"isCommentResolved",value:function(e){return this.rangesTracker.resolvedThreadIds[e.op.t]}},{key:"selectLineIfNoSelection",value:function(){this.editor.selection.isEmpty()&&this.editor.selection.selectLine()}},{key:"acceptChangeIds",value:function(e){this.rangesTracker.removeChangeIds(e),this.updateAnnotations(),this.updateFocus()}},{key:"rejectChangeIds",value:function(e){var t=this,n=this.rangesTracker.getChanges(e);if(0!==n.length){n.sort(function(e,t){return t.op.p-e.op.p});for(var i=this.editor.getSession(),r=0,o=Array.from(n);r<o.length;r++){var s=o[r];if(null!=s.op.d){var a=s.op.d,l=this.adapter.shareJsOffsetToRowColumn(s.op.p);i.$fromReject=!0,i.insert(l,a),i.$fromReject=!1}else{if(null==s.op.i)throw new Error("unknown change: ".concat(JSON.stringify(s)));var c=this.adapter.shareJsOffsetToRowColumn(s.op.p),u=this.adapter.shareJsOffsetToRowColumn(s.op.p+s.op.i.length),d=i.getDocument().getTextRange({start:c,end:u});if(d!==s.op.i)throw new Error("Op to be removed (".concat(JSON.stringify(s.op),"), does not match editor text, '").concat(d,"'"));i.$fromReject=!0,i.remove({start:c,end:u}),i.$fromReject=!1}}setTimeout(function(){return t.updateFocus()})}}},{key:"removeCommentId",value:function(e){return this.rangesTracker.removeCommentId(e),this.updateAnnotations()}},{key:"hideCommentsByThreadIds",value:function(e){for(var t={},n=this.rangesTracker.comments||[],i=0,r=Array.from(e);i<r.length;i++){var o=r[i];t[o]=!0}var s=!0,a=!1,l=void 0;try{for(var c,u=n[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var d=c.value;t[d.op.t]&&this.adapter.onCommentRemoved(d)}}catch(h){a=!0,l=h}finally{try{s||null==u["return"]||u["return"]()}finally{if(a)throw l}}return this.broadcastChange()}},{key:"showCommentByThreadId",value:function(e){var t=this.rangesTracker.comments||[],n=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.op.t!==e||this.isCommentResolved(a)||this.adapter.onCommentAdded(a)}}catch(l){i=!0,r=l}finally{try{n||null==s["return"]||s["return"]()}finally{if(i)throw r}}return this.broadcastChange()}},{key:"_resetCutState",value:function(){return this._cutState={text:null,comments:[],docId:null}}},{key:"onCut",value:function(){var e=this;this._resetCutState();var t=this.editor.getSelectionRange(),n=this._rangeToShareJs(t.start),i=this._rangeToShareJs(t.end);return this._cutState.text=this.editor.getSelectedText(),this._cutState.docId=this.$scope.docId,function(){for(var t=[],r=0,o=Array.from(e.rangesTracker.comments);r<o.length;r++){var s=o[r],a=s.op.p,l=a+s.op.c.length;a>=n&&i>=l?t.push(e._cutState.comments.push({offset:s.op.p-n,text:s.op.c,comment:s})):t.push(void 0)}return t}()}},{key:"onPaste",value:function(){var e=this;this.editor.once("change",function(t){if("insert"===t.action){var n=t.lines.join("\n"),i=e._rangeToShareJs(t.start);e.$scope.sharejsDoc.on("ranges:dirty.paste",function(){if(e.$scope.sharejsDoc.off("ranges:dirty.paste"),n===e._cutState.text&&e.$scope.docId===e._cutState.docId)for(var t=0,r=Array.from(e._cutState.comments);t<r.length;t++){var o=r[t],s=o.comment,a=o.offset,l=o.text,c={c:l,p:i+a,t:s.id};e.$scope.sharejsDoc.submitOp(c)}e._resetCutState(),e.rangesTracker.validate(e.editor.getValue())})}})}},{key:"checkMapping",value:function(){var e,t,n,i,r,o,s=this.editor.getSession(),a={},l=s.getMarkers();for(var c in l)i=l[c],a[c]=i;for(var u=[],d=0,h=Array.from(this.rangesTracker.changes);d<h.length;d++){var f=h[d];if(null!=this.adapter.changeIdToMarkerIdMap[f.id]){r=f.op;var p=this.adapter.changeIdToMarkerIdMap[f.id];e=p.background_marker_id,t=p.callout_marker_id,o=this.adapter.shareJsOffsetToRowColumn(r.p),null!=r.i?n=this.adapter.shareJsOffsetToRowColumn(r.p+r.i.length):null!=r.d&&(n=o),u.push({marker_id:e,start:o,end:n}),u.push({marker_id:t,start:o,end:o})}}for(var g=0,m=Array.from(this.rangesTracker.comments);g<m.length;g++){var v=m[g];if(null!=this.adapter.changeIdToMarkerIdMap[v.id]){var y=this.adapter.changeIdToMarkerIdMap[v.id];e=y.background_marker_id,t=y.callout_marker_id,o=this.adapter.shareJsOffsetToRowColumn(v.op.p),n=this.adapter.shareJsOffsetToRowColumn(v.op.p+v.op.c.length),u.push({marker_id:e,start:o,end:n}),u.push({marker_id:t,start:o,end:o})}}for(var w=0,b=Array.from(u);w<b.length;w++){var _=b[w];c=_.marker_id,o=_.start,n=_.end,i=a[c],delete a[c],(i.range.start.row!==o.row||i.range.start.column!==o.column||i.range.end.row!==n.row||i.range.end.column!==n.column)&&console.error("Change doesn't match marker anymore",{change:f,marker:i,start:o,end:n})}return function(){var e=[];for(c in a)i=a[c],/track-changes/.test(i.clazz)?e.push(console.error("Orphaned ace marker",i)):e.push(void 0);return e}()}},{key:"broadcastChange",value:function(){this.$scope.$emit("editor:track-changes:changed",this.$scope.docId)}},{key:"recalculateReviewEntriesScreenPositions",value:function(){var e=this.editor.getSession(),t=this.editor.renderer,n=this._getCurrentDocEntries(),i=n||{};for(var r in i){var o=i[r],s=this.adapter.shareJsOffsetToRowColumn(o.offset),a=e.documentToScreenPosition(s.row,s.column),l=a.row*t.lineHeight;null==o.screenPos&&(o.screenPos={}),o.screenPos.y=l,o.docPos=s}this.recalculateVisibleEntries(),this.$scope.$apply()}},{key:"recalculateVisibleEntries",value:function(){var e=20,t=100,n=this.editor.renderer.layerConfig,i=n.firstRow,r=n.lastRow,o=this._getCurrentDocEntries()||{},s=Object.keys(o).length,a=!1;for(var l in o){var c=o[l],u=c.visible;c.visible=t>s||i-e<=c.docPos.row&&c.docPos.row<=r+e,c.visible!==u&&(a=!0)}a&&this.$scope.$emit("editor:track-changes:visibility_changed")}},{key:"_getCurrentDocEntries",value:function(){var e=this.$scope.docId,t=this.$scope.reviewPanel.entries[e]||{};return t}},{key:"updateFocus",value:function(){if(this.editor){var e=this.editor.getSelectionRange(),t=this._rangeToShareJs(e.start),n=this._rangeToShareJs(e.end),i=t!==n;this.$scope.$emit("editor:focus:changed",t,n,i)}}},{key:"_rangeToShareJs",value:function(e){var t=this.editor.getSession().getDocument().getLines(0,e.row);return i.rangeToShareJs(e,t)}},{key:"_changeToShareJs",value:function(e){var t=this.editor.getSession().getDocument().getLines(0,e.start.row);return i.changeToShareJs(e,t)}}]),e}();return s}),define("ide/editor/directives/aceEditor/track-changes/TrackChangesAdapter",["ace/ace","ide/editor/EditorShareJsCodec"],function(e,t){var n=ace.require("ace/range"),i=n.Range,r=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.changeIdToMarkerIdMap={}}return _createClass(e,[{key:"tearDown",value:function(){this.changeIdToMarkerIdMap={}}},{key:"clearAnnotations",value:function(){var e=this.editor.getSession();for(var t in this.changeIdToMarkerIdMap){var n=this.changeIdToMarkerIdMap[t];for(var i in n){var r=n[i];e.removeMarker(r)}}this.changeIdToMarkerIdMap={}}},{key:"onInsertAdded",value:function(e){var t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.i.length),r=this.editor.getSession(),o=new i(t.row,t.column,n.row,n.column),s=r.addMarker(o,"track-changes-marker track-changes-added-marker","text"),a=this.createCalloutMarker(t,"track-changes-added-marker-callout");this.changeIdToMarkerIdMap[e.id]={background_marker_id:s,callout_marker_id:a}}},{key:"onDeleteAdded",value:function(e){var t=this.shareJsOffsetToRowColumn(e.op.p),n=this.editor.getSession(),i=this.editor.renderer.$markerBack,r="track-changes-marker track-changes-deleted-marker",o=this.makeZeroWidthRange(t),s=n.addMarker(o,r,function(e,t,n,o,s){return i.drawSingleLineMarker(e,t,"".concat(r," ace_start"),s,0,"")}),a=this.createCalloutMarker(t,"track-changes-deleted-marker-callout");this.changeIdToMarkerIdMap[e.id]={background_marker_id:s,callout_marker_id:a}}},{key:"onInsertRemoved",value:function(e){var t=this.changeIdToMarkerIdMap[e.id],n=t.background_marker_id,i=t.callout_marker_id;delete this.changeIdToMarkerIdMap[e.id];var r=this.editor.getSession();r.removeMarker(n),r.removeMarker(i)}},{key:"onDeleteRemoved",value:function(e){var t=this.changeIdToMarkerIdMap[e.id],n=t.background_marker_id,i=t.callout_marker_id;delete this.changeIdToMarkerIdMap[e.id];var r=this.editor.getSession();r.removeMarker(n),r.removeMarker(i)}},{key:"onChangeMoved",value:function(e){var t,n=this.shareJsOffsetToRowColumn(e.op.p);t=null!=e.op.i?this.shareJsOffsetToRowColumn(e.op.p+e.op.i.length):n,this.updateMarker(e.id,n,t)}},{key:"onCommentAdded",value:function(e){if(null==this.changeIdToMarkerIdMap[e.id]){var t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.c.length),r=this.editor.getSession(),o=new i(t.row,t.column,n.row,n.column),s=r.addMarker(o,"track-changes-marker track-changes-comment-marker","text"),a=this.createCalloutMarker(t,"track-changes-comment-marker-callout");this.changeIdToMarkerIdMap[e.id]={background_marker_id:s,callout_marker_id:a}}}},{key:"onCommentMoved",value:function(e){var t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.c.length);this.updateMarker(e.id,t,n)}},{key:"onCommentRemoved",value:function(e){if(null!=this.changeIdToMarkerIdMap[e.id]){var t=this.changeIdToMarkerIdMap[e.id],n=t.background_marker_id,i=t.callout_marker_id;delete this.changeIdToMarkerIdMap[e.id];var r=this.editor.getSession();r.removeMarker(n),r.removeMarker(i)}}},{key:"updateMarker",value:function(e,t,n){if(null!=this.changeIdToMarkerIdMap[e]){var i=this.editor.getSession(),r=i.getMarkers(),o=this.changeIdToMarkerIdMap[e],s=o.background_marker_id,a=o.callout_marker_id;if(null!=s&&null!=r[s]){var l=r[s];l.range.start=t,l.range.end=n}if(null!=a&&null!=r[a]){var c=r[a];c.range.start=t,c.range.end=t}}}},{key:"shareJsOffsetToRowColumn",value:function(e){var n=this.editor.getSession().getDocument().getAllLines();return t.shareJsOffsetToRowColumn(e,n)}},{key:"createCalloutMarker",value:function(e,t){var n=this.editor.getSession(),i=this.makeZeroWidthRange(e),r=this.editor.renderer.$markerBack;return n.addMarker(i,t,function(e,n,i,o,s){return r.drawSingleLineMarker(e,n,"track-changes-marker-callout ".concat(t," ace_start"),s,0,"width: auto; right: 0;")})}},{key:"makeZeroWidthRange",value:function(e){var t=new i(e.row,e.column,e.row,e.column);return t.clipRows=function(e,t){return this.isEmpty=function(){return e>this.end.row||t<this.start.row},this},t}}]),e}();return r}),define("ide/editor/directives/aceEditor/metadata/MetadataManager",["ace/ace"],function(){var e,t=ace.require("ace/range"),n=t.Range,i=function(e){var t;return(t=e.match(/(\\[^\\]+)$/))?t[1]:null};return e=function(){function e(t,r,o,s){var a=this;_classCallCheck(this,e),this.$scope=t,this.editor=r,this.element=o,this.Metadata=s,this.debouncer={};var l=function(e){if(!e.remote&&["remove","insert"].includes(e.action)){var t=(a.editor.getCursorPosition(),e.end),r=new n(t.row,0,t.row,t.column),o=a.editor.getSession().getTextRange(r);("%"===o.trim()||"\\"===o.slice(0,1))&&(r=new n(t.row,0,t.row,t.column+80),o=a.editor.getSession().getTextRange(r));var s=i(o),l=_.any(e.lines,function(e){return e.match(/^\\usepackage(?:\[.{0,80}?])?{(.{0,80}?)}/)}),c=_.any(e.lines,function(e){return e.match(/^\\RequirePackage(?:\[.{0,80}?])?{(.{0,80}?)}/)}),u=_.any(e.lines,function(e){return e.match(/\\label{(.{0,80}?)}/)}),d=l||u||c,h="\\label{"===(null!=s?s.slice(0,7):void 0),f="\\usepackage"===(null!=s?s.slice(0,11):void 0),p="\\RequirePackage"===(null!=s?s.slice(0,15):void 0),g=f||h||p;return d||g?a.Metadata.scheduleLoadDocMetaFromServer(a.$scope.docId):void 0}};this.editor.on("changeSession",function(e){return e.oldSession.off("change",l),e.session.on("change",l)})}return _createClass(e,[{key:"getAllLabels",value:function(){return this.Metadata.getAllLabels()}},{key:"getAllPackages",value:function(){return this.Metadata.getAllPackages()}}]),e}()}),define("ide/metadata/services/metadata",["base"],function(e){return e.factory("metadata",["$http","ide",function(e,t){var n={},i={documents:{}},r={state:i};return r.onBroadcastDocMeta=function(e){return null!=e.docId&&null!=e.meta?i.documents[e.docId]=e.meta:void 0},r.onEntityDeleted=function(e,t){return"doc"===t.type?delete i.documents[t.id]:void 0},r.onFileUploadComplete=function(e,t){return"doc"===t.entity_type?r.loadDocMetaFromServer(t.entity_id):void 0},r.getAllLabels=function(){return _.flatten(function(){var e=[];for(var t in i.documents){var n=i.documents[t];e.push(n.labels)}return e}())},r.getAllPackages=function(){var e={};for(var t in i.documents){var n=i.documents[t];for(var r in n.packages){var o=n.packages[r];e[r]=o}}return e},r.loadProjectMetaFromServer=function(){return e.get("/project/".concat(window.project_id,"/metadata")).then(function(e){var t=e.data;return t.projectMeta?function(){var e=[];for(var n in t.projectMeta){var r=t.projectMeta[n];e.push(i.documents[n]=r)}return e}():void 0})},r.loadDocMetaFromServer=function(t){return e.post("/project/".concat(window.project_id,"/doc/").concat(t,"/metadata"),{_csrf:window.csrfToken})},r.scheduleLoadDocMetaFromServer=function(e){var t=n[e];return null!=t&&(clearTimeout(t),delete n[e]),n[e]=setTimeout(function(){return r.loadDocMetaFromServer(e),delete n[e]},1e3)},r}])}),define("ide/graphics/services/graphics",["base"],function(e){return e.factory("graphics",["ide",function(e){var t={getGraphicsFiles:function(){var t=[];return e.fileTreeManager.forEachEntity(function(e,n,i){if("file"===e.type&&__guardMethod__(null!=e?e.name:void 0,"match",function(e){return e.match(/.*\.(png|jpg|jpeg|pdf|eps)/i)})){var r=_.clone(e);return r.path=i,t.push(r)}}),t}};return t}])}),define("ide/preamble/services/preamble",["base"],function(e){return e.factory("preamble",["ide",function(e){var t={getPreambleText:function(){var t=e.editorManager.getCurrentDocValue().slice(0,5e3),n=__guard__(t.match(/([^]*)^\\begin\{document\}/m),function(e){return e[1]})||"";return n},getGraphicsPaths:function(){for(var e,n=t.getPreambleText(),i=__guard__(n.match(/\\graphicspath\{(.*)\}/),function(e){return e[1]})||"",r=[],o=/\{([^}]*)\}/g;e=o.exec(i);)r.push(e[1]);return r}};return t}])}),define("ide/files/services/files",["base"],function(e){return e.factory("files",["ide",function(e){var t={getTeXFiles:function(){var t=[];return e.fileTreeManager.forEachEntity(function(e,n,i){if("doc"===e.type&&/.*\.(tex|md|txt|tikz)/.test(e.name)){var r=_.clone(e);r.path=i,t.push(r)}}),t}};return t}])}),define("ide/editor/directives/aceEditor",["base","ace/ace","ace/ext-searchbox","ace/ext-modelist","ace/keybinding-vim","ide/editor/directives/aceEditor/undo/UndoManager","ide/editor/directives/aceEditor/auto-complete/AutoCompleteManager","ide/editor/directives/aceEditor/spell-check/SpellCheckManager","ide/editor/directives/aceEditor/spell-check/SpellCheckAdapter","ide/editor/directives/aceEditor/highlights/HighlightsManager","ide/editor/directives/aceEditor/cursor-position/CursorPositionManager","ide/editor/directives/aceEditor/cursor-position/CursorPositionAdapter","ide/editor/directives/aceEditor/track-changes/TrackChangesManager","ide/editor/directives/aceEditor/track-changes/TrackChangesAdapter","ide/editor/directives/aceEditor/metadata/MetadataManager","ide/metadata/services/metadata","ide/graphics/services/graphics","ide/preamble/services/preamble","ide/files/services/files"],function(e,t,n,i,r,o,s,a,l,c,u,d,h,f,p){function g(e,t){var n='<div class="ace_search right">\n	<a href type="button" action="hide" class="ace_searchbtn_close">\n		<i class="fa fa-fw fa-times"></i>\n	</a>\n	<div class="ace_search_form">\n		<input class="ace_search_field form-control input-sm" placeholder="Search for" spellcheck="false"></input>\n		<div class="btn-group">\n			<button type="button" action="findNext" class="ace_searchbtn next btn btn-default btn-sm">\n				<i class="fa fa-chevron-down fa-fw"></i>\n			</button>\n			<button type="button" action="findPrev" class="ace_searchbtn prev btn btn-default btn-sm">\n				<i class="fa fa-chevron-up fa-fw"></i>\n			</button>\n		</div>\n	</div>\n	<div class="ace_replace_form">\n		<input class="ace_search_field form-control input-sm" placeholder="Replace with" spellcheck="false"></input>\n		<div class="btn-group">\n			<button type="button" action="replaceAndFindNext" class="ace_replacebtn btn btn-default btn-sm">Replace</button>\n			<button type="button" action="replaceAll" class="ace_replacebtn btn btn-default btn-sm">All</button>\n		</div>\n	</div>\n	<div class="ace_search_options">\n		<div class="btn-group">\n			<button action="toggleRegexpMode" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="RegExp Search">.*</button>\n			<button action="toggleCaseSensitive" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="CaseSensitive Search">Aa</button>\n			<button action="toggleWholeWords" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="Whole Word Search">"..."</button>\n			<button action="searchInSelection" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="Search Within Selection"><i class="fa fa-align-left"></i></button>\n		</div>\n		<span class="ace_search_counter"></span>\n	</div>\n	<div action="toggleReplace" class="hidden"></div>\n</div>';$("#ace_searchbox").remove();var i=k.SearchBox,r=i.prototype.$init;i.prototype.$init=function(){return this.element=t(n)(e.$new())[0],r.apply(this)}}var m,v=ace.require("ace/edit_session"),y=v.EditSession,w=ace.require("ace/ext/modelist"),b=ace.require("ace/keyboard/vim"),C=b.Vim,k=ace.require("ace/ext/searchbox");""!==window.aceWorkerPath?(m=!0,ace.config.set("workerPath","".concat(window.aceWorkerPath))):m=!1,ace.config.setDefaultValue("session","useWorker",!1),null==ace.config._moduleUrl&&(ace.config._moduleUrl=ace.config.moduleUrl,ace.config.moduleUrl=function(){for(var e,t=arguments.length,n=new Array(t),i=0;t>i;i++)n[i]=arguments[i];var r=(e=ace.config)._moduleUrl.apply(e,_toConsumableArray(Array.from(n||[])));return r}),e.directive("aceEditor",["$timeout","$compile","$rootScope","event_tracking","localStorage","$cacheFactory","metadata","graphics","preamble","files","$http","$q","$window",function(e,t,n,i,r,v,b,S,x,A,T,E,M){return g(n,t),{scope:{theme:"=",showPrintMargin:"=",keybindings:"=",fontSize:"=",autoComplete:"=",autoPairDelimiters:"=",sharejsDoc:"=",spellCheck:"=",spellCheckLanguage:"=",highlights:"=",text:"=",readOnly:"=",annotations:"=",navigateHighlights:"=",fileName:"=",onCtrlEnter:"=",onCtrlJ:"=",onCtrlShiftC:"=",onCtrlShiftA:"=",onSave:"=",syntaxValidation:"=",reviewPanel:"=",eventsBridge:"=",trackChanges:"=",docId:"=",rendererData:"=",lineHeight:"=",fontFamily:"="},link:function(e,t,g){var R;e.$originalApply=e.$apply,e.$apply=function(e){null==e&&(e=function(){});var t=this.$root.$$phase;return"$apply"===t||"$digest"===t?e():this.$originalApply(e)};var L=ace.edit(t.find(".ace-editor-body")[0]);if(L.$blockScrolling=1/0,L.setOption("behavioursEnabled",e.autoPairDelimiters||!1),L.setOption("wrapBehavioursEnabled",!1),e.$watch("autoPairDelimiters",function(e){return e?L.setOption("behavioursEnabled",!0):L.setOption("behavioursEnabled",!1)}),window._debug_editors||(window._debug_editors=[]),window._debug_editors.push(L),e.name=g.aceEditor,e.spellCheck){var D=v.get("spellCheck-".concat(e.name))||v("spellCheck-".concat(e.name),{capacity:1e3});R=new a(e,D,T,E,new l(L))}var F=new o(L),P=(new c(e,L,t),new u(e,new d(L),r)),I=new h(e,L,t,new f(L)),q=new p(e,L,t,b),O=(new s(e,L,t,q,S,x,A),/[\0\uD800-\uDFFF]/g),B="";L.commands.on("exec",function(e){e.command&&"paste"===e.command.name&&e.args&&O.test(e.args.text)&&(e.args.text=e.args.text.replace(O,B)),e.command&&"insertstring"===e.command.name&&e.args&&O.test(e.args)&&(e.args=e.args.replace(O,B))}),e.$watch("onSave",function(e){return null!=e?(C.defineEx("write","w",e),L.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:e,readOnly:!0}),L.commands.addCommand({name:"recompile_v1",bindKey:{win:"Ctrl-.",mac:"Ctrl-."},exec:e,readOnly:!0})):void 0}),L.commands.removeCommand("transposeletters"),L.commands.removeCommand("showSettingsMenu"),L.commands.removeCommand("foldall"),L.commands.removeCommand("toggleBlockComment"),L.commands.removeCommand("togglecomment"),L.commands.addCommand({name:"togglecomment",bindKey:{win:"Ctrl-/|Ctrl-Shift-7",mac:"Command-/|Command-Shift-/"},exec:function(e){return e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"}),L.commands.addCommand({name:"find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(e){return k.Search(e,!0)},readOnly:!0}),L.commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(e){var t=e.getSelection();if(t.isEmpty())return e.insert("\\textbf{}"),e.navigateLeft(1);var n=e.getCopyText();return e.insert("\\textbf{".concat(n,"}"))},readOnly:!1}),L.commands.addCommand({name:"italics",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(e){var t=e.getSelection();if(t.isEmpty())return e.insert("\\textit{}"),e.navigateLeft(1);var n=e.getCopyText();return e.insert("\\textit{".concat(n,"}"))},readOnly:!1}),e.$watch("onCtrlEnter",function(e){return null!=e?L.commands.addCommand({name:"compile",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(t){return e()},readOnly:!0}):void 0}),e.$watch("onCtrlJ",function(e){return null!=e?L.commands.addCommand({name:"toggle-review-panel",bindKey:{win:"Ctrl-J",mac:"Command-J"},exec:function(t){return e()},readOnly:!0}):void 0}),e.$watch("onCtrlShiftC",function(e){return null!=e?L.commands.addCommand({name:"add-new-comment",bindKey:{win:"Ctrl-Shift-C",mac:"Command-Shift-C"},exec:function(t){return e()},readOnly:!0}):void 0}),e.$watch("onCtrlShiftA",function(e){return null!=e?L.commands.addCommand({name:"toggle-track-changes",bindKey:{win:"Ctrl-Shift-A",mac:"Command-Shift-A"},exec:function(t){return e()},readOnly:!0}):void 0}),L.showCommandLine=function(e){return"/"===e?k.Search(L,!0):void 0};var H=function(){var e=L.getSession(),t=e.selection.getCursor(),n=e.documentToScreenPosition(t.row,t.column);return n.row*L.renderer.lineHeight-e.getScrollTop()};if(null!=g.resizeOn)for(var N=0,z=Array.from(g.resizeOn.split(","));N<z.length;N++){var U=z[N];e.$on(U,function(){e.$applyAsync(function(){var e=H();L.resize();var t=H(),n=L.getSession();return n.setScrollTop(n.getScrollTop()+t-e)})})}e.$on("".concat(e.name,":set-scroll-size"),function(e,t){var n=t.overflowTop,i=L.renderer.layerConfig.maxHeight,r=Math.max(t.height-i,0);return j(n,r)});var j=function(e,t){var n=!1;return L.renderer.scrollMargin.top!==e&&(L.renderer.scrollMargin.top=e,n=!0),L.renderer.scrollMargin.bottom!==t&&(L.renderer.scrollMargin.bottom=t,n=!0),n?L.renderer.updateFull():void 0},W=function(){return j(0,0)};e.$watch("theme",function(e){return L.setTheme("ace/theme/".concat(e))}),e.$watch("showPrintMargin",function(e){return L.setShowPrintMargin(e)}),e.$watch("keybindings",function(e){return["vim","emacs"].includes(e)?L.setKeyboardHandler("ace/keyboard/".concat(e)):L.setKeyboardHandler(null)}),e.$watch("fontSize",function(e){return t.find(".ace_editor, .ace_content").css({"font-size":e+"px"})}),e.$watch("fontFamily",function(e){var t=["Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro","monospace"];if(null!=e)switch(e){case"monaco":return L.setOption("fontFamily",t.join(", "));case"lucida":return L.setOption("fontFamily",'"Lucida Console", monospace');default:return L.setOption("fontFamily",null)}}),e.$watch("lineHeight",function(e){if(null!=e){switch(e){case"compact":L.container.style.lineHeight=1.33;break;case"normal":L.container.style.lineHeight=1.6;break;case"wide":L.container.style.lineHeight=2;break;default:L.container.style.lineHeight=1.6}return L.renderer.updateFontSize()}}),e.$watch("sharejsDoc",function(t,n){return null!=n&&(e.$broadcast("beforeChangeDocument"),ce(n)),null!=t&&le(t),null!=t&&null!=n?e.$broadcast("afterChangeDocument"):void 0}),e.$watch("text",function(e){if(null!=e){L.setValue(e,-1);var t=L.getSession();return t.setUseWrapMode(!0)}}),e.$watch("annotations",function(e){var t=L.getSession();return t.setAnnotations(e)}),e.$watch("readOnly",function(e){return L.setReadOnly(!!e)}),e.$watch("syntaxValidation",function(e){if(null!=e&&m){var t=L.getSession();return t.setOption("useWorker",e)}}),L.setOption("scrollPastEnd",!0);var V=0,G=function(){return V++,100===V&&i.send("editor-interaction","multi-doc-update"),e.$emit("".concat(e.name,":change"))},K=function(t){if(null!=e.eventsBridge){var n=L.renderer.layerConfig.maxHeight;return e.eventsBridge.emit("aceScroll",t,n)}},Y=function(t,n){return null!=e.eventsBridge?e.eventsBridge.emit("aceScrollbarVisibilityChanged",n.scrollBarV.isVisible,n.scrollBarV.width):void 0};null!=e.eventsBridge&&(L.renderer.on("scrollbarVisibilityChanged",Y),e.eventsBridge.on("externalScroll",function(e){return L.getSession().setScrollTop(e)}),e.eventsBridge.on("refreshScrollPosition",function(){var e=L.getSession();return e.setScrollTop(e.getScrollTop()+1),e.setScrollTop(e.getScrollTop()-1)}));var X=function(e){return R.onSessionChange(),null!=e.oldSession&&e.oldSession.getDocument().off("change",R.onChange),e.session.getDocument().on("change",R.onChange),null!=e.oldSession&&e.oldSession.off("changeScrollTop",R.onScroll),e.session.on("changeScrollTop",R.onScroll)},J=function(){return R?(R.init(),L.on("changeSession",X),X({session:L.getSession()}),L.on("nativecontextmenu",R.onContextMenu)):void 0},Q=function(){return R?(L.off("changeSession",X),L.off("nativecontextmenu",R.onContextMenu)):void 0},Z=function(){I.rangesTracker=e.sharejsDoc.ranges,I.onChangeSession(),I&&(L.on("changeSelection",I.onChangeSelection),L.on("change",I.onChangeSelection),L.on("changeSession",I.onChangeSession),L.on("cut",I.onCut),L.on("paste",I.onPaste),L.renderer.on("resize",I.onResize))},ee=function(){I&&(this.trackChangesManager.tearDown(),L.off("changeSelection",I.onChangeSelection),L.off("change",I.onChangeSelection),L.off("changeSession",I.onChangeSession),L.off("cut",I.onCut),L.off("paste",I.onPaste),L.renderer.off("resize",I.onResize))},te=function(){F.onChangeSession(L.getSession()),L.on("change",F.onChange)},ne=function(){L.off("change",F.onChange)},ie=function(e){return null!=e.oldSession&&e.oldSession.selection.off("changeCursor",P.onCursorChange),e.session.selection.on("changeCursor",P.onCursorChange)},re=function(){return P.onUnload(L.getSession())},oe=function(){return L.on("changeSession",ie),ie({session:L.getSession()}),$(window).on("unload",re)},se=function(){return L.off("changeSession",ie),$(window).off("unload",re)};oe();var ae=_.once(function(){return e.$broadcast("editorInit")}),le=function(t){var r,o=t.getSnapshot().split("\n"),s=L.getSession();null!=s&&s.destroy();try{if(/\.(Rtex|bbl|tikz)$/i.test(e.fileName))r="ace/mode/latex";else if(/\.(sty|cls|clo)$/.test(e.fileName))r="ace/mode/tex";else{var a=w.getModeForPath(e.fileName);r=a.mode,"ace/mode/text"===r&&(r="ace/mode/plain_text")}}catch(l){r="ace/mode/plain_text"}s=new y(o,r),s.setUseWrapMode(!0),null!=e.syntaxValidation&&m&&!/\.bib$/.test(e.fileName)&&s.setOption("useWorker",e.syntaxValidation),L.setReadOnly(!0),L.setSession(s);var c=s.getDocument();return c.on("change",G),L.initing=!0,t.attachToAce(L),L.initing=!1,L.setReadOnly(e.readOnly),ae(),e.readOnly||J(),Z(),te(),W(),s.setAnnotations(e.annotations),s.on("changeScrollTop",i.editingSessionHeartbeat),angular.element(M).on("click",i.editingSessionHeartbeat),e.$on("$destroy",function(){return angular.element(M).off("click",i.editingSessionHeartbeat)}),null!=e.eventsBridge&&s.on("changeScrollTop",K),n.hasLintingError=!1,s.on("changeAnnotation",function(){var e=s.getAnnotations().filter(function(e){return"info"!==e.type}).length>0;return n.hasLintingError!==e?n.hasLintingError=e:void 0}),setTimeout(function(){return K(L.renderer.getScrollTop())}),L.focus()},ce=function(e){Q(),ee(),ne(),e.detachFromAce(),e.off("remoteop.recordRemote");var t=L.getSession();t.off("changeScrollTop");var n=t.getDocument();return n.off("change",G)};return null!=e.rendererData&&L.renderer.on("changeCharacterSize",function(){e.$apply(function(){return e.rendererData.lineHeight=L.renderer.lineHeight})}),e.$watch("rendererData",function(e){return null!=e?e.lineHeight=L.renderer.lineHeight:void 0}),e.$on("$destroy",function(){if(null!=e.sharejsDoc){e.$broadcast("changeEditor"),Q(),se(),ne(),ce(e.sharejsDoc);var t=L.getSession();return null!=t&&t.destroy(),e.eventsBridge.emit("aceScrollbarVisibilityChanged",!1,0)}}),e.$emit("".concat(e.name,":inited"),L)},template:'<div class="ace-editor-wrapper">\n	<div\n		class="undo-conflict-warning alert alert-danger small"\n		ng-show="undo.show_remote_warning"\n	>\n		<strong>Watch out!</strong>\n		We had to undo some of your collaborators changes before we could undo yours.\n		<a\n			href="#"\n			class="pull-right"\n			ng-click="undo.show_remote_warning = false"\n		>Dismiss</a>\n	</div>\n	<div class="ace-editor-body"></div>\n	<spell-menu\n		open="spellMenu.open"\n		top="spellMenu.top"\n		left="spellMenu.left"\n		layout-from-bottom="spellMenu.layoutFromBottom"\n		highlight="spellMenu.highlight"\n		replace-word="replaceWord(highlight, suggestion)"\n		learn-word="learnWord(highlight)"\n	></spell-menu>\n	<div\n		class="annotation-label"\n		ng-show="annotationLabel.show"\n		ng-style="{\n			position: \'absolute\',\n			left:     annotationLabel.left,\n			right:    annotationLabel.right,\n			bottom:   annotationLabel.bottom,\n			top:      annotationLabel.top,\n			\'background-color\': annotationLabel.backgroundColor\n		}"\n	>\n		{{ annotationLabel.text }}\n	</div>\n\n	<a\n		href\n		class="highlights-before-label btn btn-info btn-xs"\n		ng-show="updateLabels.highlightsBefore > 0"\n		ng-click="gotoHighlightAbove()"\n	>\n		<i class="fa fa-fw fa-arrow-up"></i>\n		{{ updateLabels.highlightsBefore }} more update{{ updateLabels.highlightsBefore > 1 && "" || "s" }} above\n	</a>\n\n	<a\n		href\n		class="highlights-after-label btn btn-info btn-xs"\n		ng-show="updateLabels.highlightsAfter > 0"\n		ng-click="gotoHighlightBelow()"\n	>\n		<i class="fa fa-fw fa-arrow-down"></i>\n		{{ updateLabels.highlightsAfter }} more update{{ updateLabels.highlightsAfter > 1 && "" || "s" }} below\n\n	</a>\n</div>'}}])}),define("ide/editor/directives/toggleSwitch",["base"],function(e){return e.directive("toggleSwitch",function(){return{restrict:"E",scope:{description:"@",labelFalse:"@",labelTrue:"@",ngModel:"="},template:'<fieldset class="toggle-switch">\n    <legend class="sr-only">{{description}}</legend>\n\n    <input\n      type="radio"\n      name="toggle-switch-{{$id}}"\n      class="toggle-switch-input"\n      id="toggle-switch-false-{{$id}}"\n      ng-value="false"\n      ng-model="ngModel"\n    >\n    <label for="toggle-switch-false-{{$id}}" class="toggle-switch-label">{{labelFalse}}</label>\n\n    <input\n      type="radio"\n      class="toggle-switch-input"\n      name="toggle-switch-{{$id}}"\n      id="toggle-switch-true-{{$id}}"\n      ng-value="true"\n      ng-model="ngModel"\n    >\n    <label for="toggle-switch-true-{{$id}}" class="toggle-switch-label">{{labelTrue}}</label>\n\n    <span class="toggle-switch-selection" aria-hidden="true"></span>\n</fieldset>'
}})}),define("ide/editor/controllers/SavingNotificationController",["base","ide/editor/Document"],function(e,t){return e.controller("SavingNotificationController",["$scope","$interval","ide",function(e,n,i){var r;setInterval(function(){return a()},1e3),$(window).bind("beforeunload",function(){return r()});var o=null,s=15;e.docSavingStatus={};var a=function(){var n,r=e.docSavingStatus,a=e.docSavingStatusCount,l={},c=0,u=0;for(var d in t.openDocs){var h=t.openDocs[d],f=h.pollSavedStatus();f||(c++,null!=r[d]?(l[d]=r[d],n=l[d].unsavedSeconds+=1,n>u&&(u=n)):l[d]={unsavedSeconds:0,doc:i.fileTreeManager.findEntityById(d)})}return c>0&&n>s&&!o&&(o=i.showLockEditorMessageModal("Connection lost","Sorry, the connection to the server is down."),o.result["finally"](function(){return o=null})),o&&0===c&&o.dismiss("connection back up"),c||a?(e.docSavingStatus=l,e.docSavingStatusCount=c,e.$apply()):void 0};return r=function(){return t.hasUnsavedChanges()?"You have unsaved changes. If you leave now they will not be saved.":void 0}}])}),define("ide/editor/EditorManager",["ide/editor/Document","ide/editor/components/spellMenu","ide/editor/directives/aceEditor","ide/editor/directives/toggleSwitch","ide/editor/controllers/SavingNotificationController"],function(e){var t;return t=function(){return t=function(){function t(n,i,r){var o=this;_classCallCheck(this,t),this.ide=n,this.$scope=i,this.localStorage=r,this.$scope.editor={sharejs_doc:null,open_doc_id:null,open_doc_name:null,opening:!0,trackChanges:!1,wantTrackChanges:!1,showRichText:this.showRichText()},this.$scope.$on("entity:selected",function(e,t){return"history"!==o.$scope.ui.view&&"doc"===t.type?o.openDoc(t):void 0}),this.$scope.$on("entity:deleted",function(e,t){if(o.$scope.editor.open_doc_id===t.id){if(!o.$scope.project.rootDoc_id)return;var n=o.ide.fileTreeManager.findEntityById(o.$scope.project.rootDoc_id);if(null==n)return;return o.openDoc(n)}});var s=!1;this.$scope.$on("file-tree:initialized",function(){return s?void 0:(s=!0,o.autoOpenDoc())}),this.$scope.$on("flush-changes",function(){return e.flushAll()}),this.$scope.$watch("editor.wantTrackChanges",function(e){return null!=e?o._syncTrackChangesState(o.$scope.editor.sharejs_doc):void 0})}return _createClass(t,null,[{key:"initClass",value:function(){this.prototype._syncTimeout=null}}]),_createClass(t,[{key:"showRichText",value:function(){return"rich-text"===this.localStorage("editor.mode.".concat(this.$scope.project_id))}},{key:"autoOpenDoc",value:function(){var e=this.ide.localStorage("doc.open_id.".concat(this.$scope.project_id))||this.$scope.project.rootDoc_id;if(null!=e){var t=this.ide.fileTreeManager.findEntityById(e);if(null!=t)return this.openDoc(t)}}},{key:"openDocId",value:function(e,t){null==t&&(t={});var n=this.ide.fileTreeManager.findEntityById(e);if(null!=n)return this.openDoc(n,t)}},{key:"openDoc",value:function(e,t){var n=this;null==t&&(t={}),sl_console.log("[openDoc] Opening ".concat(e.id)),this.$scope.ui.view="editor";var i=function(){return null!=t.gotoLine?setTimeout(function(){return n.$scope.$broadcast("editor:gotoLine",t.gotoLine,t.gotoColumn)},0):null!=t.gotoOffset?setTimeout(function(){return n.$scope.$broadcast("editor:gotoOffset",t.gotoOffset)},0):void 0};return e.id!==this.$scope.editor.open_doc_id||t.forceReopen?(this.$scope.editor.open_doc_id=e.id,this.$scope.editor.open_doc_name=e.name,this.ide.localStorage("doc.open_id.".concat(this.$scope.project_id),e.id),this.ide.fileTreeManager.selectEntity(e),this.$scope.editor.opening=!0,this._openNewDocument(e,function(e,t){return null!=e?void n.ide.showGenericMessageModal("Error opening document","Sorry, something went wrong opening this document. Please try again."):(n._syncTrackChangesState(t),n.$scope.$broadcast("doc:opened"),n.$scope.$apply(function(){return n.$scope.editor.opening=!1,n.$scope.editor.sharejs_doc=t,i()}))})):void this.$scope.$apply(function(){return i()})}},{key:"_openNewDocument",value:function(t,n){var i=this;null==n&&(n=function(e,t){}),sl_console.log("[_openNewDocument] Opening...");var r=this.$scope.editor.sharejs_doc;null!=r&&(sl_console.log("[_openNewDocument] Leaving existing open doc..."),r.leaveAndCleanUp(),this._unbindFromDocumentEvents(r));var o=e.getDocument(this.ide,t.id);return o.join(function(e){return null!=e?n(e):(i._bindToDocumentEvents(t,o),n(null,o))})}},{key:"_bindToDocumentEvents",value:function(e,t){var n=this;return t.on("error",function(t,i){var r;return r=null!=(null!=t?t.message:void 0)?t.message:"string"==typeof t?t:"",/maxDocLength/.test(r)?n.ide.showGenericMessageModal("Document Too Long","Sorry, this file is too long to be edited manually. Please upload it directly."):/too many comments or tracked changes/.test(r)?n.ide.showGenericMessageModal("Too many comments or tracked changes","Sorry, this file has too many comments or tracked changes. Please try accepting or rejecting some existing changes, or resolving and deleting some comments."):(n.ide.socket.disconnect(),n.ide.reportError(t,i),n.ide.showGenericMessageModal("Out of sync","Sorry, this file has gone out of sync and we need to do a full refresh. <br> <a href='/learn/Kb/Editor_out_of_sync_problems'>Please see this help guide for more information</a>")),n.openDoc(e,{forceReopen:!0})}),t.on("externalUpdate",function(e){return n._ignoreExternalUpdates||"external"===_.property(["meta","type"])(e)&&"git-bridge"===_.property(["meta","source"])(e)?void 0:n.ide.showGenericMessageModal("Document Updated Externally","This document was just updated externally. Any recent changes you have made may have been overwritten. To see previous versions please look in the history.")})}},{key:"_unbindFromDocumentEvents",value:function(e){return e.off()}},{key:"getCurrentDocValue",value:function(){return null!=this.$scope.editor.sharejs_doc?this.$scope.editor.sharejs_doc.getSnapshot():void 0}},{key:"getCurrentDocId",value:function(){return this.$scope.editor.open_doc_id}},{key:"startIgnoringExternalUpdates",value:function(){return this._ignoreExternalUpdates=!0}},{key:"stopIgnoringExternalUpdates",value:function(){return this._ignoreExternalUpdates=!1}},{key:"_syncTrackChangesState",value:function(e){var t,n=this;if(null!=e){null!=this._syncTimeout&&(clearTimeout(this._syncTimeout),this._syncTimeout=null);var i=this.$scope.editor.wantTrackChanges,r=e.getTrackingChanges();return i===r?void(this.$scope.editor.trackChanges=i):(t=function(){var r=null==e.getInflightOp()&&null==e.getPendingOp();return r?(e.setTrackingChanges(i),n.$scope.$apply(function(){return n.$scope.editor.trackChanges=i})):n._syncTimeout=setTimeout(t,100)})()}}}]),t}(),t.initClass(),t}()});var CryptoJS=CryptoJS||function(e,t){var n={},i=n.lib={},r=function(){},o=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;e>r;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-8*(r%4)&255)<<24-8*((i+r)%4);else if(65535<n.length)for(r=0;e>r;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;t>i;i+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++){var r=t[i>>>2]>>>24-8*(i%4)&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-4*(i%8);return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;e>i;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-8*(i%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;t>i;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-8*(i%4);return new s.init(n,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(t=a*o,r=e.min(4*t,r),t){for(var l=0;t>l;l+=o)this._doProcessBlock(i,l);l=i.splice(0,t),n.sigBytes-=r}return new s.init(l,r)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){function t(e,t,n,i,r,o,s){return e=e+(t&n|~t&i)+r+s,(e<<o|e>>>32-o)+t}function n(e,t,n,i,r,o,s){return e=e+(t&i|n&~i)+r+s,(e<<o|e>>>32-o)+t}function i(e,t,n,i,r,o,s){return e=e+(t^n^i)+r+s,(e<<o|e>>>32-o)+t}function r(e,t,n,i,r,o,s){return e=e+(n^(t|~i))+r+s,(e<<o|e>>>32-o)+t}for(var o=CryptoJS,s=o.lib,a=s.WordArray,l=s.Hasher,s=o.algo,c=[],u=0;64>u;u++)c[u]=4294967296*e.abs(e.sin(u+1))|0;s=s.MD5=l.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var s=0;16>s;s++){var a=o+s,l=e[a];e[a]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var s=this._hash.words,a=e[o+0],l=e[o+1],u=e[o+2],d=e[o+3],h=e[o+4],f=e[o+5],p=e[o+6],g=e[o+7],m=e[o+8],v=e[o+9],y=e[o+10],w=e[o+11],b=e[o+12],_=e[o+13],C=e[o+14],k=e[o+15],S=s[0],$=s[1],x=s[2],A=s[3],S=t(S,$,x,A,a,7,c[0]),A=t(A,S,$,x,l,12,c[1]),x=t(x,A,S,$,u,17,c[2]),$=t($,x,A,S,d,22,c[3]),S=t(S,$,x,A,h,7,c[4]),A=t(A,S,$,x,f,12,c[5]),x=t(x,A,S,$,p,17,c[6]),$=t($,x,A,S,g,22,c[7]),S=t(S,$,x,A,m,7,c[8]),A=t(A,S,$,x,v,12,c[9]),x=t(x,A,S,$,y,17,c[10]),$=t($,x,A,S,w,22,c[11]),S=t(S,$,x,A,b,7,c[12]),A=t(A,S,$,x,_,12,c[13]),x=t(x,A,S,$,C,17,c[14]),$=t($,x,A,S,k,22,c[15]),S=n(S,$,x,A,l,5,c[16]),A=n(A,S,$,x,p,9,c[17]),x=n(x,A,S,$,w,14,c[18]),$=n($,x,A,S,a,20,c[19]),S=n(S,$,x,A,f,5,c[20]),A=n(A,S,$,x,y,9,c[21]),x=n(x,A,S,$,k,14,c[22]),$=n($,x,A,S,h,20,c[23]),S=n(S,$,x,A,v,5,c[24]),A=n(A,S,$,x,C,9,c[25]),x=n(x,A,S,$,d,14,c[26]),$=n($,x,A,S,m,20,c[27]),S=n(S,$,x,A,_,5,c[28]),A=n(A,S,$,x,u,9,c[29]),x=n(x,A,S,$,g,14,c[30]),$=n($,x,A,S,b,20,c[31]),S=i(S,$,x,A,f,4,c[32]),A=i(A,S,$,x,m,11,c[33]),x=i(x,A,S,$,w,16,c[34]),$=i($,x,A,S,C,23,c[35]),S=i(S,$,x,A,l,4,c[36]),A=i(A,S,$,x,h,11,c[37]),x=i(x,A,S,$,g,16,c[38]),$=i($,x,A,S,y,23,c[39]),S=i(S,$,x,A,_,4,c[40]),A=i(A,S,$,x,a,11,c[41]),x=i(x,A,S,$,d,16,c[42]),$=i($,x,A,S,p,23,c[43]),S=i(S,$,x,A,v,4,c[44]),A=i(A,S,$,x,b,11,c[45]),x=i(x,A,S,$,k,16,c[46]),$=i($,x,A,S,u,23,c[47]),S=r(S,$,x,A,a,6,c[48]),A=r(A,S,$,x,g,10,c[49]),x=r(x,A,S,$,C,15,c[50]),$=r($,x,A,S,f,21,c[51]),S=r(S,$,x,A,b,6,c[52]),A=r(A,S,$,x,d,10,c[53]),x=r(x,A,S,$,y,15,c[54]),$=r($,x,A,S,l,21,c[55]),S=r(S,$,x,A,m,6,c[56]),A=r(A,S,$,x,k,10,c[57]),x=r(x,A,S,$,p,15,c[58]),$=r($,x,A,S,_,21,c[59]),S=r(S,$,x,A,h,6,c[60]),A=r(A,S,$,x,w,10,c[61]),x=r(x,A,S,$,u,15,c[62]),$=r($,x,A,S,v,21,c[63]);s[0]=s[0]+S|0,s[1]=s[1]+$|0,s[2]=s[2]+x|0,s[3]=s[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var o=e.floor(i/4294967296);for(n[(r+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[(r+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(s),o.HmacMD5=l._createHmacHelper(s)}(Math),define("libs/md5",function(){}),define("ide/online-users/controllers/OnlineUsersController",["base"],function(e){return e.controller("OnlineUsersController",["$scope","ide",function(e,t){return e.gotoUser=function(e){return null!=e.doc&&null!=e.row?t.editorManager.openDoc(e.doc,{gotoLine:e.row+1}):void 0},e.userInitial=function(e){return"anonymous-user"===e.user_id?"?":e.name.slice(0,1)}}])}),define("ide/online-users/OnlineUsersManager",["ide/colors/ColorManager","libs/md5","ide/online-users/controllers/OnlineUsersController"],function(e){var t;return t=function(){return t=function(){function t(n,i){var r=this;_classCallCheck(this,t),this.ide=n,this.$scope=i,this.$scope.onlineUsers={},this.$scope.onlineUserCursorHighlights={},this.$scope.onlineUsersArray=[],this.$scope.$on("cursor:editor:update",function(e,t){return r.sendCursorPositionUpdate(t)}),this.$scope.$on("project:joined",function(){return r.ide.socket.emit("clientTracking.getConnectedUsers",function(e,t){r.$scope.onlineUsers={};for(var n=0,i=Array.from(t||[]);n<i.length;n++){var o=i[n];o.client_id!==r.ide.socket.socket.sessionid&&(r.$scope.onlineUsers[o.client_id]={id:o.client_id,user_id:o.user_id,email:o.email,name:"".concat(o.first_name," ").concat(o.last_name),doc_id:null!=o.cursorData?o.cursorData.doc_id:void 0,row:null!=o.cursorData?o.cursorData.row:void 0,column:null!=o.cursorData?o.cursorData.column:void 0})}return r.refreshOnlineUsers()})}),this.ide.socket.on("clientTracking.clientUpdated",function(e){return e.id!==r.ide.socket.socket.sessionid?r.$scope.$apply(function(){return r.$scope.onlineUsers[e.id]=e,r.refreshOnlineUsers()}):void 0}),this.ide.socket.on("clientTracking.clientDisconnected",function(e){return r.$scope.$apply(function(){return delete r.$scope.onlineUsers[e],r.refreshOnlineUsers()})}),this.$scope.getHueForUserId=function(t){return e.getHueForUserId(t)}}return _createClass(t,null,[{key:"initClass",value:function(){this.prototype.cursorUpdateInterval=500}}]),_createClass(t,[{key:"refreshOnlineUsers",value:function(){this.$scope.onlineUsersArray=[];for(var t in this.$scope.onlineUsers){var n=this.$scope.onlineUsers[t];null!=n.doc_id&&(n.doc=this.ide.fileTreeManager.findEntityById(n.doc_id)),(null===n.name||0===n.name.trim().length)&&(n.email?n.name=n.email.trim():"anonymous-user"===n.user_id&&(n.name="Anonymous")),n.initial=null!=n.name?n.name[0]:void 0,n.initial&&" "!==n.initial||(n.initial="?"),this.$scope.onlineUsersArray.push(n)}this.$scope.onlineUserCursorHighlights={};for(t in this.$scope.onlineUsers){var i=this.$scope.onlineUsers[t],r=i.doc_id;null!=r&&null!=i.row&&null!=i.column&&(this.$scope.onlineUserCursorHighlights[r]||(this.$scope.onlineUserCursorHighlights[r]=[]),this.$scope.onlineUserCursorHighlights[r].push({label:i.name,cursor:{row:i.row,column:i.column},hue:e.getHueForUserId(i.user_id)}))}return this.$scope.onlineUsersArray.length>0?(delete this.cursorUpdateTimeout,this.cursorUpdateInterval=500):(delete this.cursorUpdateTimeout,this.cursorUpdateInterval=3e5)}},{key:"sendCursorPositionUpdate",value:function(e){var t=this;return null!=e&&(this.$scope.currentPosition=e),null==this.cursorUpdateTimeout?this.cursorUpdateTimeout=setTimeout(function(){var e=t.$scope.editor.open_doc_id;return t.ide.socket.emit("clientTracking.updatePosition",{row:null!=t.$scope.currentPosition?t.$scope.currentPosition.row:void 0,column:null!=t.$scope.currentPosition?t.$scope.currentPosition.column:void 0,doc_id:e}),delete t.cursorUpdateTimeout},this.cursorUpdateInterval):void 0}}]),t}(),t.initClass(),t}()}),function(e){function t(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function n(e,t){return Ae.call(e,t)}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function r(e){_e.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function o(e,t){var n=!0;return p(function(){return n&&(r(e),n=!1),t.apply(this,arguments)},t)}function s(e,t){yt[e]||(r(t),yt[e]=!0)}function a(e,t){return function(n){return v(e.call(this,n),t)}}function l(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function c(e,t){var n,i,r=12*(t.year()-e.year())+(t.month()-e.month()),o=e.clone().add(r,"months");return 0>t-o?(n=e.clone().add(r-1,"months"),i=(t-o)/(o-n)):(n=e.clone().add(r+1,"months"),i=(t-o)/(n-o)),-(r+i)}function u(e,t,n){var i;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(i=e.isPM(n),i&&12>t&&(t+=12),i||12!==t||(t=0),t):t}function d(){}function h(e,t){t!==!1&&D(e),g(this,e),this._d=new Date(+e._d),bt===!1&&(bt=!0,_e.updateOffset(this),bt=!1)}function f(e){var t=x(e),n=t.year||0,i=t.quarter||0,r=t.month||0,o=t.week||0,s=t.day||0,a=t.hour||0,l=t.minute||0,c=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*c+6e4*l+36e5*a,this._days=+s+7*o,this._months=+r+3*i+12*n,this._data={},this._locale=_e.localeData(),this._bubble()}function p(e,t){for(var i in t)n(t,i)&&(e[i]=t[i]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function g(e,t){var n,i,r;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Ie.length>0)for(n in Ie)i=Ie[n],r=t[i],"undefined"!=typeof r&&(e[i]=r);return e}function m(e){return 0>e?Math.ceil(e):Math.floor(e)}function v(e,t,n){for(var i=""+Math.abs(e),r=e>=0;i.length<t;)i="0"+i;return(r?n?"+":"":"-")+i}function y(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function w(e,t){var n;return t=O(t,e),e.isBefore(t)?n=y(e,t):(n=y(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function b(e,t){return function(n,i){var r,o;return null===i||isNaN(+i)||(s(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),o=n,n=i,i=o),n="string"==typeof n?+n:n,r=_e.duration(n,i),_(this,r,e),this}}function _(e,t,n,i){var r=t._milliseconds,o=t._days,s=t._months;i=null==i?!0:i,r&&e._d.setTime(+e._d+r*n),o&&ge(e,"Date",pe(e,"Date")+o*n),s&&fe(e,pe(e,"Month")+s*n),i&&_e.updateOffset(e,o||s)}function C(e){return"[object Array]"===Object.prototype.toString.call(e)}function k(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function S(e,t,n){var i,r=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),s=0;for(i=0;r>i;i++)(n&&e[i]!==t[i]||!n&&T(e[i])!==T(t[i]))&&s++;return s+o}function $(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=dt[e]||ht[t]||t}return e}function x(e){var t,i,r={};for(i in e)n(e,i)&&(t=$(i),t&&(r[t]=e[i]));return r}function A(t){var n,i;if(0===t.indexOf("week"))n=7,i="day";else{if(0!==t.indexOf("month"))return;n=12,i="month"}_e[t]=function(r,o){var s,a,l=_e._locale[t],c=[];if("number"==typeof r&&(o=r,r=e),a=function(e){var t=_e().utc().set(i,e);return l.call(_e._locale,t,r||"")},null!=o)return a(o);for(s=0;n>s;s++)c.push(a(s));return c}}function T(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function E(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function M(e,t,n){return ce(_e([e,11,31+t-n]),t,n).week}function R(e){return L(e)?366:365}function L(e){return e%4===0&&e%100!==0||e%400===0}function D(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ee]<0||e._a[Ee]>11?Ee:e._a[Me]<1||e._a[Me]>E(e._a[Te],e._a[Ee])?Me:e._a[Re]<0||e._a[Re]>24||24===e._a[Re]&&(0!==e._a[Le]||0!==e._a[De]||0!==e._a[Fe])?Re:e._a[Le]<0||e._a[Le]>59?Le:e._a[De]<0||e._a[De]>59?De:e._a[Fe]<0||e._a[Fe]>999?Fe:-1,e._pf._overflowDayOfYear&&(Te>t||t>Me)&&(t=Me),e._pf.overflow=t)}function F(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===e)),t._isValid}function P(e){return e?e.toLowerCase().replace("_","-"):e}function I(e){for(var t,n,i,r,o=0;o<e.length;){for(r=P(e[o]).split("-"),t=r.length,n=P(e[o+1]),n=n?n.split("-"):null;t>0;){if(i=q(r.slice(0,t).join("-")))return i;if(n&&n.length>=t&&S(r,n,!0)>=t-1)break;t--}o++}return null}function q(e){var t=null;if(!Pe[e]&&qe)try{t=_e.locale(),require("./locale/"+e),_e.locale(t)}catch(n){}return Pe[e]}function O(e,t){var n,i;return t._isUTC?(n=t.clone(),i=(_e.isMoment(e)||k(e)?+e:+_e(e))-+n,n._d.setTime(+n._d+i),_e.updateOffset(n,!1),n):_e(e).local()}function B(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function H(e){var t,n,i=e.match(Ne);for(t=0,n=i.length;n>t;t++)i[t]=vt[i[t]]?vt[i[t]]:B(i[t]);return function(r){var o="";for(t=0;n>t;t++)o+=i[t]instanceof Function?i[t].call(r,e):i[t];return o}}function N(e,t){return e.isValid()?(t=z(t,e.localeData()),ft[t]||(ft[t]=H(t)),ft[t](e)):e.localeData().invalidDate()}function z(e,t){function n(e){return t.longDateFormat(e)||e}var i=5;for(ze.lastIndex=0;i>=0&&ze.test(e);)e=e.replace(ze,n),ze.lastIndex=0,i-=1;return e}function U(e,t){var n,i=t._strict;switch(e){case"Q":return Ze;case"DDDD":return tt;case"YYYY":case"GGGG":case"gggg":return i?nt:We;case"Y":case"G":case"g":return rt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?it:Ve;case"S":if(i)return Ze;case"SS":if(i)return et;case"SSS":if(i)return tt;case"DDD":return je;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ke;case"a":case"A":return t._locale._meridiemParse;case"x":return Je;case"X":return Qe;case"Z":case"ZZ":return Ye;case"T":return Xe;case"SSSS":return Ge;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?et:Ue;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ue;case"Do":return i?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(Q(J(e.replace("\\","")),"i"))}}function j(e){e=e||"";var t=e.match(Ye)||[],n=t[t.length-1]||[],i=(n+"").match(ct)||["-",0,0],r=+(60*i[1])+T(i[2]);return"+"===i[0]?r:-r}function W(e,t,n){var i,r=n._a;switch(e){case"Q":null!=t&&(r[Ee]=3*(T(t)-1));break;case"M":case"MM":null!=t&&(r[Ee]=T(t)-1);break;case"MMM":case"MMMM":i=n._locale.monthsParse(t,e,n._strict),null!=i?r[Ee]=i:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(r[Me]=T(t));break;case"Do":null!=t&&(r[Me]=T(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=T(t));break;case"YY":r[Te]=_e.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":r[Te]=T(t);break;case"a":case"A":n._meridiem=t;break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":r[Re]=T(t);break;case"m":case"mm":r[Le]=T(t);break;case"s":case"ss":r[De]=T(t);break;case"S":case"SS":case"SSS":case"SSSS":r[Fe]=T(1e3*("0."+t));break;case"x":n._d=new Date(T(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=j(t);break;case"dd":case"ddd":case"dddd":i=n._locale.weekdaysParse(t),null!=i?(n._w=n._w||{},n._w.d=i):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=T(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=_e.parseTwoDigitYear(t)}}function V(e){var n,i,r,o,s,a,l;n=e._w,null!=n.GG||null!=n.W||null!=n.E?(s=1,a=4,i=t(n.GG,e._a[Te],ce(_e(),1,4).year),r=t(n.W,1),o=t(n.E,1)):(s=e._locale._week.dow,a=e._locale._week.doy,i=t(n.gg,e._a[Te],ce(_e(),s,a).year),r=t(n.w,1),null!=n.d?(o=n.d,s>o&&++r):o=null!=n.e?n.e+s:s),l=ue(i,r,o,a,s),e._a[Te]=l.year,e._dayOfYear=l.dayOfYear}function G(e){var n,i,r,o,s=[];if(!e._d){for(r=Y(e),e._w&&null==e._a[Me]&&null==e._a[Ee]&&V(e),e._dayOfYear&&(o=t(e._a[Te],r[Te]),e._dayOfYear>R(o)&&(e._pf._overflowDayOfYear=!0),i=oe(o,0,e._dayOfYear),e._a[Ee]=i.getUTCMonth(),e._a[Me]=i.getUTCDate()),n=0;3>n&&null==e._a[n];++n)e._a[n]=s[n]=r[n];for(;7>n;n++)e._a[n]=s[n]=null==e._a[n]?2===n?1:0:e._a[n];24===e._a[Re]&&0===e._a[Le]&&0===e._a[De]&&0===e._a[Fe]&&(e._nextDay=!0,e._a[Re]=0),e._d=(e._useUTC?oe:re).apply(null,s),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Re]=24)}}function K(e){var t;e._d||(t=x(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],G(e))}function Y(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function X(t){if(t._f===_e.ISO_8601)return void ee(t);t._a=[],t._pf.empty=!0;var n,i,r,o,s,a=""+t._i,l=a.length,c=0;for(r=z(t._f,t._locale).match(Ne)||[],n=0;n<r.length;n++)o=r[n],i=(a.match(U(o,t))||[])[0],i&&(s=a.substr(0,a.indexOf(i)),s.length>0&&t._pf.unusedInput.push(s),a=a.slice(a.indexOf(i)+i.length),c+=i.length),vt[o]?(i?t._pf.empty=!1:t._pf.unusedTokens.push(o),W(o,i,t)):t._strict&&!i&&t._pf.unusedTokens.push(o);t._pf.charsLeftOver=l-c,a.length>0&&t._pf.unusedInput.push(a),t._pf.bigHour===!0&&t._a[Re]<=12&&(t._pf.bigHour=e),t._a[Re]=u(t._locale,t._a[Re],t._meridiem),G(t),D(t)}function J(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,r){return t||n||i||r})}function Q(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Z(e){var t,n,r,o,s;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(o=0;o<e._f.length;o++)s=0,t=g({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=i(),t._f=e._f[o],X(t),F(t)&&(s+=t._pf.charsLeftOver,s+=10*t._pf.unusedTokens.length,t._pf.score=s,(null==r||r>s)&&(r=s,n=t));p(e,n||t)}function ee(e){var t,n,i=e._i,r=ot.exec(i);if(r){for(e._pf.iso=!0,t=0,n=at.length;n>t;t++)if(at[t][1].exec(i)){e._f=at[t][0]+(r[6]||" ");break}for(t=0,n=lt.length;n>t;t++)if(lt[t][1].exec(i)){e._f+=lt[t][0];break}i.match(Ye)&&(e._f+="Z"),X(e)}else e._isValid=!1}function te(e){ee(e),e._isValid===!1&&(delete e._isValid,_e.createFromInputFallback(e))}function ne(e,t){var n,i=[];for(n=0;n<e.length;++n)i.push(t(e[n],n));return i}function ie(t){var n,i=t._i;i===e?t._d=new Date:k(i)?t._d=new Date(+i):null!==(n=Oe.exec(i))?t._d=new Date(+n[1]):"string"==typeof i?te(t):C(i)?(t._a=ne(i.slice(0),function(e){return parseInt(e,10)}),G(t)):"object"==typeof i?K(t):"number"==typeof i?t._d=new Date(i):_e.createFromInputFallback(t)}function re(e,t,n,i,r,o,s){var a=new Date(e,t,n,i,r,o,s);return 1970>e&&a.setFullYear(e),a}function oe(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function se(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function ae(e,t,n,i,r){return r.relativeTime(t||1,!!n,e,i)}function le(e,t,n){var i=_e.duration(e).abs(),r=xe(i.as("s")),o=xe(i.as("m")),s=xe(i.as("h")),a=xe(i.as("d")),l=xe(i.as("M")),c=xe(i.as("y")),u=r<pt.s&&["s",r]||1===o&&["m"]||o<pt.m&&["mm",o]||1===s&&["h"]||s<pt.h&&["hh",s]||1===a&&["d"]||a<pt.d&&["dd",a]||1===l&&["M"]||l<pt.M&&["MM",l]||1===c&&["y"]||["yy",c];return u[2]=t,u[3]=+e>0,u[4]=n,ae.apply({},u)}function ce(e,t,n){var i,r=n-t,o=n-e.day();return o>r&&(o-=7),r-7>o&&(o+=7),i=_e(e).add(o,"d"),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function ue(e,t,n,i,r){var o,s,a=oe(e,0,1).getUTCDay();return a=0===a?7:a,n=null!=n?n:r,o=r-a+(a>i?7:0)-(r>a?7:0),s=7*(t-1)+(n-r)+o+1,{year:s>0?e:e-1,dayOfYear:s>0?s:R(e-1)+s}}function de(t){var n,i=t._i,r=t._f;return t._locale=t._locale||_e.localeData(t._l),null===i||r===e&&""===i?_e.invalid({nullInput:!0}):("string"==typeof i&&(t._i=i=t._locale.preparse(i)),_e.isMoment(i)?new h(i,!0):(r?C(r)?Z(t):X(t):ie(t),n=new h(t),n._nextDay&&(n.add(1,"d"),n._nextDay=e),n))}function he(e,t){var n,i;if(1===t.length&&C(t[0])&&(t=t[0]),!t.length)return _e();for(n=t[0],i=1;i<t.length;++i)t[i][e](n)&&(n=t[i]);return n}function fe(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),E(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pe(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function ge(e,t,n){return"Month"===t?fe(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function me(e,t){return function(n){return null!=n?(ge(this,e,n),_e.updateOffset(this,t),this):pe(this,e)}}function ve(e){return 400*e/146097}function ye(e){return 146097*e/400}function we(e){_e.duration.fn[e]=function(){return this._data[e]}}function be(e){"undefined"==typeof ender&&(Ce=$e.moment,$e.moment=e?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",_e):_e)}for(var _e,Ce,ke,Se="2.9.0",$e="undefined"==typeof global||"undefined"!=typeof window&&window!==global.window?this:global,xe=Math.round,Ae=Object.prototype.hasOwnProperty,Te=0,Ee=1,Me=2,Re=3,Le=4,De=5,Fe=6,Pe={},Ie=[],qe="undefined"!=typeof module&&module&&module.exports,Oe=/^\/?Date\((\-?\d+)/i,Be=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,He=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ne=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,ze=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ue=/\d\d?/,je=/\d{1,3}/,We=/\d{1,4}/,Ve=/[+\-]?\d{1,6}/,Ge=/\d+/,Ke=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Ye=/Z|[\+\-]\d\d:?\d\d/gi,Xe=/T/i,Je=/[\+\-]?\d+/,Qe=/[\+\-]?\d+(\.\d{1,3})?/,Ze=/\d/,et=/\d\d/,tt=/\d{3}/,nt=/\d{4}/,it=/[+-]?\d{6}/,rt=/[+-]?\d+/,ot=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,st="YYYY-MM-DDTHH:mm:ssZ",at=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],lt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ct=/([\+\-]|\d\d)/gi,ut=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),dt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ht={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ft={},pt={s:45,m:45,h:22,d:26,M:11},gt="DDD w W M D d".split(" "),mt="M D H h m s w W".split(" "),vt={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e);
},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return v(this.year()%100,2)},YYYY:function(){return v(this.year(),4)},YYYYY:function(){return v(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+v(Math.abs(e),6)},gg:function(){return v(this.weekYear()%100,2)},gggg:function(){return v(this.weekYear(),4)},ggggg:function(){return v(this.weekYear(),5)},GG:function(){return v(this.isoWeekYear()%100,2)},GGGG:function(){return v(this.isoWeekYear(),4)},GGGGG:function(){return v(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return T(this.milliseconds()/100)},SS:function(){return v(T(this.milliseconds()/10),2)},SSS:function(){return v(this.milliseconds(),3)},SSSS:function(){return v(this.milliseconds(),3)},Z:function(){var e=this.utcOffset(),t="+";return 0>e&&(e=-e,t="-"),t+v(T(e/60),2)+":"+v(T(e)%60,2)},ZZ:function(){var e=this.utcOffset(),t="+";return 0>e&&(e=-e,t="-"),t+v(T(e/60),2)+v(T(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},yt={},wt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],bt=!1;gt.length;)ke=gt.pop(),vt[ke+"o"]=l(vt[ke],ke);for(;mt.length;)ke=mt.pop(),vt[ke+ke]=a(vt[ke],2);vt.DDDD=a(vt.DDD,3),p(d.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var i,r,o;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;12>i;i++){if(r=_e.utc([2e3,i]),n&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")),n||this._monthsParse[i]||(o="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[i]=new RegExp(o.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[i].test(e))return i;if(n&&"MMM"===t&&this._shortMonthsParse[i].test(e))return i;if(!n&&this._monthsParse[i].test(e))return i}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=_e([2e3,1]).day(t),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var i=this._calendar[e];return"function"==typeof i?i.apply(t,[n]):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var r=this._relativeTime[n];return"function"==typeof r?r(e,t,n,i):r.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return ce(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),_e=function(t,n,r,o){var s;return"boolean"==typeof r&&(o=r,r=e),s={},s._isAMomentObject=!0,s._i=t,s._f=n,s._l=r,s._strict=o,s._isUTC=!1,s._pf=i(),de(s)},_e.suppressDeprecationWarnings=!1,_e.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),_e.min=function(){var e=[].slice.call(arguments,0);return he("isBefore",e)},_e.max=function(){var e=[].slice.call(arguments,0);return he("isAfter",e)},_e.utc=function(t,n,r,o){var s;return"boolean"==typeof r&&(o=r,r=e),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=r,s._i=t,s._f=n,s._strict=o,s._pf=i(),de(s).utc()},_e.unix=function(e){return _e(1e3*e)},_e.duration=function(e,t){var i,r,o,s,a=e,l=null;return _e.isDuration(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(a={},t?a[t]=e:a.milliseconds=e):(l=Be.exec(e))?(i="-"===l[1]?-1:1,a={y:0,d:T(l[Me])*i,h:T(l[Re])*i,m:T(l[Le])*i,s:T(l[De])*i,ms:T(l[Fe])*i}):(l=He.exec(e))?(i="-"===l[1]?-1:1,o=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*i},a={y:o(l[2]),M:o(l[3]),d:o(l[4]),h:o(l[5]),m:o(l[6]),s:o(l[7]),w:o(l[8])}):null==a?a={}:"object"==typeof a&&("from"in a||"to"in a)&&(s=w(_e(a.from),_e(a.to)),a={},a.ms=s.milliseconds,a.M=s.months),r=new f(a),_e.isDuration(e)&&n(e,"_locale")&&(r._locale=e._locale),r},_e.version=Se,_e.defaultFormat=st,_e.ISO_8601=function(){},_e.momentProperties=Ie,_e.updateOffset=function(){},_e.relativeTimeThreshold=function(t,n){return pt[t]===e?!1:n===e?pt[t]:(pt[t]=n,!0)},_e.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return _e.locale(e,t)}),_e.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?_e.defineLocale(e,t):_e.localeData(e),n&&(_e.duration._locale=_e._locale=n)),_e._locale._abbr},_e.defineLocale=function(e,t){return null!==t?(t.abbr=e,Pe[e]||(Pe[e]=new d),Pe[e].set(t),_e.locale(e),Pe[e]):(delete Pe[e],null)},_e.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(e){return _e.localeData(e)}),_e.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return _e._locale;if(!C(e)){if(t=q(e))return t;e=[e]}return I(e)},_e.isMoment=function(e){return e instanceof h||null!=e&&n(e,"_isAMomentObject")},_e.isDuration=function(e){return e instanceof f};for(ke=wt.length-1;ke>=0;--ke)A(wt[ke]);_e.normalizeUnits=function(e){return $(e)},_e.invalid=function(e){var t=_e.utc(NaN);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},_e.parseZone=function(){return _e.apply(null,arguments).parseZone()},_e.parseTwoDigitYear=function(e){return T(e)+(T(e)>68?1900:2e3)},_e.isDate=k,p(_e.fn=h.prototype,{clone:function(){return _e(this)},valueOf:function(){return+this._d-6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=_e(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():N(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):N(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return F(this)},isDSTShifted:function(){return this._a?this.isValid()&&S(this._a,(this._isUTC?_e.utc(this._a):_e(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.utcOffset(0,e)},local:function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(e){var t=N(this,e||_e.defaultFormat);return this.localeData().postformat(t)},add:b(1,"add"),subtract:b(-1,"subtract"),diff:function(e,t,n){var i,r,o=O(e,this),s=6e4*(o.utcOffset()-this.utcOffset());return t=$(t),"year"===t||"month"===t||"quarter"===t?(r=c(this,o),"quarter"===t?r/=3:"year"===t&&(r/=12)):(i=this-o,r="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-s)/864e5:"week"===t?(i-s)/6048e5:i),n?r:m(r)},from:function(e,t){return _e.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(_e(),e)},calendar:function(e){var t=e||_e(),n=O(t,this).startOf("day"),i=this.diff(n,"days",!0),r=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.localeData().calendar(r,this,_e(t)))},isLeapYear:function(){return L(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=se(e,this.localeData()),this.add(e-t,"d")):t},month:me("Month",!0),startOf:function(e){switch(e=$(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=$(t),t===e||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(e,t){var n;return t=$("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=_e.isMoment(e)?e:_e(e),+this>+e):(n=_e.isMoment(e)?+e:+_e(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=$("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=_e.isMoment(e)?e:_e(e),+e>+this):(n=_e.isMoment(e)?+e:+_e(e),+this.clone().endOf(t)<n)},isBetween:function(e,t,n){return this.isAfter(e,n)&&this.isBefore(t,n)},isSame:function(e,t){var n;return t=$(t||"millisecond"),"millisecond"===t?(e=_e.isMoment(e)?e:_e(e),+this===+e):(n=+_e(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=_e.apply(null,arguments),this>e?this:e}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=_e.apply(null,arguments),e>this?this:e}),zone:o("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),utcOffset:function(e,t){var n,i=this._offset||0;return null!=e?("string"==typeof e&&(e=j(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateUtcOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),i!==e&&(!t||this._changeInProgress?_(this,_e.duration(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,_e.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?i:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&0===this._offset},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(j(this._i)),this},hasAlignedHourOffset:function(e){return e=e?_e(e).utcOffset():0,(this.utcOffset()-e)%60===0},daysInMonth:function(){return E(this.year(),this.month())},dayOfYear:function(e){var t=xe((_e(this).startOf("day")-_e(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=ce(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=ce(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=ce(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return M(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return M(this.year(),e.dow,e.doy)},get:function(e){return e=$(e),this[e]()},set:function(e,t){var n;if("object"==typeof e)for(n in e)this.set(n,e[n]);else e=$(e),"function"==typeof this[e]&&this[e](t);return this},locale:function(t){var n;return t===e?this._locale._abbr:(n=_e.localeData(t),null!=n&&(this._locale=n),this)},lang:o("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return 15*-Math.round(this._d.getTimezoneOffset()/15)}}),_e.fn.millisecond=_e.fn.milliseconds=me("Milliseconds",!1),_e.fn.second=_e.fn.seconds=me("Seconds",!1),_e.fn.minute=_e.fn.minutes=me("Minutes",!1),_e.fn.hour=_e.fn.hours=me("Hours",!0),_e.fn.date=me("Date",!0),_e.fn.dates=o("dates accessor is deprecated. Use date instead.",me("Date",!0)),_e.fn.year=me("FullYear",!0),_e.fn.years=o("years accessor is deprecated. Use year instead.",me("FullYear",!0)),_e.fn.days=_e.fn.day,_e.fn.months=_e.fn.month,_e.fn.weeks=_e.fn.week,_e.fn.isoWeeks=_e.fn.isoWeek,_e.fn.quarters=_e.fn.quarter,_e.fn.toJSON=_e.fn.toISOString,_e.fn.isUTC=_e.fn.isUtc,p(_e.duration.fn=f.prototype,{_bubble:function(){var e,t,n,i=this._milliseconds,r=this._days,o=this._months,s=this._data,a=0;s.milliseconds=i%1e3,e=m(i/1e3),s.seconds=e%60,t=m(e/60),s.minutes=t%60,n=m(t/60),s.hours=n%24,r+=m(n/24),a=m(ve(r)),r-=m(ye(a)),o+=m(r/30),r%=30,a+=m(o/12),o%=12,s.days=r,s.months=o,s.years=a},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return m(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*T(this._months/12)},humanize:function(e){var t=le(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=_e.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=_e.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=$(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=$(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*ve(t),"month"===e?n:n/12;switch(t=this._days+Math.round(ye(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:_e.fn.lang,locale:_e.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),r=Math.abs(this.minutes()),o=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||r||o?"T":"")+(i?i+"H":"")+(r?r+"M":"")+(o?o+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}}),_e.duration.fn.toString=_e.duration.fn.toISOString;for(ke in ut)n(ut,ke)&&we(ke.toLowerCase());_e.duration.fn.asMilliseconds=function(){return this.as("ms")},_e.duration.fn.asSeconds=function(){return this.as("s")},_e.duration.fn.asMinutes=function(){return this.as("m")},_e.duration.fn.asHours=function(){return this.as("h")},_e.duration.fn.asDays=function(){return this.as("d")},_e.duration.fn.asWeeks=function(){return this.as("weeks")},_e.duration.fn.asMonths=function(){return this.as("M")},_e.duration.fn.asYears=function(){return this.as("y")},_e.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===T(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),qe?module.exports=_e:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&($e.moment=Ce),_e}),be(!0)):be()}.call(this),define("ide/history/util/displayNameForUser",[],function(){var e;return e=function(e){if(null==e)return"Anonymous";if(e.id===window.user.id)return"you";if(null!=e.name)return e.name;var t=[e.first_name,e.last_name].filter(function(e){return null!=e}).join(" ").trim();return""===t&&(t=e.email.split("@")[0]),null==t||""===t?"?":t}}),define("ide/history/controllers/HistoryListController",["base","ide/history/util/displayNameForUser"],function(e,t){return e.controller("HistoryListController",["$scope","$modal","ide",function(e,n,i){e.hoveringOverListSelectors=!1,e.projectUsers=[],e.$watch("project.members",function(t){return null!=t?e.projectUsers=t.concat(e.project.owner):void 0});var r=function(t){return _.find(e.projectUsers,function(e){var n=(null!=e?e._id:void 0)||(null!=e?e.id:void 0);return n===t})};return e.getDisplayNameById=function(e){return t(r(e))},e.deleteLabel=function(e){return n.open({templateUrl:"historyV2DeleteLabelModalTemplate",controller:"HistoryV2DeleteLabelModalController",resolve:{labelDetails:function(){return e}}})},e.loadMore=function(){return i.historyManager.fetchNextBatchOfUpdates()},e.recalculateSelectedUpdates=function(){var t=!0,n=!1;return e.history.selection.updates=[],function(){for(var i=[],r=0,o=Array.from(e.history.updates);r<o.length;r++){var s,a=o[r];a.selectedTo&&(s=!0,t=!1),a.beforeSelection=t,a.inSelection=s,a.afterSelection=n,s&&e.history.selection.updates.push(a),a.selectedFrom?(s=!1,i.push(n=!0)):i.push(void 0)}return i}()},e.recalculateHoveredUpdates=function(){for(var t,n=!1,i=!1,r=0,o=Array.from(e.history.updates);r<o.length;r++){var s=o[r];s.hoverSelectedFrom&&(n=!0),s.hoverSelectedTo&&(i=!0)}if(n){t=!1;for(var a=0,l=Array.from(e.history.updates);a<l.length;a++)s=l[a],s.selectedTo&&(s.hoverSelectedTo=!0,t=!0),s.inHoverSelection=t,s.hoverSelectedFrom&&(t=!1)}return i?(t=!1,function(){for(var n=[],i=0,r=Array.from(e.history.updates);i<r.length;i++)s=r[i],s.hoverSelectedTo&&(t=!0),s.inHoverSelection=t,s.selectedFrom?(s.hoverSelectedFrom=!0,n.push(t=!1)):n.push(void 0);return n}()):void 0},e.resetHoverState=function(){return function(){for(var t=[],n=0,i=Array.from(e.history.updates);n<i.length;n++){var r=i[n];delete r.hoverSelectedFrom,delete r.hoverSelectedTo,t.push(delete r.inHoverSelection)}return t}()},e.$watch("history.updates.length",function(){return e.recalculateSelectedUpdates()})}]),e.controller("HistoryListItemController",["$scope","event_tracking",function(e,n){return e.$watch("update.selectedFrom",function(t,n){if(t){for(var i=0,r=Array.from(e.history.updates);i<r.length;i++){var o=r[i];o!==e.update&&(o.selectedFrom=!1)}return e.recalculateSelectedUpdates()}}),e.$watch("update.selectedTo",function(t,n){if(t){for(var i=0,r=Array.from(e.history.updates);i<r.length;i++){var o=r[i];o!==e.update&&(o.selectedTo=!1)}return e.recalculateSelectedUpdates()}}),e.select=function(){return n.sendMB("history-view-change"),e.update.selectedTo=!0,e.update.selectedFrom=!0},e.mouseOverSelectedFrom=function(){return e.history.hoveringOverListSelectors=!0,e.update.hoverSelectedFrom=!0,e.recalculateHoveredUpdates()},e.mouseOutSelectedFrom=function(){return e.history.hoveringOverListSelectors=!1,e.resetHoverState()},e.mouseOverSelectedTo=function(){return e.history.hoveringOverListSelectors=!0,e.update.hoverSelectedTo=!0,e.recalculateHoveredUpdates()},e.mouseOutSelectedTo=function(){return e.history.hoveringOverListSelectors=!1,e.resetHoverState()},e.displayName=t}])}),define("ide/history/controllers/HistoryDiffController",["base"],function(e){return e.controller("HistoryDiffController",["$scope","$modal","ide","event_tracking",function(e,t,n,i){return e.restoreDeletedDoc=function(){return i.sendMB("history-restore-deleted"),e.history.diff.restoreInProgress=!0,n.historyManager.restoreDeletedDoc(e.history.diff.doc).then(function(t){var n=t.data;return e.history.diff.restoredDocNewId=n.doc_id,e.history.diff.restoreInProgress=!1,e.history.diff.restoreDeletedSuccess=!0})},e.openRestoreDiffModal=function(){return i.sendMB("history-restore-modal"),t.open({templateUrl:"historyRestoreDiffModalTemplate",controller:"HistoryRestoreDiffModalController",resolve:{diff:function(){return e.history.diff}}})},e.backToEditorAfterRestore=function(){return n.editorManager.openDoc({id:e.history.diff.restoredDocNewId})}}]),e.controller("HistoryRestoreDiffModalController",["$scope","$modalInstance","diff","ide","event_tracking",function(e,t,n,i,r){return e.state={inflight:!1},e.diff=n,e.restore=function(){return r.sendMB("history-restored"),e.state.inflight=!0,i.historyManager.restoreDiff(n).then(function(){return e.state.inflight=!1,t.close(),i.editorManager.openDoc(n.doc)})},e.cancel=function(){return t.dismiss()}}])}),define("ide/history/directives/infiniteScroll",["base"],function(e){return e.directive("infiniteScroll",function(){return{link:function(e,t,n,i){var r=t.find(".infinite-scroll-inner");t.css({"overflow-y":"auto"});var o=function(){return null!=n.infiniteScrollUpwards?s():a()},s=function(){return t.scrollTop()<30},a=function(){return t.scrollTop()+t.height()>=r.height()-30},l=function(){return t.height()>r.height()},c=function u(){if((l()||o())&&!e.$eval(n.infiniteScrollDisabled)){var t=e.$eval(n.infiniteScroll);return t.then(function(){return setTimeout(function(){return u()},0)})}};return t.on("scroll",function(e){return c()}),e.$watch(n.infiniteScrollInitialize,function(e){return e?c():void 0})}}})}),define("ide/history/HistoryManager",["moment","ide/colors/ColorManager","ide/history/util/displayNameForUser","ide/history/controllers/HistoryListController","ide/history/controllers/HistoryDiffController","ide/history/directives/infiniteScroll"],function(e,t,n){var i;return i=function(){return i=function(){function i(e,t){var n=this;_classCallCheck(this,i),this.ide=e,this.$scope=t,this.reset(),this.$scope.toggleHistory=function(){return"history"===n.$scope.ui.view?n.hide():n.show()},this.$scope.$watch("history.selection.updates",function(e){return null!=e&&e.length>0?(n._selectDocFromUpdates(),n.reloadDiff()):void 0}),this.$scope.$on("entity:selected",function(e,t){return"history"===n.$scope.ui.view&&"doc"===t.type?(n.$scope.history.selection.doc=t,n.reloadDiff()):void 0})}return _createClass(i,null,[{key:"initClass",value:function(){this.prototype.BATCH_SIZE=10}}]),_createClass(i,[{key:"show",value:function(){return this.$scope.ui.view="history",this.reset()}},{key:"hide",value:function(){return this.$scope.ui.view="editor",this.$scope.$emit("entity:selected",this.ide.fileTreeManager.findSelectedEntity())}},{key:"reset",value:function(){return this.$scope.history={updates:[],nextBeforeTimestamp:null,atEnd:!1,selection:{updates:[],doc:null,range:{fromV:null,toV:null,start_ts:null,end_ts:null}},diff:null}}},{key:"autoSelectRecentUpdates",value:function(){if(0!==this.$scope.history.updates.length){this.$scope.history.updates[0].selectedTo=!0;for(var e=0,t=0;t<this.$scope.history.updates.length;t++){var n=this.$scope.history.updates[t];if(this._updateContainsUserId(n,this.$scope.user.id))break;e=t}return this.$scope.history.updates[e].selectedFrom=!0}}},{key:"fetchNextBatchOfUpdates",value:function(){var e=this,t="/project/".concat(this.ide.project_id,"/updates?min_count=").concat(this.BATCH_SIZE);return null!=this.$scope.history.nextBeforeTimestamp&&(t+="&before=".concat(this.$scope.history.nextBeforeTimestamp)),this.$scope.history.loading=!0,this.ide.$http.get(t).then(function(t){var n=t.data;return e._loadUpdates(n.updates),e.$scope.history.nextBeforeTimestamp=n.nextBeforeTimestamp,null==n.nextBeforeTimestamp&&(e.$scope.history.atEnd=!0),e.$scope.history.loading=!1})}},{key:"reloadDiff",value:function(){var e=this,t=this.$scope.history.diff,n=this.$scope.history.selection,i=(n.updates,n.doc),r=this._calculateRangeFromSelection(),o=r.fromV,s=r.toV,a=r.start_ts,l=r.end_ts;if(null!=i&&(null==t||t.doc!==i||t.fromV!==o||t.toV!==s)){if(this.$scope.history.diff=t={fromV:o,toV:s,start_ts:a,end_ts:l,doc:i,error:!1,pathname:i.name},i.deleted)return t.deleted=!0,t.restoreInProgress=!1,t.restoreDeletedSuccess=!1,t.restoredDocNewId=null;t.loading=!0;var c="/project/".concat(this.$scope.project_id,"/doc/").concat(t.doc.id,"/diff");return null!=t.fromV&&null!=t.toV&&(c+="?from=".concat(t.fromV,"&to=").concat(t.toV)),this.ide.$http.get(c).then(function(n){var i=n.data;t.loading=!1;var r=e._parseDiff(i),o=r.text,s=r.highlights;return t.text=o,t.highlights=s})["catch"](function(){return t.loading=!1,t.error=!0})}}},{key:"restoreDeletedDoc",value:function(e){var t="/project/".concat(this.$scope.project_id,"/doc/").concat(e.id,"/restore");return this.ide.$http.post(t,{name:e.name,_csrf:window.csrfToken})}},{key:"restoreDiff",value:function(e){var t="/project/".concat(this.$scope.project_id,"/doc/").concat(e.doc.id,"/version/").concat(e.fromV,"/restore");return this.ide.$http.post(t,{_csrf:window.csrfToken})}},{key:"_parseDiff",value:function(i){for(var r=0,o=0,s=[],a="",l=i.diff||[],c=0;c<l.length;c++){var u,d,h=l[c],f=h.u||h.i||h.d;f||(f=""),a+=f;var p=f.split("\n"),g=r,m=o;p.length>1?(d=g+p.length-1,u=p[p.length-1].length):(d=g,u=m+p[0].length),r=d,o=u;var v={start:{row:g,column:m},end:{row:d,column:u}};if(null!=h.i||null!=h.d){var y=n(h.meta.user),w=e(h.meta.end_ts).format("Do MMM YYYY, h:mm a");null!=h.i?s.push({label:"Added by ".concat(y," on ").concat(w),highlight:v,hue:t.getHueForUserId(null!=h.meta.user?h.meta.user.id:void 0)}):null!=h.d&&s.push({label:"Deleted by ".concat(y," on ").concat(w),strikeThrough:v,hue:t.getHueForUserId(null!=h.meta.user?h.meta.user.id:void 0)})}}return{text:a,highlights:s}}},{key:"_loadUpdates",value:function(n){null==n&&(n=[]);for(var i=this.$scope.history.updates[this.$scope.history.updates.length-1],r=0,o=Array.from(n);r<o.length;r++){var s=o[r];s.pathnames=[];var a=s.docs||{};for(var l in a){var c=a[l];c.entity=this.ide.fileTreeManager.findEntityById(l,{includeDeleted:!0}),s.pathnames.push(c.entity.name)}for(var u=0,d=Array.from(s.meta.users||[]);u<d.length;u++){var h=d[u];null!=h&&(h.hue=t.getHueForUserId(h.id))}null!=i&&e(i.meta.end_ts).isSame(s.meta.end_ts,"day")||(s.meta.first_in_day=!0),s.selectedFrom=!1,s.selectedTo=!1,s.inSelection=!1,i=s}var f=0===this.$scope.history.updates.length;return this.$scope.history.updates=this.$scope.history.updates.concat(n),f?this.autoSelectRecentUpdates():void 0}},{key:"_calculateRangeFromSelection",value:function(){for(var e,t,n,i=n=t=e=null,r=null!=this.$scope.history.selection.doc?this.$scope.history.selection.doc.id:void 0,o=0,s=Array.from(this.$scope.history.selection.updates||[]);o<s.length;o++){var a=s[o];for(var l in a.docs){var c=a.docs[l];if(l===r){null!=i&&null!=n?(i=Math.min(i,c.fromV),n=Math.max(n,c.toV),t=Math.min(t,a.meta.start_ts),e=Math.max(e,a.meta.end_ts)):(i=c.fromV,n=c.toV,t=a.meta.start_ts,e=a.meta.end_ts);break}}}return{fromV:i,toV:n,start_ts:t,end_ts:e}}},{key:"_selectDocFromUpdates",value:function(){for(var e,t,n={},i=0,r=Array.from(this.$scope.history.selection.updates);i<r.length;i++){var o=r[i];for(t in o.docs)e=o.docs[t],n[t]=e.entity}var s=this.$scope.history.selection.doc;if(null!=s&&null!=n[s.id]);else for(t in n){e=n[t],s=e;break}return this.$scope.history.selection.doc=s,this.ide.fileTreeManager.selectEntity(s)}},{key:"_updateContainsUserId",value:function(e,t){for(var n=0,i=Array.from(e.meta.users);n<i.length;n++){var r=i[n];if((null!=r?r.id:void 0)===t)return!0}return!1}}]),i}(),i.initClass(),i}()}),define("ide/history/util/HistoryViewModes",[],function(){var e;return e={POINT_IN_TIME:"point_in_time",COMPARE:"compare"}}),define("ide/history/controllers/HistoryV2ListController",["base","ide/history/util/displayNameForUser"],function(e,t){return e.controller("HistoryV2ListController",["$scope","$modal","ide",function(e,t,n){return e.hoveringOverListSelectors=!1,e.listConfig={showOnlyLabelled:!1},e.projectUsers=[],e.$watch("project.members",function(t){return null!=t?e.projectUsers=t.concat(e.project.owner):void 0}),e.loadMore=function(){return n.historyManager.fetchNextBatchOfUpdates()},e.handleVersionSelect=function(t){return e.$applyAsync(function(){return n.historyManager.selectVersionForPointInTime(t)})},e.handleRangeSelect=function(t,i){return e.$applyAsync(function(){return n.historyManager.selectVersionsForCompare(t,i)})},e.handleLabelDelete=function(e){return t.open({templateUrl:"historyV2DeleteLabelModalTemplate",controller:"HistoryV2DeleteLabelModalController",resolve:{labelDetails:function(){return e}}})}}])}),define("ide/history/controllers/HistoryV2FileTreeController",["base"],function(e){return e.controller("HistoryV2FileTreeController",["$scope","ide",function(e,t){e.handleFileSelection=function(e){t.historyManager.selectFile(e)}}])}),define("ide/history/controllers/HistoryV2ToolbarController",["base"],function(e){return e.controller("HistoryV2ToolbarController",["$scope","$modal","ide","event_tracking","waitFor",function(e,t,n,i,r){var o;e.currentUpdate=null,e.currentLabel=null,e.restoreState={inflight:!1,error:!1},e.toolbarUIConfig={showOnlyLabels:!1};var s=e.$watch("history.showOnlyLabels",function(t){
null!=t&&(e.toolbarUIConfig.showOnlyLabels=t,s())});e.$watch("toolbarUIConfig.showOnlyLabels",function(e,t){null!=e&&e!==t&&(e?n.historyManager.showOnlyLabels():n.historyManager.showAllUpdates())}),e.$watch("history.viewMode",function(t,i){null!=t&&t!==i&&(e.currentUpdate=n.historyManager.getUpdateForVersion(t))}),e.$watch("history.selection.range.toV",function(t,i){null!=t&&t!==i&&e.history.viewMode===e.HistoryViewModes.POINT_IN_TIME&&(e.currentUpdate=n.historyManager.getUpdateForVersion(t))}),e.toggleHistoryViewMode=function(){n.historyManager.toggleHistoryViewMode()},e.restoreDeletedFile=function(){var t=e.history.selection.file,r=t.pathname,s=t.deletedAtV;if(null!=r&&null!=s)return i.sendMB("history-v2-restore-deleted"),e.restoreState.inflight=!0,n.historyManager.restoreFile(s,r).then(function(e){var t=e.data;return o(t)})["catch"](function(){return n.showGenericMessageModal("Sorry, something went wrong with the restore")})["finally"](function(){return e.restoreState.inflight=!1})},e.showAddLabelDialog=function(){t.open({templateUrl:"historyV2AddLabelModalTemplate",controller:"HistoryV2AddLabelModalController",resolve:{update:function(){return e.history.selection.update}}})},o=function(e){var t=e.id,i=e.type;return r(function(){return n.fileTreeManager.findEntityById(t)},3e3).then(function(e){var t=this;"doc"===i?(n.editorManager.openDoc(e),this.ide.$timeout(function(){t.$scope.$broadcast("history:toggle")},0)):"file"===i&&(n.binaryFilesManager.openFile(e),this.ide.$timeout(function(){t.$scope.$broadcast("history:toggle")},0))})["catch"](function(e){return console.warn(e)})}}])}),define("ide/history/controllers/HistoryV2AddLabelModalController",["base"],function(e){return e.controller("HistoryV2AddLabelModalController",["$scope","$modalInstance","ide","update",function(e,t,n,i){return e.update=i,e.inputs={labelName:null},e.state={inflight:!1,error:!1},t.opened.then(function(){return e.$applyAsync(function(){return e.$broadcast("open")})}),e.addLabelModalFormSubmit=function(){return e.state.inflight=!0,n.historyManager.labelCurrentVersion(e.inputs.labelName).then(function(n){return e.state.inflight=!1,t.close()})["catch"](function(t){var n=t.data,i=t.status;return e.state.inflight=!1,400===i?e.state.error={message:n}:e.state.error=!0})}}])}),define("ide/history/controllers/HistoryV2DeleteLabelModalController",["base"],function(e){return e.controller("HistoryV2DeleteLabelModalController",["$scope","$modalInstance","ide","labelDetails",function(e,t,n,i){return e.labelDetails=i,e.state={inflight:!1,error:!1},e.deleteLabel=function(){return e.state.inflight=!0,n.historyManager.deleteLabel(i).then(function(n){return e.state.inflight=!1,t.close()})["catch"](function(t){var n=t.data,i=t.status;return e.state.inflight=!1,400===i?e.state.error={message:n}:e.state.error=!0})}}])}),define("ide/history/directives/historyDraggableBoundary",["base"],function(e){return e.directive("historyDraggableBoundary",function(){return{scope:{historyDraggableBoundary:"@",historyDraggableBoundaryOnDragStart:"&",historyDraggableBoundaryOnDragStop:"&"},restrict:"A",link:function(e,t,n){t.data("selectionBoundary",{boundary:e.historyDraggableBoundary}),t.draggable({axis:"y",opacity:!1,helper:"clone",revert:!0,scroll:!0,cursor:"row-resize",start:function(t,n){n.helper.data("wasProperlyDropped",!1),e.historyDraggableBoundaryOnDragStart()},stop:function(t,n){e.historyDraggableBoundaryOnDragStop({isValidDrop:n.helper.data("wasProperlyDropped"),boundary:e.historyDraggableBoundary})}})}}})}),define("ide/history/directives/historyDroppableArea",["base"],function(e){return e.directive("historyDroppableArea",function(){return{scope:{historyDroppableAreaOnDrop:"&",historyDroppableAreaOnOver:"&",historyDroppableAreaOnOut:"&"},restrict:"A",link:function(e,t,n){t.droppable({accept:function(e){return".history-entry-toV-handle, .history-entry-fromV-handle"},drop:function(t,n){var i=n.draggable.data("selectionBoundary").boundary;n.helper.data("wasProperlyDropped",!0),e.historyDroppableAreaOnDrop({boundary:i})},over:function(t,n){var i=n.draggable.data("selectionBoundary").boundary;e.historyDroppableAreaOnOver({boundary:i})}})}}})}),define("ide/history/components/historyEntriesList",["base"],function(e){var t=function(e,t,n,i){var r=this;r.$entryListViewportEl=null,r.isDragging=!1;var o=function(e){var t=e.offset().top,n=t+e.outerHeight(),i=r.$entryListViewportEl.offset().top,o=i+r.$entryListViewportEl.height();return t>=i&&o>=n},s=function(e){var t=r.$entryListViewportEl.height()/2;return e.offset().top-t};r.onEntryLinked=function(t,n){r.rangeSelectionEnabled||t.toV!==r.selectedHistoryVersion||e.$applyAsync(function(){o(n)||r.$entryListViewportEl.scrollTop(s(n))})},r.handleEntrySelect=function(e){r.rangeSelectionEnabled?r.onRangeSelect({selectedToV:e.toV,selectedFromV:e.fromV}):r.onVersionSelect({version:e.toV})},r.setRangeToV=function(e){e>r.selectedHistoryRange.fromV&&r.onRangeSelect({selectedToV:e,selectedFromV:r.selectedHistoryRange.fromV})},r.setRangeFromV=function(e){e<r.selectedHistoryRange.toV&&r.onRangeSelect({selectedToV:r.selectedHistoryRange.toV,selectedFromV:e})},r.initHoveredRange=function(){r.hoveredHistoryRange={toV:r.selectedHistoryRange.toV,fromV:r.selectedHistoryRange.fromV}},r.resetHoveredRange=function(){r.hoveredHistoryRange={toV:null,fromV:null}},r.setHoveredRangeToV=function(t){t>r.hoveredHistoryRange.fromV&&e.$applyAsync(function(){return r.hoveredHistoryRange.toV=t})},r.setHoveredRangeFromV=function(t){t<r.hoveredHistoryRange.toV&&e.$applyAsync(function(){return r.hoveredHistoryRange.fromV=t})},r.onDraggingStart=function(){e.$applyAsync(function(){r.isDragging=!0,r.initHoveredRange()})},r.onDraggingStop=function(t,n){e.$applyAsync(function(){r.isDragging=!1,t||("toV"===n?r.setRangeToV(r.hoveredHistoryRange.toV):"fromV"===n&&r.setRangeFromV(r.hoveredHistoryRange.fromV)),r.resetHoveredRange()})},r.$onInit=function(){r.$entryListViewportEl=t.find("> .history-entries"),r.resetHoveredRange()}};return t.$inject=["$scope","$element","$attrs","_"],e.component("historyEntriesList",{bindings:{entries:"<",users:"<",loadEntries:"&",loadDisabled:"<",loadInitialize:"<",isLoading:"<",currentUser:"<",freeHistoryLimitHit:"<",currentUserIsOwner:"<",rangeSelectionEnabled:"<",selectedHistoryVersion:"<?",selectedHistoryRange:"<?",onVersionSelect:"&",onRangeSelect:"&",onLabelDelete:"&"},controller:t,templateUrl:"historyEntriesListTpl"})}),define("ide/history/components/historyEntry",["base","ide/colors/ColorManager","ide/history/util/displayNameForUser"],function(e,t,n){var i=function(e,i,r,o){var s=this,a=function(e){return o.find(s.users,function(t){var n=(null!=t?t._id:void 0)||(null!=t?t.id:void 0);return n===e})};s.displayName=n,s.displayNameById=function(e){return n(a(e))},s.getProjectOpDoc=function(e){return null!=e.rename?"".concat(e.rename.pathname,"  ").concat(e.rename.newPathname):null!=e.add?"".concat(e.add.pathname):null!=e.remove?"".concat(e.remove.pathname):void 0},s.getUserCSSStyle=function(e){var n=(null!=e?e._id:void 0)||(null!=e?e.id:void 0),i=t.getHueForUserId(n)||100;return s.isEntrySelected()||s.isEntryHoverSelected()?{color:"#FFF"}:{color:"hsl(".concat(i,", 70%, 50%)")}},s.isEntrySelected=function(){return s.rangeSelectionEnabled?s.entry.toV<=s.selectedHistoryRange.toV&&s.entry.fromV>=s.selectedHistoryRange.fromV:s.entry.toV===s.selectedHistoryVersion},s.isEntryHoverSelected=function(){return s.rangeSelectionEnabled&&s.entry.toV<=s.hoveredHistoryRange.toV&&s.entry.fromV>=s.hoveredHistoryRange.fromV},s.onDraggingStart=function(){s.historyEntriesList.onDraggingStart()},s.onDraggingStop=function(e,t){return s.historyEntriesList.onDraggingStop(e,t)},s.onDrop=function(t){"toV"===t?e.$applyAsync(function(){return s.historyEntriesList.setRangeToV(s.entry.toV)}):"fromV"===t&&e.$applyAsync(function(){return s.historyEntriesList.setRangeFromV(s.entry.fromV)})},s.onOver=function(t){"toV"===t?e.$applyAsync(function(){return s.historyEntriesList.setHoveredRangeToV(s.entry.toV)}):"fromV"===t&&e.$applyAsync(function(){return s.historyEntriesList.setHoveredRangeFromV(s.entry.fromV)})},s.$onInit=function(){s.$entryEl=i.find("> .history-entry"),s.$entryDetailsEl=i.find(".history-entry-details"),s.$toVHandleEl=i.find(".history-entry-toV-handle"),s.$fromVHandleEl=i.find(".history-entry-fromV-handle"),s.historyEntriesList.onEntryLinked(s.entry,s.$entryEl)}};return i.$inject=["$scope","$element","$attrs","_"],e.component("historyEntry",{bindings:{entry:"<",currentUser:"<",users:"<",rangeSelectionEnabled:"<",isDragging:"<",selectedHistoryVersion:"<?",selectedHistoryRange:"<?",hoveredHistoryRange:"<?",onSelect:"&",onLabelDelete:"&"},require:{historyEntriesList:"^historyEntriesList"},controller:i,templateUrl:"historyEntryTpl"})}),define("ide/history/components/historyLabelsList",["base","ide/colors/ColorManager","ide/history/util/displayNameForUser"],function(e,t,n){var i=function(e,i,r,o){var s=this;s.isDragging=!1,s.versionsWithLabels=[],e.$watchCollection("$ctrl.labels",function(e){if(null!=e&&e.length>0){var t=o.groupBy(e,"version");s.versionsWithLabels=o.map(t,function(e,t){return{version:parseInt(t,10),labels:e}})}}),s.initHoveredRange=function(){s.hoveredHistoryRange={toV:s.selectedHistoryRange.toV,fromV:s.selectedHistoryRange.fromV}},s.resetHoveredRange=function(){s.hoveredHistoryRange={toV:null,fromV:null}},s.setHoveredRangeToV=function(e){e>=s.hoveredHistoryRange.fromV&&(s.hoveredHistoryRange.toV=e)},s.setHoveredRangeFromV=function(e){e<=s.hoveredHistoryRange.toV&&(s.hoveredHistoryRange.fromV=e)},s.isVersionSelected=function(e){return s.rangeSelectionEnabled?e<=s.selectedHistoryRange.toV&&e>=s.selectedHistoryRange.fromV:e===s.selectedHistoryVersion},s.isVersionHoverSelected=function(e){return s.rangeSelectionEnabled&&e<=s.hoveredHistoryRange.toV&&e>=s.hoveredHistoryRange.fromV},s.onDraggingStart=function(){e.$applyAsync(function(){s.isDragging=!0,s.initHoveredRange()})},s.onDraggingStop=function(t,n){e.$applyAsync(function(){t||("toV"===n?s.setRangeToV(s.hoveredHistoryRange.toV):"fromV"===n&&s.setRangeFromV(s.hoveredHistoryRange.fromV)),s.isDragging=!1,s.resetHoveredRange()})},s.onDrop=function(t,n){"toV"===t?e.$applyAsync(function(){return s.setRangeToV(n.version)}):"fromV"===t&&e.$applyAsync(function(){return s.setRangeFromV(n.version)})},s.onOver=function(t,n){"toV"===t?e.$applyAsync(function(){return s.setHoveredRangeToV(n.version)}):"fromV"===t&&e.$applyAsync(function(){return s.setHoveredRangeFromV(n.version)})},s.handleVersionSelect=function(e){s.rangeSelectionEnabled?s.onRangeSelect({selectedToV:e.version,selectedFromV:e.version}):s.onVersionSelect({version:e.version})},s.setRangeToV=function(e){e>=s.selectedHistoryRange.fromV&&s.onRangeSelect({selectedToV:e,selectedFromV:s.selectedHistoryRange.fromV})},s.setRangeFromV=function(e){e<=s.selectedHistoryRange.toV&&s.onRangeSelect({selectedToV:s.selectedHistoryRange.toV,selectedFromV:e})},s.getUserById=function(e){return o.find(s.users,function(t){var n=(null!=t?t._id:void 0)||(null!=t?t.id:void 0);return n===e})},s.displayName=n,s.getUserCSSStyle=function(e,n){var i=(null!=e?e._id:void 0)||(null!=e?e.id:void 0),r=t.getHueForUserId(i)||100;return s.isVersionSelected(n.version)||s.isVersionHoverSelected(n.version)?{color:"#FFF"}:{color:"hsl(".concat(r,", 70%, 50%)")}},s.$onInit=function(){s.resetHoveredRange()}};return i.$inject=["$scope","$element","$attrs","_"],e.component("historyLabelsList",{bindings:{labels:"<",rangeSelectionEnabled:"<",users:"<",currentUser:"<",isLoading:"<",selectedHistoryVersion:"<?",selectedHistoryRange:"<?",onVersionSelect:"&",onRangeSelect:"&",onLabelDelete:"&"},controller:i,templateUrl:"historyLabelsListTpl"})}),define("ide/history/components/historyLabel",["base"],function(e){var t=function(e,t,n,i,r){var o=this;o.$onInit=function(){null==o.showTooltip&&(o.showTooltip=!0),null==o.isPseudoCurrentStateLabel&&(o.isPseudoCurrentStateLabel=!1)}};return t.$inject=["$scope","$element","$attrs","$filter","_"],e.component("historyLabel",{bindings:{labelText:"<",labelOwnerName:"<?",labelCreationDateTime:"<?",isOwnedByCurrentUser:"<",isPseudoCurrentStateLabel:"<",onLabelDelete:"&",showTooltip:"<?"},controller:t,templateUrl:"historyLabelTpl"})}),define("ide/history/components/historyFileTree",["base"],function(e){var t=function(e,t,n,i){function r(e,t){for(var n=t.pathname.split("/"),r=e,o=0;o<n.length;o++){var s,a=n[o],l=o===n.length-1;l?(s=i.clone(t),s.name=a,s.type="file",r.push(s)):(s=i.find(r,function(e){return e.name===a}),null==s&&(s={name:a,type:"folder",children:[]},r.push(s)),r=s.children)}return e}var o=this;o.handleEntityClick=function(e){return o.onSelectedFileChange({file:e})},o._fileTree=[],e.$watch("$ctrl.files",function(e){null!=e&&e.length>0&&(o._fileTree=i.reduce(e,r,[]))})};return t.$inject=["$scope","$element","$attrs","_"],e.component("historyFileTree",{bindings:{files:"<",selectedPathname:"<",onSelectedFileChange:"&",isLoading:"<"},controller:t,templateUrl:"historyFileTreeTpl"})}),define("ide/file-tree/util/fileOperationI18nNames",[],function(){return{edited:document.getElementById("file_action_edited_str").innerText,renamed:document.getElementById("file_action_renamed_str").innerText,created:document.getElementById("file_action_created_str").innerText,deleted:document.getElementById("file_action_deleted_str").innerText}}),define("ide/history/components/historyFileEntity",["base","ide/file-tree/util/iconTypeFromName","ide/file-tree/util/fileOperationI18nNames"],function(e,t,n){var i=function(e,i,r){var o=this;o.hasOperation=!1,o.getRenameTooltip=function(e){var t=s(o.fileEntity.oldPathname,o.fileEntity.pathname),i=_slicedToArray(t,2),r=i[0],a=i[1];return"".concat(n.renamed," <strong>").concat(r,"</strong> &rarr; <strong>").concat(a,"</strong>")},o.getFileOperationName=function(){return"edited"===o.fileEntity.operation?n.edited:"renamed"===o.fileEntity.operation?n.renamed:"added"===o.fileEntity.operation?n.created:"removed"===o.fileEntity.operation?n.deleted:""};var s=function(e,t){for(var n=e.split("/"),i=t.split("/"),r=Math.min(n.length,i.length)-1,o=0;r>o&&n[o]===i[o];o++);return n.splice(0,o),i.splice(0,o),[n.join("/"),i.join("/")]},a=function(){o.isOpen=!o.isOpen,o.entityTypeIconClass=c()},l=function(){return o.historyFileTreeController.handleEntityClick(o.fileEntity)},c=function(){return o.isOpen?"fa-folder-open":"fa-folder"};o.$onInit=function(){"folder"===o.fileEntity.type?(o.isOpen=!0,o.entityTypeIconClass=c(),o.handleClick=a):(o.fileEntity.operation&&(o.hasOperation=!0),o.entityTypeIconClass="fa-".concat(t(o.fileEntity.name)),o.entityOpTextClass=o.fileEntity.operation?"history-file-entity-name-".concat(o.fileEntity.operation):null,o.handleClick=l,e.$watch(function(){return o.historyFileTreeController.selectedPathname},function(e){return o.isSelected=o.fileEntity.pathname===e}))}};return i.$inject=["$scope","$element","$attrs"],e.component("historyFileEntity",{require:{historyFileTreeController:"^historyFileTree"},bindings:{fileEntity:"<"},controller:i,templateUrl:"historyFileEntityTpl"})}),define("ide/history/HistoryV2Manager",["moment","ide/colors/ColorManager","ide/history/util/displayNameForUser","ide/history/util/HistoryViewModes","ide/history/controllers/HistoryV2ListController","ide/history/controllers/HistoryV2FileTreeController","ide/history/controllers/HistoryV2ToolbarController","ide/history/controllers/HistoryV2AddLabelModalController","ide/history/controllers/HistoryV2DeleteLabelModalController","ide/history/directives/infiniteScroll","ide/history/directives/historyDraggableBoundary","ide/history/directives/historyDroppableArea","ide/history/components/historyEntriesList","ide/history/components/historyEntry","ide/history/components/historyLabelsList","ide/history/components/historyLabel","ide/history/components/historyFileTree","ide/history/components/historyFileEntity"],function(e,t,n,i){var r;return r=function(){return r=function(){function r(e,t,n){var o=this;_classCallCheck(this,r),this.labelCurrentVersion=this.labelCurrentVersion.bind(this),this.deleteLabel=this.deleteLabel.bind(this),this._addLabelLocally=this._addLabelLocally.bind(this),this.ide=e,this.$scope=t,this.localStorage=n,this.$scope.HistoryViewModes=i,this._localStorageViewModeProjKey="history.userPrefs.viewMode.".concat(t.project_id),this._localStorageShowOnlyLabelsProjKey="history.userPrefs.showOnlyLabels.".concat(t.project_id),this._previouslySelectedPathname=null,this._loadFileTreeRequestCanceller=null,this.hardReset(),this.$scope.toggleHistory=function(){"history"===o.$scope.ui.view?o.hide():(o.show(),o._handleHistoryUIStateChange()),o.ide.$timeout(function(){o.$scope.$broadcast("history:toggle")},0)},this.$scope.isHistoryLoading=function(){var e=o.$scope.history.selection;return o.$scope.history.loadingFileTree||o.$scope.history.viewMode===i.POINT_IN_TIME&&e.file&&e.file.loading||o.$scope.history.viewMode===i.COMPARE&&e.diff&&e.diff.loading}}return _createClass(r,null,[{key:"initClass",value:function(){this.prototype.MAX_RECENT_UPDATES_TO_SELECT=5,this.prototype.BATCH_SIZE=10}}]),_createClass(r,[{key:"show",value:function(){this.$scope.ui.view="history",this.hardReset(),this.$scope.history.showOnlyLabels&&this.fetchNextBatchOfUpdates()}},{key:"hide",value:function(){this.$scope.ui.view="editor"}},{key:"_getViewModeUserPref",value:function(){return this.localStorage(this._localStorageViewModeProjKey)||i.POINT_IN_TIME}},{key:"_getShowOnlyLabelsUserPref",value:function(){return this.localStorage(this._localStorageShowOnlyLabelsProjKey)||!1}},{key:"_setViewModeUserPref",value:function(e){(e===i.POINT_IN_TIME||e===i.COMPARE)&&this.localStorage(this._localStorageViewModeProjKey,e)}},{key:"_setShowOnlyLabelsUserPref",value:function(e){this.localStorage(this._localStorageShowOnlyLabelsProjKey,!!e)}},{key:"hardReset",value:function(){var e=this;this.$scope.history={isV2:!0,updates:[],viewMode:this._getViewModeUserPref(),nextBeforeTimestamp:null,atEnd:!1,userHasFullFeature:void 0,freeHistoryLimitHit:!1,selection:{docs:{},pathname:null,range:{fromV:null,toV:null},hoveredRange:{fromV:null,toV:null},diff:null,files:[],file:null},error:null,showOnlyLabels:this._getShowOnlyLabelsUserPref(),labels:null,loadingFileTree:!0};var t=this.$scope.$watch("project.features.versioning",function(n){null!=n&&(e.$scope.history.userHasFullFeature=n,e.$scope.user.isAdmin&&(e.$scope.history.userHasFullFeature=!0),t())})}},{key:"softReset",value:function(){this.$scope.history.viewMode=this._getViewModeUserPref(),this.$scope.history.selection={docs:{},pathname:null,range:{fromV:null,toV:null},hoveredRange:{fromV:null,toV:null},diff:null,files:[],file:null},this.$scope.history.error=null,this.$scope.history.showOnlyLabels=this._getShowOnlyLabelsUserPref(),this.$scope.history.loadingFileTree=!0}},{key:"toggleHistoryViewMode",value:function(){var e=this;this.$scope.history.viewMode===i.COMPARE?(this.softReset(),this.$scope.history.viewMode=i.POINT_IN_TIME,this._setViewModeUserPref(i.POINT_IN_TIME)):(this.softReset(),this.$scope.history.viewMode=i.COMPARE,this._setViewModeUserPref(i.COMPARE)),this._handleHistoryUIStateChange(),this.ide.$timeout(function(){e.$scope.$broadcast("history:toggle")},0)}},{key:"_handleHistoryUIStateChange",value:function(){this.$scope.history.viewMode===i.COMPARE?this.$scope.history.showOnlyLabels?this.autoSelectLabelsForComparison():this.autoSelectRecentUpdates():this.$scope.history.showOnlyLabels?this.autoSelectLabelForPointInTime():this.autoSelectVersionForPointInTime()}},{key:"setHoverFrom",value:function(e){var t=this.$scope.history.selection;t.hoveredRange.fromV=e,t.hoveredRange.toV=t.range.toV,this.$scope.history.hoveringOverListSelectors=!0}},{key:"setHoverTo",value:function(e){var t=this.$scope.history.selection;t.hoveredRange.toV=e,t.hoveredRange.fromV=t.range.fromV,this.$scope.history.hoveringOverListSelectors=!0}},{key:"resetHover",value:function(){var e=this.$scope.history.selection;e.hoveredRange.toV=null,e.hoveredRange.fromV=null,this.$scope.history.hoveringOverListSelectors=!1}},{key:"showAllUpdates",value:function(){this.$scope.history.showOnlyLabels&&(this.$scope.history.showOnlyLabels=!1,this._setShowOnlyLabelsUserPref(!1),this._handleHistoryUIStateChange())}},{key:"showOnlyLabels",value:function(){this.$scope.history.showOnlyLabels||(this.$scope.history.showOnlyLabels=!0,this._setShowOnlyLabelsUserPref(!0),this._handleHistoryUIStateChange())}},{key:"restoreFile",value:function(e,t){var n="/project/".concat(this.$scope.project_id,"/restore_file");return this.ide.$http.post(n,{version:e,pathname:t,_csrf:window.csrfToken})}},{key:"loadFileTreeForVersion",value:function(e){return this._loadFileTree(e,e)}},{key:"loadFileTreeDiff",value:function(e,t){return this._loadFileTree(e,t)}},{key:"_loadFileTree",value:function(e,t){var n=this,i="/project/".concat(this.$scope.project_id,"/filetree/diff"),r=this.$scope.history.selection,o=["from=".concat(t),"to=".concat(e)];return i+="?".concat(o.join("&")),this.$scope.$applyAsync(function(){return n.$scope.history.loadingFileTree=!0}),r.file=null,r.pathname=null,null!=this._loadFileTreeRequestCanceller&&this._loadFileTreeRequestCanceller.resolve(),this._loadFileTreeRequestCanceller=this.ide.$q.defer(),this.ide.$http.get(i,{timeout:this._loadFileTreeRequestCanceller.promise}).then(function(e){n.$scope.history.selection.files=e.data.diff;var t=!0,i=!1,r=void 0;try{for(var o,s=n.$scope.history.selection.files[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;null!=a.newPathname&&(a.oldPathname=a.pathname,a.pathname=a.newPathname,delete a.newPathname)}}catch(l){i=!0,r=l}finally{try{t||null==s["return"]||s["return"]()}finally{if(i)throw r}}n._loadFileTreeRequestCanceller=null,n.$scope.history.loadingFileTree=!1,n.autoSelectFile()})["catch"](function(e){-1!==e.status?n._loadFileTreeRequestCanceller=null:n.$scope.history.loadingFileTree=!1})}},{key:"selectFile",value:function(e){null!=e&&null!=e.pathname&&(this.$scope.history.selection.pathname=this._previouslySelectedPathname=e.pathname,this.$scope.history.selection.file=e,this.$scope.history.viewMode===i.POINT_IN_TIME?this.loadFileAtPointInTime():this.reloadDiff())}},{key:"autoSelectFile",value:function(){var e=this.$scope.history.selection.files,t=null,n=null,i=!1,r=this._getFilesWithOps(),o=["edited","added","renamed","removed"];if(null!=this._previouslySelectedPathname&&(n=_.find(e,{pathname:this._previouslySelectedPathname}),i=_.some(r,{pathname:this._previouslySelectedPathname})),null!=n&&i)t=n;else{for(var s=0,a=o;s<a.length;s++){var l=a[s],c=_.find(r,{operation:l});if(null!=c){t=_.find(e,{pathname:c.pathname});break}}if(null==t)if(null!=n)t=n;else{var u=_.find(e,function(e){return/main\.tex$/.test(e.pathname)});if(null!=u)t=u;else{var d=_.find(e,function(e){return/\.tex$/.test(e.pathname)});t=null!=d?d:e[0]}}}this.selectFile(t)}},{key:"_getFilesWithOps",value:function(){var e;if(this.$scope.history.viewMode===i.POINT_IN_TIME){var t=this.getUpdateForVersion(this.$scope.history.selection.range.toV);if(e=[],null!=t){var n=!0,r=!1,o=void 0;try{for(var s,a=t.pathnames[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)pathname=s.value,e.push({pathname:pathname,operation:"edited"})}catch(l){r=!0,o=l}finally{try{n||null==a["return"]||a["return"]()}finally{if(r)throw o}}var c=!0,u=!1,d=void 0;try{for(var h,f=t.project_ops[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){op=h.value;var p=void 0;null!=op.add?p={pathname:op.add.pathname,operation:"added"}:null!=op.remove?p={pathname:op.remove.pathname,operation:"removed"}:null!=op.rename&&(p={pathname:op.rename.newPathname,operation:"renamed"}),null!=p&&e.push(p)}}catch(l){u=!0,d=l}finally{try{c||null==f["return"]||f["return"]()}finally{if(u)throw d}}}}else e=_.reduce(this.$scope.history.selection.files,function(e,t){return t.operation&&e.push({pathname:t.pathname,operation:t.operation}),e},[]);return e}},{key:"autoSelectRecentUpdates",value:function(){if(0!==this.$scope.history.updates.length){for(var e=this.$scope.history.updates[0].toV,t=null,n=0,i=0;i<this.$scope.history.updates.length;i++){var r=this.$scope.history.updates[i];if(this._updateContainsUserId(r,this.$scope.user.id)||i>this.MAX_RECENT_UPDATES_TO_SELECT)break;n=i}t=this.$scope.history.updates[n].fromV,this.selectVersionsForCompare(e,t)}}},{key:"autoSelectVersionForPointInTime",value:function(){if(0!==this.$scope.history.updates.length){var e=this.$scope.history.updates[0].toV,t=this.$scope.history.selection.range;null!=t.toV&&null!=t.fromV&&t.toV===t.fromV&&(e=t.toV),this.selectVersionForPointInTime(e)}}},{key:"autoSelectLastLabel",value:function(){return null!=this.$scope.history.labels&&0!==this.$scope.history.labels.length?this.selectLabelForPointInTime(this.$scope.history.labels[0]):void 0}},{key:"expandSelectionToVersion",value:function(e){e>this.$scope.history.selection.range.toV?this.$scope.history.selection.range.toV=e:e<this.$scope.history.selection.range.fromV&&(this.$scope.history.selection.range.fromV=e)}},{key:"selectVersionForPointInTime",value:function(e){var t=this.$scope.history.selection;t.range.toV!==e&&t.range.fromV!==e&&(t.range.toV=e,t.range.fromV=e,this.loadFileTreeForVersion(e))}},{key:"selectVersionsForCompare",value:function(e,t){var n=this.$scope.history.selection.range;(n.toV!==e||n.fromV!==t)&&(n.toV=e,n.fromV=t,this.loadFileTreeDiff(e,t))}},{key:"autoSelectLabelForPointInTime",value:function(){var e=this.getUpdateForVersion(this.$scope.history.selection.range.toV),t=0;if(null!=e&&null!=e.labels&&(t=e.labels.length),0===t)this.autoSelectLastLabel();else if(1===t)this.selectLabelForPointInTime(e.labels[0]);else if(t>1){var n=this.ide.$filter("orderBy")(e.labels,"-created_at"),i=n[0];this.selectLabelForPointInTime(i)}}},{key:"selectLabelForPointInTime",value:function(e){var t=null;if(!this._isLabelSelected(e)){for(var n=0,i=Array.from(this.$scope.history.updates);n<i.length;n++){var r=i[n];if(r.toV===e.version){t=r;break}}if(null!=t)this.selectVersionForPointInTime(t.toV);else{var o=this.$scope.history.selection;o.range.toV=e.version,o.range.fromV=e.version,this.loadFileTreeForVersion(e.version)}}}},{key:"getUpdateForVersion",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=this.$scope.history.updates[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;if(s.toV===e)return s}}catch(a){n=!0,i=a}finally{try{t||null==o["return"]||o["return"]()}finally{if(n)throw i}}}},{key:"autoSelectLabelsForComparison",value:function(){var e=this.$scope.history.labels,t=0;Array.isArray(e)&&(t=e.length),0===t||(1===t?this.selectVersionsForCompare(e[0].version,e[0].version):t>1&&this.selectVersionsForCompare(e[0].version,e[1].version))}},{key:"fetchNextBatchOfUpdates",value:function(){var e=this;if(!this.$scope.history.atEnd){var t="/project/".concat(this.ide.project_id,"/updates?min_count=").concat(this.BATCH_SIZE);null!=this.$scope.history.nextBeforeTimestamp&&(t+="&before=".concat(this.$scope.history.nextBeforeTimestamp));var n="/project/".concat(this.ide.project_id,"/labels"),i={updates:this.ide.$http.get(t)};return null==this.$scope.history.labels&&(i.labels=this.ide.$http.get(n)),this.ide.$q.all(i).then(function(t){var n=t.updates.data,i=null;n.updates.length>0&&(i=n.updates[0].toV),null!=t.labels&&(e.$scope.history.labels=e._loadLabels(t.labels.data,i)),e._loadUpdates(n.updates),e.$scope.history.nextBeforeTimestamp=n.nextBeforeTimestamp,(null==n.nextBeforeTimestamp||e.$scope.history.freeHistoryLimitHit||0===e.$scope.history.updates.length)&&(e.$scope.history.atEnd=!0),0===e.$scope.history.updates.length&&(e.$scope.history.loadingFileTree=!1)})["catch"](function(t){var n=t.status,i=t.statusText;e.$scope.history.error={status:n,statusText:i},e.$scope.history.atEnd=!0,e.$scope.history.loadingFileTree=!1})}}},{key:"_loadLabels",value:function(e,t){var n=this._sortLabelsByVersionAndDate(e),i=n.length,r=!1,o=!1;if(t)if(r=i>0?n[0].isPseudoCurrentStateLabel:!1,o=r?i>1?n[1].version!==t:!1:i>0?n[0].version!==t:!0,o&&!r){var s={id:"1",isPseudoCurrentStateLabel:!0,version:t,created_at:(new Date).toISOString()};n.unshift(s)}else!o&&r&&n.shift();return n}},{key:"_sortLabelsByVersionAndDate",value:function(e){return this.ide.$filter("orderBy")(e,["isPseudoCurrentStateLabel","-version","-created_at"])}},{key:"loadFileAtPointInTime",value:function(){var e=this,t=this.$scope.history.selection.range.toV,n=this.$scope.history.selection.pathname;if(null!=t){var i="/project/".concat(this.$scope.project_id,"/diff"),r=["pathname=".concat(encodeURIComponent(n)),"from=".concat(t),"to=".concat(t)];return i+="?".concat(r.join("&")),this.$scope.history.selection.file.loading=!0,this.ide.$http.get(i).then(function(t){var n=e._parseDiff(t.data.diff),i=n.text,r=n.binary;e.$scope.history.selection.file.binary=r,e.$scope.history.selection.file.text=i,e.$scope.history.selection.file.loading=!1})["catch"](function(){})}}},{key:"reloadDiff",value:function(){var e=this,t=this.$scope.history.selection.diff,n=this.$scope.history.selection,i=n.range,r=n.pathname,o=i.fromV,s=i.toV;if(null==r)return void(this.$scope.history.selection.diff=null);if(null==t||t.pathname!==r||t.fromV!==o||t.toV!==s){this.$scope.history.selection.diff=t={fromV:o,toV:s,pathname:r,error:!1},t.loading=!0;var a="/project/".concat(this.$scope.project_id,"/diff"),l=["pathname=".concat(encodeURIComponent(r))];return null!=t.fromV&&null!=t.toV&&l.push("from=".concat(t.fromV),"to=".concat(t.toV)),a+="?".concat(l.join("&")),this.ide.$http.get(a).then(function(n){var i=n.data;t.loading=!1;var r=e._parseDiff(i.diff),o=r.text,s=r.highlights,a=r.binary;t.binary=a,t.text=o,t.highlights=s})["catch"](function(){t.loading=!1,t.error=!0})}}},{key:"labelCurrentVersion",value:function(e){return this._labelVersion(e,this.$scope.history.selection.range.toV)}},{key:"deleteLabel",value:function(e){var t=this,n="/project/".concat(this.$scope.project_id,"/labels/").concat(e.id);return this.ide.$http({url:n,method:"DELETE",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(n){return t._deleteLabelLocally(e)})}},{key:"_deleteLabelLocally",value:function(e){for(var t=0;t<this.$scope.history.updates.length;t++){var n=this.$scope.history.updates[t];if(n.toV===e.version){n.labels=_.filter(n.labels,function(t){return t.id!==e.id});break}}this.$scope.history.labels=this._loadLabels(_.filter(this.$scope.history.labels,function(t){return t.id!==e.id}),this.$scope.history.updates[0].toV),this._handleHistoryUIStateChange()}},{key:"_isLabelSelected",value:function(e){return e?e.version<=this.$scope.history.selection.range.toV&&e.version>=this.$scope.history.selection.range.fromV:!1}},{key:"_parseDiff",value:function(i){if(i.binary)return{binary:!0};for(var r=0,o=0,s=[],a="",l=i||[],c=0;c<l.length;c++){var u,d,h=l[c],f=h.u||h.i||h.d;f||(f=""),a+=f;var p=f.split("\n"),g=r,m=o;p.length>1?(d=g+p.length-1,u=p[p.length-1].length):(d=g,u=m+p[0].length),r=d,o=u;var v={start:{row:g,column:m},end:{row:d,column:u}};if(null!=h.i||null!=h.d){var y=null!=h.meta.users?h.meta.users[0]:void 0,w=n(y),b=e(h.meta.end_ts).format("Do MMM YYYY, h:mm a");null!=h.i?s.push({label:"Added by ".concat(w," on ").concat(b),highlight:v,hue:t.getHueForUserId(null!=y?y.id:void 0)}):null!=h.d&&s.push({label:"Deleted by ".concat(w," on ").concat(b),strikeThrough:v,hue:t.getHueForUserId(null!=y?y.id:void 0)})}}return{text:a,highlights:s}}},{key:"_loadUpdates",value:function(n){null==n&&(n=[]);for(var i=this.$scope.history.updates[this.$scope.history.updates.length-1],r=new Date,o=r.setDate(r.getDate()-1),s=null,a=n||[],l=0;l<a.length;l++){for(var c=a[l],u=0,d=Array.from(c.meta.users||[]);u<d.length;u++){var h=d[u];null!=h&&(h.hue=t.getHueForUserId(h.id))}if(null!=i&&e(i.meta.end_ts).isSame(c.meta.end_ts,"day")||(c.meta.first_in_day=!0),i=c,!this.$scope.history.userHasFullFeature&&c.meta.end_ts<o){s=l||1,this.$scope.history.freeHistoryLimitHit=!0,this.$scope.project.owner._id===this.$scope.user.id&&ga("send","event","subscription-funnel","editor-click-feature","history");break}}var f=0===this.$scope.history.updates.length;
this.$scope.history.userHasFullFeature||null==s||(n=n.slice(0,s)),this.$scope.history.updates=this.$scope.history.updates.concat(n),f&&this._handleHistoryUIStateChange()}},{key:"_labelVersion",value:function(e,t){var n=this,i="/project/".concat(this.$scope.project_id,"/labels");return this.ide.$http.post(i,{comment:e,version:t,_csrf:window.csrfToken}).then(function(e){return n._addLabelLocally(e.data)})}},{key:"_addLabelLocally",value:function(e){var t=_.find(this.$scope.history.updates,function(t){return t.toV===e.version});null!=t&&(t.labels=t.labels.concat(e)),this.$scope.history.labels=this._loadLabels(this.$scope.history.labels.concat(e),this.$scope.history.updates[0].toV),this._handleHistoryUIStateChange()}},{key:"_updateContainsUserId",value:function(e,t){for(var n=0,i=Array.from(e.meta.users);n<i.length;n++){var r=i[n];if((null!=r?r.id:void 0)===t)return!0}return!1}}]),r}(),r.initClass(),r}()}),define("ide/permissions/PermissionsManager",[],function(){var e;return e=function t(e,n){var i=this;_classCallCheck(this,t),this.ide=e,this.$scope=n,this.$scope.permissions={read:!1,write:!1,admin:!1,comment:!1},this.$scope.$watch("permissionsLevel",function(e){return null!=e&&("readOnly"===e?(i.$scope.permissions.read=!0,i.$scope.permissions.comment=!0):"readAndWrite"===e?(i.$scope.permissions.read=!0,i.$scope.permissions.write=!0,i.$scope.permissions.comment=!0):"owner"===e&&(i.$scope.permissions.read=!0,i.$scope.permissions.write=!0,i.$scope.permissions.admin=!0,i.$scope.permissions.comment=!0)),i.$scope.anonymous?i.$scope.permissions.comment=!1:void 0})}}),define("libs/latex-log-parser",[],function(){var e,t,n,i,r,o,s,a,l;return i=79,t=/^LaTeX Warning: (.*)$/,e=/^(Over|Under)full \\(v|h)box/,a=/^(Package \b.+\b Warning:.*)$/,n=/lines? ([0-9]+)/,s=/^Package (\b.+\b) Warning/,o=function(e){var t,n;for(this.text=e.replace(/(\r\n)|\r/g,"\n"),n=this.text.split("\n"),this.lines=[n[0]],t=1;t<n.length;)n[t-1].length===i&&"..."!==n[t-1].slice(-3)?this.lines[this.lines.length-1]+=n[t]:this.lines.push(n[t]),t++;this.row=0},function(){this.nextLine=function(){return this.row++,this.row>=this.lines.length?!1:this.lines[this.row]},this.rewindLine=function(){this.row--},this.linesUpToNextWhitespaceLine=function(){return this.linesUpToNextMatchingLine(/^ *$/)},this.linesUpToNextMatchingLine=function(e){var t,n;for(t=[],n=this.nextLine(),n!==!1&&t.push(n);n!==!1&&!n.match(e)&&n!==!1;)n=this.nextLine(),n!==!1&&t.push(n);return t}}.call(o.prototype),l={NORMAL:0,ERROR:1},r=function(e,t){this.log=new o(e),this.state=l.NORMAL,t=t||{},this.fileBaseNames=t.fileBaseNames||[/compiles/,/\/usr\/local/],this.ignoreDuplicates=t.ignoreDuplicates,this.data=[],this.fileStack=[],this.currentFileList=this.rootFileList=[],this.openParens=0},function(){return this.parse=function(){for(var e;(this.currentLine=this.log.nextLine())!==!1;)this.state===l.NORMAL&&(this.currentLineIsError()?(this.state=l.ERROR,this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine.slice(2),content:"",raw:this.currentLine+"\n"}):this.currentLineIsRunawayArgument()?this.parseRunawayArgumentError():this.currentLineIsWarning()?this.parseSingleWarningLine(t):this.currentLineIsHboxWarning()?this.parseHboxLine():this.currentLineIsPackageWarning()?this.parseMultipleWarningLine():this.parseParensForFilenames()),this.state===l.ERROR&&(this.currentError.content+=this.log.linesUpToNextMatchingLine(/^l\.[0-9]+/).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content,e=this.currentError.raw.match(/l\.([0-9]+)/),e&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError),this.state=l.NORMAL);return this.postProcess(this.data)},this.currentLineIsError=function(){return"!"===this.currentLine[0]},this.currentLineIsRunawayArgument=function(){return this.currentLine.match(/^Runaway argument/)},this.currentLineIsWarning=function(){return!!this.currentLine.match(t)},this.currentLineIsPackageWarning=function(){return!!this.currentLine.match(a)},this.currentLineIsHboxWarning=function(){return!!this.currentLine.match(e)},this.parseRunawayArgumentError=function(){var e;return this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine,content:"",raw:this.currentLine+"\n"},this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content,e=this.currentError.raw.match(/l\.([0-9]+)/),e&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError)},this.parseSingleWarningLine=function(e){var t,i,r,o;o=this.currentLine.match(e),o&&(r=o[1],i=r.match(n),t=i?parseInt(i[1],10):null,this.data.push({line:t,file:this.currentFilePath,level:"warning",message:r,raw:r}))},this.parseMultipleWarningLine=function(){var e,t,i,r,o,l,c,u;if(c=this.currentLine.match(a)){for(u=[c[1]],t=this.currentLine.match(n),e=t?parseInt(t[1],10):null,i=this.currentLine.match(s),r=i[1],o=new RegExp("(?:\\("+r+"\\))*[\\s]*(.*)","i");this.currentLine=this.log.nextLine();)t=this.currentLine.match(n),e=t?parseInt(t[1],10):e,c=this.currentLine.match(o),u.push(c[1]);l=u.join(" "),this.data.push({line:e,file:this.currentFilePath,level:"warning",message:l,raw:l})}},this.parseHboxLine=function(){var e,t;t=this.currentLine.match(n),e=t?parseInt(t[1],10):null,this.data.push({line:e,file:this.currentFilePath,level:"typesetting",message:this.currentLine,raw:this.currentLine})},this.parseParensForFilenames=function(){var e,t,n,i,r;n=this.currentLine.search(/\(|\)/),-1!==n&&(r=this.currentLine[n],this.currentLine=this.currentLine.slice(n+1),"("===r?(e=this.consumeFilePath(),e?(this.currentFilePath=e,t={path:e,files:[]},this.fileStack.push(t),this.currentFileList.push(t),this.currentFileList=t.files):this.openParens++):")"===r&&(this.openParens>0?this.openParens--:this.fileStack.length>1&&(this.fileStack.pop(),i=this.fileStack[this.fileStack.length-1],this.currentFilePath=i.path,this.currentFileList=i.files)),this.parseParensForFilenames())},this.consumeFilePath=function(){var e,t;return this.currentLine.match(/^\/?([^ \)]+\/)+/)?(e=this.currentLine.search(RegExp(" |\\)")),t=void 0,-1===e?(t=this.currentLine,this.currentLine=""):(t=this.currentLine.slice(0,e),this.currentLine=this.currentLine.slice(e)),t):!1},this.postProcess=function(e){var t,n,i,r,o,s,a;for(t=[],n=[],a=[],s=[],r=[],i=function(e){return e.raw},o=0;o<e.length;)this.ignoreDuplicates&&r.indexOf(i(e[o]))>-1?o++:("error"===e[o].level?n.push(e[o]):"typesetting"===e[o].level?s.push(e[o]):"warning"===e[o].level&&a.push(e[o]),t.push(e[o]),r.push(i(e[o])),o++);return{errors:n,warnings:a,typesetting:s,all:t,files:this.rootFileList}}}.call(r.prototype),r.parse=function(e,t){return new r(e,t).parse()},r}),define("ide/human-readable-logs/HumanReadableLogsRules",[],function(){return[{regexToMatch:/Misplaced alignment tab character \&/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Misplaced_alignment_tab_character_%26",humanReadableHint:"You have placed an alignment tab character '&' in the wrong place. If you want to align something, you must write it inside an align environment such as \\begin{align}  \\end{align}, \\begin{tabular}  \\end{tabular}, etc. If you want to write an ampersand '&' in text, you must write \\& instead."},{regexToMatch:/Extra alignment tab has been changed to \\cr/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Extra_alignment_tab_has_been_changed_to_%5Ccr",humanReadableHint:'You have written too many alignment tabs in a table, causing one of them to be turned into a line break. Make sure you have specified the correct number of columns in your <a target="_blank" href="https://www.sharelatex.com/learn/Tables">table</a>.'},{regexToMatch:/Display math should end with \$\$/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Display_math_should_end_with_$$",humanReadableHint:"You have forgotten a $ sign at the end of 'display math' mode. When writing in display math mode, you must always math write inside $$  $$. Check that the number of $s match around each math expression."},{regexToMatch:/Missing [{$] inserted./,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Missing_$_inserted",humanReadableHint:"Check that your $'s match around math expressions. If they do, then you've probably used a symbol in normal text that needs to be in math mode. Symbols such as subscripts ( _ ), integrals ( \\int ), Greek letters ( \\alpha, \\beta, \\delta ), and modifiers (\\vec{x}, \\tilde{x} ) must be written in math mode. See the full list <a target=\"_blank\" href=\"https://www.sharelatex.com/learn/Errors/Missing_$_inserted \">here</a>.If you intended to use mathematics mode, then use $  $ for 'inline math mode', $$  $$ for 'display math mode' or alternatively \\begin{math}  \\end{math}."},{regexToMatch:/(undefined )?[rR]eference(s)?.+(undefined)?/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/There_were_undefined_references",humanReadableHint:"You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref{...} is the same as what is written inside \\label{...}."},{regexToMatch:/Citation .+ on page .+ undefined on input line .+/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Citation_XXX_on_page_XXX_undefined_on_input_line_XXX",humanReadableHint:"You have cited something which is not included in your bibliography. Make sure that the citation (\\cite{...}) has a corresponding key in your bibliography, and that both are spelled the same way."},{regexToMatch:/(Label .+)? multiply[ -]defined( labels)?/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/There_were_multiply-defined_labels",humanReadableHint:"You have used the same label more than once. Check that each \\label{...} labels only one item."},{regexToMatch:/`!?h' float specifier changed to `!?ht'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/%60!h%27_float_specifier_changed_to_%60!ht%27",humanReadableHint:"The float specifier 'h' is too strict of a demand for LaTeX to place your float in a nice way here. Try relaxing it by using 'ht', or even 'htbp' if necessary. If you want to try keep the float here anyway, check out the <a target=\"_blank\" href=\"https://www.sharelatex.com/learn/Positioning_of_Figures\">float package</a>."},{regexToMatch:/No positions in optional float specifier/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/No_positions_in_optional_float_specifier",humanReadableHint:'You have forgotten to include a float specifier, which tells LaTeX where to position your figure. To fix this, either insert a float specifier inside the square brackets (e.g. \\begin{figure}[h]), or remove the square brackets (e.g. \\begin{figure}). Find out more about float specifiers <a target="_blank" href="https://www.sharelatex.com/learn/Positioning_of_Figures">here</a>.'},{regexToMatch:/Undefined control sequence/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Undefined_control_sequence",humanReadableHint:"The compiler is having trouble understanding a command you have used. Check that the command is spelled correctly. If the command is part of a package, make sure you have included the package in your preamble using \\usepackage{...}."},{regexToMatch:/File .+ not found/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/File_XXX_not_found_on_input_line_XXX",humanReadableHint:'The compiler cannot find the file you want to include. Make sure that you have <a target="_blank" href="https://www.sharelatex.com/learn/Including_images_in_ShareLaTeX">uploaded the file</a> and <a target="_blank" href="https://www.sharelatex.com/learn/Errors/File_XXX_not_found_on_input_line_XXX.">specified the file location correctly</a>.'},{regexToMatch:/LaTeX Error: Unknown graphics extension: \..+/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.XXX",humanReadableHint:'The compiler does not recognise the file type of one of your images. Make sure you are using a <a target="_blank" href="https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.gif.">supported image format</a> for your choice of compiler, and check that there are no periods (.) in the name of your image.'},{regexToMatch:/LaTeX Error: Unknown float option `H'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60H%27",humanReadableHint:"The compiler isn't recognizing the float option 'H'. Include \\usepackage{float} in your preamble to fix this."},{regexToMatch:/LaTeX Error: Unknown float option `q'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60q%27",humanReadableHint:'You have used a float specifier which the compiler does not understand. You can learn more about the different float options available for placing figures <a target="_blank" href="https://www.sharelatex.com/learn/Positioning_of_Figures">here</a>.'},{regexToMatch:/LaTeX Error: \\math.+ allowed only in math mode/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_%5Cmathrm_allowed_only_in_math_mode",humanReadableHint:"You have used a font command which is only available in math mode. To use this command, you must be in maths mode (E.g. $  $ or \\begin{math}  \\end{math}). If you want to use it outside of math mode, use the text version instead: \\textrm, \\textit, etc."},{ruleId:"hint_mismatched_environment",types:["environment"],regexToMatch:/Error: `([^']{2,})' expected, found `([^']{2,})'.*/,newMessage:"Error: environment does not match \\begin{$1} ... \\end{$2}",humanReadableHint:"You have used \\begin{...} without a corresponding \\end{...}."},{ruleId:"hint_mismatched_brackets",types:["environment"],regexToMatch:/Error: `([^a-zA-Z0-9])' expected, found `([^a-zA-Z0-9])'.*/,newMessage:"Error: brackets do not match, found '$2' instead of '$1'",humanReadableHint:"You have used an open bracket without a corresponding close bracket."},{regexToMatch:/LaTeX Error: Can be used only in preamble/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Can_be_used_only_in_preamble",humanReadableHint:"You have used a command in the main body of your document which should be used in the preamble. Make sure that \\documentclass[]{} and all \\usepackage{} commands are written before \\begin{document}."},{regexToMatch:/Missing \\right inserted/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Missing_%5Cright_insertede",humanReadableHint:'You have started an expression with a \\left command, but have not included a corresponding \\right command. Make sure that your \\left and \\right commands balance everywhere, or else try using \\Biggl and \\Biggr commands instead as shown <a target="_blank" href="https://www.sharelatex.com/learn/Errors/Missing_%5Cright_inserted">here</a>.'},{regexToMatch:/Double superscript/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Double_superscript",humanReadableHint:"You have written a double superscript incorrectly as a^b^c, or else you have written a prime with a superscript. Remember to include { and } when using multiple superscripts. Try a^{b^c} instead."},{regexToMatch:/Double subscript/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Double_subscript",humanReadableHint:"You have written a double subscript incorrectly as a_b_c. Remember to include { and } when using multiple subscripts. Try a_{b_c} instead."},{regexToMatch:/No \\author given/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/No_%5Cauthor_given",humanReadableHint:"You have used the \\maketitle command, but have not specified any \\author. To fix this, include an author in your preamble using the \\author{} command."},{regexToMatch:/LaTeX Error: Environment .+ undefined/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FLaTeX%20Error%3A%20Environment%20XXX%20undefined",humanReadableHint:"You have created an environment (using \\begin{} and \\end{} commands) which is not recognized. Make sure you have included the required package for that environment in your preamble, and that the environment is spelled correctly."},{regexToMatch:/LaTeX Error: Something's wrong--perhaps a missing \\item/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Something%27s_wrong--perhaps_a_missing_%5Citem",humanReadableHint:"There are no entries found in a list you have created. Make sure you label list entries using the \\item command, and that you have not used a list inside a table."},{regexToMatch:/Misplaced \\noalign/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Misplaced_%5Cnoalign",humanReadableHint:"You have used a \\hline command in the wrong place, probably outside a table. If the \\hline command is written inside a table, try including \\\\ before it."},{regexToMatch:/LaTeX Error: There's no line here to end/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_There%27s_no_line_here_to_end",humanReadableHint:"You have used a \\\\ or \\newline command where LaTeX was not expecting one. Make sure that you only use line breaks after blocks of text, and be careful using linebreaks inside lists and other environments."},{regexToMatch:/LaTeX Error: \\verb ended by end of line/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_%5Cverb_ended_by_end_of_line",humanReadableHint:"You have used a \\verb command incorrectly. Try replacling the \\verb command with \\begin{verbatim}\\end{verbatim}."},{regexToMatch:/Illegal unit of measure (pt inserted)/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FIllegal%20unit%20of%20measure%20(pt%20inserted)",humanReadableHint:"You have written a length, but have not specified the appropriate units (pt, mm, cm etc.). If you have not written a length, check that you have not witten a linebreak \\\\ followed by square brackets [] anywhere."},{regexToMatch:/Extra \\right/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Extra_%5Cright",humanReadableHint:"You have written a \\right command without a corresponding \\left command. Check that all \\left and \\right commands balance everywhere. "},{regexToMatch:/Missing \\begin{document}/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FLaTeX%20Error%3A%20Missing%20%5Cbegin%20document",humanReadableHint:"No \\begin{document} command was found. Make sure you have included \\begin{document} in your preamble, and that your main document is set correctly."},{ruleId:"hint_mismatched_environment2",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: `\\end\{([^\}]+)\}' expected but found `\\end\{([^\}]+)\}'.*/,newMessage:"Error: environments do not match: \\begin{$1} ... \\end{$2}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."},{ruleId:"hint_mismatched_environment3",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Warning: No matching \\end found for `\\begin\{([^\}]+)\}'.*/,newMessage:"Warning: No matching \\end found for \\begin{$1}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."},{ruleId:"hint_mismatched_environment4",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: Found `\\end\{([^\}]+)\}' without corresponding \\begin.*/,newMessage:"Error: found \\end{$1} without a corresponding \\begin{$1}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."}]}),define("ide/human-readable-logs/HumanReadableLogs",["libs/latex-log-parser","ide/human-readable-logs/HumanReadableLogsRules"],function(e,t){return{parse:function(n,i){var r;r="string"==typeof n?e.parse(n,i):n;for(var o=function(e){for(var n=0,i=Array.from(t);n<i.length;n++){var r=i[n];if(r.regexToMatch.test(e))return r}},s={},a=0,l=Array.from(r.all);a<l.length;a++){var c=l[a],u=o(c.message);if(null!=u){var d;if(null!=u.ruleId?c.ruleId=u.ruleId:null!=u.regexToMatch&&(c.ruleId="hint_".concat(u.regexToMatch.toString().replace(/\s/g,"_").slice(1,-1))),null!=u.newMessage&&(c.message=c.message.replace(u.regexToMatch,u.newMessage)),null!=u.cascadesFrom)for(var h=0,f=Array.from(u.cascadesFrom);h<f.length;h++)d=f[h],s[d]&&(c.suppressed=!0);if(null!=u.types)for(var p=0,g=Array.from(u.types);p<g.length;p++)d=g[p],s[d]=!0;null!=u.humanReadableHint&&(c.humanReadableHint=u.humanReadableHint),null!=u.extraInfoURL&&(c.extraInfoURL=u.extraInfoURL)}}for(var m in r){var v=r[m];"object"===_typeof(v)&&v.length>0&&(r[m]=Array.from(v).filter(function(e){return!e.suppressed}))}return r}}}),define("libs/bib-log-parser",[],function(){var e,t,n,i,r,o,s,a,l,c,u;return n=/^\[(\d+)].*>\s(INFO|WARN|ERROR)\s-\s(.*)$/,i={INFO:"info",WARN:"warning",ERROR:"error"},t=function(e,t){if("string"!=typeof e)throw new Error("BibLogParser Error: text parameter must be a string");this.text=e.replace(/(\r\n)|\r/g,"\n"),this.options=t||{},this.lines=e.split("\n")},l=function(e,t,n){var i,r,o,s,a,l;for(l=e,a=[],s=t,i=0;r=s.exec(l);){if(i+=1,i>=1e4)return a;o=n(r),a.push(o),l=r.input.slice(0,r.index)+r.input.slice(r.index+r[0].length+1,r.input.length)}return[a,l]},s=/^Warning--(.+)\n--line (\d+) of file (.+)$/m,a=/^Warning--(.+)$/m,o=/^(.*)---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this entry$/m,e=/^(A bad cross reference---entry ".+?"\nrefers to entry.+?, which doesn't exist)$/m,r=/^(.*)\n---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this command$/m,u=[[s,function(e){var t,n,i,r;return n=e[0],r=e[1],i=e[2],t=e[3],{file:t,level:"warning",message:r,line:i,raw:n}}],[a,function(e){var t,n;return t=e[0],n=e[1],{file:"",level:"warning",message:n,line:"",raw:t}}]],c=[[o,function(e){var t,n,i,r,o;return i=e[0],n=e[1],r=e[2],t=e[3],o=e[4],{file:t,level:"error",message:n+"\n"+o,line:r,raw:i}}],[e,function(e){var t,n;return t=e[0],n=e[1],{file:"",level:"error",message:n,line:"",raw:t}}],[r,function(e){var t,n,i,r,o;return i=e[0],n=e[1],r=e[2],t=e[3],o=e[4],{file:t,level:"error",message:n+"\n"+o,line:r,raw:i}}]],function(){return this.parseBibtex=function(){var e,t,n,i,r,o;return o={all:[],errors:[],warnings:[],files:[],typesetting:[]},n=u.reduce(function(e,t){var n,i,r,o,s,a,c;return i=e[0],a=e[1],s=t[0],r=t[1],o=l(a,s,r),c=o[0],n=o[1],[i.concat(c),n]},[[],this.text]),t=n[0],r=n[1],i=c.reduce(function(e,t){var n,i,r,o,s,a,c;return i=e[0],c=e[1],a=t[0],o=t[1],s=l(c,a,o),r=s[0],n=s[1],[i.concat(r),n]},[[],r]),e=i[0],r=i[1],o.warnings=t,o.errors=e,o.all=t.concat(e),o},this.parseBiber=function(){var e;return e={all:[],errors:[],warnings:[],files:[],typesetting:[]},this.lines.forEach(function(t){var r,o,s,a,l,c,u,d,h,f;if(c=t.match(n))switch(s=c[0],l=c[1],d=c[2],u=c[3],h={file:"",level:i[d]||"INFO",message:u,line:"",raw:s},a=h.message.match(/^BibTeX subsystem: \/.+\/(\w+\.\w+)_.+, line (\d+), (.+)$/),a&&4===a.length&&(r=a[0],o=a[1],l=a[2],f=a[3],h.file=o,h.line=l,h.message=f),e.all.push(h),h.level){case"error":return e.errors.push(h);case"warning":return e.warnings.push(h)}}),e},this.parse=function(){var e;if(e=this.lines[0],e.match(/^.*INFO - This is Biber.*$/))return this.parseBiber();if(e.match(/^This is BibTeX, Version.+$/))return this.parseBibtex();throw new Error("BibLogParser Error: cannot determine whether text is biber or bibtex output")}}.call(t.prototype),t.parse=function(e,n){return new t(e,n).parse()},t}),define("ide/pdf/controllers/PdfController",["base","ace/ace","ide/human-readable-logs/HumanReadableLogs","libs/bib-log-parser"],function(e,t,n,i){var r=5e3,o=2e3;return e.filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),e.controller("PdfController",["$scope","$http","ide","$modal","synctex","event_tracking","localStorage",function(e,t,s,a,l,c,u){var d=!0;e.pdf.view=__guard__(null!=e?e.pdf:void 0,function(e){return e.url})?"pdf":"uncompiled",e.shouldShowLogs=!1,e.wikiEnabled=window.wikiEnabled,e.shouldDropUp=!1;var h=document.querySelector(".pdf-logs"),f=null!=h?h.querySelector(".files-dropdown"):void 0,p=function(){return(null!=f?f.getBoundingClientRect().top:void 0)/(null!=h?h.getBoundingClientRect().height:void 0)};e.$watch("shouldShowLogs",function(t){return t?e.$applyAsync(function(){return e.shouldDropUp=p()>.65}):void 0}),e.trackLogHintsLearnMore=function(){return c.sendMB("logs-hints-learn-more")},ace.require("ace/lib/useragent").isMac?e.modifierKey="Cmd":e.modifierKey="Ctrl";var g=function(e){var t=function(){var t=[];for(var n in e){var i=e[n];t.push("".concat(n,"=").concat(i))}return t}();return t.length?"?".concat(t.join("&")):""};e.stripHTMLFromString=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},e.$on("project:joined",function(){return d?(d=!1,e.recompile({isAutoCompileOnLoad:!0}),e.hasPremiumCompile="priority"===e.project.features.compileGroup):void 0}),e.$on("pdf:error:display",function(){return e.pdf.view="errors",e.pdf.renderingError=!0});var m=null,v=function(){if(!e.pdf.compiling&&e.autocompile_enabled&&e.pdf.uncompiled){var t=s.$scope.hasLintingError&&s.$scope.settings.syntaxValidation;if(e.autoCompileLintingError!==t&&e.$apply(function(){return e.autoCompileLintingError=t,e.startedTryingAutoCompileAt=Date.now(),e.docLastChangedAt=Date.now()}),!t||!e.stop_on_validation_error){var n=Math.max(e.startedTryingAutoCompileAt,e.lastFinishedCompileAt||0),i=Date.now()-n,a=Date.now()-e.docLastChangedAt,l=!1;return a>o?l=!0:i>r?l=!0:(0>i||0>a)&&(l=!0),l?y():void 0}}},y=function(){return e.recompile({isAutoCompileOnChange:!0})},w=function(){return null==m?(e.startedTryingAutoCompileAt=Date.now(),m=setInterval(v,200)):void 0},b=function(){return clearInterval(m),m=null};e.changesToAutoCompile=!1,e.$watch("pdf.uncompiled",function(t){return e.pdf.uncompiled&&e.autocompile_enabled&&!e.ui.pdfHidden?(e.changesToAutoCompile=!0,w()):(e.changesToAutoCompile=!1,b())});var _=function(){null==e.docLastChangedAt?e.pdf.uncompiled=!1:null==e.lastStartedCompileAt||e.docLastChangedAt>e.lastStartedCompileAt?e.pdf.uncompiled=!0:e.pdf.uncompiled=!1},C=function(){return e.docLastChangedAt=Date.now(),_()},k=function(){return e.autoCompileLintingError=!1,C()},S=function(){return C()},$=function(e){return _()};s.$scope.$on("doc:changed",k),s.$scope.$on("doc:saved",S),e.$watch("pdf.compiling",$),e.autocompile_enabled=u("autocompile_enabled:".concat(e.project_id))||!1,e.$watch("autocompile_enabled",function(t,n){return null!=t&&n!==t?(t===!0&&v(),u("autocompile_enabled:".concat(e.project_id),t),c.sendMB("autocompile-setting-changed",{value:t})):void 0}),e.stop_on_validation_error=u("stop_on_validation_error:".concat(e.project_id)),null==e.stop_on_validation_error&&(e.stop_on_validation_error=!0),e.$watch("stop_on_validation_error",function(t,n){return null!=t&&n!==t?u("stop_on_validation_error:".concat(e.project_id),t):void 0}),e.draft=u("draft:".concat(e.project_id))||!1,e.$watch("draft",function(t,n){return null!=t&&n!==t?u("draft:".concat(e.project_id),t):void 0});var x=function(n){null==n&&(n={});var i="/project/".concat(e.project_id,"/compile"),r={};(n.isAutoCompileOnLoad||n.isAutoCompileOnChange)&&(r.auto_compile=!0),e.check&&(e.pdf.logEntries=[]),e.check=!!n.check,n.check&&c.sendMB("syntax-check-request");var o=function(){switch(!1){case!e.check:return"validate";case!n["try"]:return"silent";case!e.stop_on_validation_error:return"error";default:return"silent"}}();return"error"===o&&(o="silent"),t.post(i,{rootDoc_id:n.rootDocOverride_id||null,draft:e.draft,check:o,incrementalCompilesEnabled:!e.pdf.error,_csrf:window.csrfToken},{params:r})},A=function(e,t){return null!=e&&null!=t&&-1!==t.indexOf("build")?"".concat(e).concat(t):t},T=function(t){var n,i=e.pdf.url,r=t.pdfDownloadDomain;e.pdf.error=!1,e.pdf.timedout=!1,e.pdf.failure=!1,e.pdf.url=null,e.pdf.clsiMaintenance=!1,e.pdf.tooRecentlyCompiled=!1,e.pdf.renderingError=!1,e.pdf.projectTooLarge=!1,e.pdf.compileTerminated=!1,e.pdf.compileExited=!1,e.pdf.failedCheck=!1,e.pdf.compileInProgress=!1,e.pdf.autoCompileDisabled=!1;var o={};if(null!=(null!=t?t.outputFiles:void 0))for(var a=0,l=Array.from(null!=t?t.outputFiles:void 0);a<l.length;a++)n=l[a],o[n.path]=n;var u={};if(null!=t.compileGroup&&(s.compileGroup=u.compileGroup=t.compileGroup),null!=t.clsiServerId&&(s.clsiServerId=u.clsiserverid=t.clsiServerId),"timedout"===t.status)e.pdf.view="errors",e.pdf.timedout=!0,E(o,{pdfDownloadDomain:r}),e.hasPremiumCompile||s.$scope.project.owner._id!==s.$scope.user.id||c.send("subscription-funnel","editor-click-feature","compile-timeout");else if("terminated"===t.status)e.pdf.view="errors",e.pdf.compileTerminated=!0,E(o,{pdfDownloadDomain:r});else if(["validation-fail","validation-pass"].includes(t.status))e.pdf.view="pdf",e.pdf.url=A(r,i),e.shouldShowLogs=!0,"validation-fail"===t.status&&(e.pdf.failedCheck=!0),c.sendMB("syntax-check-".concat(t.status)),E(o,{validation:!0,pdfDownloadDomain:r});else if("exited"===t.status)e.pdf.view="pdf",e.pdf.compileExited=!0,e.pdf.url=A(r,i),e.shouldShowLogs=!0,E(o,{pdfDownloadDomain:r});else if("autocompile-backoff"===t.status)e.pdf.isAutoCompileOnLoad?e.pdf.view="uncompiled":(e.pdf.view="errors",e.pdf.autoCompileDisabled=!0,e.autocompile_enabled=!1,c.sendMB("autocompile-rate-limited",{hasPremiumCompile:e.hasPremiumCompile}));else if("project-too-large"===t.status)e.pdf.view="errors",e.pdf.projectTooLarge=!0;else if("failure"===t.status)e.pdf.view="errors",e.pdf.failure=!0,e.shouldShowLogs=!0,E(o,{pdfDownloadDomain:r});else if("clsi-maintenance"===t.status)e.pdf.view="errors",e.pdf.clsiMaintenance=!0;else if("too-recently-compiled"===t.status)e.pdf.view="errors",e.pdf.tooRecentlyCompiled=!0;else if("validation-problems"===t.status)e.pdf.view="validation-problems",e.pdf.validation=t.validationProblems,e.shouldShowLogs=!1;else if("compile-in-progress"===t.status)e.pdf.view="errors",e.pdf.compileInProgress=!0;else if("success"===t.status){var d;e.pdf.view="pdf",e.shouldShowLogs=!1,null!=(null!=o["output.pdf"]?o["output.pdf"].url:void 0)?e.pdf.url=A(r,o["output.pdf"].url):null!=(null!=o["output.pdf"]?o["output.pdf"].build:void 0)?(d=o["output.pdf"].build,e.pdf.url=A(r,"/project/".concat(e.project_id,"/build/").concat(d,"/output/output.pdf"))):e.pdf.url=A(r,"/project/".concat(e.project_id,"/output/output.pdf")),null==(null!=o["output.pdf"]?o["output.pdf"].build:void 0)&&(u.cache_bust="".concat(Date.now())),e.pdf.url+=g(u),u.popupDownload=!0;var h=null;o["output.pdf"]&&o["output.pdf"].build&&(h=o["output.pdf"].build),e.pdf.downloadUrl="/download/project/".concat(e.project_id).concat(h?"/build/"+h:"","/output/output.pdf")+g(u),E(o,{pdfDownloadDomain:r})}var f=["output.fls","output.fdb_latexmk"];if(e.pdf.outputFiles=[],null!=t.outputFiles){u={},null!=t.clsiServerId&&(u.clsiserverid=t.clsiServerId);for(var p=0,m=Array.from(t.outputFiles);p<m.length;p++)if(n=m[p],-1===f.indexOf(n.path)){var v=/^output\./.test(n.path);e.pdf.outputFiles.push({name:v?"".concat(n.path.replace(/^output\./,"")," file"):n.path,url:"/project/".concat(project_id,"/output/").concat(n.path)+g(u),main:!!v})}return e.pdf.outputFiles.sort(function(e,t){return t.main-e.main||e.name.localeCompare(t.name)})}},E=function(r,o){var a,l,u,d;(null!=o?o.validation:void 0)?l=r["output.chktex"]:(u=r["output.log"],a=r["output.blg"]);var h=function(n,i){var r={method:"GET",params:{compileGroup:s.compileGroup,clsiserverid:s.clsiServerId}};return null!=(null!=i?i.url:void 0)?r.url=i.url:null!=(null!=i?i.build:void 0)?r.url="/project/".concat(e.project_id,"/build/").concat(i.build,"/output/").concat(n):r.url="/project/".concat(e.project_id,"/output/").concat(n),null==(null!=i?i.build:void 0)&&(r.params.cache_bust="".concat(Date.now())),r.url=A(o.pdfDownloadDomain,r.url),t(r)},f={all:[],errors:[],warnings:[]},p=function(e){return function(){for(var t=[],n=0,i=["all","errors","warnings"];n<i.length;n++){
var r=i[n];if(null!=e.type)for(var o=0,s=Array.from(e[r]);o<s.length;o++){var a=s[o];a.type=e.type}t.push(f[r]=f[r].concat(e[r]))}return t}()},g=function(t){e.pdf.rawLog=t;var i=n.parse(t,{ignoreDuplicates:!0}),r=i.errors,o=i.warnings,s=i.typesetting,a=[].concat(r,o,s);return p({all:a,errors:r,warnings:o})},m=function(e){for(var t=[],i=[],r=0,o=Array.from(e.split("\n"));r<o.length;r++){var s,a=o[r];if(s=a.match(/^(\S+):(\d+):(\d+): (Error|Warning): (.*)/)){var l={file:s[1],line:s[2],column:s[3],level:s[4].toLowerCase(),message:"".concat(s[4],": ").concat(s[5])};"error"===l.level?t.push(l):i.push(l)}}var u=[].concat(t,i),d=n.parse({type:"Syntax",all:u,errors:t,warnings:i});return c.sendMB("syntax-check-return-count",{errors:t.length,warnings:i.length}),p(d)},v=function(e){var t=i.parse(e,{}),n=t.errors,r=t.warnings,o=[].concat(n,r);return p({type:"BibTeX",all:o,errors:n,warnings:r})},y=function(){return e.pdf.logEntries=[],e.pdf.rawLog=""},w=function(){return e.pdf.logEntries=f,e.pdf.logEntryAnnotations={},function(){for(var t=[],n=0,i=Array.from(f.all);n<i.length;n++){var r=i[n];if(null!=r.file){r.file=R(r.file);var o=s.fileTreeManager.findEntityByPath(r.file);null!=o?(e.pdf.logEntryAnnotations[o.id]||(e.pdf.logEntryAnnotations[o.id]=[]),t.push(e.pdf.logEntryAnnotations[o.id].push({row:r.line-1,type:"error"===r.level?"error":"warning",text:r.message}))):t.push(void 0)}else t.push(void 0)}return t}()};if(null!=u&&(d=h("output.log",u).then(function(e){return g(e.data)}),null!=a&&(d=d.then(function(){return h("output.blg",a).then(function(e){return v(e.data)},function(){return!0})}))),null!=d?d["catch"](y):y(),null!=l){var b=function(){return h("output.chktex",l).then(function(e){return m(e.data)})};d=null!=d?d.then(b,b):b()}return null!=d?d["finally"](w):void 0},M=function(){var e=s.editorManager.getCurrentDocValue();if(null==e)return null;for(var t=0,n=Array.from(e.split("\n"));t<n.length;t++){var i=n[t];if(/^[^%]*\\documentclass/.test(i))return s.editorManager.getCurrentDocId()}return null},R=function(e){e=e.replace(/^(.*)\/compiles\/[0-9a-f]{24}(-[0-9a-f]{24})?\/(\.\/)?/,""),e=e.replace(/^\/compile\//,"");var t=s.fileTreeManager.getRootDocDirname();return null!=t&&(e=e.replace(/^\.\//,t+"/")),e};return e.recompile=function(t){return null==t&&(t={}),e.pdf.compiling?void 0:(c.sendMBSampled("editor-recompile-sampled",t),e.lastStartedCompileAt=Date.now(),e.pdf.compiling=!0,e.pdf.isAutoCompileOnLoad=null!=t?t.isAutoCompileOnLoad:void 0,(null!=t?t.force:void 0)&&(e.stop_on_validation_error=!1,e.shouldShowLogs=!1,c.sendMB("syntax-check-turn-off-checking")),(null!=t?t["try"]:void 0)&&(e.shouldShowLogs=!1,c.sendMB("syntax-check-try-compile-anyway")),s.$scope.$broadcast("flush-changes"),t.rootDocOverride_id=M(),x(t).then(function(t){var n=t.data;return e.pdf.view="pdf",e.pdf.compiling=!1,T(n)})["catch"](function(t){var n=(t.data,t.status);return 429===n&&(e.pdf.rateLimited=!0),e.pdf.compiling=!1,e.pdf.renderingError=!1,e.pdf.error=!0,e.pdf.view="errors"})["finally"](function(){return e.lastFinishedCompileAt=Date.now()}))},s.$scope.recompile=e.recompile,s.$scope.recompileViaKey=function(){return e.recompile({keyShortcut:!0})},e.stop=function(){return e.pdf.compiling?t({url:"/project/".concat(e.project_id,"/compile/stop"),method:"POST",params:{clsiserverid:s.clsiServerId},headers:{"X-Csrf-Token":window.csrfToken}}):void 0},e.clearCache=function(){return t({url:"/project/".concat(e.project_id,"/output"),method:"DELETE",params:{clsiserverid:s.clsiServerId},headers:{"X-Csrf-Token":window.csrfToken}})},e.toggleLogs=function(){return e.shouldShowLogs=!e.shouldShowLogs,e.shouldShowLogs?c.sendMBOnce("ide-open-logs-once"):void 0},e.showPdf=function(){return e.pdf.view="pdf",e.shouldShowLogs=!1},e.toggleRawLog=function(){return e.pdf.showRawLog=!e.pdf.showRawLog,e.pdf.showRawLog?c.sendMB("logs-view-raw"):void 0},e.openClearCacheModal=function(){var t;return t=a.open({templateUrl:"clearCacheModalTemplate",controller:"ClearCacheModalController",scope:e})},e.syncToCode=function(e){return l.syncToCode(e).then(function(e){var t=e.doc,n=e.line;return s.editorManager.openDoc(t,{gotoLine:n})})}}]),e.factory("synctex",["ide","$http","$q",function(e,t,n){var i={syncToPdf:function(i){var r=n.defer(),o=e.editorManager.getCurrentDocId();if(null==o)return r.reject(),r.promise;var s=e.fileTreeManager.findEntityById(o);if(null==s)return r.reject(),r.promise;var a=e.fileTreeManager.getEntityPath(s);if(null==a)return r.reject(),r.promise;var l=e.fileTreeManager.getRootDocDirname();null!=l&&""!==l&&(a=a.replace(RegExp("^".concat(l)),"".concat(l,"/.")));var c=i.row,u=i.column;return t({url:"/project/".concat(e.project_id,"/sync/code"),method:"GET",params:{file:a,line:c+1,column:u,clsiserverid:e.clsiServerId}}).then(function(e){var t=e.data;return r.resolve(t.pdf||[])})["catch"](function(e){var t=e.data;return r.reject(t)}),r.promise},syncToCode:function(i,r){var o;null==r&&(r={});var s=n.defer();if(null==i)return s.reject(),s.promise;var a=i.offset.left;return o=r.fromPdfPosition&&null!=(null!=i.pageSize?i.pageSize.height:void 0)?i.pageSize.height-i.offset.top||0:i.offset.top||0,r.includeVisualOffset&&(o+=72),t({url:"/project/".concat(e.project_id,"/sync/pdf"),method:"GET",params:{page:i.page+1,h:a.toFixed(2),v:o.toFixed(2),clsiserverid:e.clsiServerId}}).then(function(t){var n=t.data;if(null!=n.code&&n.code.length>0&&""!==n.code[0].file){var i=e.fileTreeManager.findEntityByPath(n.code[0].file);if(null==i)return;return s.resolve({doc:i,line:n.code[0].line})}""===n.code[0].file&&(e.$scope.sync_tex_error=!0,setTimeout(function(){return e.$scope.sync_tex_error=!1},4e3))})["catch"](function(e){var t=e.data;return s.reject(t)}),s.promise}};return i}]),e.controller("PdfSynctexController",["$scope","synctex","ide",function(e,t,n){var i=this;return this.cursorPosition=null,n.$scope.$on("cursor:editor:update",function(e,t){i.cursorPosition=t}),e.syncToPdf=function(){return null!=i.cursorPosition?t.syncToPdf(i.cursorPosition).then(function(t){return e.pdf.highlights=t}):void 0},n.$scope.$on("cursor:editor:syncToPdf",e.syncToPdf),e.syncToCode=function(){return t.syncToCode(e.pdf.position,{includeVisualOffset:!0,fromPdfPosition:!0}).then(function(e){var t=e.doc,i=e.line;return n.editorManager.openDoc(t,{gotoLine:i})})}}]),e.controller("PdfLogEntryController",["$scope","ide","event_tracking",function(e,t,n){return e.openInEditor=function(e){var i,r;n.sendMBOnce("logs-jump-to-location-once");var o=t.fileTreeManager.findEntityByPath(e.file);if(null!=o&&"doc"===o.type)return null!=e.line&&(r=e.line),null!=e.column&&(i=e.column),t.editorManager.openDoc(o,{gotoLine:r,gotoColumn:i})}}]),e.controller("ClearCacheModalController",["$scope","$modalInstance",function(e,t){return e.state={inflight:!1},e.clear=function(){return e.state.inflight=!0,e.clearCache().then(function(){return e.state.inflight=!1,t.close()})},e.cancel=function(){return t.dismiss("cancel")}}])}),define("ide/pdf/controllers/PdfViewToggleController",["base"],function(e){return e.controller("PdfViewToggleController",["$scope",function(e){return e.togglePdfView=function(){return"pdf"===e.ui.view?e.ui.view="editor":e.ui.view="pdf"},e.fileTreeClosed=!1,e.$on("layout:main:resize",function(t,n){return n.west.initClosed?e.fileTreeClosed=!0:e.fileTreeClosed=!1,e.$apply()})}])}),define("ide/pdfng/directives/pdfTextLayer",["base"],function(e){return e.factory("pdfTextLayer",function(){var e;return e=function(){function e(t){_classCallCheck(this,e),this.textLayerDiv=t.textLayerDiv,this.divContentDone=!1,this.viewport=t.viewport,this.textDivs=[],this.renderer=t.renderer,this.renderingDone=!1}return _createClass(e,[{key:"render",value:function(e){var t=this;if(!this.renderingDone&&this.divContentDone){null!=this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textDivs=[];var n=document.createDocumentFragment();this.textLayerRenderTask=this.renderer({textContent:this.textContent,container:n,viewport:this.viewport,textDivs:this.textDivs,timeout:e,enhanceTextSelection:this.enhanceTextSelection});var i=function(){return t.textLayerDiv.appendChild(n),t.renderingDone=!0},r=function(){};return this.textLayerRenderTask.promise.then(i,r)}}},{key:"setTextContent",value:function(e){return this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textContent=e,this.divContentDone=!0}}]),e}()})}),define("ide/pdfng/directives/pdfAnnotations",["base","pdfjs-dist/build/pdf"],function(e,t){var n="_blank",i="noreferrer noopener";e.factory("pdfAnnotations",function(){var e=function(){function e(t){_classCallCheck(this,e),this.annotationsLayerDiv=t.annotations,this.viewport=t.viewport,this.navigateFn=t.navigateFn}return _createClass(e,[{key:"setAnnotations",value:function(e){var t=[],n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;switch(a.subtype){case"Link":t.push(this.addLink(a));break;case"Text":continue;default:t.push(void 0)}}}catch(l){i=!0,r=l}finally{try{n||null==s["return"]||s["return"]()}finally{if(i)throw r}}}},{key:"addLink",value:function(e){var t=this.buildLinkElementFromRect(e.rect);this.setLinkTarget(t,e),this.annotationsLayerDiv.appendChild(t)}},{key:"buildLinkElementFromRect",value:function(e){e=this.viewport.convertToViewportRectangle(e),e=t.Util.normalizeRect(e);var n=document.createElement("a");return n.style.left=Math.floor(e[0])+"px",n.style.top=Math.floor(e[1])+"px",n.style.width=Math.ceil(e[2]-e[0])+"px",n.style.height=Math.ceil(e[3]-e[1])+"px",n}},{key:"setLinkTarget",value:function(e,t){var r=this;t.url?(e.href=t.url,e.target=n,e.rel=i):t.dest&&(e.href="#".concat(t.dest),e.onclick=function(){return r.navigateFn(t),!1})}}]),e}();return e})}),define("ide/pdfng/directives/pdfHighlights",["base","pdfjs-dist/build/pdf"],function(e,t){return e.factory("pdfHighlights",function(){var e;return e=function(){function e(t){_classCallCheck(this,e),this.highlightsLayerDiv=t.highlights[0],this.highlightElements=[]}return _createClass(e,[{key:"addHighlight",value:function(e,n,i,r,o){var s=e.convertToViewportRectangle([n,i,n+r,i+o]);s=t.Util.normalizeRect(s);var a=document.createElement("div");return a.style.left=Math.floor(s[0])+"px",a.style.top=Math.floor(s[1])+"px",a.style.width=Math.ceil(s[2]-s[0])+"px",a.style.height=Math.ceil(s[3]-s[1])+"px",this.highlightElements.push(a),this.highlightsLayerDiv.appendChild(a),a}},{key:"clearHighlights",value:function(){for(var e=0,t=Array.from(this.highlightElements);e<t.length;e++){var n=t[e];null!=n&&n.parentNode.removeChild(n)}return this.highlightElements=[]}}]),e}()})}),define("ide/pdfng/directives/pdfRenderer",["base","pdfjs-dist/build/pdf"],function(e,t){return e.factory("PDFRenderer",["$q","$timeout","pdfAnnotations","pdfTextLayer","pdfSpinner",function(e,n,i,r,o){var s;return s=function(){return s=function(){function s(n,i){var r=this;_classCallCheck(this,s),this.url=n,this.options=i,this.scale=this.options.scale||1;var a;a=__guard__(null!=window.location?window.location.search:void 0,function(e){return e.indexOf("disable-font-face=true")})>=0?!0:!1,this.pdfjs=t.getDocument({url:this.url,cMapUrl:window.pdfCMapsPath,cMapPacked:!0,disableFontFace:a,rangeChunkSize:131072,disableAutoFetch:!!this.options.disableAutoFetch,disableStream:!!this.options.disableAutoFetch}),this.pdfjs.onProgress=this.options.progressCallback,this.document=e.when(this.pdfjs),this.navigateFn=this.options.navigateFn,this.spinner=new o,this.resetState(),this.document.then(function(e){return e.getDownloadInfo().then(function(){return r.options.loadedCallback()})}),this.errorCallback=this.options.errorCallback,this.pageSizeChangeCallback=this.options.pageSizeChangeCallback,this.pdfjs.promise["catch"](function(e){return r.errorCallback(e)})}return _createClass(s,null,[{key:"initClass",value:function(){this.prototype.JOB_QUEUE_INTERVAL=25,this.prototype.PAGE_LOAD_TIMEOUT=6e4,this.prototype.INDICATOR_DELAY1=100,this.prototype.INDICATOR_DELAY2=250,this.prototype.TEXTLAYER_TIMEOUT=100}}]),_createClass(s,[{key:"resetState",value:function(){this.renderQueue=[],null!=this.queueTimer&&clearTimeout(this.queueTimer);for(var e=0,t=Array.from(this.spinTimer||[]);e<t.length;e++){var n=t[e];clearTimeout(n)}for(var i=0,r=Array.from(this.pageState||[]);i<r.length;i++){var o=r[i];__guard__(null!=o?o.loadTask:void 0,function(e){return e.cancel()}),__guard__(null!=o?o.renderTask:void 0,function(e){return e.cancel()})}return this.pageState=[],this.spinTimer=[],this.spinTimerDone=[],this.jobs=0}},{key:"getNumPages",value:function(){return this.document.then(function(e){return e.numPages})}},{key:"getPage",value:function(e){return this.document.then(function(t){return t.getPage(e)})}},{key:"getPdfViewport",value:function(e,t){var n=this;return null==t&&(t=this.scale),this.document.then(function(i){return i.getPage(e).then(function(e){var n;return n=e.getViewport(t)},function(e){return"function"==typeof n.errorCallback?n.errorCallback(e):void 0})})}},{key:"getDestinations",value:function(){return this.document.then(function(e){return e.getDestinations()})}},{key:"getDestination",value:function(e){var t=this;return this.document.then(function(t){return t.getDestination(e)},function(e){return"function"==typeof t.errorCallback?t.errorCallback(e):void 0})}},{key:"getPageIndex",value:function(e){var t=this;return this.document.then(function(n){return n.getPageIndex(e).then(function(e){return e},function(e){return"function"==typeof t.errorCallback?t.errorCallback(e):void 0})})}},{key:"getScale",value:function(){return this.scale}},{key:"setScale",value:function(e){return this.scale=e,this.resetState()}},{key:"triggerRenderQueue",value:function(e){var t=this;return null==e&&(e=this.JOB_QUEUE_INTERVAL),null!=this.queueTimer&&clearTimeout(this.queueTimer),this.queueTimer=setTimeout(function(){return t.queueTimer=null,t.processRenderQueue()},e)}},{key:"removeCompletedJob",value:function(e){return this.jobs=this.jobs-1,this.triggerRenderQueue(0)}},{key:"renderPages",value:function(e){return this.shuttingDown?void 0:(this.renderQueue=Array.from(e).map(function(e){return{element:e.elementChildren,pagenum:e.pageNum}}),this.triggerRenderQueue())}},{key:"renderPage",value:function(e){if(!this.shuttingDown){var t={element:e.elementChildren,pagenum:e.pageNum};return this.renderQueue.push(t),this.processRenderQueue()}}},{key:"getPageDetails",value:function(e){return[e.element.canvas,e.pagenum]}},{key:"startIndicators",value:function(){var e=this;this.queuedPages=[];for(var t=0,n=Array.from(this.renderQueue);t<n.length;t++){var i=n[t];this.queuedPages[i.pagenum]=!0}for(var r in this.spinTimer)this.queuedPages[r]||(clearTimeout(this.spinTimer[r]),delete this.spinTimer[r]);return function(){for(var t=[],n=0,r=Array.from(e.renderQueue);n<r.length;n++)i=r[n],e.spinTimer[i.pagenum]||e.spinTimerDone[i.pagenum]||t.push(e.startIndicator(i));return t}()}},{key:"startIndicator",value:function(e){var t=this,n=Array.from(this.getPageDetails(e)),i=_slicedToArray(n,2),r=i[0],o=i[1];return r.addClass("pdfng-loading"),this.spinTimer[o]=setTimeout(function(){for(var e=0,n=Array.from(t.renderQueue);e<n.length;e++){var i=n[e];if(o===i.pagenum){t.spinner.add(r,{"static":!0}),t.spinTimerDone[o]=!0;break}}return delete t.spinTimer[o]},this.INDICATOR_DELAY1)}},{key:"updateIndicator",value:function(e){var t=this,n=Array.from(this.getPageDetails(e)),i=_slicedToArray(n,2),r=i[0],o=i[1];return this.spinTimerDone[o]?this.spinTimer[o]=setTimeout(function(){return t.spinner.start(r),delete t.spinTimer[o]},this.INDICATOR_DELAY2):(clearTimeout(this.spinTimer[o]),this.spinTimer[o]=setTimeout(function(){return t.spinner.add(r,{"static":!0}),t.spinTimerDone[o]=!0,t.spinTimer[o]=setTimeout(function(){return t.spinner.start(r),delete t.spinTimer[o]},t.INDICATOR_DELAY2)},this.INDICATOR_DELAY1))}},{key:"clearIndicator",value:function(e){var t=Array.from(this.getPageDetails(e)),n=_slicedToArray(t,2),i=n[0],r=n[1];return this.spinner.stop(i),clearTimeout(this.spinTimer[r]),delete this.spinTimer[r],this.spinTimerDone[r]=!0}},{key:"processRenderQueue",value:function(){var e,t=this;if(!(this.shuttingDown||(this.startIndicators(),this.jobs>0))){for(var i=this.renderQueue.shift();null!=i&&null!=this.pageState[i.pagenum];)i=this.renderQueue.shift();if(null!=i){var r=Array.from([i.element,i.pagenum]),o=_slicedToArray(r,2),s=o[0],a=o[1];this.jobs=this.jobs+1,this.updateIndicator(i);var l=!1,c=n(function(){return u.cancelled?void 0:(__guardMethod__(window.Raven,"captureMessage",function(e){return e.captureMessage("pdfng page load timed out after ".concat(t.PAGE_LOAD_TIMEOUT,"ms"))}),l=!0,t.clearIndicator(i),"function"==typeof t.errorCallback?t.errorCallback("timeout"):void 0)},this.PAGE_LOAD_TIMEOUT),u=this.getPage(a);return u.cancel=function(){return this.cancelled=!0},this.pageState[a]=e={loadTask:u},u.then(function(r){return n.cancel(c),u.cancelled?void 0:(e.renderTask=t.doRender(s,a,r),e.renderTask.then(function(){return t.clearIndicator(i),e.complete=!0,delete e.renderTask,t.removeCompletedJob(a)},function(){return e.complete=!1,delete e.renderTask,t.removeCompletedJob(a)}))})["catch"](function(e){return n.cancel(c),t.clearIndicator(i)})}}}},{key:"doRender",value:function(e,n,o){var s=this,a=this.scale;if(null!=a){var l=$('<canvas class="pdf-canvas pdfng-rendering"></canvas>');e.canvas.replaceWith(l);var c=o.getViewport(a),u=window.devicePixelRatio||1,d=l[0].getContext("2d"),h=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1,f=u/h,p=Math.floor(c.width)*f|0,g=Math.floor(c.height)*f|0,m=Math.floor(c.width),v=Math.floor(c.height);l[0].height=g,l[0].width=p,l.height(v+"px"),l.width(m+"px");var y=e.canvas.height(),w=e.canvas.width();(v!==y||m!==w)&&(e.canvas.height(v+"px"),e.canvas.width(m+"px"),e.container.height(v+"px"),e.container.width(m+"px"),"function"==typeof this.pageSizeChangeCallback&&this.pageSizeChangeCallback(n,v-y));var b=new r({textLayerDiv:e.text[0],viewport:c,renderer:t.renderTextLayer}),_=new i({annotations:e.annotations[0],viewport:c,navigateFn:this.navigateFn}),C=o.render({canvasContext:d,viewport:c,transform:[f,0,0,f,0,0]}),k=this.TEXTLAYER_TIMEOUT;return C.then(function(){return l.removeClass("pdfng-rendering"),o.getTextContent({normalizeWhitespace:!0}).then(function(e){return b.setTextContent(e),b.render(k)},function(e){return"function"==typeof s.errorCallback?s.errorCallback(e):void 0}),o.getAnnotations().then(function(e){return _.setAnnotations(e)},function(e){return"function"==typeof s.errorCallback?s.errorCallback(e):void 0})})["catch"](function(e){return"RenderingCancelledException"!==e.name&&"function"==typeof s.errorCallback?s.errorCallback(e):void 0}),C}}},{key:"destroy",value:function(){return this.shuttingDown=!0,this.resetState(),this.pdfjs.then(function(e){return e.cleanup(),e.destroy()})}}]),s}(),s.initClass(),s}()}])}),define("ide/pdfng/directives/pdfPage",["base"],function(e){return e.directive("pdfPage",["$timeout","pdfHighlights","pdfSpinner",function(e,t,n){return{require:"^pdfViewer",template:'<div class="plv-page-view page-view">\n	<div class="pdf-canvas pdfng-empty"></div>\n	<div class="plv-text-layer text-layer"></div>\n	<div class="plv-annotations-layer annotations-layer"></div>\n	<div class="plv-highlights-layer highlights-layer"></div>\n</div>',link:function(n,i,r,o){var s=$(i).find(".pdf-canvas"),a=$(i).find(".text-layer"),l=$(i).find(".annotations-layer"),c=$(i).find(".highlights-layer"),u=function(e){var t=Math.floor(e[0]),r=Math.floor(e[1]);return i.height(t),i.width(r),s.height(t),s.width(r),n.page.sized=!0};if(n.page.element=i,n.page.elementChildren={canvas:s,text:a,annotations:l,highlights:c,container:i},!n.page.sized)if(null!=n.defaultPageSize)u(n.defaultPageSize);else var d=n.$watch("defaultPageSize",function(e){return null!=e?(u(e),d()):void 0});n.page.current&&(n.document.renderPage(n.page),o.setPdfPosition(n.page,n.page.position)),i.on("dblclick",function(e){var t=$(i).find(".pdf-canvas").offset(),r=e.pageX-t.left,o=e.pageY-t.top;return n.document.getPdfViewport(n.page.pageNum).then(function(e){var t=e.convertToPdfPoint(r,o),i={page:n.page.pageNum,x:t[0],y:e.viewBox[3]-t[1]};return n.$emit("pdfDoubleClick",i)})});var h=new t({highlights:c});return n.$on("pdf:highlights",function(t,i){var r;if(null!=i&&i.length>0){n.timeoutHandler&&(e.cancel(n.timeoutHandler),h.clearHighlights(),n.timeoutHandler=null);var o=function(){for(var e=[],t=0,o=Array.from(i);t<o.length;t++)r=o[t],r.page===n.page.pageNum&&e.push(r);return e}();if(o.length)return n.document.getPdfViewport(n.page.pageNum).then(function(e){return function(){for(var t=[],n=0,i=Array.from(o);n<i.length;n++){var r=i[n],s=e.viewBox[3]-r.v;t.push(h.addHighlight(e,r.h,s,r.width,r.height))}return t}()}),n.timeoutHandler=e(function(){return h.clearHighlights(),n.timeoutHandler=null},1e3)}}),n.$on("$destroy",function(){return null!=n.timeoutHandler?(e.cancel(n.timeoutHandler),h.clearHighlights()):void 0})}}}])}),define("ide/pdfng/directives/pdfSpinner",["base"],function(e){return e.factory("pdfSpinner",function(){var e;return e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"add",value:function(e,t){var n=64,i=$('<div class="pdfng-spinner" style="position: absolute; top: 50%; left:50%; transform: translateX(-50%) translateY(-50%);"><i class="fa fa-spinner'.concat((null!=t?t["static"]:void 0)?"":" fa-spin",'" style="color: #999"></i></div>'));return i.css({"font-size":n+"px"}),e.append(i)}},{key:"start",value:function(e){return e.find(".fa-spinner").addClass("fa-spin")}},{key:"stop",value:function(e){return e.find(".fa-spinner").removeClass("fa-spin")}},{key:"remove",value:function(e){return e.find(".fa-spinner").remove()}}]),e}()})}),define("ide/pdfng/directives/pdfViewer",["base","ide/pdfng/directives/pdfTextLayer","ide/pdfng/directives/pdfAnnotations","ide/pdfng/directives/pdfHighlights","ide/pdfng/directives/pdfRenderer","ide/pdfng/directives/pdfPage","ide/pdfng/directives/pdfSpinner"],function(e,t,n,i,r,o,s,a){return e.controller("pdfViewerController",["$scope","$q","$timeout","PDFRenderer","$element","pdfHighlights","pdfSpinner",function(e,t,n,i,r,o,s){return this.load=function(){null!=e.document&&e.document.destroy(),e.loadCount=null!=e.loadCount?e.loadCount+1:1;var n=e.pdfSrc,r=/\?/.test(n);n=n+(r?"&":"?")+"pdfng=true";var o=!0;return e.document=new i(n,{scale:1,disableAutoFetch:o?!0:void 0,navigateFn:function(t){return e.navigateTo=t,e.$apply()},progressCallback:function(t){return e.$emit("progress",t)},loadedCallback:function(){return e.$emit("loaded")},errorCallback:function(t){return __guardMethod__(window.Raven,"captureMessage",function(e){return e.captureMessage("pdfng error ".concat(t))}),e.$emit("pdf:error",t)},pageSizeChangeCallback:function(t,n){return e.$broadcast("pdf:page:size-change",t,n)}}),e.loaded=t.all({numPages:e.document.getNumPages(),pdfViewport:e.document.getPdfViewport(1,1)}).then(function(t){return e.pdfViewport=t.pdfViewport,e.pdfPageSize=[t.pdfViewport.height,t.pdfViewport.width],e.$emit("loaded"),e.numPages=t.numPages})["catch"](function(n){return e.$emit("pdf:error",n),t.reject(n)})},this.setScale=function(n,i,r){return e.loaded.then(function(){var t;return null==n&&(n={}),0===i||0===r?t=1:"scale_mode_fit_width"===n.scaleMode?t=(r-40)/e.pdfPageSize[1]:"scale_mode_fit_height"===n.scaleMode?t=(i-20)/e.pdfPageSize[0]:"scale_mode_value"===n.scaleMode?t=n.scale:"scale_mode_auto"===n.scaleMode||(n.scaleMode="scale_mode_fit_width",t=(r-40)/e.pdfPageSize[1]),e.scale.scale=t,e.document.setScale(t),e.defaultPageSize=[t*e.pdfPageSize[0],t*e.pdfPageSize[1]]})["catch"](function(n){return e.$emit("pdf:error",n),t.reject(n)})},this.redraw=function(t){if(e.pages=__range__(0,e.numPages-1,!0).map(function(e){return{pageNum:e+1}}),null!=t&&null!=t.page){var n=t.page;return n>e.numPages-1&&(n=e.numPages-1),e.pages[n].current=!0,e.pages[n].position=t}},this.zoomIn=function(){var t=1.2*e.scale.scale;return e.forceScale={scaleMode:"scale_mode_value",scale:t}},this.zoomOut=function(){var t=e.scale.scale/1.2;return e.forceScale={scaleMode:"scale_mode_value",scale:t}},this.fitWidth=function(){return e.forceScale={scaleMode:"scale_mode_fit_width"}},this.fitHeight=function(){return e.forceScale={scaleMode:"scale_mode_fit_height"}},this.checkPosition=function(){return e.forceCheck=(e.forceCheck||0)+1},this.showRandomHighlights=function(){return e.highlights=[{page:3,h:100,v:100,height:30,width:200}]},this.getPdfPosition=function(){var t,n,i,o=0,s=e.pages[0],a=e.pages.some(function(e,t){if(e.visible){var n,i,r;return n=Array.from(r=[t,e]),i=_slicedToArray(n,2),o=i[0],s=i[1],n,r}});if(a&&null!=s.element){var l=s.element.offset(),c=l.top,u=c+s.element.innerHeight(),d=r.offset().top,h=d+r.height(),f=c>=d&&h>c,p=d>c&&u>d;if(t=f?0:p?d-c:null,s.viewport){var g=s;i=g.viewport,n=i.convertToPdfPoint(0,t)}else{i=e.pdfViewport;var m=t/e.scale.scale;n=i.convertToPdfPoint(0,m)}var v={page:o,offset:{top:n[1],left:0},pageSize:{height:i.viewBox[3],width:i.viewBox[2]}};return v}},this.computeOffset=function(n,i){var r=n.element,o=__guard__($(r).offset(),function(e){return e.top}),s=__guard__($(r).parent().offset(),function(e){return e.top});if(null==o||null==s)return t(function(e,t){return t("elements destroyed")});var a=$(r).offset().top-$(r).parent().offset().top,l=$(r).parent().scrollTop(),c=i.offset;return e.document.getPdfViewport(n.pageNum).then(function(e){n.viewport=e;var t=e.convertToViewportPoint(c.left,c.top);return null==i.pageSize&&(i.pageSize={height:e.viewBox[3],width:e.viewBox[2]}),Math.round(a+t[1]+l)})},this.setPdfPosition=function(t,n){return this.computeOffset(t,n).then(function(t){return e.pleaseScrollTo=t,e.position=n})},this}]),e.directive("pdfViewer",["$q","$timeout","pdfSpinner",function(e,t,n){return{controller:"pdfViewerController",controllerAs:"ctrl",scope:{pdfSrc:"=",highlights:"=",position:"=",scale:"=",pleaseJumpTo:"="},template:"<div data-pdf-page class='pdf-page-container page-container' ng-repeat='page in pages'></div>",link:function(i,r,o,s){var a=new n,l=e.defer();l.notify("waiting for layout"),l.promise.then(function(){});var c=function(){var e=u(),t=d(e);return i.document.renderPages(t)},u=function(){var e=r[0].scrollTop,t=e+r[0].clientHeight,n=_.filter(i.pages,function(n){if(null==n.element)return!1;var i=n.element[0],r=i.offsetTop,o=r+i.clientHeight;return n.visible=t>r&&o>e,n.visible});return n},d=function(e){var t=[];if(e.length>0){var n=e[0].pageNum,r=n-1,o=e.length,s=e[o-1].pageNum,a=s-1;a+1<i.pages.length&&t.push(i.pages[a+1]),r>0&&t.push(i.pages[r-1]),a+2<i.pages.length&&t.push(i.pages[a+2])}return e.concat(t)},h=null,f=function(e){return null==h&&null==y&&null==m?h=setTimeout(function(){return g(e),h=null},0):void 0},p=null,g=function(e){if(null!=e){var n=angular.copy(i.position);return null==p&&(p=setTimeout(function(){return a.add(r),p=null},100)),l.promise.then(function(o){var l=Array.from(o),u=_slicedToArray(l,2),d=u[0],h=u[1];return s.setScale(e,d,h).then(function(){return i.$evalAsync(function(){return p?clearTimeout(p):a.remove(r),r.removeClass("pdfjs-viewer-show-text"),s.redraw(n),t(c),i.loadSuccess=!0})})["catch"](function(e){return i.$emit("pdf:error",e)})})}},m=null,v=function E(){if(0===r.height()||0===r.width()){if(null!=m)return;return m=setTimeout(function(){return m=null,E()},1e3)}return i.parentSize=[r.innerHeight(),r.innerWidth()],t(function(){return l.resolve(i.parentSize),i.$emit("flash-controls")})},y=null,w=function(){return null==y?(l=e.defer(),y=setTimeout(function(){return v(),y=null},0)):void 0};w(),i.$on("layout:main:resize",function(){return w()}),i.$on("layout:pdf:resize",function(){return w()}),i.$on("pdf:error",function(e,t){if("RenderingCancelledException"!==t.name){var n=(null!=t?t.message:void 0)||t;return i.loadCount>3||/^Missing PDF/i.test(n)||/^loading/i.test(n)?void i.$emit("pdf:error:display"):i.loadSuccess?s.load().then(function(){return i.scale=angular.copy(i.scale)})["catch"](function(e){return i.$emit("pdf:error:display")}):void i.$emit("pdf:error:display")}}),i.$on("pdf:page:size-change",function(e,t,n){var o=angular.copy(i.position);if(null!=o&&t-1<o.page&&0!==n){var s=r.scrollTop();return i.adjustingScroll=!0,r.scrollTop(s+n)}}),r.on("mousedown",function(e){return e.target===r[0]||x()?void 0:(r.addClass("pdfjs-viewer-show-text"),C())});var b=null,C=function(){return null==b?b=$(document.body).one("mouseup",k):void 0},k=function(){return b=null,window.setTimeout(function(){var e=S();return e?void 0:C()},10),!0},S=function(){return x()?!1:(r.removeClass("pdfjs-viewer-show-text"),!0)},x=function(){var e="function"==typeof window.getSelection?window.getSelection():void 0;return null!=e&&A(e)&&!e.isCollapsed},A=function(e){if(0===e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return r.find(t).length>0||r.is(t)};r.on("scroll",function(){return i.adjustingScroll?(c(),void(i.adjustingScroll=!1)):(i.scrollHandlerTimeout&&clearTimeout(i.scrollHandlerTimeout),i.scrollHandlerTimeout=setTimeout(T,25))});var T=function(){c();var e=s.getPdfPosition();return null!=e&&(i.position=e),i.scrollHandlerTimeout=null};return i.$watch("pdfSrc",function(e,t){return null!=e?(i.loadCount=0,i.loadSuccess=!1,s.load().then(function(){return i.scale=angular.copy(i.scale)})["catch"](function(e){return i.$emit("pdf:error",e)})):void 0}),i.$watch("scale",function(e,t){return e!==t?f(e):void 0}),i.$watch("forceScale",function(e,t){return null!=e?f(e):void 0}),i.$watch("forceCheck",function(e,t){return null!=e?(i.adjustingScroll=!0,f(i.scale)):void 0}),i.$watch("parentSize",function(e,t){return null!=e?f(i.scale):void 0},!0),i.$watch("pleaseScrollTo",function(e,t){return null!=e?(i.adjustingScroll=!0,$(r).scrollTop(e),i.pleaseScrollTo=void 0):void 0}),i.$watch("pleaseJumpTo",function(e,t){return null!=e?s.setPdfPosition(i.pages[e.page-1],e):void 0}),i.$watch("navigateTo",function(e,t){return null!=e?(i.navigateTo=void 0,i.document.getDestination(e.dest).then(function(e){return i.document.getPageIndex(e[0]).then(function(t){var n=i.pages[t];return i.document.getPdfViewport(n.pageNum).then(function(n){n.convertToViewportPoint(e[2],e[3]);if("XYZ"===e[1].name){var r={page:t,offset:{top:e[3],left:e[2]}};return s.setPdfPosition(i.pages[t],r)}})})})):void 0}),i.$watch("highlights",function(e){if(null!=e){var t=Array.from(e||[]).map(function(e){return{page:e.page-1,highlight:{left:e.h,top:e.v,height:e.height,width:e.width}}});if(t.length){i.$broadcast("pdf:highlights",e);var n=t[0];if(i.pages){var r=null!=i.pages[n.page]?i.pages[n.page].pageNum:void 0;if(null!=r)return i.document.getPdfViewport(r).then(function(e){var t={page:n.page,offset:{left:n.highlight.left,top:e.viewBox[3]-n.highlight.top+n.highlight.height+72}};return s.setPdfPosition(i.pages[n.page],t)})}}}}),i.$on("$destroy",function(){return null!=m&&clearTimeout(m),null!=y&&clearTimeout(y),null!=h&&clearTimeout(h),null!=p?clearTimeout(p):void 0})}}}])}),define("ide/pdfng/directives/pdfJs",["base","ide/pdfng/directives/pdfViewer"],function(e,t){return e.directive("pdfng",["$timeout","localStorage",function(e,t){return{scope:{pdfSrc:"=",highlights:"=",position:"=",dblClickCallback:"="},link:function(n,i,r){n.loading=!1,n.pleaseJumpTo=null,n.scale=null;var o=!1,s=function(){var e,i;if(!o)return o=!0,null!=(i=t("pdf.scale"))?n.scale={scaleMode:i.scaleMode,scale:+i.scale}:n.scale={scaleMode:"scale_mode_fit_width"},(e=t("pdf.position.".concat(r.key)))&&(n.position={page:+e.page,offset:{top:+e.offset.top,left:+e.offset.left}}),n.$on("$destroy",function(){return t("pdf.scale",n.scale),t("pdf.position.".concat(r.key),n.position)}),$(window).unload(function(){return t("pdf.scale",n.scale),t("pdf.position.".concat(r.key),n.position)})},a=function(){return n.$evalAsync(function(){return n.flashControls=!0,e(function(){return n.flashControls=!1},1e3)})};if(n.$on("pdfDoubleClick",function(e,t){return"function"==typeof n.dblClickCallback?n.dblClickCallback({
page:t.page-1,offset:{top:t.y,left:t.x}}):void 0}),n.$on("flash-controls",function(){return a()}),n.$watch("pdfSrc",function(e){return e?(n.loading=!0,n.loaded=!1,n.progress=1,s(),a()):void 0}),n.$on("loaded",function(){return n.loaded=!0,n.progress=100,e(function(){return n.loading=!1,delete n.progress},500)}),n.fitToHeight=function(){var e=angular.copy(n.scale);return e.scaleMode="scale_mode_fit_height",n.scale=e},n.fitToWidth=function(){var e=angular.copy(n.scale);return e.scaleMode="scale_mode_fit_width",n.scale=e},n.zoomIn=function(){var e=angular.copy(n.scale);return e.scaleMode="scale_mode_value",e.scale=1.2*e.scale,n.scale=e},n.zoomOut=function(){var e=angular.copy(n.scale);return e.scaleMode="scale_mode_value",e.scale=e.scale/1.2,n.scale=e},null!=r.resizeOn)for(var l=0,c=Array.from(r.resizeOn.split(","));l<c.length;l++){var u=c[l];n.$on(u,function(e){})}return n.$on("progress",function(e,t){return n.$apply(function(){return n.loaded?void 0:(n.progress=Math.floor(t.loaded/t.total*100),n.progress>100&&(n.progress=100),n.progress<0?n.progress=0:void 0)})}),n.$on("$destroy",function(){})},template:'<div data-pdf-viewer class="pdfjs-viewer" pdf-src=\'pdfSrc\' position=\'position\' scale=\'scale\' highlights=\'highlights\' please-jump-to=\'pleaseJumpTo\'></div>\n<div class="pdfjs-controls" ng-class="{\'flash\': flashControls }">\n	<div class="btn-group">\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="fitToWidth()"\n			tooltip="Fit to Width"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-arrows-h"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="fitToHeight()"\n			tooltip="Fit to Height"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-arrows-v"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="zoomIn()"\n			tooltip="Zoom In"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-search-plus"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="zoomOut()"\n			tooltip="Zoom Out"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-search-minus"></i>\n		</a>\n	</div>\n</div>\n<div class="progress-thin" ng-show="loading">\n	<div class="progress-bar" ng-style="{ \'width\': progress + \'%\' }"></div>\n</div>'}}])}),define("ide/pdf/PdfManager",["ide/pdf/controllers/PdfController","ide/pdf/controllers/PdfViewToggleController","ide/pdfng/directives/pdfJs"],function(){var e;return e=function t(e,n){_classCallCheck(this,t),this.ide=e,this.$scope=n,this.$scope.pdf={url:null,error:!1,timeout:!1,failure:!1,compiling:!1,uncompiled:!0,logEntries:[],logEntryAnnotations:{},rawLog:"",view:null,showRawLog:!1,highlights:[],position:null}}}),define("ide/binary-files/controllers/BinaryFileController",["base","moment"],function(e,t){return e.controller("BinaryFileController",["$scope","$rootScope","$http","$timeout","$element","ide","waitFor",function(e,t,n,i,r,o,s){function a(){var t="/project/".concat(window.project_id,"/file/").concat(e.openFile.id),n=!1;d(),l(t).then(function(e){var i={};return e>g&&(n=!0,i.maxSize=g),c(t,i)}).then(function(e){var t=n?u(e):e;h(t,n)})["catch"](function(e){console.error(e),f()})}function l(e){return n.head(e).then(function(e){var t=parseInt(e.headers("Content-Length"),10);if(isNaN(t))throw new Error("Could not parse Content-Length header");return t})}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.maxSize;return null!=i&&(e+="?range=0-".concat(i)),n.get(e,{transformResponse:null}).then(function(e){return e.data})}function u(e){return e.replace(/\n.*$/,"")}function d(){e.textPreview.data=null,e.textPreview.loading=!0,e.textPreview.shouldShowDots=!1,e.$apply()}function h(t,n){e.textPreview.error=!1,e.textPreview.data=t,e.textPreview.shouldShowDots=n,i(p,0)}function f(){e.textPreview.error=!0,e.textPreview.loading=!1}function p(){var t=r.find(".text-preview .scroll-container"),n=r.find(".binary-file-footer"),i=r.height()-n.height()-14;t.css({"max-height":i}),e.textPreview.loading=!1}var g=2097152,m=60,v=35,y="...",w=m-v-y.length,b=["bib","tex","txt","cls","sty"],_=["png","jpg","jpeg","gif"],C=[],k=function(e){return e.name.split(".").pop().toLowerCase()};e.isTextFile=function(){return b.indexOf(k(e.openFile))>-1},e.isImageFile=function(){return _.indexOf(k(e.openFile))>-1},e.isPreviewableFile=function(){return C.indexOf(k(e.openFile))>-1},e.isUnpreviewableFile=function(){return!e.isTextFile()&&!e.isImageFile()&&!e.isPreviewableFile()},e.textPreview={loading:!1,shouldShowDots:!1,error:!1,data:null},e.refreshing=!1,e.refreshError=null,e.displayUrl=function(e){if(null!=e){if(e.length>m){var t=e.slice(0,v),n=e.slice(e.length-w);return t+y+n}return e}},e.refreshFile=function(t){e.refreshing=!0,e.refreshError=null,o.fileTreeManager.refreshLinkedFile(t).then(function(t){var n=t.data,r=n.new_file_id;i(function(){return s(function(){return o.fileTreeManager.findEntityById(r)},5e3).then(function(e){return o.binaryFilesManager.openFile(e)})["catch"](function(e){return console.warn(e)})},0),e.refreshError=null})["catch"](function(t){return e.refreshError=t.data})["finally"](function(){e.refreshing=!1;var n=t.linkedFileData.provider;("mendeley"===n||"zotero"===n||t.name.match(/^.*\.bib$/))&&o.$scope.$emit("references:should-reindex",{})})},e.failedLoad=!1,window.sl_binaryFilePreviewError=function(){e.failedLoad=!0,e.$apply()},e.imgLoaded=!1,window.sl_binaryFilePreviewLoaded=function(){e.imgLoaded=!0,e.$apply()},e.isTextFile()&&a()}])}),define("ide/binary-files/BinaryFilesManager",["ide/binary-files/controllers/BinaryFileController"],function(){var e;return e=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.ide=t,this.$scope=n,this.$scope.$on("entity:selected",function(e,t){return"track-changes"!==i.$scope.ui.view&&"file"===t.type?i.openFile(t):void 0})}return _createClass(e,[{key:"openFile",value:function(e){var t=this;return this.ide.fileTreeManager.selectEntity(e),this.$scope.ui.view="file",this.$scope.openFile=null,this.$scope.$apply(),window.setTimeout(function(){return t.$scope.openFile=e,t.$scope.$apply()},0,this)}}]),e}()}),define("ide/references/ReferencesManager",[],function(){var e;return e=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.ide=t,this.$scope=n,this.$scope.$root._references=this.state={keys:[]},this.$scope.$on("document:closed",function(e,t){var n;return t.doc_id&&(n=i.ide.fileTreeManager.findEntityById(t.doc_id)),__guard__(null!=n?n.name:void 0,function(e){return e.match(/.*\.bib$/)})?i.indexReferences([t.doc_id],!0):void 0}),this.$scope.$on("references:should-reindex",function(e,t){return i.indexAllReferences(!0)}),this.inited=!1,this.$scope.$on("project:joined",function(e){return i.inited?void 0:(i.inited=!0,i.indexAllReferences(!1))}),setTimeout(function(e){return e.ide.socket.on("references:keys:updated",function(t){return e._storeReferencesKeys(t)})},1e3,this)}return _createClass(e,[{key:"_storeReferencesKeys",value:function(e){var t=this.$scope.$root._references.keys;return this.$scope.$root._references.keys=_.union(t,e)}},{key:"indexReferences",value:function(e,t){var n=this,i={docIds:e,shouldBroadcast:t,_csrf:window.csrfToken};return this.ide.$http.post("/project/".concat(this.$scope.project_id,"/references/index"),i).then(function(e){return n._storeReferencesKeys(e.data.keys)})}},{key:"indexAllReferences",value:function(e){var t=this,n={shouldBroadcast:e,_csrf:window.csrfToken};return this.ide.$http.post("/project/".concat(this.$scope.project_id,"/references/indexAll"),n).then(function(e){return t._storeReferencesKeys(e.data.keys)})}}]),e}()}),define("ide/metadata/MetadataManager",[],function(){var e;return e=function(){function e(t,n,i){var r=this;_classCallCheck(this,e),this.ide=t,this.$scope=n,this.metadata=i,this.ide.socket.on("broadcastDocMeta",function(e){return r.metadata.onBroadcastDocMeta(e)}),this.$scope.$on("entity:deleted",this.metadata.onEntityDeleted),this.$scope.$on("file:upload:complete",this.metadata.fileUploadComplete)}return _createClass(e,[{key:"loadProjectMetaFromServer",value:function(){return this.metadata.loadProjectMetaFromServer()}}]),e}()}),define("ide/review-panel/controllers/ReviewPanelController",["base","utils/EventEmitter","ide/colors/ColorManager","ide/review-panel/RangesTracker"],function(e,t,n,i){return e.controller("ReviewPanelController",["$scope","$element","ide","$timeout","$http","$modal","event_tracking","localStorage",function(e,r,o,s,a,l,c,u){var d,h=r.find("#review-panel"),f={MEMBER:"member",GUEST:"guest",ANONYMOUS:"anonymous"},p=function(){if(null==(null!=o.$scope.user?o.$scope.user.id:void 0))return f.ANONYMOUS;var e=o.$scope.user.id,t=o.$scope.project;if((null!=t.owner?t.owner.id:void 0)===e)return f.MEMBER;for(var n=0,i=Array.from(t.members);n<i.length;n++){var r=i[n];if(r._id===e)return f.MEMBER}return f.GUEST};e.SubViews={CUR_FILE:"cur_file",OVERVIEW:"overview"},e.UserTCSyncState=d={SYNCED:"synced",PENDING:"pending"},e.reviewPanel={trackChangesState:{},trackChangesOnForEveryone:!1,trackChangesOnForGuests:!1,trackChangesForGuestsAvailable:!1,entries:{},resolvedComments:{},hasEntries:!1,subView:e.SubViews.CUR_FILE,openSubView:e.SubViews.CUR_FILE,overview:{loading:!1,docsCollapsedState:JSON.parse(u("docs_collapsed_state:".concat(e.project_id)))||{}},dropdown:{loading:!1},commentThreads:{},resolvedThreadIds:{},rendererData:{},formattedProjectMembers:{},fullTCStateCollapsed:!0,loadingThreads:!1,selectedEntryIds:[],nVisibleSelectedChanges:0},window.addEventListener("beforeunload",function(){var t={};for(var n in e.reviewPanel.overview.docsCollapsedState){var i=e.reviewPanel.overview.docsCollapsedState[n];i&&(t[n]=i)}var r=Object.keys(t).length>0?JSON.stringify(t):null;return u("docs_collapsed_state:".concat(e.project_id),r)}),e.$on("layout:pdf:linked",function(t,n){return e.$broadcast("review-panel:layout")}),e.$on("layout:pdf:resize",function(t,n){return e.$broadcast("review-panel:layout",!1)}),e.$on("expandable-text-area:resize",function(t){return s(function(){return e.$broadcast("review-panel:layout")})}),e.$on("review-panel:sizes",function(t,n){return e.$broadcast("editor:set-scroll-size",n)}),e.$watch("project.features.trackChangesVisible",function(t){return null!=t?t?void 0:e.ui.reviewPanelOpen=!1:void 0}),e.$watch("project.members",function(t){return e.reviewPanel.formattedProjectMembers={},null!=(null!=e.project?e.project.owner:void 0)&&(e.reviewPanel.formattedProjectMembers[e.project.owner._id]=J(e.project.owner)),null!=(null!=e.project?e.project.members:void 0)?function(){for(var n=[],i=0,r=Array.from(t);i<r.length;i++){var o=r[i];"readAndWrite"===o.privileges?n.push(e.reviewPanel.formattedProjectMembers[o._id]=J(o)):n.push(void 0)}return n}():void 0}),e.commentState={adding:!1,content:""},e.users={},e.reviewPanelEventsBridge=new t,o.socket.on("new-comment",function(t,n){var i=y(t);return delete i.submitting,i.messages.push(X(n)),e.$apply(),s(function(){return e.$broadcast("review-panel:layout")})}),o.socket.on("accept-changes",function(t,n){return t!==e.editor.open_doc_id?w(t).removeChangeIds(n):e.$broadcast("changes:accept",n),$(t),e.$apply(function(){})}),o.socket.on("resolve-thread",function(e,t){return R(e,t)}),o.socket.on("reopen-thread",function(e){return L(e)}),o.socket.on("delete-thread",function(t){return D(t),e.$apply(function(){})}),o.socket.on("edit-message",function(t,n,i){return F(t,n,i),e.$apply(function(){})}),o.socket.on("delete-message",function(t,n){return P(t,n),e.$apply(function(){})});var g={},m=function(t){return null==e.reviewPanel.entries[t]&&(e.reviewPanel.entries[t]={}),e.reviewPanel.entries[t]},v=function(t){return null==e.reviewPanel.resolvedComments[t]&&(e.reviewPanel.resolvedComments[t]={}),e.reviewPanel.resolvedComments[t]},y=function(t){return null==e.reviewPanel.commentThreads[t]&&(e.reviewPanel.commentThreads[t]={messages:[]}),e.reviewPanel.commentThreads[t]},w=function(t){return null==g[t]&&(g[t]=new i,g[t].resolvedThreadIds=e.reviewPanel.resolvedThreadIds),g[t]},b={};e.reviewPanelEventsBridge.on("aceScrollbarVisibilityChanged",function(e,t){return b={isVisible:e,scrollbarWidth:t},_()});var _=function(){return b.isVisible&&e.reviewPanel.subView===e.SubViews.CUR_FILE&&!e.editor.showRichText?h.css("right","".concat(b.scrollbarWidth,"px")):h.css("right","0")};e.$watch("!ui.reviewPanelOpen && reviewPanel.hasEntries",function(t,n){return null!=t?(e.ui.miniReviewPanelVisible=t,t!==n?s(function(){return e.$broadcast("review-panel:toggle")}):void 0):void 0}),e.$watch("ui.reviewPanelOpen",function(t){return null!=t?(t?e.reviewPanel.subView=e.reviewPanel.openSubView:(e.reviewPanel.openSubView=e.reviewPanel.subView,e.reviewPanel.subView=e.SubViews.CUR_FILE),s(function(){return e.$broadcast("review-panel:toggle"),e.$broadcast("review-panel:layout",!1)})):void 0}),e.$watch("reviewPanel.subView",function(t){return null!=t?(_(),t===e.SubViews.OVERVIEW?S():void 0):void 0}),e.$watch("editor.sharejs_doc",function(t,n){return null!=t?(g[t.doc_id]=t.ranges,g[t.doc_id].resolvedThreadIds=e.reviewPanel.resolvedThreadIds,e.reviewPanel.rangesTracker=g[t.doc_id],null!=n&&n.off("flipped_pending_to_inflight"),t.on("flipped_pending_to_inflight",function(){return C(t)}),C(t)):void 0}),e.$watch(function(){var t=e.reviewPanel.entries[e.editor.open_doc_id]||{},n={};for(var i in t){var r=t[i];["add-comment","bulk-actions"].includes(i)||(n[i]=r)}return Object.keys(n).length},function(t){return e.reviewPanel.hasEntries=t>0&&e.project.features.trackChangesVisible});var C=function(e){var t=w(e.doc_id).getIdSeed(),n=i.generateIdSeed();return w(e.doc_id).setIdSeed(n),e.setTrackChangesIdSeeds({pending:n,inflight:t})},k=function(){return a.get("/project/".concat(e.project_id,"/ranges")).then(function(t){var n=t.data;return function(){for(var t=[],i=0,r=Array.from(n);i<r.length;i++){var o=r[i];if(null==e.reviewPanel.overview.docsCollapsedState[o.id]&&(e.reviewPanel.overview.docsCollapsedState[o.id]=!1),o.id!==e.editor.open_doc_id){var s=w(o.id);s.comments=(null!=o.ranges?o.ranges.comments:void 0)||[],s.changes=(null!=o.ranges?o.ranges.changes:void 0)||[]}t.push($(o.id))}return t}()})},S=function(){return e.reviewPanel.overview.loading=!0,k().then(function(){return e.reviewPanel.overview.loading=!1})["catch"](function(){return e.reviewPanel.overview.loading=!1})};e.refreshResolvedCommentsDropdown=function(){e.reviewPanel.dropdown.loading=!0;var t=k();return t.then(function(){return e.reviewPanel.dropdown.loading=!1}),t["catch"](function(){return e.reviewPanel.dropdown.loading=!1}),t};var $=function(t){var n,i,r,o,s,a=w(t),l=m(t),c=v(t),u=!1,d={};for(var h in l)if(n=l[h],!["add-comment","bulk-actions"].includes(h))for(var f=0,p=Array.from(n.entry_ids);f<p.length;f++)i=p[f],d[i]=!0;for(h in c){n=c[h];for(var g=0,y=Array.from(n.entry_ids);g<y.length;g++)i=y[g],d[i]=!0}for(var b=!1,_=null,C=0,k=Array.from(a.changes);C<k.length;C++){if(n=k[C],u=!0,b&&n.op.d&&n.op.p===_.op.p+_.op.i.length&&n.metadata.user_id===_.metadata.user_id)l[_.id].type="aggregate-change",l[_.id].metadata.replaced_content=n.op.d,l[_.id].entry_ids.push(n.id);else{null==l[n.id]&&(l[n.id]={}),delete d[n.id],o={type:n.op.i?"insert":"delete",entry_ids:[n.id],content:n.op.i||n.op.d,offset:n.op.p,metadata:n.metadata};for(r in o)s=o[r],l[n.id][r]=s}n.op.i?(b=!0,_=n):(b=!1,_=null),null==e.users[n.metadata.user_id]&&G(n.metadata.user_id)}a.comments.length>0&&Y();for(var S=0,$=Array.from(a.comments);S<$.length;S++){var x,A=$[S];u=!0,delete d[A.id],e.reviewPanel.resolvedThreadIds[A.op.t]?(x=null!=c[A.id]?c[A.id]:c[A.id]={},delete l[A.id]):(x=null!=l[A.id]?l[A.id]:l[A.id]={},delete c[A.id]),o={type:"comment",thread_id:A.op.t,entry_ids:[A.id],content:A.op.c,offset:A.op.p};for(r in o)s=o[r],x[r]=s}for(var T in d){d[T];u=!0,delete l[T],delete c[T]}return u?e.$broadcast("entries:changed"):void 0};e.$on("editor:track-changes:changed",function(){var t=e.editor.open_doc_id;return $(t),e.editor.showRichText?void 0:(e.$broadcast("review-panel:recalculate-screen-positions"),e.$broadcast("review-panel:layout"))}),e.$on("editor:track-changes:visibility_changed",function(){return s(function(){return e.$broadcast("review-panel:layout",!1)})}),e.$on("editor:focus:changed",function(t,n,i,r){var o=e.editor.open_doc_id,s=m(o);e.reviewPanel.selectedEntryIds=[],e.reviewPanel.nVisibleSelectedChanges=0,delete s["add-comment"],delete s["bulk-actions"],r&&(s["add-comment"]={type:"add-comment",offset:n,length:i-n},s["bulk-actions"]={type:"bulk-actions",offset:n,length:i-n});for(var a in s){var l=s[a],c=!1;if("comment"!==l.type||e.reviewPanel.resolvedThreadIds[l.thread_id]?"insert"===l.type?(c=l.offset>=n&&l.offset+l.content.length<=i,l.focused=l.offset<=n&&n<=l.offset+l.content.length):"delete"===l.type?(c=n<=l.offset&&l.offset<=i,l.focused=l.offset===n):"aggregate-change"===l.type?(c=l.offset>=n&&l.offset+l.content.length<=i,l.focused=l.offset<=n&&n<=l.offset+l.content.length):["add-comment","bulk-actions"].includes(l.type)&&r&&(l.focused=!0):l.focused=l.offset<=n&&n<=l.offset+l.content.length,c){for(var u=0,d=Array.from(l.entry_ids);u<d.length;u++){var h=d[u];e.reviewPanel.selectedEntryIds.push(h)}e.reviewPanel.nVisibleSelectedChanges++}}return e.$broadcast("review-panel:recalculate-screen-positions"),e.$broadcast("review-panel:layout")}),e.acceptChanges=function(t){return x(t),c.sendMB("rp-changes-accepted",{view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini"})},e.rejectChanges=function(t){return A(t),c.sendMB("rp-changes-rejected",{view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini"})};var x=function(t){return a.post("/project/".concat(e.project_id,"/doc/").concat(e.editor.open_doc_id,"/changes/accept"),{change_ids:t,_csrf:window.csrfToken}),e.$broadcast("changes:accept",t)},A=function(t){return e.$broadcast("changes:reject",t)},T=function(){return x(e.reviewPanel.selectedEntryIds.slice()),c.sendMB("rp-bulk-accept",{view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini",nEntries:e.reviewPanel.nVisibleSelectedChanges})},E=function(){return A(e.reviewPanel.selectedEntryIds.slice()),c.sendMB("rp-bulk-reject",{view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini",nEntries:e.reviewPanel.nVisibleSelectedChanges})};e.showBulkAcceptDialog=function(){return M(!0)},e.showBulkRejectDialog=function(){return M(!1)};var M=function(t){return l.open({templateUrl:"bulkActionsModalTemplate",controller:"BulkActionsModalController",resolve:{isAccept:function(){return t},nChanges:function(){return e.reviewPanel.nVisibleSelectedChanges}},scope:e.$new()}).result.then(function(e){return e?T():E()})};e.handleTogglerClick=function(t){return t.target.blur(),e.toggleReviewPanel()},e.addNewComment=function(){return e.$broadcast("comment:start_adding"),e.toggleReviewPanel()},e.addNewCommentFromKbdShortcut=function(){return e.project.features.trackChangesVisible?(e.$broadcast("comment:select_line"),e.ui.reviewPanelOpen||e.toggleReviewPanel(),s(function(){return e.$broadcast("review-panel:layout"),e.$broadcast("comment:start_adding")})):void 0},e.startNewComment=function(){return e.$broadcast("comment:select_line"),s(function(){return e.$broadcast("review-panel:layout")})},e.submitNewComment=function(t){if(null!=t&&""!==t){var n=e.editor.open_doc_id,r=m(n);if(null!=r["add-comment"]){var l=r["add-comment"],u=l.offset,d=l.length,h=i.generateId(),f=y(h);return f.submitting=!0,e.$broadcast("comment:add",h,u,d),a.post("/project/".concat(e.project_id,"/thread/").concat(h,"/messages"),{content:t,_csrf:window.csrfToken})["catch"](function(){return o.showGenericMessageModal("Error submitting comment","Sorry, there was a problem submitting your comment")}),e.$broadcast("editor:clearSelection"),s(function(){return e.$broadcast("review-panel:layout")}),c.sendMB("rp-new-comment",{size:t.length})}}},e.cancelNewComment=function(t){return s(function(){return e.$broadcast("review-panel:layout")})},e.startReply=function(t){return t.replying=!0,s(function(){return e.$broadcast("review-panel:layout")})},e.submitReply=function(t,n){var i=t.thread_id,r=t.replyContent;a.post("/project/".concat(e.project_id,"/thread/").concat(i,"/messages"),{content:r,_csrf:window.csrfToken})["catch"](function(){return o.showGenericMessageModal("Error submitting comment","Sorry, there was a problem submitting your comment")});var l={view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini",size:t.replyContent.length,thread:i},u=y(i);return u.submitting=!0,t.replyContent="",t.replying=!1,s(function(){return e.$broadcast("review-panel:layout")}),c.sendMB("rp-comment-reply",l)},e.cancelReply=function(t){return t.replying=!1,t.replyContent="",e.$broadcast("review-panel:layout")},e.resolveComment=function(t,n){return t.focused=!1,a.post("/project/".concat(e.project_id,"/thread/").concat(t.thread_id,"/resolve"),{_csrf:window.csrfToken}),R(t.thread_id,o.$scope.user),c.sendMB("rp-comment-resolve",{view:e.ui.reviewPanelOpen?e.reviewPanel.subView:"mini"})},e.unresolveComment=function(t){return L(t),a.post("/project/".concat(e.project_id,"/thread/").concat(t,"/reopen"),{_csrf:window.csrfToken}),c.sendMB("rp-comment-reopen")};var R=function(t,n){var i=y(t);if(null!=i)return i.resolved=!0,i.resolved_by_user=J(n),i.resolved_at=(new Date).toISOString(),e.reviewPanel.resolvedThreadIds[t]=!0,e.$broadcast("comment:resolve_threads",[t])},L=function(t){var n=y(t);if(null!=n)return delete n.resolved,delete n.resolved_by_user,delete n.resolved_at,delete e.reviewPanel.resolvedThreadIds[t],e.$broadcast("comment:unresolve_thread",t)},D=function(t){return delete e.reviewPanel.resolvedThreadIds[t],delete e.reviewPanel.commentThreads[t],e.$broadcast("comment:remove",t)},F=function(e,t,n){var i=y(e);if(null!=i){for(var r=0,o=Array.from(i.messages);r<o.length;r++){var s=o[r];s.id===t&&(s.content=n)}return $()}},P=function(e,t){var n=y(e);if(null!=n)return n.messages=n.messages.filter(function(e){return e.id!==t}),$()};e.deleteThread=function(t,n,i){return D(i),a({method:"DELETE",url:"/project/".concat(e.project_id,"/doc/").concat(n,"/thread/").concat(i),headers:{"X-CSRF-Token":window.csrfToken}}),c.sendMB("rp-comment-delete")},e.saveEdit=function(t,n){return a.post("/project/".concat(e.project_id,"/thread/").concat(t,"/messages/").concat(n.id,"/edit"),{content:n.content,_csrf:window.csrfToken}),s(function(){return e.$broadcast("review-panel:layout")})},e.deleteComment=function(t,n){return P(t,n.id),a({method:"DELETE",url:"/project/".concat(e.project_id,"/thread/").concat(t,"/messages/").concat(n.id),headers:{"X-CSRF-Token":window.csrfToken}}),s(function(){return e.$broadcast("review-panel:layout")})},e.setSubView=function(t){return e.reviewPanel.subView=t,c.sendMB("rp-subview-change",{subView:t})},e.gotoEntry=function(e,t){return o.editorManager.openDocId(e,{gotoOffset:t.offset})},e.toggleFullTCStateCollapse=function(){return e.project.features.trackChanges?e.reviewPanel.fullTCStateCollapsed=!e.reviewPanel.fullTCStateCollapsed:(I(),e.openTrackChangesUpgradeModal())};var I=function(){c.send("subscription-funnel","editor-click-feature","real-time-track-changes")},q=function(t,n,i){null==i&&(i=!1),null==e.reviewPanel.trackChangesState[t]&&(e.reviewPanel.trackChangesState[t]={});var r=e.reviewPanel.trackChangesState[t];return null==r.syncState||r.syncState===d.SYNCED?(r.value=n,r.syncState=d.SYNCED):r.syncState===d.PENDING&&r.value===n?r.syncState=d.SYNCED:i&&(r.value=n,r.syncState=d.PENDING),t===o.$scope.user.id?e.editor.wantTrackChanges=n:void 0},O=function(t,n){null==n&&(n=!1),e.reviewPanel.trackChangesOnForEveryone=t;for(var i=e.project,r=0,o=Array.from(i.members);r<o.length;r++){var s=o[r];q(s._id,t,n)}return B(t,n),q(i.owner._id,t,n)},B=function(t,n){return null==n&&(n=!1),e.reviewPanel.trackChangesOnForGuests=t,p()===f.GUEST||p()===f.ANONYMOUS?e.editor.wantTrackChanges=t:void 0},H=function(){var t={};if(e.reviewPanel.trackChangesOnForEveryone)t.on=!0;else{t.on_for={};for(var n in e.reviewPanel.trackChangesState){var i=e.reviewPanel.trackChangesState[n];t.on_for[n]=i.value}e.reviewPanel.trackChangesOnForGuests&&(t.on_for_guests=!0)}return t._csrf=window.csrfToken,a.post("/project/".concat(e.project_id,"/track_changes"),t)},N=function(t){if("boolean"==typeof t)return O(t),B(t);var n=e.project;e.reviewPanel.trackChangesOnForEveryone=!1,B(t.__guests__===!0);for(var i=0,r=Array.from(n.members);i<r.length;i++){var o=r[i];q(o._id,null!=t[o._id]?t[o._id]:!1)}return q(e.project.owner._id,null!=t[e.project.owner._id]?t[e.project.owner._id]:!1)};e.toggleTrackChangesForEveryone=function(e){return O(e,!0),B(e,!0),H()},e.toggleTrackChangesForGuests=function(e){return B(e,!0),H()},e.toggleTrackChangesForUser=function(e,t){return q(t,e,!0),H()},o.socket.on("toggle-track-changes",function(t){return e.$apply(function(){return N(t)})}),e.toggleTrackChangesFromKbdShortcut=function(){return e.project.features.trackChangesVisible&&e.project.features.trackChanges?e.toggleTrackChangesForUser(!e.reviewPanel.trackChangesState[o.$scope.user.id].value,o.$scope.user.id):void 0};var z=function(t){return e.reviewPanel.trackChangesForGuestsAvailable="tokenBased"===t},U=function(t){return t||!e.reviewPanel.trackChangesOnForGuests||e.reviewPanel.trackChangesOnForEveryone?void 0:e.toggleTrackChangesForGuests(!1)};e.$watch("project.publicAccesLevel",z),e.$watch("reviewPanel.trackChangesForGuestsAvailable",function(e){return null!=e?U(e):void 0});var j=!1;o.$scope.$on("project:joined",function(){if(!j){var e=o.$scope.project;return e.features.trackChanges?(null==window.trackChangesState&&(window.trackChangesState=!1),N(window.trackChangesState)):N(!1),z(e.publicAccesLevel),j=!0}});var W=!1,V={},G=function(t){if(null!=t){if(null!=V[t])return;V[t]=!0}if(!W)return W=!0,a.get("/project/".concat(e.project_id,"/changes/users")).then(function(t){var n=t.data;return W=!1,e.users={},null!=(null!=o.$scope.user?o.$scope.user.id:void 0)&&(e.users[o.$scope.user.id]=J(o.$scope.user)),function(){for(var t=[],i=0,r=Array.from(n);i<r.length;i++){var o=r[i];null!=o.id?t.push(e.users[o.id]=J(o)):t.push(void 0)}return t}()})["catch"](function(){return W=!1})},K=!1,Y=function(){return K?void 0:(K=!0,e.reviewPanel.loadingThreads=!0,a.get("/project/".concat(e.project_id,"/threads")).then(function(t){var n=t.data;e.reviewPanel.loadingThreads=!1;for(var i in e.reviewPanel.resolvedThreadIds){e.reviewPanel.resolvedThreadIds[i];delete e.reviewPanel.resolvedThreadIds[i]}for(i in n){for(var r=n[i],o=0,a=Array.from(r.messages);o<a.length;o++){var l=a[o];X(l)}null!=r.resolved_by_user&&(r.resolved_by_user=J(r.resolved_by_user),e.reviewPanel.resolvedThreadIds[i]=!0,e.$broadcast("comment:resolve_threads",[i]))}return e.reviewPanel.commentThreads=n,s(function(){return e.$broadcast("review-panel:layout")})}))},X=function(e){return e.user=J(e.user),e.timestamp=new Date(e.timestamp),e},J=function(e){var t,i,r=(null!=e?e._id:void 0)||(null!=e?e.id:void 0);return null==r?{email:null,name:"Anonymous",isSelf:!1,hue:n.ANONYMOUS_HUE,avatar_text:"A"}:(r===window.user_id?(i="You",t=!0):(i=[e.first_name,e.last_name].filter(function(e){return null!=e&&""!==e}).join(" "),""===i&&(i=(null!=e.email?e.email.split("@")[0]:void 0)||"Unknown"),t=!1),{id:r,email:e.email,name:i,isSelf:t,hue:n.getHueForUserId(r),avatar_text:[e.first_name,e.last_name].filter(function(e){return null!=e}).map(function(e){return e[0]}).join("")})};return e.openTrackChangesUpgradeModal=function(){return l.open({templateUrl:"trackChangesUpgradeModalTemplate",controller:"TrackChangesUpgradeModalController",scope:e.$new()})}}])}),define("ide/review-panel/controllers/TrackChangesUpgradeModalController",["base"],function(e){return e.controller("TrackChangesUpgradeModalController",["$scope","$modalInstance",function(e,t){return e.cancel=function(){return t.dismiss()}}])}),define("ide/review-panel/controllers/BulkActionsModalController",["base"],function(e){return e.controller("BulkActionsModalController",["$scope","$modalInstance","isAccept","nChanges",function(e,t,n,i){return e.isAccept=n,e.nChanges=i,e.cancel=function(){return t.dismiss()},e.confirm=function(){return t.close(n)}}])}),define("ide/review-panel/directives/reviewPanelSorted",["base"],function(e){return e.directive("reviewPanelSorted",["$timeout",function(e){return{link:function(e,t,n){var i=0,r=function(n){var r,o,s,a,l,c,u,d,h;null==n&&(n=!0),n?t.removeClass("no-animate"):t.addClass("no-animate"),e.ui.reviewPanelOpen?(u=8,d=38,c=57):(u=4,d=4,c=0);for(var f=[],p=0,g=Array.from(t.find(".rp-entry-wrapper"));p<g.length;p++){var m=g[p];r={$indicator_el:$(m).find(".rp-entry-indicator"),$box_el:$(m).find(".rp-entry"),$callout_el:$(m).find(".rp-entry-callout"),scope:angular.element(m).scope()},e.ui.reviewPanelOpen?r.$layout_el=r.$box_el:r.$layout_el=r.$indicator_el,r.height=r.$layout_el.height(),f.push(r)}if(f.sort(function(e,t){return e.scope.entry.offset-t.scope.entry.offset}),0!==f.length){var v=e.reviewPanel.rendererData.lineHeight,y=Math.min(i,f.length-1);for(s=0;s<f.length;s++)if(r=f[s],r.scope.entry.focused){y=s;break}var w=f.slice(y+1),b=f.slice(0,y),_=f[y];i=y,sl_console.log("focused_entry_index",y);var C=function(e,t,n){return n>=t?(e.removeClass("rp-entry-callout-inverted"),e.css({top:t+v-1,height:n-t})):(e.addClass("rp-entry-callout-inverted"),e.css({top:n+v,height:t-n}))},k=Math.max(_.scope.entry.screenPos.y,d);_.$box_el.css({top:k,visibility:"visible"}),_.$indicator_el.css({top:k}),C(_.$callout_el,_.scope.entry.screenPos.y,k);for(var S=k+_.$layout_el.height(),x=0,A=Array.from(w);x<A.length;x++){r=A[x],a=r.scope.entry.screenPos.y;var T=r;o=T.height,h=Math.max(a,S+u),S=h+o,r.$box_el.css({top:h,visibility:"visible"}),r.$indicator_el.css({top:h}),C(r.$callout_el,a,h),sl_console.log("ENTRY",{entry:r.scope.entry,top:h})}var E=k;for(b.reverse(),s=0;s<b.length;s++){r=b[s],a=r.scope.entry.screenPos.y;var M=r;o=M.height;var R=a+o,L=Math.min(R,E-u);h=L-o,E=h,r.$box_el.css({top:h,visibility:"visible"}),r.$indicator_el.css({top:h}),C(r.$callout_el,a,h),sl_console.log("ENTRY",{entry:r.scope.entry,top:h})}var D=h;return l=d>D?-D+d:0,e.$emit("review-panel:sizes",{overflowTop:l,height:S+c})}};e.$applyAsync(function(){return r()}),e.$on("review-panel:layout",function(t,n){return null==n&&(n=!0),e.$applyAsync(function(){return r(n)})}),e.$watch("reviewPanel.rendererData.lineHeight",function(){return r()});var o=t,s=t.find(".rp-entry-list-inner");ace.require("ace/lib/event").addMouseWheelListener(o[0],function(e){var t=e.wheelY,n=parseInt(s.css("top")),i=n-4*t;return c(-i),e.preventDefault()});var a=!1,l=function(e,t){if(a)return a=!1;return s.height(t),s.css({top:-e})},c=function(t){return e.reviewPanelEventsBridge.emit("externalScroll",t)};return e.reviewPanelEventsBridge.on("aceScroll",l),e.$on("$destroy",function(){return e.reviewPanelEventsBridge.off("aceScroll")}),e.reviewPanelEventsBridge.emit("refreshScrollPosition")}}}])}),define("ide/review-panel/directives/reviewPanelToggle",["base"],function(e){return e.directive("reviewPanelToggle",function(){return{restrict:"E",scope:{onToggle:"&",ngModel:"=",valWhenUndefined:"=?",isDisabled:"=?",onDisabledClick:"&?",description:"@"},link:function(e){return null==e.disabled&&(e.disabled=!1),e.onChange=function(){return e.onToggle({isOn:e.localModel})},e.handleClick=function(){return e.disabled&&null!=e.onDisabledClick?e.onDisabledClick():void 0},e.localModel=e.ngModel,e.$watch("ngModel",function(t){return null!=e.valWhenUndefined&&null==t&&(t=e.valWhenUndefined),e.localModel=t})},template:'<fieldset class="rp-toggle" ng-click="handleClick();">\n  <legend class="sr-only">{{description}}</legend>\n  <input id="rp-toggle-{{$id}}" ng-disabled="isDisabled" type="checkbox" class="rp-toggle-hidden-input" ng-model="localModel" ng-change="onChange()" />\n  <label for="rp-toggle-{{$id}}" class="rp-toggle-btn"></label>\n</fieldset>'}})}),define("ide/review-panel/directives/changeEntry",["base"],function(e){return e.directive("changeEntry",["$timeout",function(e){return{restrict:"E",templateUrl:"changeEntryTemplate",
scope:{entry:"=",user:"=",permissions:"=",onAccept:"&",onReject:"&",onIndicatorClick:"&",onBodyClick:"&"},link:function(t,n,i){return t.contentLimit=40,t.isCollapsed=!0,t.needsCollapsing=!1,n.on("click",function(e){return $(e.target).is(".rp-entry, .rp-entry-description, .rp-entry-body, .rp-entry-action-icon i")?t.onBodyClick():void 0}),t.toggleCollapse=function(){return t.isCollapsed=!t.isCollapsed,e(function(){return t.$emit("review-panel:layout")})},t.$watch("entry.content.length",function(e){return t.needsCollapsing=e>t.contentLimit})}}}])}),define("ide/review-panel/directives/aggregateChangeEntry",["base"],function(e){return e.directive("aggregateChangeEntry",["$timeout",function(e){return{restrict:"E",templateUrl:"aggregateChangeEntryTemplate",scope:{entry:"=",user:"=",permissions:"=",onAccept:"&",onReject:"&",onIndicatorClick:"&",onBodyClick:"&"},link:function(t,n,i){return t.contentLimit=17,t.isDeletionCollapsed=!0,t.isInsertionCollapsed=!0,t.deletionNeedsCollapsing=!1,t.insertionNeedsCollapsing=!1,n.on("click",function(e){return $(e.target).is(".rp-entry, .rp-entry-description, .rp-entry-body, .rp-entry-action-icon i")?t.onBodyClick():void 0}),t.toggleDeletionCollapse=function(){return t.isDeletionCollapsed=!t.isDeletionCollapsed,e(function(){return t.$emit("review-panel:layout")})},t.toggleInsertionCollapse=function(){return t.isInsertionCollapsed=!t.isInsertionCollapsed,e(function(){return t.$emit("review-panel:layout")})},t.$watch("entry.metadata.replaced_content.length",function(e){return t.deletionNeedsCollapsing=e>t.contentLimit}),t.$watch("entry.content.length",function(e){return t.insertionNeedsCollapsing=e>t.contentLimit})}}}])}),define("ide/review-panel/directives/commentEntry",["base"],function(e){return e.directive("commentEntry",["$timeout",function(e){return{restrict:"E",templateUrl:"commentEntryTemplate",scope:{entry:"=",threads:"=",permissions:"=",onResolve:"&",onReply:"&",onIndicatorClick:"&",onSaveEdit:"&",onDelete:"&",onBodyClick:"&"},link:function(t,n,i){return t.state={animating:!1},n.on("click",function(e){return $(e.target).is(".rp-entry, .rp-comment-loaded, .rp-comment-content, .rp-comment-reply, .rp-entry-metadata")?t.onBodyClick():void 0}),t.handleCommentReplyKeyPress=function(e){return 13===e.keyCode&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),t.entry.replyContent.length>0)?(e.target.blur(),t.onReply()):void 0},t.animateAndCallOnResolve=function(){return t.state.animating=!0,n.find(".rp-entry").css("top",0),e(function(){return t.onResolve()},350),!0},t.startEditing=function(e){return e.editing=!0,setTimeout(function(){return t.$emit("review-panel:layout")})},t.saveEdit=function(e){return e.editing=!1,t.onSaveEdit({comment:e})},t.confirmDelete=function(e){return e.deleting=!0,setTimeout(function(){return t.$emit("review-panel:layout")})},t.cancelDelete=function(e){return e.deleting=!1,setTimeout(function(){return t.$emit("review-panel:layout")})},t.doDelete=function(e){return e.deleting=!1,t.onDelete({comment:e})},t.saveEditOnEnter=function(e,n){return 13!==e.keyCode||e.shiftKey||e.ctrlKey||e.metaKey?void 0:(e.preventDefault(),t.saveEdit(n))}}}}])}),define("ide/review-panel/directives/addCommentEntry",["base"],function(e){return e.directive("addCommentEntry",function(){return{restrict:"E",templateUrl:"addCommentEntryTemplate",scope:{onStartNew:"&",onSubmit:"&",onCancel:"&"},link:function(e,t,n){return e.state={isAdding:!1,content:""},e.$on("comment:start_adding",function(){return e.startNewComment()}),e.startNewComment=function(){return e.state.isAdding=!0,e.onStartNew(),setTimeout(function(){return e.$broadcast("comment:new:open")})},e.cancelNewComment=function(){return e.state.isAdding=!1,e.onCancel()},e.handleCommentKeyPress=function(t){return 13===t.keyCode&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey&&(t.preventDefault(),e.state.content.length>0)?e.submitNewComment():void 0},e.submitNewComment=function(t){return null!=t&&"blur"===t.type&&($(t.relatedTarget).hasClass("rp-entry-button-cancel")||$(t.originalEvent.explicitOriginalTarget).hasClass("rp-entry-button-cancel"))?!0:(e.onSubmit({content:e.state.content}),e.state.isAdding=!1,e.state.content="")}}}})}),define("ide/review-panel/directives/bulkActionsEntry",["base"],function(e){return e.directive("bulkActionsEntry",function(){return{restrict:"E",templateUrl:"bulkActionsEntryTemplate",scope:{onBulkAccept:"&",onBulkReject:"&",nEntries:"="},link:function(e,t,n){return e.bulkAccept=function(){return e.onBulkAccept()},e.bulkReject=function(){return e.onBulkReject()}}}})}),define("ide/review-panel/directives/resolvedCommentEntry",["base"],function(e){return e.directive("resolvedCommentEntry",function(){return{restrict:"E",templateUrl:"resolvedCommentEntryTemplate",scope:{thread:"=",permissions:"=",onUnresolve:"&",onDelete:"&"},link:function(e,t,n){return e.contentLimit=40,e.needsCollapsing=!1,e.isCollapsed=!0,e.toggleCollapse=function(){return e.isCollapsed=!e.isCollapsed},e.$watch("thread.content.length",function(t){return e.needsCollapsing=t>e.contentLimit})}}})}),define("ide/review-panel/directives/resolvedCommentsDropdown",["base"],function(e){return e.directive("resolvedCommentsDropdown",["_",function(e){return{restrict:"E",templateUrl:"resolvedCommentsDropdownTemplate",scope:{entries:"=",threads:"=",resolvedIds:"=",docs:"=",permissions:"=",onOpen:"&",onUnresolve:"&",onDelete:"&",isLoading:"="},link:function(t,n,i){var r;t.state={isOpen:!1},t.toggleOpenState=function(){return t.state.isOpen=!t.state.isOpen,t.state.isOpen?t.onOpen().then(function(){return r()}):void 0},t.resolvedComments=[],t.handleUnresolve=function(e){return t.onUnresolve({threadId:e}),t.resolvedComments=t.resolvedComments.filter(function(t){return t.threadId!==e})},t.handleDelete=function(e,n,i){return t.onDelete({entryId:e,docId:n,threadId:i}),t.resolvedComments=t.resolvedComments.filter(function(e){return e.threadId!==i})};var o=function(n){var i=e.find(t.docs,function(e){return e.doc.id===n});return null!=i?i.path:null};return r=function(){return t.resolvedComments=[],function(){var e=[];for(var n in t.entries){var i=t.entries[n];e.push(function(){var e=[];for(var r in i){var s=i[r];if("comment"===s.type&&null!=(null!=t.threads[s.thread_id]?t.threads[s.thread_id].resolved:void 0)){var a=angular.copy(t.threads[s.thread_id]);a.content=s.content,a.threadId=s.thread_id,a.entryId=r,a.docId=n,a.docName=o(n),e.push(t.resolvedComments.push(a))}else e.push(void 0)}return e}())}return e}()}}}}])}),define("ide/review-panel/directives/reviewPanelCollapseHeight",["base"],function(e){return e.directive("reviewPanelCollapseHeight",["$parse",function(e){return{restrict:"A",link:function(t,n,i){return t.$watch(function(){return e(i.reviewPanelCollapseHeight)(t)},function(e){var t=n.prop("scrollHeight");return t>0?e?n.animate({height:0},150):n.animate({height:t},150):e?n.height(0):void 0})}}}])}),define("ide/review-panel/filters/notEmpty",["base"],function(e){return app.filter("notEmpty",function(){return function(e){return!angular.equals({},e)}})}),define("ide/review-panel/filters/numKeys",["base"],function(e){return app.filter("numKeys",function(){return function(e){return null!=e?Object.keys(e).length:0}})}),define("ide/review-panel/filters/orderOverviewEntries",["base"],function(e){return e.filter("orderOverviewEntries",function(){return function(e){var t=[];for(var n in e){var i=e[n];i.entry_id=n,t.push(i)}return t.sort(function(e,t){return e.offset-t.offset}),t}})}),define("ide/review-panel/ReviewPanelManager",["ide/review-panel/controllers/ReviewPanelController","ide/review-panel/controllers/TrackChangesUpgradeModalController","ide/review-panel/controllers/BulkActionsModalController","ide/review-panel/directives/reviewPanelSorted","ide/review-panel/directives/reviewPanelToggle","ide/review-panel/directives/changeEntry","ide/review-panel/directives/aggregateChangeEntry","ide/review-panel/directives/commentEntry","ide/review-panel/directives/addCommentEntry","ide/review-panel/directives/bulkActionsEntry","ide/review-panel/directives/resolvedCommentEntry","ide/review-panel/directives/resolvedCommentsDropdown","ide/review-panel/directives/reviewPanelCollapseHeight","ide/review-panel/filters/notEmpty","ide/review-panel/filters/numKeys","ide/review-panel/filters/orderOverviewEntries"],function(){}),define("ide/SafariScrollPatcher",[],function(){var e;return e=function t(e){var n=this;_classCallCheck(this,t),this.isOverAce=!1,this.pdfDiv=null,this.aceDiv=null,this.handlePdfDivMouseLeave=function(){return n.pdfDiv.addEventListener("wheel",n.dispatchToAce)},this.handlePdfDivMouseEnter=function(){return n.pdfDiv.removeEventListener("wheel",n.dispatchToAce)},this.handleAceDivMouseLeave=function(){return n.isOverAce=!1},this.handleAceDivMouseEnter=function(){return n.isOverAce=!0},this.setListeners=function(){return n.isOverAce=!1,null!=n.pdfDiv&&(n.pdfDiv.removeEventListener(n.handlePdfDivMouseLeave),n.pdfDiv.removeEventListener(n.handlePdfDivMouseEnter)),null!=n.aceDiv&&(n.aceDiv.removeEventListener(n.handleAceDivMouseLeave),n.aceDiv.removeEventListener(n.handleAceDivMouseEnter)),n.pdfDiv=document.querySelector(".pdfjs-viewer"),n.aceDiv=document.querySelector(".ace_content"),n.pdfDiv.addEventListener("mouseleave",n.handlePdfDivMouseLeave),n.pdfDiv.addEventListener("mouseenter",n.handlePdfDivMouseEnter),n.aceDiv.addEventListener("mouseleave",n.handleAceDivMouseLeave),n.aceDiv.addEventListener("mouseenter",n.handleAceDivMouseEnter)},this.dispatchToAce=function(e){return n.isOverAce?(window.setTimeout(function(){return n.aceDiv.dispatchEvent(e)},1),e.preventDefault()):void 0},e.$on("loaded",function(){return n.setListeners()})}}),define("ide/cobranding/CobrandingDataService",["base"],function(e){var t=window.brandVariation;return e.factory("CobrandingDataService",function(){var e=function(){return null!=t},n=function(){return null!=t?t.logo_url:void 0},i=function(){return null!=t?t.submit_button_html:void 0},r=function(){return null!=t?t.name:void 0},o=function(){return null!=t?t.home_url:void 0},s=function(){return null!=t?t.publish_guide_html:void 0},a=function(){return null!=t?t.partner:void 0},l=function(){return null!=t?t.branded_menu:void 0},c=function(){return null!=t?t.brand_id:void 0},u=function(){return null!=t?t.id:void 0};return{isProjectCobranded:e,getLogoImgUrl:n,getSubmitBtnHtml:i,getBrandVariationName:r,getBrandVariationHomeUrl:o,getPublishGuideHtml:s,getPartner:a,hasBrandedMenu:l,getBrandId:c,getBrandVariationId:u}})}),define("ide/settings/services/settings",["base"],function(e){return e.factory("settings",["ide","event_tracking",function(e,t){return{saveSettings:function(n){for(var i=0,r=Array.from(Object.keys(n));i<r.length;i++){var o=r[i],s=o,a=n[o];t.sendMB("setting-changed",{changedSetting:s,changedSettingVal:a})}return n._csrf=window.csrfToken,e.$http.post("/user/settings",n)},saveProjectSettings:function(n){for(var i=0,r=Array.from(Object.keys(n));i<r.length;i++){var o=r[i],s=o,a=n[o];t.sendMB("project-setting-changed",{changedSetting:s,changedSettingVal:a})}return n._csrf=window.csrfToken,e.$http.post("/project/".concat(e.project_id,"/settings"),n)},saveProjectAdminSettings:function(n){for(var i=0,r=Array.from(Object.keys(n));i<r.length;i++){var o=r[i],s=o,a=n[o];t.sendMB("project-admin-setting-changed",{changedSetting:s,changedSettingVal:a})}return n._csrf=window.csrfToken,e.$http.post("/project/".concat(e.project_id,"/settings/admin"),n)}}}])}),define("ide/settings/controllers/SettingsController",["base"],function(e){return e.controller("SettingsController",["$scope","settings","ide","_",function(e,t,n,i){var r=this;e.overallThemesList=window.overallThemes,e.ui={loadingStyleSheet:!1};var o=function(t){e.ui.loadingStyleSheet=!0;var n=document.querySelector("head"),i=document.getElementById("main-stylesheet"),r=document.createElement("link");return r.addEventListener("load",function(t){return e.$applyAsync(function(){return e.ui.loadingStyleSheet=!1,n.removeChild(i)})}),r.setAttribute("rel","stylesheet"),r.setAttribute("id","main-stylesheet"),r.setAttribute("href",t.path),n.appendChild(r)};return["default","vim","emacs"].includes(e.settings.mode)||(e.settings.mode="default"),["pdfjs","native"].includes(e.settings.pdfViewer)||(e.settings.pdfViewer="pdfjs"),null==e.settings.fontFamily||["monaco","lucida"].includes(e.settings.fontFamily)||delete e.settings.fontFamily,null==e.settings.lineHeight||["compact","normal","wide"].includes(e.settings.lineHeight)||delete e.settings.lineHeight,e.fontSizeAsStr=function(t){return null!=t&&(e.settings.fontSize=t),e.settings.fontSize.toString()},e.$watch("settings.editorTheme",function(e,n){return e!==n?t.saveSettings({editorTheme:e}):void 0}),e.$watch("settings.overallTheme",function(n,r){if(n!==r){var s=i.find(e.overallThemesList,function(e){return e.val===n});if(null!=s)return o(s),t.saveSettings({overallTheme:n})}}),e.$watch("settings.fontSize",function(e,n){return e!==n?t.saveSettings({fontSize:parseInt(e,10)}):void 0}),e.$watch("settings.mode",function(e,n){return e!==n?t.saveSettings({mode:e}):void 0}),e.$watch("settings.autoComplete",function(e,n){return e!==n?t.saveSettings({autoComplete:e}):void 0}),e.$watch("settings.autoPairDelimiters",function(e,n){return e!==n?t.saveSettings({autoPairDelimiters:e}):void 0}),e.$watch("settings.pdfViewer",function(e,n){return e!==n?t.saveSettings({pdfViewer:e}):void 0}),e.$watch("settings.syntaxValidation",function(e,n){return e!==n?t.saveSettings({syntaxValidation:e}):void 0}),e.$watch("settings.fontFamily",function(e,n){return e!==n?t.saveSettings({fontFamily:e}):void 0}),e.$watch("settings.lineHeight",function(e,n){return e!==n?t.saveSettings({lineHeight:e}):void 0}),e.$watch("project.spellCheckLanguage",function(e,n){return r.ignoreUpdates?void 0:null!=n&&e!==n?(t.saveProjectSettings({spellCheckLanguage:e}),t.saveSettings({spellCheckLanguage:e})):void 0}),e.$watch("project.compiler",function(e,n){return r.ignoreUpdates?void 0:null!=n&&e!==n?t.saveProjectSettings({compiler:e}):void 0}),e.$watch("project.imageName",function(e,n){return r.ignoreUpdates?void 0:null!=n&&e!==n?t.saveProjectSettings({imageName:e}):void 0}),e.$watch("project.rootDoc_id",function(e,n){return r.ignoreUpdates||"undefined"==typeof n?void 0:e!==n?t.saveProjectSettings({rootDocId:e}):void 0}),n.socket.on("compilerUpdated",function(t){return r.ignoreUpdates=!0,e.$apply(function(){return e.project.compiler=t}),delete r.ignoreUpdates}),n.socket.on("imageNameUpdated",function(t){return r.ignoreUpdates=!0,e.$apply(function(){return e.project.imageName=t}),delete r.ignoreUpdates}),n.socket.on("spellCheckLanguageUpdated",function(t){return r.ignoreUpdates=!0,e.$apply(function(){return e.project.spellCheckLanguage=t}),delete r.ignoreUpdates})}])}),define("ide/settings/controllers/ProjectNameController",["base"],function(e){return e.controller("ProjectNameController",["$scope","$element","settings","ide",function(e,t,n,i){var r=t.find(".name")[0];return e.state={renaming:!1,overflowed:!1},e.inputs={},e.startRenaming=function(){return e.inputs.name=e.project.name,e.state.renaming=!0,e.$emit("project:rename:start")},e.finishRenaming=function(){e.state.renaming=!1;var t=e.inputs.name;if(e.project.name!==t){var r=e.project.name;return e.project.name=t,n.saveProjectSettings({name:e.project.name})["catch"](function(t){var n=t.data,o=t.status;return e.project.name=r,400===o?i.showGenericMessageModal("Error renaming project",n):i.showGenericMessageModal("Error renaming project","Please try again in a moment")})}},i.socket.on("projectNameUpdated",function(t){return e.$apply(function(){return e.project.name=t})}),e.$watch("project.name",function(t){return null!=t?(window.document.title=t+" - Online LaTeX Editor ".concat(ExposedSettings.appName),e.$applyAsync(function(){return e.state.overflowed=r.scrollWidth>r.clientWidth})):void 0})}])}),define("ide/settings/index",["ide/settings/services/settings","ide/settings/controllers/SettingsController","ide/settings/controllers/ProjectNameController"],function(){}),define("ide/share/controllers/ShareController",["base"],function(e){return e.controller("ShareController",["$scope","$modal","ide","projectInvites","projectMembers","event_tracking",function(e,t,n,i,r,o){return e.openShareProjectModal=function(n){return e.isAdmin=n,o.sendMBOnce("ide-open-share-modal-once"),t.open({templateUrl:"shareProjectModalTemplate",controller:"ShareProjectModalController",scope:e})},n.socket.on("project:tokens:changed",function(t){return null!=t.tokens?(n.$scope.project.tokens=t.tokens,e.$digest()):void 0}),n.socket.on("project:membership:changed",function(t){return t.members&&r.getMembers().then(function(n){return t=n.data,t.members?e.project.members=t.members:void 0})["catch"](function(){return console.error("Error fetching members for project")}),t.invites?i.getInvites().then(function(n){return t=n.data,t.invites?e.project.invites=t.invites:void 0})["catch"](function(){return console.error("Error fetching invites for project")}):void 0})}])}),define("ide/share/controllers/ShareProjectModalController",["base"],function(e){return e.controller("ShareProjectModalController",["$scope","$modalInstance","$timeout","projectMembers","projectInvites","$modal","$http","ide","validateCaptcha","validateCaptchaV3","settings","event_tracking",function(e,t,n,i,r,o,s,a,l,c,u,d){var h;e.inputs={privileges:"readAndWrite",contacts:[]},e.state={error:null,errorReason:null,inflight:!1,startedFreeTrial:!1,invites:[]},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)});var f=-1;e.refreshCanAddCollaborators=function(){var t=e.project.features.collaborators;return e.canAddCollaborators=e.project.members.length+e.project.invites.length<t||t===f},e.refreshCanAddCollaborators(),e.$watch("canAddCollaborators",function(){e.canAddCollaborators||d.send("subscription-funnel","editor-click-feature","projectMembers")}),e.$watch("(project.members.length + project.invites.length)",function(t){return e.refreshCanAddCollaborators()}),e.autocompleteContacts=[],(h=function(){return s.get("/user/contacts").then(function(t){var n=t.data;return e.autocompleteContacts=n.contacts||[],function(){for(var t=[],n=0,i=Array.from(e.autocompleteContacts);n<i.length;n++){var r=i[n];"user"===r.type?r.first_name!==r.email.split("@")[0]||r.last_name?(r.name="".concat(r.first_name," ").concat(r.last_name),t.push(r.display="".concat(r.name," <").concat(r.email,">"))):t.push(r.display=r.email):t.push(r.display=r.name)}return t}()})})();var p=function(){return(e.project.members||[]).map(function(e){return e.email})},g=function(){return(e.project.invites||[]).map(function(e){return e.email})};return e.filterAutocompleteUsers=function(t){var n=p();return e.autocompleteContacts.filter(function(e){if(null!=e.email&&Array.from(n).includes(e.email))return!1;for(var i=0,r=[e.name,e.email];i<r.length;i++){var o=r[i];if((null!=o?o.toLowerCase().indexOf(t.toLowerCase()):void 0)>-1)return!0}return!1})},e.addMembers=function(){var t=function(){var t;if(0!==e.inputs.contacts.length){var n=e.inputs.contacts;e.inputs.contacts=[],e.state.error=!1,e.state.errorReason=null,e.state.inflight=!0,null==e.project.invites&&(e.project.invites=[]);var i=p(),o=g();return(t=function(){var s;if(0===n.length||!e.canAddCollaborators)return e.state.inflight=!1,void e.$apply();var a=n.shift();if(s="user"===a.type?a.email:a.display,s=s.toLowerCase(),Array.from(i).includes(s))return t();c("invite");var u=window.ExposedSettings;return l(function(n){var i,a;return e.grecaptchaResponse=n,a=Array.from(o).includes(s)&&(i=__guard__(_.find(e.project.invites||[],function(e){return e.email===s}),function(e){return e._id}))?r.resendInvite(i):r.sendInvite(s,e.inputs.privileges,e.grecaptchaResponse),a.then(function(n){var i=n.data;if(i.error)e.state.error=!0,e.state.errorReason="".concat(i.error),e.state.inflight=!1;else if(i.invite){var r=i.invite;e.project.invites.push(r)}else{var o,s;s=null!=i.users?i.users:null!=i.user?[i.user]:[],(o=e.project.members).push.apply(o,_toConsumableArray(Array.from(s||[])))}return setTimeout(function(){return t()},0)})["catch"](function(t){var n=t.data;t.status,t.headers,t.config;return e.state.inflight=!1,e.state.error=!0,null!=(null!=n?n.errorReason:void 0)?e.state.errorReason=null!=n?n.errorReason:void 0:e.state.errorReason=null})},u.recaptchaDisabled.invite)})()}};return n(t,50)},e.removeMember=function(t){return e.state.error=null,e.state.inflight=!0,i.removeMember(t).then(function(){e.state.inflight=!1;var n=e.project.members.indexOf(t);if(-1!==n)return e.project.members.splice(n,1)})["catch"](function(){return e.state.inflight=!1,e.state.error="Sorry, something went wrong :("})},e.revokeInvite=function(t){return e.state.error=null,e.state.inflight=!0,r.revokeInvite(t._id).then(function(){e.state.inflight=!1;var n=e.project.invites.indexOf(t);if(-1!==n)return e.project.invites.splice(n,1)})["catch"](function(){return e.state.inflight=!1,e.state.error="Sorry, something went wrong :("})},e.resendInvite=function(t,n){return e.state.error=null,e.state.inflight=!0,r.resendInvite(t._id).then(function(){return e.state.inflight=!1,n.target.blur()})["catch"](function(){return e.state.inflight=!1,e.state.error="Sorry, something went wrong resending the invite :(",n.target.blur()})},e.makeTokenBased=function(){return e.project.publicAccesLevel="tokenBased",u.saveProjectAdminSettings({publicAccessLevel:"tokenBased"}),d.sendMB("project-make-token-based")},e.makePrivate=function(){return e.project.publicAccesLevel="private",u.saveProjectAdminSettings({publicAccessLevel:"private"})},e.$watch("project.tokens.readAndWrite",function(t){return null!=t?e.readAndWriteTokenLink="".concat(location.origin,"/").concat(t):e.readAndWriteTokenLink=null}),e.$watch("project.tokens.readOnly",function(t){return null!=t?e.readOnlyTokenLink="".concat(location.origin,"/read/").concat(t):e.readOnlyTokenLink=null}),e.done=function(){return t.close()},e.cancel=function(){return t.dismiss()}}])}),define("ide/share/services/projectMembers",["base"],function(e){return e.factory("projectMembers",["ide","$http",function(e,t){return{removeMember:function(n){return t({url:"/project/".concat(e.project_id,"/users/").concat(n._id),method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}})},addGroup:function(n,i){return t.post("/project/".concat(e.project_id,"/group"),{group_id:n,privileges:i,_csrf:window.csrfToken})},getMembers:function(){return t.get("/project/".concat(e.project_id,"/members"),{json:!0,headers:{"X-Csrf-Token":window.csrfToken}})}}}])}),define("ide/share/services/projectInvites",["base"],function(e){return e.factory("projectInvites",["ide","$http",function(e,t){return{sendInvite:function(n,i,r){return t.post("/project/".concat(e.project_id,"/invite"),{email:n,privileges:i,_csrf:window.csrfToken,"g-recaptcha-response":r})},revokeInvite:function(n){return t({url:"/project/".concat(e.project_id,"/invite/").concat(n),method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}})},resendInvite:function(n,i){return t.post("/project/".concat(e.project_id,"/invite/").concat(n,"/resend"),{_csrf:window.csrfToken})},getInvites:function(){return t.get("/project/".concat(e.project_id,"/invites"),{json:!0,headers:{"X-Csrf-Token":window.csrfToken}})}}}])}),define("ide/share/index",["ide/share/controllers/ShareController","ide/share/controllers/ShareProjectModalController","ide/share/services/projectMembers","ide/share/services/projectInvites"],function(){}),define("ide/chat/controllers/ChatButtonController",["base"],function(e){return e.controller("ChatButtonController",["$scope","ide",function(e,t){var n;e.toggleChat=function(){return e.ui.chatOpen=!e.ui.chatOpen,e.resetUnreadMessages()},e.unreadMessages=0,e.resetUnreadMessages=function(){return e.unreadMessages=0},e.$on("chat:resetUnreadMessages",function(t){return e.resetUnreadMessages()}),e.$on("chat:newMessage",function(n,i){return null!=i&&__guard__(null!=i?i.user:void 0,function(e){return e.id})!==t.$scope.user.id?(e.ui.chatOpen||(e.unreadMessages+=1),s()):void 0});var i=!0,r=null,o=null;$(window).on("focus",function(){return n(),i=!0}),$(window).on("blur",function(){return i=!1});var s=function(){if(!i&&null==r){var e;return o||(o=window.document.title),(e=function(){return window.document.title===o?window.document.title="New Message":window.document.title=o,r=setTimeout(e,800)})()}};return n=function(){return clearTimeout(r),r=null,null!=o?window.document.title=o:void 0}}])}),define("ide/chat/services/chatMessages",["base","libs/md5"],function(e){return e.factory("chatMessages",["$http","ide",function(e,t){var n="/project/".concat(t.project_id,"/messages"),i=50,r=("/project/".concat(t.project_id,"/connected_users"),{state:{messages:[],loading:!1,atEnd:!1,errored:!1,nextBeforeTimestamp:null,newMessage:null}}),o=!1;t.socket.on("new-chat-message",function(e){return __guard__(null!=e?e.user:void 0,function(e){return e.id})===t.$scope.user.id&&o||t.$scope.$apply(function(){return c(e)}),o=!1}),r.sendMessage=function(i){var r={content:i,_csrf:window.csrfToken};return o=!0,c({user:t.$scope.user,content:i,timestamp:Date.now()}),e.post(n,r)},r.loadMoreMessages=function(){if(!r.state.atEnd&&!r.state.errored){var t=n+"?limit=".concat(i);return null!=r.state.nextBeforeTimestamp&&(t+="&before=".concat(r.state.nextBeforeTimestamp)),r.state.loading=!0,e.get(t).then(function(e){var t=null!=e.data?e.data:[];return r.state.loading=!1,t.length<i&&(r.state.atEnd=!0),null==t.reverse&&"undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(new Error("messages has no reverse property ".concat(_typeof(t)))),"function"!=typeof t.reverse?("undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(new Error("messages.reverse not a function ".concat(_typeof(t.reverse)," ").concat(_typeof(t)))),r.state.errored=!0):(t.reverse(),l(t),r.state.nextBeforeTimestamp=null!=r.state.messages[0]?r.state.messages[0].timestamp:void 0)})}};var s=3e5,a=function(e){var t=r.state.messages[0],n=null!=t&&t.user.id===__guard__(null!=e?e.user:void 0,function(e){return e.id})&&t.timestamp-e.timestamp<s;return n?(t.timestamp=e.timestamp,t.contents.unshift(e.content)):r.state.messages.unshift({user:u(e.user),timestamp:e.timestamp,contents:[e.content]})},l=function(e){return Array.from(e.slice(0).reverse()).map(function(e){return a(e)})},c=function(e){r.state.newMessage=e;var t=r.state.messages[r.state.messages.length-1],n=null!=t&&t.user.id===__guard__(null!=e?e.user:void 0,function(e){return e.id})&&e.timestamp-t.timestamp<s;return n?(t.timestamp=e.timestamp,t.contents.push(e.content)):r.state.messages.push({user:u(e.user),timestamp:e.timestamp,contents:[e.content]})},u=function(e){var t=CryptoJS.MD5(e.email.toLowerCase());return e.gravatar_url="//www.gravatar.com/avatar/".concat(t),e};return r}])}),define("ide/chat/controllers/ChatController",["base","ide/chat/services/chatMessages"],function(e){return e.controller("ChatController",["$scope","chatMessages","ide","$location",function(e,t,n,i){return e.chat=t.state,e.$watch("chat.messages",function(t){return null!=t?e.$emit("updateScrollPosition"):void 0},!0),e.$on("layout:chat:resize",function(){return e.$emit("updateScrollPosition")}),e.$watch("chat.newMessage",function(e){return null!=e?n.$scope.$broadcast("chat:newMessage",e):void 0}),e.resetUnreadMessages=function(){return n.$scope.$broadcast("chat:resetUnreadMessages")},e.sendMessage=function(){var n=e.newMessageContent;return e.newMessageContent="",t.sendMessage(n)},e.loadMoreMessages=function(){return t.loadMoreMessages()}}])}),define("ide/chat/controllers/ChatMessageController",["base","ide/colors/ColorManager"],function(e,t){return e.controller("ChatMessageController",["$scope","ide",function(e,n){var i={borderSaturation:(null!=window.uiConfig?window.uiConfig.chatMessageBorderSaturation:void 0)||"70%",borderLightness:(null!=window.uiConfig?window.uiConfig.chatMessageBorderLightness:void 0)||"70%",bgSaturation:(null!=window.uiConfig?window.uiConfig.chatMessageBgSaturation:void 0)||"60%",bgLightness:(null!=window.uiConfig?window.uiConfig.chatMessageBgLightness:void 0)||"97%"},r=function(e){return null==e?0:t.getHueForUserId(e.id)};return e.getMessageStyle=function(e){return{"border-color":"hsl(".concat(r(e),", ").concat(i.borderSaturation,", ").concat(i.borderLightness,")"),"background-color":"hsl(".concat(r(e),", ").concat(i.bgSaturation,", ").concat(i.bgLightness,")")}},e.getArrowStyle=function(e){return{"border-color":"hsl(".concat(r(e),", ").concat(i.borderSaturation,", ").concat(i.borderLightness,")")}}}])}),define("directives/mathjax",["base"],function(e){return e.directive("mathjax",["$compile","$parse",function(e,t){return{link:function(n,i,r){if(MathJax&&MathJax.Hub){if(!t(r.mathjaxAllowHtml)(n)){var o=i.html(),s=e("<span ng-non-bindable></span>")({});i.html("").append(s),s.html(o)}if("no-single-dollar"!==r.delimiter){var a=MathJax.Hub.config&&MathJax.Hub.config.tex2jax.inlineMath,l=_.find(a,function(e){return"$"===e[0]&&"$"===e[1]});l||MathJax.Hub.Config({tex2jax:{inlineMath:a.concat([["$","$"]])}})}setTimeout(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,i.get(0)])},0)}}}}])}),define("filters/wrapLongWords",["base"],function(e){var t=20,n=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})},i=function(e,i,r){var o;r=r||t;var s=e.split(" "),a=Array.from(s).map(function(e){return n(e).length>=r?"<".concat(i,' class="break-word">').concat(e,"</").concat(i,">"):e});return o=a.join(" ")};return e.filter("wrapLongWords",function(){return function(e,t){return i(e,"span",t)}})}),define("ide/chat/index",["ide/chat/controllers/ChatButtonController","ide/chat/controllers/ChatController","ide/chat/controllers/ChatMessageController","directives/mathjax","filters/wrapLongWords"],function(){}),define("ide/clone/controllers/CloneProjectController",["base"],function(e){return e.controller("CloneProjectController",["$scope","$modal",function(e,t){return e.openCloneProjectModal=function(){return t.open({templateUrl:"cloneProjectModalTemplate",controller:"CloneProjectModalController"})}}])}),define("ide/clone/controllers/CloneProjectModalController",["base"],function(e){return e.controller("CloneProjectModalController",["$scope","$modalInstance","$timeout","$http","ide",function(e,t,n,i,r){e.inputs={projectName:r.$scope.project.name+" (Copy)"},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)});var o=function(e){return i.post("/project/".concat(r.$scope.project._id,"/clone"),{_csrf:window.csrfToken,projectName:e})};return e.clone=function(){return e.state.inflight=!0,e.state.error=!1,o(e.inputs.projectName).then(function(e){var t=e.data;return window.location="/project/".concat(t.project_id)})["catch"](function(t){var n=t.data,i=t.status;return e.state.inflight=!1,400===i?e.state.error={message:n}:e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}])}),define("ide/clone/index",["ide/clone/controllers/CloneProjectController","ide/clone/controllers/CloneProjectModalController"],function(){}),define("ide/hotkeys/BackspaceHighjack",[],function(){var e=/INPUT|SELECT|TEXTAREA/i;return $(document).bind("keydown keypress",function(t){return 8!==t.which||e.test(t.target.tagName)&&!t.target.disabled&&!t.target.readOnly?void 0:t.preventDefault()})}),define("ide/hotkeys/controllers/HotkeysController",["base","ace/ace"],function(e){return e.controller("HotkeysController",["$scope","$modal","event_tracking",function(e,t,n){return e.openHotkeysModal=function(){return n.sendMB("ide-open-hotkeys-modal"),t.open({templateUrl:"hotkeysModalTemplate",controller:"HotkeysModalController",size:"lg",resolve:{trackChangesVisible:function(){return e.project.features.trackChangesVisible}}})}}]),e.controller("HotkeysModalController",["$scope","$modalInstance","trackChangesVisible",function(e,t,n){return e.trackChangesVisible=n,ace.require("ace/lib/useragent").isMac?e.ctrl="Cmd":e.ctrl="Ctrl",e.cancel=function(){return t.dismiss()};
}])}),define("ide/hotkeys/index",["ide/hotkeys/BackspaceHighjack","ide/hotkeys/controllers/HotkeysController"],function(){}),define("ide/test-controls/controllers/TestControlsController",["base","ace/ace"],function(e){return e.controller("TestControlsController",["$scope",function(e){return e.richText=function(){var e=window.location.toString(),t="".concat(e).concat(window.location.search?"&":"?","rt=true");return window.location.href=t}}])}),define("ide/test-controls/index",["ide/test-controls/controllers/TestControlsController"],function(){}),define("ide/wordcount/controllers/WordCountController",["base"],function(e){return e.controller("WordCountController",["$scope","$modal",function(e,t){return e.openWordCountModal=function(){return t.open({templateUrl:"wordCountModalTemplate",controller:"WordCountModalController"})}}])}),define("ide/wordcount/controllers/WordCountModalController",["base"],function(e){return e.controller("WordCountModalController",["$scope","$modalInstance","ide","$http",function(e,t,n,i){e.status={loading:!0};var r={url:"/project/".concat(n.project_id,"/wordcount"),method:"GET",params:{clsiserverid:n.clsiServerId}};return i(r).then(function(t){var n=t.data;return e.status.loading=!1,e.data=n.texcount})["catch"](function(){return e.status.error=!0}),e.cancel=function(){return t.dismiss("cancel")}}])}),define("ide/wordcount/index",["ide/wordcount/controllers/WordCountController","ide/wordcount/controllers/WordCountModalController"],function(){}),$.ui=$.ui||{},$.extend($.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),$.fn.extend({scrollParent:function(e){var t=this.css("position"),n="absolute"===t,i=e?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var e=$(this);return n&&"static"===e.css("position")?!1:i.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==t&&r.length?r:$(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&$(this).removeAttr("id")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(e){return function(t){return!!$.data(t,e)}}):function(e,t,n){return!!$.data(e,n[3])},focusable:function(e){return focusable(e,!isNaN($.attr(e,"tabindex")))},tabbable:function(e){var t=$.attr(e,"tabindex"),n=isNaN(t);return(n||t>=0)&&focusable(e,!n)}}),$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(e,t){function n(e,t,n,r){return $.each(i,function(){t-=parseFloat($.css(e,"padding"+this))||0,n&&(t-=parseFloat($.css(e,"border"+this+"Width"))||0),r&&(t-=parseFloat($.css(e,"margin"+this))||0)}),t}var i="Width"===t?["Left","Right"]:["Top","Bottom"],r=t.toLowerCase(),o={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+t]=function(e){return void 0===e?o["inner"+t].call(this):this.each(function(){$(this).css(r,n(this,e)+"px")})},$.fn["outer"+t]=function(e,i){return"number"!=typeof e?o["outer"+t].call(this,e):this.each(function(){$(this).css(r,n(this,e,!0,i)+"px")})}}),$.fn.addBack||($.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),$("<a>").data("a-b","a").removeData("a-b").data("a-b")&&($.fn.removeData=function(e){return function(t){return arguments.length?e.call(this,$.camelCase(t)):e.call(this)}}($.fn.removeData)),$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),$.fn.extend({focus:function(e){return function(t,n){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){$(e).focus(),n&&n.call(e)},t)}):e.apply(this,arguments)}}($.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var t,n,i=$(this[0]);i.length&&i[0]!==document;){if(t=i.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(n=parseInt(i.css("zIndex"),10),!isNaN(n)&&0!==n))return n;i=i.parent()}return 0}}),$.ui.plugin={add:function(e,t,n){var i,r=$.ui[e].prototype;for(i in n)r.plugins[i]=r.plugins[i]||[],r.plugins[i].push([t,n[i]])},call:function(e,t,n,i){var r,o=e.plugins[t];if(o&&(i||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(r=0;r<o.length;r++)e.options[o[r][0]]&&o[r][1].apply(e.element,n)}};var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=function(e){return function(t){var n,i,r;for(r=0;null!=(i=t[r]);r++)try{n=$._data(i,"events"),n&&n.remove&&$(i).triggerHandler("remove")}catch(o){}e(t)}}($.cleanData),$.widget=function(e,t,n){var i,r,o,s,a={},l=e.split(".")[0];return e=e.split(".")[1],i=l+"-"+e,n||(n=t,t=$.Widget),$.expr[":"][i.toLowerCase()]=function(e){return!!$.data(e,i)},$[l]=$[l]||{},r=$[l][e],o=$[l][e]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},$.extend(o,r,{version:n.version,_proto:$.extend({},n),_childConstructors:[]}),s=new t,s.options=$.widget.extend({},s.options),$.each(n,function(e,n){return $.isFunction(n)?void(a[e]=function(){var i=function(){return t.prototype[e].apply(this,arguments)},r=function(n){return t.prototype[e].apply(this,n)};return function(){var e,t=this._super,o=this._superApply;return this._super=i,this._superApply=r,e=n.apply(this,arguments),this._super=t,this._superApply=o,e}}()):void(a[e]=n)}),o.prototype=$.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||e:e},a,{constructor:o,namespace:l,widgetName:e,widgetFullName:i}),r?($.each(r._childConstructors,function(e,t){var n=t.prototype;$.widget(n.namespace+"."+n.widgetName,o,t._proto)}),delete r._childConstructors):t._childConstructors.push(o),$.widget.bridge(e,o),o},$.widget.extend=function(e){for(var t,n,i=widget_slice.call(arguments,1),r=0,o=i.length;o>r;r++)for(t in i[r])n=i[r][t],i[r].hasOwnProperty(t)&&void 0!==n&&($.isPlainObject(n)?e[t]=$.isPlainObject(e[t])?$.widget.extend({},e[t],n):$.widget.extend({},n):e[t]=n);return e},$.widget.bridge=function(e,t){var n=t.prototype.widgetFullName||e;$.fn[e]=function(i){var r="string"==typeof i,o=widget_slice.call(arguments,1),s=this;return r?this.each(function(){var t,r=$.data(this,n);return"instance"===i?(s=r,!1):r?$.isFunction(r[i])&&"_"!==i.charAt(0)?(t=r[i].apply(r,o),t!==r&&void 0!==t?(s=t&&t.jquery?s.pushStack(t.get()):t,!1):void 0):$.error("no such method '"+i+"' for "+e+" widget instance"):$.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+i+"'")}):(o.length&&(i=$.widget.extend.apply(null,[i].concat(o))),this.each(function(){var e=$.data(this,n);e?(e.option(i||{}),e._init&&e._init()):$.data(this,n,new t(i,this))})),s}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=$(t||this.defaultElement||this)[0],this.element=$(t),this.uuid=widget_uuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=$(),this.hoverable=$(),this.focusable=$(),t!==this&&($.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=$(t.style?t.ownerDocument:t.document||t),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this.options=$.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(e,t){var n,i,r,o=e;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof e)if(o={},n=e.split("."),e=n.shift(),n.length){for(i=o[e]=$.widget.extend({},this.options[e]),r=0;r<n.length-1;r++)i[n[r]]=i[n[r]]||{},i=i[n[r]];if(e=n.pop(),1===arguments.length)return void 0===i[e]?null:i[e];i[e]=t}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,t,n){var i,r=this;"boolean"!=typeof e&&(n=t,t=e,e=!1),n?(t=i=$(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element,i=this.widget()),$.each(n,function(n,o){function s(){return e||r.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||$.guid++);var a=n.match(/^([\w:-]*)\s*(.*)$/),l=a[1]+r.eventNamespace,c=a[2];c?i.delegate(c,l,s):t.bind(l,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t),this.bindings=$(this.bindings.not(e).get()),this.focusable=$(this.focusable.not(e).get()),this.hoverable=$(this.hoverable.not(e).get())},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){$(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){$(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){$(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){$(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,n){var i,r,o=this.options[e];if(n=n||{},t=$.Event(t),t.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],r=t.originalEvent)for(i in r)i in t||(t[i]=r[i]);return this.element.trigger(t,n),!($.isFunction(o)&&o.apply(this.element[0],[t].concat(n))===!1||t.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(e,t){$.Widget.prototype["_"+e]=function(n,i,r){"string"==typeof i&&(i={effect:i});var o,s=i?i===!0||"number"==typeof i?t:i.effect||t:e;i=i||{},"number"==typeof i&&(i={duration:i}),o=!$.isEmptyObject(i),i.complete=r,i.delay&&n.delay(i.delay),o&&$.effects&&$.effects.effect[s]?n[e](i):s!==e&&n[s]?n[s](i.duration,i.easing,r):n.queue(function(t){$(this)[e](),r&&r.call(n[0]),t()})}});var widget=$.widget,mouseHandled=!1;$(document).mouseup(function(){mouseHandled=!1});var mouse=$.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(t){return!0===$.data(t.target,e.widgetName+".preventClickEvent")?($.removeData(t.target,e.widgetName+".preventClickEvent"),t.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!mouseHandled){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var t=this,n=1===e.which,i="string"==typeof this.options.cancel&&e.target.nodeName?$(e.target).closest(this.options.cancel).length:!1;return n&&!i&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===$.data(e.target,this.widgetName+".preventClickEvent")&&$.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),mouseHandled=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&$.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),mouseHandled=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});$.widget("ui.draggable",$.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var t=this.options;return this._blurActiveElement(e),this.helper||t.disabled||$(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blockFrames(t.iframeFix===!0?"iframe":t.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=$(this);return $("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var t=this.document[0];if(this.handleElement.is(e.target))try{t.activeElement&&"body"!==t.activeElement.nodeName.toLowerCase()&&$(t.activeElement).blur()}catch(n){}},_mouseStart:function(e){var t=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===$(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!t.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,e),this._normalizeRightBottom(),this._mouseDrag(e,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(e,t){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!t){var n=this._uiHash();if(this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",$.ui.ddmanager&&$.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var t=this,n=!1;return $.ui.ddmanager&&!this.options.dropBehaviour&&(n=$.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){t._trigger("stop",e)!==!1&&t._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.focus(),$.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!$(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var t=this.options,n=$.isFunction(t.helper),i=n?$(t.helper.apply(this.element[0],[e])):"clone"===t.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===t.appendTo?this.element[0].parentNode:t.appendTo),n&&i[0]===this.element[0]&&this._setPositionRelative(),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),$.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),t=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==t&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,n,i=this.options,r=this.document[0];return this.relativeContainer=null,i.containment?"window"===i.containment?void(this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===i.containment?void(this.containment=[0,0,$(r).width()-this.helperProportions.width-this.margins.left,($(r).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):i.containment.constructor===Array?void(this.containment=i.containment):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),t=$(i.containment),n=t[0],void(n&&(e=/(scroll|auto)/.test(t.css("overflow")),this.containment=[(parseInt(t.css("borderLeftWidth"),10)||0)+(parseInt(t.css("paddingLeft"),10)||0),(parseInt(t.css("borderTopWidth"),10)||0)+(parseInt(t.css("paddingTop"),10)||0),(e?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t.css("borderRightWidth"),10)||0)-(parseInt(t.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t.css("borderBottomWidth"),10)||0)-(parseInt(t.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=t))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var n="absolute"===e?1:-1,i=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.offset.scroll.top:i?0:this.offset.scroll.top)*n,left:t.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.offset.scroll.left:i?0:this.offset.scroll.left)*n}},_generatePosition:function(e,t){var n,i,r,o,s=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(i=this.relativeContainer.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),e.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=n?r-this.offset.click.top>=n[1]||r-this.offset.click.top>n[3]?r:r-this.offset.click.top>=n[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=n?o-this.offset.click.left>=n[0]||o-this.offset.click.left>n[2]?o:o-this.offset.click.left>=n[0]?o-s.grid[0]:o+s.grid[0]:o),"y"===s.axis&&(l=this.originalPageX),"x"===s.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(e,t,n){return n=n||this._uiHash(),$.ui.plugin.call(this,e,[t,n,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),n.offset=this.positionAbs),$.Widget.prototype._trigger.call(this,e,t,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.ui.plugin.add("draggable","connectToSortable",{start:function(e,t,n){var i=$.extend({},t,{item:n.element});n.sortables=[],$(n.options.connectToSortable).each(function(){var t=$(this).sortable("instance");t&&!t.options.disabled&&(n.sortables.push(t),t.refreshPositions(),t._trigger("activate",e,i))})},stop:function(e,t,n){var i=$.extend({},t,{item:n.element});n.cancelHelperRemoval=!1,$.each(n.sortables,function(){var t=this;t.isOver?(t.isOver=0,n.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,i))})},drag:function(e,t,n){$.each(n.sortables,function(){var i=!1,r=this;r.positionAbs=n.positionAbs,r.helperProportions=n.helperProportions,r.offset.click=n.offset.click,r._intersectsWith(r.containerCache)&&(i=!0,$.each(n.sortables,function(){return this.positionAbs=n.positionAbs,this.helperProportions=n.helperProportions,this.offset.click=n.offset.click,this!==r&&this._intersectsWith(this.containerCache)&&$.contains(r.element[0],this.element[0])&&(i=!1),i})),i?(r.isOver||(r.isOver=1,n._parent=t.helper.parent(),r.currentItem=t.helper.appendTo(r.element).data("ui-sortable-item",!0),r.options._helper=r.options.helper,r.options.helper=function(){return t.helper[0]},e.target=r.currentItem[0],r._mouseCapture(e,!0),r._mouseStart(e,!0,!0),r.offset.click.top=n.offset.click.top,r.offset.click.left=n.offset.click.left,r.offset.parent.left-=n.offset.parent.left-r.offset.parent.left,r.offset.parent.top-=n.offset.parent.top-r.offset.parent.top,n._trigger("toSortable",e),n.dropped=r.element,$.each(n.sortables,function(){this.refreshPositions()}),n.currentItem=n.element,r.fromOutside=n),r.currentItem&&(r._mouseDrag(e),t.position=r.position)):r.isOver&&(r.isOver=0,r.cancelHelperRemoval=!0,r.options._revert=r.options.revert,r.options.revert=!1,r._trigger("out",e,r._uiHash(r)),r._mouseStop(e,!0),r.options.revert=r.options._revert,r.options.helper=r.options._helper,r.placeholder&&r.placeholder.remove(),t.helper.appendTo(n._parent),n._refreshOffsets(e),t.position=n._generatePosition(e,!0),n._trigger("fromSortable",e),n.dropped=!1,$.each(n.sortables,function(){this.refreshPositions()}))})}}),$.ui.plugin.add("draggable","cursor",{start:function(e,t,n){var i=$("body"),r=n.options;i.css("cursor")&&(r._cursor=i.css("cursor")),i.css("cursor",r.cursor)},stop:function(e,t,n){var i=n.options;i._cursor&&$("body").css("cursor",i._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(e,t,n){var i=$(t.helper),r=n.options;i.css("opacity")&&(r._opacity=i.css("opacity")),i.css("opacity",r.opacity)},stop:function(e,t,n){var i=n.options;i._opacity&&$(t.helper).css("opacity",i._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(e,t,n){n.scrollParentNotHidden||(n.scrollParentNotHidden=n.helper.scrollParent(!1)),n.scrollParentNotHidden[0]!==n.document[0]&&"HTML"!==n.scrollParentNotHidden[0].tagName&&(n.overflowOffset=n.scrollParentNotHidden.offset())},drag:function(e,t,n){var i=n.options,r=!1,o=n.scrollParentNotHidden[0],s=n.document[0];o!==s&&"HTML"!==o.tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+o.offsetHeight-e.pageY<i.scrollSensitivity?o.scrollTop=r=o.scrollTop+i.scrollSpeed:e.pageY-n.overflowOffset.top<i.scrollSensitivity&&(o.scrollTop=r=o.scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+o.offsetWidth-e.pageX<i.scrollSensitivity?o.scrollLeft=r=o.scrollLeft+i.scrollSpeed:e.pageX-n.overflowOffset.left<i.scrollSensitivity&&(o.scrollLeft=r=o.scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(e.pageY-$(s).scrollTop()<i.scrollSensitivity?r=$(s).scrollTop($(s).scrollTop()-i.scrollSpeed):$(window).height()-(e.pageY-$(s).scrollTop())<i.scrollSensitivity&&(r=$(s).scrollTop($(s).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(e.pageX-$(s).scrollLeft()<i.scrollSensitivity?r=$(s).scrollLeft($(s).scrollLeft()-i.scrollSpeed):$(window).width()-(e.pageX-$(s).scrollLeft())<i.scrollSensitivity&&(r=$(s).scrollLeft($(s).scrollLeft()+i.scrollSpeed)))),r!==!1&&$.ui.ddmanager&&!i.dropBehaviour&&$.ui.ddmanager.prepareOffsets(n,e)}}),$.ui.plugin.add("draggable","snap",{start:function(e,t,n){var i=n.options;n.snapElements=[],$(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var e=$(this),t=e.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t,n){var i,r,o,s,a,l,c,u,d,h,f=n.options,p=f.snapTolerance,g=t.offset.left,m=g+n.helperProportions.width,v=t.offset.top,y=v+n.helperProportions.height;for(d=n.snapElements.length-1;d>=0;d--)a=n.snapElements[d].left-n.margins.left,l=a+n.snapElements[d].width,c=n.snapElements[d].top-n.margins.top,u=c+n.snapElements[d].height,a-p>m||g>l+p||c-p>y||v>u+p||!$.contains(n.snapElements[d].item.ownerDocument,n.snapElements[d].item)?(n.snapElements[d].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,$.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(i=Math.abs(c-y)<=p,r=Math.abs(u-v)<=p,o=Math.abs(a-m)<=p,s=Math.abs(l-g)<=p,i&&(t.position.top=n._convertPositionTo("relative",{top:c-n.helperProportions.height,left:0}).top),r&&(t.position.top=n._convertPositionTo("relative",{top:u,left:0}).top),o&&(t.position.left=n._convertPositionTo("relative",{top:0,left:a-n.helperProportions.width}).left),s&&(t.position.left=n._convertPositionTo("relative",{top:0,left:l}).left)),h=i||r||o||s,"outer"!==f.snapMode&&(i=Math.abs(c-v)<=p,r=Math.abs(u-y)<=p,o=Math.abs(a-g)<=p,s=Math.abs(l-m)<=p,i&&(t.position.top=n._convertPositionTo("relative",{top:c,left:0}).top),r&&(t.position.top=n._convertPositionTo("relative",{top:u-n.helperProportions.height,left:0}).top),o&&(t.position.left=n._convertPositionTo("relative",{top:0,left:a}).left),s&&(t.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width
}).left)),!n.snapElements[d].snapping&&(i||r||o||s||h)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,$.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=i||r||o||s||h)}}),$.ui.plugin.add("draggable","stack",{start:function(e,t,n){var i,r=n.options,o=$.makeArray($(r.stack)).sort(function(e,t){return(parseInt($(e).css("zIndex"),10)||0)-(parseInt($(t).css("zIndex"),10)||0)});o.length&&(i=parseInt($(o[0]).css("zIndex"),10)||0,$(o).each(function(e){$(this).css("zIndex",i+e)}),this.css("zIndex",i+o.length))}}),$.ui.plugin.add("draggable","zIndex",{start:function(e,t,n){var i=$(t.helper),r=n.options;i.css("zIndex")&&(r._zIndex=i.css("zIndex")),i.css("zIndex",r.zIndex)},stop:function(e,t,n){var i=n.options;i._zIndex&&$(t.helper).css("zIndex",i._zIndex)}});var draggable=$.ui.draggable;$.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,t=this.options,n=t.accept;this.isover=!1,this.isout=!0,this.accept=$.isFunction(n)?n:function(e){return e.is(n)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(t.scope),t.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){$.ui.ddmanager.droppables[e]=$.ui.ddmanager.droppables[e]||[],$.ui.ddmanager.droppables[e].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var e=$.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){if("accept"===e)this.accept=$.isFunction(t)?t:function(e){return e.is(t)};else if("scope"===e){var n=$.ui.ddmanager.droppables[this.options.scope];this._splice(n),this._addToManager(t)}this._super(e,t)},_activate:function(e){var t=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=$.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=$.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(t)))},_drop:function(e,t){var n=t||$.ui.ddmanager.current,i=!1;return n&&(n.currentItem||n.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=$(this).droppable("instance");return t.options.greedy&&!t.options.disabled&&t.options.scope===n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&$.ui.intersect(n,$.extend(t,{offset:t.element.offset()}),t.options.tolerance,e)?(i=!0,!1):void 0}),i?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),$.ui.intersect=function(){function e(e,t,n){return e>=t&&t+n>e}return function(t,n,i,r){if(!n.offset)return!1;var o=(t.positionAbs||t.position.absolute).left+t.margins.left,s=(t.positionAbs||t.position.absolute).top+t.margins.top,a=o+t.helperProportions.width,l=s+t.helperProportions.height,c=n.offset.left,u=n.offset.top,d=c+n.proportions().width,h=u+n.proportions().height;switch(i){case"fit":return o>=c&&d>=a&&s>=u&&h>=l;case"intersect":return c<o+t.helperProportions.width/2&&a-t.helperProportions.width/2<d&&u<s+t.helperProportions.height/2&&l-t.helperProportions.height/2<h;case"pointer":return e(r.pageY,u,n.proportions().height)&&e(r.pageX,c,n.proportions().width);case"touch":return(s>=u&&h>=s||l>=u&&h>=l||u>s&&l>h)&&(o>=c&&d>=o||a>=c&&d>=a||c>o&&a>d);default:return!1}}}(),$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,t){var n,i,r=$.ui.ddmanager.droppables[e.options.scope]||[],o=t?t.type:null,s=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(n=0;n<r.length;n++)if(!(r[n].options.disabled||e&&!r[n].accept.call(r[n].element[0],e.currentItem||e.element))){for(i=0;i<s.length;i++)if(s[i]===r[n].element[0]){r[n].proportions().height=0;continue e}r[n].visible="none"!==r[n].element.css("display"),r[n].visible&&("mousedown"===o&&r[n]._activate.call(r[n],t),r[n].offset=r[n].element.offset(),r[n].proportions({width:r[n].element[0].offsetWidth,height:r[n].element[0].offsetHeight}))}},drop:function(e,t){var n=!1;return $.each(($.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&$.ui.intersect(e,this,this.options.tolerance,t)&&(n=this._drop.call(this,t)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),n},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||$.ui.ddmanager.prepareOffsets(e,t)})},drag:function(e,t){e.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(e,t);var n=$.ui.ddmanager.droppables[e.options.scope]||[];$.each(n,function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,i,r,o=$.ui.intersect(e,this,this.options.tolerance,t),s=!o&&this.isover?"isout":o&&!this.isover?"isover":null;s&&(this.options.greedy&&(i=this.options.scope,r=this.element.parents(":data(ui-droppable)").filter(function(){return $(this).droppable("instance").options.scope===i}),r.length&&(n=$(r[0]).droppable("instance"),n.enteredGreedyChild=n.enteredGreedyChild||"isover"===s,n.leftGreedyChild=n.leftGreedyChild||"isout"===s)),this[s]=!0,this["isout"===s?"isover":"isout"]=!1,this.c=s)}}),$.each(n,function(){this.enteredGreedyChild&&(this.greedyChild=!0,this.isover=!1,this.isout=!0,this.c="isout"),this.leftGreedyChild&&!this.enteredGreedyChild&&(this.greedyChild=!1,this.isover=!0,this.isout=!1,this.c="isover"),this.c&&(this["isover"===this.c?"_over":"_out"].call(this,t),this.leftGreedyChild=!1,this.enteredGreedyChild=!1,this.c=null)})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||$.ui.ddmanager.prepareOffsets(e,t)}};var droppable=$.ui.droppable;!function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(e){return"string"===$.type(e)},runPluginCallbacks=function(Instance,a_fn){function g(e){return e}if($.isArray(a_fn))for(var i=0,c=a_fn.length;c>i;i++){var fn=a_fn[i];try{isStr(fn)&&(fn=eval(fn)),$.isFunction(fn)&&g(fn)(Instance)}catch(ex){}}};$.layout={version:"1.3.rc30.79",revision:.033007,browser:{},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(e){var t=$(e),n=t.data("layout")||t.data("parentLayout");if(n){var i=n.container;if(i.data("layoutPane"))return i;var r=i.closest("."+$.layout.defaults.panes.paneClass);if(r.data("layoutPane"))return r}return null},getParentPaneInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("layoutPane"):null},getParentLayoutInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("parentLayout"):null},getEventObject:function(e){return"object"==typeof e&&e.stopPropagation?e:null},parsePaneName:function(e){var t=$.layout.getEventObject(e),n=e;return t&&(t.stopPropagation(),n=$(this).data("layoutEdge")),n&&!/^(west|east|north|south|center)$/.test(n)&&($.layout.msg('LAYOUT ERROR - Invalid pane-name: "'+n+'"'),n="error"),n},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect&&$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(e){var t=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"></div>').appendTo("body"),n={width:t.css("width")-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),window.scrollbarWidth=n.width,window.scrollbarHeight=n.height,e.match(/^(width|height)$/)?n[e]:n},showInvisibly:function(e,t){if(e&&e.length&&(t||"none"===e.css("display"))){var n=e[0].style,i={display:n.display||"",visibility:n.visibility||""};return e.css({display:"block",visibility:"hidden"}),i}return{}},getElementDimensions:function(e,t){var n,i,r,o={css:{},inset:{}},s=o.css,a={bottom:0},l=$.layout.cssNum,c=e.offset();return o.offsetLeft=c.left,o.offsetTop=c.top,t||(t={}),$.each("Left,Right,Top,Bottom".split(","),function(l,c){n=s["border"+c]=$.layout.borderWidth(e,c),i=s["padding"+c]=$.layout.cssNum(e,"padding"+c),r=c.toLowerCase(),o.inset[r]=t[r]>=0?t[r]:i,a[r]=o.inset[r]+n}),s.width=e.width(),s.height=e.height(),s.top=l(e,"top",!0),s.bottom=l(e,"bottom",!0),s.left=l(e,"left",!0),s.right=l(e,"right",!0),o.outerWidth=e.outerWidth(),o.outerHeight=e.outerHeight(),o.innerWidth=max(0,o.outerWidth-a.left-a.right),o.innerHeight=max(0,o.outerHeight-a.top-a.bottom),o.layoutWidth=e.innerWidth(),o.layoutHeight=e.innerHeight(),o},getElementStyles:function(e,t){var n,i,r,o,s,a,l={},c=e[0].style,u=t.split(","),d="Top,Bottom,Left,Right".split(","),h="Color,Style,Width".split(",");for(o=0;o<u.length;o++)if(n=u[o],n.match(/(border|padding|margin)$/))for(s=0;4>s;s++)if(i=d[s],"border"===n)for(a=0;3>a;a++)r=h[a],l[n+i+r]=c[n+i+r];else l[n+i]=c[n+i];else l[n]=c[n];return l},cssWidth:function(e,t){if(0>=t)return 0;var n=$.layout.browser.boxModel?$.support.boxSizing?e.css("boxSizing"):"content-box":"border-box",i=$.layout.borderWidth,r=$.layout.cssNum,o=t;return"border-box"!==n&&(o-=i(e,"Left")+i(e,"Right")),"content-box"===n&&(o-=r(e,"paddingLeft")+r(e,"paddingRight")),max(0,o)},cssHeight:function(e,t){if(0>=t)return 0;var n=$.layout.browser.boxModel?$.support.boxSizing?e.css("boxSizing"):"content-box":"border-box",i=$.layout.borderWidth,r=$.layout.cssNum,o=t;return"border-box"!==n&&(o-=i(e,"Top")+i(e,"Bottom")),"content-box"===n&&(o-=r(e,"paddingTop")+r(e,"paddingBottom")),max(0,o)},cssNum:function(e,t,n){e.jquery||(e=$(e));var i=$.layout.showInvisibly(e),r=$.css(e[0],t,!0),o=n&&"auto"==r?r:Math.round(parseFloat(r)||0);return e.css(i),o},borderWidth:function(e,t){e.jquery&&(e=e[0]);var n="border"+t.substr(0,1).toUpperCase()+t.substr(1);return"none"===$.css(e,n+"Style",!0)?0:Math.round(parseFloat($.css(e,n+"Width",!0))||0)},isMouseOverElem:function(e,t){var n=$(t||this),i=n.offset(),r=i.top,o=i.left,s=o+n.outerWidth(),a=r+n.outerHeight(),l=e.pageX,c=e.pageY;return $.layout.browser.msie&&0>l&&0>c||l>=o&&s>=l&&c>=r&&a>=c},msg:function(e,t,n,i){function r(){var e=$.support.fixedPosition?"fixed":"absolute",t=$('<div id="layoutLogger" style="position: '+e+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);"><div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;"><span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div><ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul></div>').appendTo("body");return t.css("left",$(window).width()-t.outerWidth()-5),$.ui.draggable&&t.draggable({handle:":first-child"}),t}if($.isPlainObject(e)&&window.debugData){"string"==typeof t?(i=n,n=t):"object"==typeof n&&(i=n,n=null);var o=n||"log( <object> )",s=$.extend({sort:!1,returnHTML:!1,display:!1},i);t===!0||s.display?debugData(e,o,s):window.console&&console.log(debugData(e,o,s))}else if(t)alert(e);else if(window.console)console.log(e);else{var a="#layoutLogger",l=$(a);l.length||(l=r()),l.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}};var u=navigator.userAgent.toLowerCase(),m=/(chrome)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(u)||[],b=m[1]||"",v=m[2]||0,ie="msie"===b;$.layout.browser={version:v,safari:"webkit"===b,webkit:"chrome"===b,msie:ie,isIE6:ie&&6==v,boxModel:!ie||$.support.boxModel!==!1},b&&($.layout.browser[b]=!0),ie&&$(function(){$.layout.browser.boxModel=$.support.boxModel}),$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button\nInvalid ",containerMissing:"UI Layout Initialization Error\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\nThe center-pane element does not exist.\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\nThe layout-container \"CONTAINER\" has no height.\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},$.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onload_start,onload_end,onunload,onunload_start,onunload_end".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},$.layout.transformData=function(e,t){var n,i,r,o,s,a,l,c=t?{panes:{},center:{}}:{};if("object"!=typeof e)return c;for(i in e)for(n=c,s=e[i],r=i.split("__"),l=r.length-1,a=0;l>=a;a++)o=r[a],a===l?$.isPlainObject(s)?n[o]=$.layout.transformData(s):n[o]=s:(n[o]||(n[o]={}),n=n[o]);return c},$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(e){function t(t,n){for(var i,r=t.split("."),o=r.length-1,s={branch:e,key:r[o]},a=0;o>a;a++)i=r[a],void 0==s.branch[i]?n?s.branch=s.branch[i]={}:s.branch={}:s.branch=s.branch[i];return s}var n,i,r,o=$.layout.backwardCompatibility.map;for(var s in o)n=t(s),r=n.branch[n.key],void 0!==r&&(i=t(o[s],!0),i.branch[i.key]=r,delete n.branch[n.key])},renameAllOptions:function(e){var t=$.layout.backwardCompatibility.renameOptions;return t(e),e.defaults&&("object"!=typeof e.panes&&(e.panes={}),$.extend(!0,e.panes,e.defaults),delete e.defaults),e.panes&&t(e.panes),$.each($.layout.config.allPanes,function(n,i){e[i]&&t(e[i])}),e}},$.fn.layout=function(opts){function keyDown(e){if(!e)return!0;var t=e.keyCode;if(33>t)return!0;var n,i,r,o,s={38:"north",40:"south",37:"west",39:"east"},a=(e.altKey,e.shiftKey),l=e.ctrlKey,c=l&&t>=37&&40>=t;return c&&options[s[t]].enableCursorHotkey?o=s[t]:(l||a)&&$.each(_c.borderPanes,function(e,s){return n=options[s],i=n.customHotkey,r=n.customHotkeyModifier,(a&&"SHIFT"==r||l&&"CTRL"==r||l&&a)&&i&&t===(isNaN(i)||9>=i?i.toUpperCase().charCodeAt(0):i)?(o=s,!1):void 0}),o&&$Ps[o]&&options[o].closable&&!state[o].isHidden?(toggle(o),e.stopPropagation(),e.returnValue=!1,!1):!0}function allowOverflow(e){if(isInitialized()){this&&this.tagName&&(e=this);var t;if(isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each(function(){return $(this).data("layoutRole")?(t=$(this),!1):void 0}),t&&t.length){var n=t.data("layoutEdge"),i=state[n];if(i.cssSaved&&resetOverflow(n),i.isSliding||i.isResizing||i.isClosed)return void(i.cssSaved=!1);var r={zIndex:options.zIndexes.resizer_normal+1},o={},s=t.css("overflow"),a=t.css("overflowX"),l=t.css("overflowY");"visible"!=s&&(o.overflow=s,r.overflow="visible"),a&&!a.match(/(visible|auto)/)&&(o.overflowX=a,r.overflowX="visible"),l&&!l.match(/(visible|auto)/)&&(o.overflowY=a,r.overflowY="visible"),i.cssSaved=o,t.css(r),$.each(_c.allPanes,function(e,t){t!=n&&resetOverflow(t)})}}}function resetOverflow(e){if(isInitialized()){this&&this.tagName&&(e=this);var t;if(isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each(function(){return $(this).data("layoutRole")?(t=$(this),!1):void 0}),t&&t.length){var n=t.data("layoutEdge"),i=state[n],r=i.cssSaved||{};i.isSliding||i.isResizing||t.css("zIndex",options.zIndexes.pane_normal),t.css(r),i.cssSaved=!1}}}var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(!0,{},$.layout.defaults),effects=options.effects=$.extend(!0,{},$.layout.effects),state={id:"layout"+$.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(e,t,n){timer.clear(e),timer.data[e]=setTimeout(t,n)},clear:function(e){var t=timer.data;t[e]&&(clearTimeout(t[e]),delete t[e])}},_log=function(e,t,n){var i=options;return(i.showErrorMessages&&!n||n&&i.showDebugMessages)&&$.layout.msg(i.name+" / "+e,t!==!1),!1},_runCallbacks=function(evtName,pane,skipBoundEvents){function g(e){return e}var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P;return hasPane||"boolean"!==$.type(pane)||(skipBoundEvents=pane,pane=""),fn&&(isStr(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),$.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,$Ps[pane],s,o,lName):g(fn)(Instance,s,o,lName))),skipBoundEvents||retVal===!1||(hasPane?($P=$Ps[pane],o=options[pane],s=state[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):($N.triggerHandler("layout"+lng,[Instance,s,o,lName]),shrt&&$N.triggerHandler("layout"+shrt,[Instance,s,o,lName]))),hasPane&&"onresize_end"===evtName&&resizeChildren(pane+"",!0),retVal},_fixIframe=function(e){if(!browser.mozilla){var t=$Ps[e];"IFRAME"===state[e].tagName?t.css(_c.hidden).css(_c.visible):t.find("IFRAME").css(_c.hidden).css(_c.visible)}},cssSize=function(e,t){var n="horz"==_c[e].dir?cssH:cssW;return n($Ps[e],t)},cssMinDims=function(e){var t=$Ps[e],n=_c[e].dir,i={minWidth:1001-cssW(t,1e3),minHeight:1001-cssH(t,1e3)};return"horz"===n&&(i.minSize=i.minHeight),"vert"===n&&(i.minSize=i.minWidth),i},setOuterWidth=function(e,t,n){var i,r=e;isStr(e)?r=$Ps[e]:e.jquery||(r=$(e)),i=cssW(r,t),r.css({width:i}),i>0?n&&r.data("autoHidden")&&r.innerHeight()>0&&(r.show().data("autoHidden",!1),browser.mozilla||r.css(_c.hidden).css(_c.visible)):n&&!r.data("autoHidden")&&r.hide().data("autoHidden",!0)},setOuterHeight=function(e,t,n){var i,r=e;isStr(e)?r=$Ps[e]:e.jquery||(r=$(e)),i=cssH(r,t),r.css({height:i,visibility:"visible"}),i>0&&r.innerWidth()>0?n&&r.data("autoHidden")&&(r.show().data("autoHidden",!1),browser.mozilla||r.css(_c.hidden).css(_c.visible)):n&&!r.data("autoHidden")&&r.hide().data("autoHidden",!0)},_parseSize=function(e,t,n){if(n||(n=_c[e].dir),isStr(t)&&t.match(/%/)&&(t="100%"===t?-1:parseInt(t,10)/100),0===t)return 0;if(t>=1)return parseInt(t,10);var i=options,r=0;if("horz"==n?r=sC.innerHeight-($Ps.north?i.north.spacing_open:0)-($Ps.south?i.south.spacing_open:0):"vert"==n&&(r=sC.innerWidth-($Ps.west?i.west.spacing_open:0)-($Ps.east?i.east.spacing_open:0)),-1===t)return r;if(t>0)return round(r*t);if("center"==e)return 0;var o="horz"===n?"height":"width",s=$Ps[e],a="height"===o?$Cs[e]:!1,l=$.layout.showInvisibly(s),c=s.css(o),u=a?a.css(o):0;return s.css(o,"auto"),a&&a.css(o,"auto"),t="height"===o?s.outerHeight():s.outerWidth(),s.css(o,c).css(l),a&&a.css(o,u),t},getPaneSize=function(e,t){var n=$Ps[e],i=options[e],r=state[e],o=t?i.spacing_open:0,s=t?i.spacing_closed:0;return!n||r.isHidden?0:r.isClosed||r.isSliding&&t?s:"horz"===_c[e].dir?n.outerHeight()+o:n.outerWidth()+o},setSizeLimits=function(e,t){if(isInitialized()){var n=options[e],i=state[e],r=_c[e],o=r.dir,s=(r.sizeType.toLowerCase(),void 0!=t?t:i.isSliding),a=($Ps[e],n.spacing_open),l=_c.oppositeEdge[e],c=state[l],u=$Ps[l],d=!u||c.isVisible===!1||c.isSliding?0:"horz"==o?u.outerHeight():u.outerWidth(),h=(!u||c.isHidden?0:options[l][c.isClosed!==!1?"spacing_closed":"spacing_open"])||0,f="horz"==o?sC.innerHeight:sC.innerWidth,p=cssMinDims("center"),g="horz"==o?max(options.center.minHeight,p.minHeight):max(options.center.minWidth,p.minWidth),m=f-a-(s?0:_parseSize("center",g,o)+d+h),v=i.minSize=max(_parseSize(e,n.minSize),cssMinDims(e).minSize),y=i.maxSize=min(n.maxSize?_parseSize(e,n.maxSize):1e5,m),w=i.resizerPosition={},b=sC.inset.top,_=sC.inset.left,C=sC.innerWidth,k=sC.innerHeight,S=n.spacing_open;switch(e){case"north":w.min=b+v,w.max=b+y;break;case"west":w.min=_+v,w.max=_+y;break;case"south":w.min=b+k-y-S,w.max=b+k-v-S;break;case"east":w.min=_+C-y-S,w.max=_+C-v-S}}},calcNewCenterPaneDims=function(){var e={top:getPaneSize("north",!0),bottom:getPaneSize("south",!0),left:getPaneSize("west",!0),right:getPaneSize("east",!0),width:0,height:0};return e.width=sC.innerWidth-e.left-e.right,e.height=sC.innerHeight-e.bottom-e.top,e.top+=sC.inset.top,e.bottom+=sC.inset.bottom,e.left+=sC.inset.left,e.right+=sC.inset.right,e},getHoverClasses=function(e,t){var n=$(e),i=n.data("layoutRole"),r=n.data("layoutEdge"),o=options[r],s=o[i+"Class"],a="-"+r,l="-open",c="-closed",u="-sliding",d="-hover ",h=n.hasClass(s+c)?c:l,f=h===c?l:c,p=s+d+(s+a+d)+(s+h+d)+(s+a+h+d);return t&&(p+=s+f+d+(s+a+f+d)),"resizer"==i&&n.hasClass(s+u)&&(p+=s+u+d+(s+a+u+d)),$.trim(p)},addHover=function(e,t){var n=$(t||this);e&&"toggler"===n.data("layoutRole")&&e.stopPropagation(),n.addClass(getHoverClasses(n))},removeHover=function(e,t){var n=$(t||this);n.removeClass(getHoverClasses(n,!0))},onResizerEnter=function(e){var t=$(this).data("layoutEdge"),n=state[t];n.isClosed||n.isResizing||state.paneResizing||($.fn.disableSelection&&$("body").disableSelection(),options.maskPanesEarly&&showMasks(t,{resizing:!0}))},onResizerLeave=function(e,t){var n=t||this,i=$(n).data("layoutEdge"),r=i+"ResizerLeave";timer.clear(i+"_openSlider"),timer.clear(r),t?state.paneResizing||($.fn.enableSelection&&$("body").enableSelection(),options.maskPanesEarly&&hideMasks()):timer.set(r,function(){onResizerLeave(e,n)},200)},_create=function(){initOptions();var e=options,t=state;return t.creatingLayout=!0,runPluginCallbacks(Instance,$.layout.onCreate),!1===_runCallbacks("onload_start")?"cancel":(_initContainer(),initHotkeys(),$(window).bind("unload."+sID,unload),runPluginCallbacks(Instance,$.layout.onLoad),e.initPanes&&_initLayoutElements(),delete t.creatingLayout,state.initialized)},isInitialized=function(){return state.initialized||state.creatingLayout?!0:_initLayoutElements()},_initLayoutElements=function(e){var t=options;if(!$N.is(":visible"))return!e&&browser.webkit&&"BODY"===$N[0].tagName&&setTimeout(function(){_initLayoutElements(!0)},50),!1;if(!getPane("center").length)return _log(t.errors.centerPaneMissing);if(state.creatingLayout=!0,$.extend(sC,elDims($N,t.inset)),initPanes(),t.scrollToBookmarkOnLoad){var n=self.location;n.hash&&n.replace(n.hash)}return Instance.hasParentLayout?t.resizeWithWindow=!1:t.resizeWithWindow&&$(window).bind("resize."+sID,windowResize),delete state.creatingLayout,state.initialized=!0,runPluginCallbacks(Instance,$.layout.onReady),_runCallbacks("onload_end"),!0},createChildren=function(e,t){var n=evtPane.call(this,e),i=$Ps[n];if(i){var r=$Cs[n],o=state[n],s=options[n],a=options.stateManagement||{},l=t?s.children=t:s.children;if($.isPlainObject(l))l=[l];else if(!l||!$.isArray(l))return;$.each(l,function(e,t){if($.isPlainObject(t)){var s=t.containerSelector?i.find(t.containerSelector):r||i;s.each(function(){var e=$(this),i=e.data("layout");if(!i){if(setInstanceKey({container:e,options:t},o),a.includeChildren&&state.stateData[n]){var r=state.stateData[n].children||{},s=r[t.instanceKey],l=t.stateManagement||(t.stateManagement={autoLoad:!0});l.autoLoad===!0&&s&&(l.autoSave=!1,l.includeChildren=!0,l.autoLoad=$.extend(!0,{},s))}i=e.layout(t),i&&refreshChildren(n,i)}})}})}},setInstanceKey=function(e,t){var n=e.container,i=e.options,r=i.stateManagement,o=i.instanceKey||n.data("layoutInstanceKey");return o||(o=(r&&r.cookie?r.cookie.name:"")||i.name),o=o?o.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++t.childIdx,i.instanceKey=o,n.data("layoutInstanceKey",o),o},refreshChildren=function(e,t){var n,i=$Ps[e],r=children[e],o=state[e];$.isPlainObject(r)&&($.each(r,function(e,t){t.destroyed&&delete r[e]}),$.isEmptyObject(r)&&(r=children[e]=null)),t||r||(t=i.data("layout")),t&&(t.hasParentLayout=!0,n=t.options,setInstanceKey(t,o),r||(r=children[e]={}),r[n.instanceKey]=t.container.data("layout")),Instance[e].children=children[e],t||createChildren(e)},windowResize=function(){var e=options,t=Number(e.resizeWithWindowDelay);10>t&&(t=100),timer.clear("winResize"),timer.set("winResize",function(){timer.clear("winResize"),timer.clear("winResizeRepeater");var t=elDims($N,e.inset);(t.innerWidth!==sC.innerWidth||t.innerHeight!==sC.innerHeight)&&resizeAll()},t),timer.data.winResizeRepeater||setWindowResizeRepeater()},setWindowResizeRepeater=function(){var e=Number(options.resizeWithWindowMaxDelay);
e>0&&timer.set("winResizeRepeater",function(){setWindowResizeRepeater(),resizeAll()},e)},unload=function(){_runCallbacks("onunload_start"),runPluginCallbacks(Instance,$.layout.onUnload),_runCallbacks("onunload_end")},_initContainer=function(){var e,t,n=$N[0],i=$("html"),r=sC.tagName=n.tagName,o=sC.id=n.id,s=sC.className=n.className,a=options,l=a.name,c="position,margin,padding,border",u="layoutCSS",d={},h="hidden",f=$N.data("parentLayout"),p=$N.data("layoutEdge"),g=f&&p,m=$.layout.cssNum;sC.selector=$N.selector.split(".slice")[0],sC.ref=(a.name?a.name+" layout / ":"")+r+(o?"#"+o:s?".["+s+"]":""),sC.isBody="BODY"===r,g||sC.isBody||(e=$N.closest("."+$.layout.defaults.panes.paneClass),f=e.data("parentLayout"),p=e.data("layoutEdge"),g=f&&p),$N.data({layout:Instance,layoutContainer:sID}).addClass(a.containerClass);var v={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(l in v)$N.bind("layout"+l.toLowerCase()+"."+sID,Instance[v[l]||l]);g&&(Instance.hasParentLayout=!0,f.refreshChildren(p,Instance)),$N.data(u)||(sC.isBody?($N.data(u,$.extend(styles($N,c),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")})),i.data(u,$.extend(styles(i,"padding"),{height:"auto",overflow:i.css("overflow"),overflowX:i.css("overflowX"),overflowY:i.css("overflowY")}))):$N.data(u,styles($N,c+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{if(d={overflow:h,overflowX:h,overflowY:h},$N.css(d),a.inset&&!$.isPlainObject(a.inset)&&(t=parseInt(a.inset,10)||0,a.inset={top:t,bottom:t,left:t,right:t}),sC.isBody)a.outset?$.isPlainObject(a.outset)||(t=parseInt(a.outset,10)||0,a.outset={top:t,bottom:t,left:t,right:t}):a.outset={top:m(i,"paddingTop"),bottom:m(i,"paddingBottom"),left:m(i,"paddingLeft"),right:m(i,"paddingRight")},i.css(d).css({height:"100%",border:"none",padding:0,margin:0}),browser.isIE6?($N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),a.inset||(a.inset=elDims($N).inset)):($N.css({width:"auto",height:"auto",margin:0,position:"absolute"}),$N.css(a.outset)),$.extend(sC,elDims($N,a.inset));else{var y=$N.css("position");y&&y.match(/(fixed|absolute|relative)/)||$N.css("position","relative"),$N.is(":visible")&&($.extend(sC,elDims($N,a.inset)),sC.innerHeight<1&&_log(a.errors.noContainerHeight.replace(/CONTAINER/,sC.ref)))}m($N,"minWidth")&&$N.parent().css("overflowX","auto"),m($N,"minHeight")&&$N.parent().css("overflowY","auto")}catch(w){}},initHotkeys=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var n=options[t];return n.enableCursorHotkey||n.customHotkey?($(document).bind("keydown."+sID,keyDown),!1):void 0})},initOptions=function(){function e(e){var t=options[e],n=options.panes;t.fxSettings||(t.fxSettings={}),n.fxSettings||(n.fxSettings={}),$.each(["_open","_close","_size"],function(i,r){var o="fxName"+r,s="fxSpeed"+r,a="fxSettings"+r,l=t[o]=t[o]||n[o]||t.fxName||n.fxName||"none",c=$.effects&&($.effects[l]||$.effects.effect&&$.effects.effect[l]);"none"!==l&&options.effects[l]&&c||(l=t[o]="none");var u=options.effects[l]||{},d=u.all||null,h=u[e]||null;t[s]=t[s]||n[s]||t.fxSpeed||n.fxSpeed||null,t[a]=$.extend(!0,{},d,h,n.fxSettings,t.fxSettings,n[a],t[a])}),delete t.fxName,delete t.fxSpeed,delete t.fxSettings}var t,n,i,r,o,s,a;if(opts=$.layout.transformData(opts,!0),opts=$.layout.backwardCompatibility.renameAllOptions(opts),!$.isEmptyObject(opts.panes)){for(t=$.layout.optionsMap.noDefault,o=0,s=t.length;s>o;o++)i=t[o],delete opts.panes[i];for(t=$.layout.optionsMap.layout,o=0,s=t.length;s>o;o++)i=t[o],delete opts.panes[i]}t=$.layout.optionsMap.layout;var l=$.layout.config.optionRootKeys;for(i in opts)r=opts[i],$.inArray(i,l)<0&&$.inArray(i,t)<0&&(opts.panes[i]||(opts.panes[i]=$.isPlainObject(r)?$.extend(!0,{},r):r),delete opts[i]);$.extend(!0,options,opts),$.each(_c.allPanes,function(r,o){if(_c[o]=$.extend(!0,{},_c.panes,_c[o]),n=options.panes,a=options[o],"center"===o)for(t=$.layout.optionsMap.center,r=0,s=t.length;s>r;r++)i=t[r],opts.center[i]||!opts.panes[i]&&a[i]||(a[i]=n[i]);else a=options[o]=$.extend(!0,{},n,a),e(o),a.resizerClass||(a.resizerClass="ui-layout-resizer"),a.togglerClass||(a.togglerClass="ui-layout-toggler");a.paneClass||(a.paneClass="ui-layout-pane")});var c=opts.zIndex,u=options.zIndexes;c>0&&(u.pane_normal=c,u.content_mask=max(c+1,u.content_mask),u.resizer_normal=max(c+2,u.resizer_normal)),delete options.panes},getPane=function(e){var t=options[e].paneSelector;if("#"===t.substr(0,1))return $N.find(t).eq(0);var n=$N.children(t).eq(0);return n.length?n:$N.children("form:first").children(t).eq(0)},initPanes=function(e){evtPane(e),$.each(_c.allPanes,function(e,t){addPane(t,!0)}),initHandles(),$.each(_c.borderPanes,function(e,t){$Ps[t]&&state[t].isVisible&&(setSizeLimits(t),makePaneFit(t))}),sizeMidPanes("center"),$.each(_c.allPanes,function(e,t){afterInitPane(t)})},addPane=function(e,t){if(t||isInitialized()){var n,i,r,o=options[e],s=state[e],a=_c[e],l=a.dir,c=(s.fx,o.spacing_open||0,"center"===e),u={},d=$Ps[e];if(d?removePane(e,!1,!0,!1):$Cs[e]=!1,d=$Ps[e]=getPane(e),!d.length)return void($Ps[e]=!1);if(!d.data("layoutCSS")){var h="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border";d.data("layoutCSS",styles(d,h))}Instance[e]={name:e,pane:$Ps[e],content:$Cs[e],options:options[e],state:state[e],children:children[e]},d.data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"pane"}).css(a.cssReq).css("zIndex",options.zIndexes.pane_normal).css(o.applyDemoStyles?a.cssDemo:{}).addClass(o.paneClass+" "+o.paneClass+"-"+e).bind("mouseenter."+sID,addHover).bind("mouseleave."+sID,removeHover);var f,p={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(f in p)d.bind("layoutpane"+f.toLowerCase()+"."+sID,Instance[p[f]||f]);initContent(e,!1),c||(n=s.size=_parseSize(e,o.size),i=_parseSize(e,o.minSize)||1,r=_parseSize(e,o.maxSize)||1e5,n>0&&(n=max(min(n,r),i)),s.autoResize=o.autoResize,s.isClosed=!1,s.isSliding=!1,s.isResizing=!1,s.isHidden=!1,s.pins||(s.pins=[])),s.tagName=d[0].tagName,s.edge=e,s.noRoom=!1,s.isVisible=!0,setPanePosition(e),"horz"===l?u.height=cssH(d,n):"vert"===l&&(u.width=cssW(d,n)),d.css(u),"horz"!=l&&sizeMidPanes(e,!0),state.initialized&&(initHandles(e),initHotkeys(e)),o.initClosed&&o.closable&&!o.initHidden?close(e,!0,!0):o.initHidden||o.initClosed?hide(e):s.noRoom||d.css("display","block"),d.css("visibility","visible"),o.showOverflowOnHover&&d.hover(allowOverflow,resetOverflow),state.initialized&&afterInitPane(e)}},afterInitPane=function(e){var t=$Ps[e],n=state[e],i=options[e];t&&(t.data("layout")&&refreshChildren(e,t.data("layout")),n.isVisible&&(state.initialized?resizeAll():sizeContent(e),i.triggerEventsOnLoad?_runCallbacks("onresize_end",e):resizeChildren(e,!0)),i.initChildren&&i.children&&createChildren(e))},setPanePosition=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var n=$Ps[t],i=$Rs[t],r=(options[t],state[t]),o=_c[t].side,s={};if(n){switch(t){case"north":s.top=sC.inset.top,s.left=sC.inset.left,s.right=sC.inset.right;break;case"south":s.bottom=sC.inset.bottom,s.left=sC.inset.left,s.right=sC.inset.right;break;case"west":s.left=sC.inset.left;break;case"east":s.right=sC.inset.right;break;case"center":}n.css(s),i&&r.isClosed?i.css(o,sC.inset[o]):i&&!r.isHidden&&i.css(o,sC.inset[o]+getPaneSize(t))}})},initHandles=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var n=$Ps[t];if($Rs[t]=!1,$Ts[t]=!1,n){var i=options[t],r=state[t],o=(_c[t],"#"===i.paneSelector.substr(0,1)?i.paneSelector.substr(1):""),s=i.resizerClass,a=i.togglerClass,l=(r.isVisible?i.spacing_open:i.spacing_closed,"-"+t),c=(r.isVisible?"-open":"-closed",Instance[t]),u=c.resizer=$Rs[t]=$("<div></div>"),d=c.toggler=i.closable?$Ts[t]=$("<div></div>"):!1;!r.isVisible&&i.slidable&&u.attr("title",i.tips.Slide).css("cursor",i.sliderCursor),u.attr("id",o?o+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(i.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(s+" "+s+l).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).appendTo($N),i.resizerDblClickToggle&&u.bind("dblclick."+sID,toggle),d&&(d.attr("id",o?o+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(i.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(a+" "+a+l).hover(addHover,removeHover).bind("mouseenter",onResizerEnter).appendTo(u),i.togglerContent_open&&$("<span>"+i.togglerContent_open+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(d),i.togglerContent_closed&&$("<span>"+i.togglerContent_closed+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(d),enableClosable(t)),initResizable(t),r.isVisible?setAsOpen(t):(setAsClosed(t),bindStartSlidingEvents(t,!0))}}),sizeHandles()},initContent=function(e,t){if(isInitialized()){var n,i=options[e],r=i.contentSelector,o=Instance[e],s=$Ps[e];r&&(n=o.content=$Cs[e]=i.findNestedContent?s.find(r).eq(0):s.children(r).eq(0)),n&&n.length?(n.data("layoutRole","content"),n.data("layoutCSS")||n.data("layoutCSS",styles(n,"height")),n.css(_c.content.cssReq),i.applyDemoStyles&&(n.css(_c.content.cssDemo),s.css(_c.content.cssDemoPane)),s.css("overflowX").match(/(scroll|auto)/)&&s.css("overflow","hidden"),state[e].content={},t!==!1&&sizeContent(e)):o.content=$Cs[e]=!1}},initResizable=function(e){var t=$.layout.plugins.draggable;e=e?e.split(","):_c.borderPanes,$.each(e,function(e,i){var r=options[i];if(!t||!$Ps[i]||!r.resizable)return r.resizable=!1,!0;var o,s,a=state[i],l=options.zIndexes,c=_c[i],u="horz"==c.dir?"top":"left",d=($Ps[i],$Rs[i]),h=r.resizerClass,f=0,p=h+"-drag",g=h+"-"+i+"-drag",m=h+"-dragging",v=h+"-"+i+"-dragging",y=h+"-dragging-limit",w=h+"-"+i+"-dragging-limit",b=!1;a.isClosed||d.attr("title",r.tips.Resize).css("cursor",r.resizerCursor),d.draggable({containment:$N[0],axis:"horz"==c.dir?"y":"x",delay:0,distance:1,grid:r.resizingGrid,helper:"clone",opacity:r.resizerDragOpacity,addClasses:!1,zIndex:l.resizer_drag,start:function(e,t){return r=options[i],a=state[i],s=r.livePaneResizing,!1===_runCallbacks("ondrag_start",i)?!1:(a.isResizing=!0,state.paneResizing=i,timer.clear(i+"_closeSlider"),setSizeLimits(i),o=a.resizerPosition,f=t.position[u],d.addClass(p+" "+g),b=!1,$("body").disableSelection(),void showMasks(i,{resizing:!0}))},drag:function(e,t){b||(t.helper.addClass(m+" "+v).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),b=!0,a.isSliding&&$Ps[i].css("zIndex",l.pane_sliding));var c=0;t.position[u]<o.min?(t.position[u]=o.min,c=-1):t.position[u]>o.max&&(t.position[u]=o.max,c=1),c?(t.helper.addClass(y+" "+w),window.defaultStatus=c>0&&i.match(/(north|west)/)||0>c&&i.match(/(south|east)/)?r.tips.maxSizeWarning:r.tips.minSizeWarning):(t.helper.removeClass(y+" "+w),window.defaultStatus=""),s&&Math.abs(t.position[u]-f)>=r.liveResizingTolerance&&(f=t.position[u],n(e,t,i))},stop:function(e,t){$("body").enableSelection(),window.defaultStatus="",d.removeClass(p+" "+g),a.isResizing=!1,state.paneResizing=!1,n(e,t,i,!0)}})});var n=function(e,t,n,i){var r,o=t.position,s=_c[n],a=options[n],l=state[n];switch(n){case"north":r=o.top;break;case"west":r=o.left;break;case"south":r=sC.layoutHeight-o.top-a.spacing_open;break;case"east":r=sC.layoutWidth-o.left-a.spacing_open}var c=r-sC.inset[s.side];if(i)!1!==_runCallbacks("ondrag_end",n)&&manualSizePane(n,c,!1,!0),hideMasks(!0),l.isSliding&&showMasks(n,{resizing:!0});else{if(Math.abs(c-l.size)<a.liveResizingTolerance)return;manualSizePane(n,c,!1,!0),sizeMasks()}}},sizeMask=function(){var e=$(this),t=e.data("layoutMask"),n=state[t];"IFRAME"==n.tagName&&n.isVisible&&e.css({top:n.offsetTop,left:n.offsetLeft,width:n.outerWidth,height:n.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(e,t){var n,i,r=_c[e],o=["center"],s=options.zIndexes,a=$.extend({objectsOnly:!1,animation:!1,resizing:!0,sliding:state[e].isSliding},t);a.resizing&&o.push(e),a.sliding&&o.push(_c.oppositeEdge[e]),"horz"===r.dir&&(o.push("west"),o.push("east")),$.each(o,function(e,t){i=state[t],n=options[t],i.isVisible&&(n.maskObjects||!a.objectsOnly&&n.maskContents)&&getMasks(t).each(function(){sizeMask.call(this),this.style.zIndex=i.isSliding?s.pane_sliding+1:s.pane_normal+1,this.style.display="block"})})},hideMasks=function(e){if(e||!state.paneResizing)$Ms.hide();else if(!e&&!$.isEmptyObject(state.panesSliding))for(var t,n,i=$Ms.length-1;i>=0;i--)n=$Ms.eq(i),t=n.data("layoutMask"),options[t].maskObjects||n.hide()},getMasks=function(e){for(var t,n=$([]),i=0,r=$Ms.length;r>i;i++)t=$Ms.eq(i),t.data("layoutMask")===e&&(n=n.add(t));return n.length?n:createMasks(e)},createMasks=function(e){var t,n,i,r,o,s=$Ps[e],a=state[e],l=options[e],c=options.zIndexes,u=$([]);if(!l.maskContents&&!l.maskObjects)return u;for(o=0;o<(l.maskObjects?2:1);o++)t=l.maskObjects&&0==o,n=document.createElement(t?"iframe":"div"),i=$(n).data("layoutMask",e),n.className="ui-layout-mask ui-layout-mask-"+e,r=n.style,r.display="block",r.position="absolute",r.background="#FFF",t&&(n.frameborder=0,n.src="about:blank",r.opacity=0,r.filter="Alpha(Opacity='0')",r.border=0),"IFRAME"==a.tagName?(r.zIndex=c.pane_normal+1,$N.append(n)):(i.addClass("ui-layout-mask-inside-pane"),r.zIndex=l.maskZindex||c.content_mask,r.top=0,r.left=0,r.width="100%",r.height="100%",s.append(n)),u=u.add(n),$Ms=$Ms.add(n);return u},destroy=function(e,t){$(window).unbind("."+sID),$(document).unbind("."+sID),"object"==typeof e?evtPane(e):t=e,$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID),$Ms.remove(),$.each(_c.allPanes,function(e,n){removePane(n,!1,!0,t)});var n="layoutCSS";$N.data(n)&&!$N.data("layoutRole")&&$N.css($N.data(n)).removeData(n),"BODY"===sC.tagName&&($N=$("html")).data(n)&&$N.css($N.data(n)).removeData(n),runPluginCallbacks(Instance,$.layout.onDestroy),unload();for(var i in Instance)i.match(/^(container|options)$/)||delete Instance[i];return Instance.destroyed=!0,Instance},removePane=function(e,t,n,i){if(isInitialized()){var r=evtPane.call(this,e),o=$Ps[r],s=$Cs[r],a=$Rs[r],l=$Ts[r];o&&$.isEmptyObject(o.data())&&(o=!1),s&&$.isEmptyObject(s.data())&&(s=!1),a&&$.isEmptyObject(a.data())&&(a=!1),l&&$.isEmptyObject(l.data())&&(l=!1),o&&o.stop(!0,!0);var c=options[r],u=state[r],d="layout",h="layoutCSS",f=children[r],p=$.isPlainObject(f)&&!$.isEmptyObject(f),g=void 0!==i?i:c.destroyChildren;if(p&&g&&($.each(f,function(e,t){t.destroyed||t.destroy(!0),t.destroyed&&delete f[e]}),$.isEmptyObject(f)&&(f=children[r]=null,p=!1)),o&&t&&!p)o.remove();else if(o&&o[0]){var m=c.paneClass,v=m+"-"+r,y="-open",w="-sliding",b="-closed",_=[m,m+y,m+b,m+w,v,v+y,v+b,v+w];$.merge(_,getHoverClasses(o,!0)),o.removeClass(_.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID),p&&s?(s.width(s.width()),$.each(f,function(e,t){t.resizeAll()})):s&&s.css(s.data(h)).removeData(h).removeData("layoutRole"),o.data(d)||o.css(o.data(h)).removeData(h)}l&&l.remove(),a&&a.remove(),Instance[r]=$Ps[r]=$Cs[r]=$Rs[r]=$Ts[r]=!1,u={removed:!0},n||resizeAll()}},_hidePane=function(e){var t=$Ps[e],n=options[e],i=t[0].style;n.useOffscreenClose?(t.data(_c.offscreenReset)||t.data(_c.offscreenReset,{left:i.left,right:i.right}),t.css(_c.offscreenCSS)):t.hide().removeData(_c.offscreenReset)},_showPane=function(e){var t=$Ps[e],n=options[e],i=_c.offscreenCSS,r=t.data(_c.offscreenReset),o=t[0].style;t.show().removeData(_c.offscreenReset),n.useOffscreenClose&&r&&(o.left==i.left&&(o.left=r.left),o.right==i.right&&(o.right=r.right))},hide=function(e,t){if(isInitialized()){var n=evtPane.call(this,e),i=options[n],r=state[n],o=$Ps[n],s=$Rs[n];o&&!r.isHidden&&(state.initialized&&!1===_runCallbacks("onhide_start",n)||(r.isSliding=!1,delete state.panesSliding[n],s&&s.hide(),!state.initialized||r.isClosed?(r.isClosed=!0,r.isHidden=!0,r.isVisible=!1,state.initialized||_hidePane(n),sizeMidPanes("horz"===_c[n].dir?"":"center"),(state.initialized||i.triggerEventsOnLoad)&&_runCallbacks("onhide_end",n)):(r.isHiding=!0,close(n,!1,t))))}},show=function(e,t,n,i){if(isInitialized()){var r=evtPane.call(this,e),o=(options[r],state[r]),s=$Ps[r];$Rs[r];s&&o.isHidden&&!1!==_runCallbacks("onshow_start",r)&&(o.isShowing=!0,o.isSliding=!1,delete state.panesSliding[r],t===!1?close(r,!0):open(r,!1,n,i))}},toggle=function(e,t){if(isInitialized()){var n=evtObj(e),i=evtPane.call(this,e),r=state[i];n&&n.stopImmediatePropagation(),r.isHidden?show(i):r.isClosed?open(i,!!t):close(i)}},_closePane=function(e,t){var n=($Ps[e],state[e]);_hidePane(e),n.isClosed=!0,n.isVisible=!1,t&&setAsClosed(e)},close=function(e,t,n,i){function r(){h.isMoving=!1,bindStartSlidingEvents(o,!0);var e=_c.oppositeEdge[o];state[e].noRoom&&(setSizeLimits(e),makePaneFit(e)),i||!state.initialized&&!d.triggerEventsOnLoad||(a||_runCallbacks("onclose_end",o),a&&_runCallbacks("onshow_end",o),l&&_runCallbacks("onhide_end",o))}var o=evtPane.call(this,e);if(!state.initialized&&$Ps[o])return void _closePane(o,!0);if(isInitialized()){var s,a,l,c,u=$Ps[o],d=($Rs[o],$Ts[o],options[o]),h=state[o];_c[o];$N.queue(function(e){if(!u||!d.closable&&!h.isShowing&&!h.isHiding||!t&&h.isClosed&&!h.isShowing)return e();var i=!h.isShowing&&!1===_runCallbacks("onclose_start",o);return a=h.isShowing,l=h.isHiding,c=h.isSliding,delete h.isShowing,delete h.isHiding,i?e():(s=!n&&!h.isClosed&&"none"!=d.fxName_close,h.isMoving=!0,h.isClosed=!0,h.isVisible=!1,l?h.isHidden=!0:a&&(h.isHidden=!1),h.isSliding?bindStopSlidingEvents(o,!1):sizeMidPanes("horz"===_c[o].dir?"":"center",!1),setAsClosed(o),void(s?(lockPaneForFX(o,!0),u.hide(d.fxName_close,d.fxSettings_close,d.fxSpeed_close,function(){lockPaneForFX(o,!1),h.isClosed&&r(),e()})):(_hidePane(o),r(),e())))})}},setAsClosed=function(e){if($Rs[e]){var t=($Ps[e],$Rs[e]),n=$Ts[e],i=options[e],r=(state[e],_c[e].side),o=i.resizerClass,s=i.togglerClass,a="-"+e,l="-open",c="-sliding",u="-closed";t.css(r,sC.inset[r]).removeClass(o+l+" "+o+a+l).removeClass(o+c+" "+o+a+c).addClass(o+u+" "+o+a+u),i.resizable&&$.layout.plugins.draggable&&t.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),n&&(n.removeClass(s+l+" "+s+a+l).addClass(s+u+" "+s+a+u).attr("title",i.tips.Open),n.children(".content-open").hide(),n.children(".content-closed").css("display","block")),syncPinBtns(e,!1),state.initialized&&sizeHandles()}},open=function(e,t,n,i){function r(){u.isMoving=!1,_fixIframe(a),u.isSliding||sizeMidPanes("vert"==_c[a].dir?"center":"",!1),setAsOpen(a)}if(isInitialized()){var o,s,a=evtPane.call(this,e),l=$Ps[a],c=($Rs[a],$Ts[a],options[a]),u=state[a];_c[a];$N.queue(function(e){if(!l||!c.resizable&&!c.closable&&!u.isShowing||u.isVisible&&!u.isSliding)return e();if(u.isHidden&&!u.isShowing)return e(),void show(a,!0);u.autoResize&&u.size!=c.size?sizePane(a,c.size,!0,!0,!0):setSizeLimits(a,t);var d=_runCallbacks("onopen_start",a);return"abort"===d?e():("NC"!==d&&setSizeLimits(a,t),u.minSize>u.maxSize?(syncPinBtns(a,!1),!i&&c.tips.noRoomToOpen&&alert(c.tips.noRoomToOpen),e()):(t?bindStopSlidingEvents(a,!0):u.isSliding?bindStopSlidingEvents(a,!1):c.slidable&&bindStartSlidingEvents(a,!1),u.noRoom=!1,makePaneFit(a),s=u.isShowing,delete u.isShowing,o=!n&&u.isClosed&&"none"!=c.fxName_open,u.isMoving=!0,u.isVisible=!0,u.isClosed=!1,s&&(u.isHidden=!1),void(o?(lockPaneForFX(a,!0),l.show(c.fxName_open,c.fxSettings_open,c.fxSpeed_open,function(){lockPaneForFX(a,!1),u.isVisible&&r(),e()})):(_showPane(a),r(),e()))))})}},setAsOpen=function(e,t){var n=$Ps[e],i=$Rs[e],r=$Ts[e],o=options[e],s=state[e],a=_c[e].side,l=o.resizerClass,c=o.togglerClass,u="-"+e,d="-open",h="-closed",f="-sliding";i.css(a,sC.inset[a]+getPaneSize(e)).removeClass(l+h+" "+l+u+h).addClass(l+d+" "+l+u+d),s.isSliding?i.addClass(l+f+" "+l+u+f):i.removeClass(l+f+" "+l+u+f),removeHover(0,i),o.resizable&&$.layout.plugins.draggable?i.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.tips.Resize):s.isSliding||i.css("cursor","default"),r&&(r.removeClass(c+h+" "+c+u+h).addClass(c+d+" "+c+u+d).attr("title",o.tips.Close),removeHover(0,r),r.children(".content-closed").hide(),r.children(".content-open").css("display","block")),syncPinBtns(e,!s.isSliding),$.extend(s,elDims(n)),state.initialized&&(sizeHandles(),sizeContent(e,!0)),!t&&(state.initialized||o.triggerEventsOnLoad)&&n.is(":visible")&&(_runCallbacks("onopen_end",e),s.isShowing&&_runCallbacks("onshow_end",e),state.initialized&&_runCallbacks("onresize_end",e))},slideOpen=function(e){function t(){r.isClosed?r.isMoving||open(i,!0):bindStopSlidingEvents(i,!0)}if(isInitialized()){var n=evtObj(e),i=evtPane.call(this,e),r=state[i],o=options[i].slideDelay_open;n&&n.stopImmediatePropagation(),r.isClosed&&n&&"mouseenter"===n.type&&o>0?timer.set(i+"_openSlider",t,o):t()}},slideClose=function(e){function t(){o.isClosed?bindStopSlidingEvents(i,!1):o.isMoving||close(i)}if(isInitialized()){var n=evtObj(e),i=evtPane.call(this,e),r=options[i],o=state[i],s=o.isMoving?1e3:300;if(!o.isClosed&&!o.isResizing)if("click"===r.slideTrigger_close)t();else{if(r.preventQuickSlideClose&&o.isMoving)return;if(r.preventPrematureSlideClose&&n&&$.layout.isMouseOverElem(n,$Ps[i]))return;n?timer.set(i+"_closeSlider",t,max(r.slideDelay_close,s)):t()}}},slideToggle=function(e){var t=evtPane.call(this,e);toggle(t,!0)},lockPaneForFX=function(e,t){var n=$Ps[e],i=state[e],r=options[e],o=options.zIndexes;t?(showMasks(e,{animation:!0,objectsOnly:!0}),n.css({zIndex:o.pane_animate}),"south"==e?n.css({top:sC.inset.top+sC.innerHeight-n.outerHeight()}):"east"==e&&n.css({left:sC.inset.left+sC.innerWidth-n.outerWidth()})):(hideMasks(),n.css({zIndex:i.isSliding?o.pane_sliding:o.pane_normal}),"south"==e?n.css({top:"auto"}):"east"!=e||n.css("left").match(/\-99999/)||n.css({left:"auto"}),browser.msie&&r.fxOpacityFix&&"slide"!=r.fxName_open&&n.css("filter")&&1==n.css("opacity")&&n[0].style.removeAttribute("filter"))},bindStartSlidingEvents=function(e,t){var n=options[e],i=($Ps[e],$Rs[e]),r=n.slideTrigger_open.toLowerCase();!i||t&&!n.slidable||(r.match(/mouseover/)?r=n.slideTrigger_open="mouseenter":r.match(/(click|dblclick|mouseenter)/)||(r=n.slideTrigger_open="click"),n.resizerDblClickToggle&&r.match(/click/)&&i[t?"unbind":"bind"]("dblclick."+sID,toggle),i[t?"bind":"unbind"](r+"."+sID,slideOpen).css("cursor",t?n.sliderCursor:"default").attr("title",t?n.tips.Slide:""))},bindStopSlidingEvents=function(e,t){function n(t){timer.clear(e+"_closeSlider"),t.stopPropagation()}var i=options[e],r=state[e],o=(_c[e],options.zIndexes),s=i.slideTrigger_close.toLowerCase(),a=t?"bind":"unbind",l=$Ps[e],c=$Rs[e];timer.clear(e+"_closeSlider"),t?(r.isSliding=!0,state.panesSliding[e]=!0,bindStartSlidingEvents(e,!1)):(r.isSliding=!1,delete state.panesSliding[e]),l.css("zIndex",t?o.pane_sliding:o.pane_normal),c.css("zIndex",t?o.pane_sliding+2:o.resizer_normal),s.match(/(click|mouseleave)/)||(s=i.slideTrigger_close="mouseleave"),c[a](s,slideClose),"mouseleave"===s&&(l[a]("mouseleave."+sID,slideClose),c[a]("mouseenter."+sID,n),l[a]("mouseenter."+sID,n)),t?"click"!==s||i.resizable||(c.css("cursor",t?i.sliderCursor:"default"),c.attr("title",t?i.tips.Close:"")):timer.clear(e+"_closeSlider")},makePaneFit=function(e,t,n,i){var r=options[e],o=state[e],s=_c[e],a=$Ps[e],l=$Rs[e],c="vert"===s.dir,u=!1;if(("center"===e||c&&o.noVerticalRoom)&&(u=o.maxHeight>=0,u&&o.noRoom?(_showPane(e),l&&l.show(),o.isVisible=!0,o.noRoom=!1,c&&(o.noVerticalRoom=!1),_fixIframe(e)):u||o.noRoom||(_hidePane(e),l&&l.hide(),o.isVisible=!1,o.noRoom=!0)),"center"===e);else if(o.minSize<=o.maxSize){if(u=!0,o.size>o.maxSize)sizePane(e,o.maxSize,n,!0,i);else if(o.size<o.minSize)sizePane(e,o.minSize,n,!0,i);else if(l&&o.isVisible&&a.is(":visible")){var d=o.size+sC.inset[s.side];$.layout.cssNum(l,s.side)!=d&&l.css(s.side,d)}o.noRoom&&(o.wasOpen&&r.closable?r.autoReopen?open(e,!1,!0,!0):o.noRoom=!1:show(e,o.wasOpen,!0,!0))}else o.noRoom||(o.noRoom=!0,o.wasOpen=!o.isClosed&&!o.isSliding,o.isClosed||(r.closable?close(e,!0,!0):hide(e,!0)))},manualSizePane=function(e,t,n,i,r){if(isInitialized()){var o=evtPane.call(this,e),s=options[o],a=state[o],l=r||s.livePaneResizing&&!a.isResizing;a.autoResize=!1,sizePane(o,t,n,i,l)}},sizePane=function(e,t,n,i,r){function o(){for(var e="width"===p?d.outerWidth():d.outerHeight(),i=[{pane:l,count:1,target:t,actual:e,correct:t===e,attempt:t,cssSize:a}],o=i[0],c={},m="Inaccurate size after resizing the "+l+"-pane.";!(o.correct||(c={pane:l,count:o.count+1,target:t},o.actual>t?c.attempt=max(0,o.attempt-(o.actual-t)):c.attempt=max(0,o.attempt+(t-o.actual)),c.cssSize=cssSize(l,c.attempt),d.css(p,c.cssSize),c.actual="width"==p?d.outerWidth():d.outerHeight(),c.correct=t===c.actual,1===i.length&&(_log(m,!1,!0),_log(o,!1,!0)),_log(c,!1,!0),i.length>3));)i.push(c),o=i[i.length-1];u.size=t,$.extend(u,elDims(d)),u.isVisible&&d.is(":visible")&&(h&&h.css(f,t+sC.inset[f]),sizeContent(l)),!n&&!g&&state.initialized&&u.isVisible&&_runCallbacks("onresize_end",l),n||(u.isSliding||sizeMidPanes("horz"==_c[l].dir?"":"center",g,r),sizeHandles());var v=_c.oppositeEdge[l];s>t&&state[v].noRoom&&(setSizeLimits(v),makePaneFit(v,!1,n)),i.length>1&&_log(m+"\nSee the Error Console for details.",!0,!0)}if(isInitialized()){var s,a,l=evtPane.call(this,e),c=options[l],u=state[l],d=$Ps[l],h=$Rs[l],f=_c[l].side,p=_c[l].sizeType.toLowerCase(),g=u.isResizing&&!c.triggerEventsDuringLiveResize,m=i!==!0&&c.animatePaneSizing;$N.queue(function(e){if(setSizeLimits(l),s=u.size,t=_parseSize(l,t),t=max(t,_parseSize(l,c.minSize)),t=min(t,u.maxSize),t<u.minSize)return e(),void makePaneFit(l,!1,n);if(!r&&t===s)return e();if(u.newSize=t,!n&&state.initialized&&u.isVisible&&_runCallbacks("onresize_start",l),a=cssSize(l,t),m&&d.is(":visible")){var i=$.layout.effects.size[l]||$.layout.effects.size.all,h=c.fxSettings_size.easing||i.easing,f=options.zIndexes,g={};g[p]=a+"px",u.isMoving=!0,d.css({zIndex:f.pane_animate}).show().animate(g,c.fxSpeed_size,h,function(){d.css({zIndex:u.isSliding?f.pane_sliding:f.pane_normal}),u.isMoving=!1,delete u.newSize,o(),e()})}else d.css(p,a),delete u.newSize,d.is(":visible")?o():(u.size=t,$.extend(u,elDims(d))),e()})}},sizeMidPanes=function(e,t,n){e=(e?e:"east,west,center").split(","),$.each(e,function(e,i){if($Ps[i]){var r=options[i],o=state[i],s=$Ps[i],a=($Rs[i],!0),l={},c=$.layout.showInvisibly(s),u=calcNewCenterPaneDims();if($.extend(o,elDims(s)),"center"===i){if(!n&&o.isVisible&&u.width===o.outerWidth&&u.height===o.outerHeight)return s.css(c),!0;if($.extend(o,cssMinDims(i),{maxWidth:u.width,maxHeight:u.height}),l=u,o.newWidth=l.width,o.newHeight=l.height,l.width=cssW(s,l.width),l.height=cssH(s,l.height),a=l.width>=0&&l.height>=0,!state.initialized&&r.minWidth>u.width){var d=r.minWidth-o.outerWidth,h=options.east.minSize||0,f=options.west.minSize||0,p=state.east.size,g=state.west.size,m=p,v=g;if(d>0&&state.east.isVisible&&p>h&&(m=max(p-h,p-d),d-=p-m),d>0&&state.west.isVisible&&g>f&&(v=max(g-f,g-d),d-=g-v),0===d)return p&&p!=h&&sizePane("east",m,!0,!0,n),g&&g!=f&&sizePane("west",v,!0,!0,n),sizeMidPanes("center",t,n),void s.css(c)}}else{if(o.isVisible&&!o.noVerticalRoom&&$.extend(o,elDims(s),cssMinDims(i)),!n&&!o.noVerticalRoom&&u.height===o.outerHeight)return s.css(c),!0;l.top=u.top,l.bottom=u.bottom,o.newSize=u.height,l.height=cssH(s,u.height),o.maxHeight=l.height,a=o.maxHeight>=0,a||(o.noVerticalRoom=!0)}if(a?(!t&&state.initialized&&_runCallbacks("onresize_start",i),s.css(l),"center"!==i&&sizeHandles(i),!o.noRoom||o.isClosed||o.isHidden||makePaneFit(i),o.isVisible&&($.extend(o,elDims(s)),state.initialized&&sizeContent(i))):!o.noRoom&&o.isVisible&&makePaneFit(i),s.css(c),delete o.newSize,delete o.newWidth,delete o.newHeight,!o.isVisible)return!0;if("center"===i){var y=browser.isIE6||!browser.boxModel;$Ps.north&&(y||"IFRAME"==state.north.tagName)&&$Ps.north.css("width",cssW($Ps.north,sC.innerWidth)),$Ps.south&&(y||"IFRAME"==state.south.tagName)&&$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}!t&&state.initialized&&_runCallbacks("onresize_end",i)}})},resizeAll=function(e){var t=sC.innerWidth,n=sC.innerHeight;if(evtPane(e),$N.is(":visible")){if(!state.initialized)return void _initLayoutElements();if(e===!0&&$.isPlainObject(options.outset)&&$N.css(options.outset),$.extend(sC,elDims($N,options.inset)),sC.outerHeight){if(e===!0&&setPanePosition(),!1===_runCallbacks("onresizeall_start"))return!1;var i,r,o;sC.innerHeight<n,sC.innerWidth<t;$.each(["south","north","east","west"],function(e,t){$Ps[t]&&(r=options[t],o=state[t],o.autoResize&&o.size!=r.size?sizePane(t,r.size,!0,!0,!0):(setSizeLimits(t),makePaneFit(t,!1,!0,!0)))}),sizeMidPanes("",!0,!0),sizeHandles(),$.each(_c.allPanes,function(e,t){i=$Ps[t],i&&state[t].isVisible&&_runCallbacks("onresize_end",t)}),_runCallbacks("onresizeall_end")}}},resizeChildren=function(e,t){var n=evtPane.call(this,e);if(options[n].resizeChildren){t||refreshChildren(n);var i=children[n];$.isPlainObject(i)&&$.each(i,function(e,t){t.destroyed||t.resizeAll()})}},sizeContent=function(e,t){if(isInitialized()){var n=evtPane.call(this,e);n=n?n.split(","):_c.allPanes,$.each(n,function(e,n){function i(e){return max(l.css.paddingBottom,parseInt(e.css("marginBottom"),10)||0)}function r(){var e=options[n].contentIgnoreSelector,t=s.nextAll().not(".ui-layout-mask").not(e||":lt(0)"),r=t.filter(":visible"),o=r.filter(":last");c={top:s[0].offsetTop,height:s.outerHeight(),numFooters:t.length,hiddenFooters:t.length-r.length,spaceBelow:0},c.spaceAbove=c.top,c.bottom=c.top+c.height,o.length?c.spaceBelow=o[0].offsetTop+o.outerHeight()-c.bottom+i(o):c.spaceBelow=i(s)}var o=$Ps[n],s=$Cs[n],a=options[n],l=state[n],c=l.content;if(!o||!s||!o.is(":visible"))return!0;if((s.length||(initContent(n,!1),s))&&!1!==_runCallbacks("onsizecontent_start",n)){(!l.isMoving&&!l.isResizing||a.liveContentResizing||t||void 0==c.top)&&(r(),c.hiddenFooters>0&&"hidden"===o.css("overflow")&&(o.css("overflow","visible"),r(),o.css("overflow","hidden")));var u=l.innerHeight-(c.spaceAbove-l.css.paddingTop)-(c.spaceBelow-l.css.paddingBottom);s.is(":visible")&&c.height==u||(setOuterHeight(s,u,!0),c.height=u),state.initialized&&_runCallbacks("onsizecontent_end",n)}})}},sizeHandles=function(e){var t=evtPane.call(this,e);t=t?t.split(","):_c.borderPanes,$.each(t,function(e,t){var n,i=options[t],r=state[t],o=$Ps[t],s=$Rs[t],a=$Ts[t];if(o&&s){var l,c,u,d=_c[t].dir,h=r.isClosed?"_closed":"_open",f=i["spacing"+h],p=i["togglerAlign"+h],g=i["togglerLength"+h];if(0===f)return void s.hide();if(r.noRoom||r.isHidden||s.show(),"horz"===d?(l=sC.innerWidth,r.resizerLength=l,c=$.layout.cssNum(o,"left"),s.css({width:cssW(s,l),height:cssH(s,f),left:c>-9999?c:sC.inset.left})):(l=o.outerHeight(),r.resizerLength=l,s.css({height:cssH(s,l),width:cssW(s,f),top:sC.inset.top+getPaneSize("north",!0)})),removeHover(i,s),a){if(0===g||r.isSliding&&i.hideTogglerOnSlide)return void a.hide();if(a.show(),!(g>0)||"100%"===g||g>l)g=l,u=0;else if(isStr(p))switch(p){case"top":case"left":u=0;break;case"bottom":case"right":u=l-g;break;case"middle":case"center":default:u=round((l-g)/2)}else{var m=parseInt(p,10);u=p>=0?m:l-g+m}if("horz"===d){var v=cssW(a,g);a.css({width:v,height:cssH(a,f),left:u,top:0}),a.children(".content").each(function(){n=$(this),n.css("marginLeft",round((v-n.outerWidth())/2));
})}else{var y=cssH(a,g);a.css({height:y,width:cssW(a,f),top:u,left:0}),a.children(".content").each(function(){n=$(this),n.css("marginTop",round((y-n.outerHeight())/2))})}removeHover(0,a)}state.initialized||!i.initHidden&&!r.isHidden||(s.hide(),a&&a.hide())}})},enableClosable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Ts[t],i=options[t];n&&(i.closable=!0,n.bind("click."+sID,function(e){e.stopPropagation(),toggle(t)}).css("visibility","visible").css("cursor","pointer").attr("title",state[t].isClosed?i.tips.Open:i.tips.Close).show())}},disableClosable=function(e,t){if(isInitialized()){var n=evtPane.call(this,e),i=$Ts[n];i&&(options[n].closable=!1,state[n].isClosed&&open(n,!1,!0),i.unbind("."+sID).css("visibility",t?"hidden":"visible").css("cursor","default").attr("title",""))}},enableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&n.data("draggable")&&(options[t].slidable=!0,state[t].isClosed&&bindStartSlidingEvents(t,!0))}},disableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&(options[t].slidable=!1,state[t].isSliding?close(t,!1,!0):(bindStartSlidingEvents(t,!1),n.css("cursor","default").attr("title",""),removeHover(null,n[0])))}},enableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t],i=options[t];n&&n.data("draggable")&&(i.resizable=!0,n.draggable("enable"),state[t].isClosed||n.css("cursor",i.resizerCursor).attr("title",i.tips.Resize))}},disableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&n.data("draggable")&&(options[t].resizable=!1,n.draggable("disable").css("cursor","default").attr("title",""),removeHover(null,n[0]))}},swapPanes=function(e,t){function n(e){var t=$Ps[e],n=$Cs[e];return t?{pane:e,P:t?t[0]:!1,C:n?n[0]:!1,state:$.extend(!0,{},state[e]),options:$.extend(!0,{},options[e])}:!1}function i(e,t){if(e){var n,i,r=e.P,o=e.C,s=e.pane,l=_c[t],c=$.extend(!0,{},state[t]),u=options[t],d={resizerCursor:u.resizerCursor};$.each("fxName,fxSpeed,fxSettings".split(","),function(e,t){d[t+"_open"]=u[t+"_open"],d[t+"_close"]=u[t+"_close"],d[t+"_size"]=u[t+"_size"]}),$Ps[t]=$(r).data({layoutPane:Instance[t],layoutEdge:t}).css(_c.hidden).css(l.cssReq),$Cs[t]=o?$(o):!1,options[t]=$.extend(!0,{},e.options,d),state[t]=$.extend(!0,{},e.state),n=new RegExp(u.paneClass+"-"+s,"g"),r.className=r.className.replace(n,u.paneClass+"-"+t),initHandles(t),l.dir!=_c[s].dir?(i=a[t]||0,setSizeLimits(t),i=max(i,state[t].minSize),manualSizePane(t,i,!0,!0)):$Rs[t].css(l.side,sC.inset[l.side]+(state[t].isVisible?getPaneSize(t):0)),e.state.isVisible&&!c.isVisible?setAsOpen(t,!0):(setAsClosed(t),bindStartSlidingEvents(t,!0)),e=null}}if(isInitialized()){var r=evtPane.call(this,e);if(state[r].edge=t,state[t].edge=r,!1===_runCallbacks("onswap_start",r)||!1===_runCallbacks("onswap_start",t))return state[r].edge=r,void(state[t].edge=t);var o=n(r),s=n(t),a={};a[r]=o?o.state.size:0,a[t]=s?s.state.size:0,$Ps[r]=!1,$Ps[t]=!1,state[r]={},state[t]={},$Ts[r]&&$Ts[r].remove(),$Ts[t]&&$Ts[t].remove(),$Rs[r]&&$Rs[r].remove(),$Rs[t]&&$Rs[t].remove(),$Rs[r]=$Rs[t]=$Ts[r]=$Ts[t]=!1,i(o,t),i(s,r),o=s=a=null,$Ps[r]&&$Ps[r].css(_c.visible),$Ps[t]&&$Ps[t].css(_c.visible),resizeAll(),_runCallbacks("onswap_end",r),_runCallbacks("onswap_end",t)}},syncPinBtns=function(e,t){$.layout.plugins.buttons&&$.each(state[e].pins,function(n,i){$.layout.buttons.setPinState(Instance,$(i),e,t)})};try{var $N=$(this).eq(0);if(!$N.length)return _log(options.errors.containerMissing);if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout")}catch(e){console.log("eeeee",e)}var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id,Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:!1,children:children,north:!1,south:!1,west:!1,east:!1,center:!1};return"cancel"===_create()?null:Instance}}(jQuery),function(e){e.ui||(e.ui={}),e.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(t){for(var n,i=document.cookie,r=i?i.split(";"):[],o=0,s=r.length;s>o;o++)if(n=e.trim(r[o]).split("="),n[0]==t)return decodeURIComponent(n[1]);return null},write:function(t,n,i){var r="",o="",s=!1,a=i||{},l=a.expires||null,c=e.type(l);"date"===c?o=l:"string"===c&&l>0&&(l=parseInt(l,10),c="number"),"number"===c&&(o=new Date,l>0?o.setDate(o.getDate()+l):(o.setFullYear(1970),s=!0)),o&&(r+=";expires="+o.toUTCString()),a.path&&(r+=";path="+a.path),a.domain&&(r+=";domain="+a.domain),a.secure&&(r+=";secure"),document.cookie=t+"="+(s?"":encodeURIComponent(n))+r},clear:function(t){e.ui.cookie.write(t,"",{expires:-1})}},e.cookie||(e.cookie=function(t,n,i){var r=e.ui.cookie;if(null===n)r.clear(t);else{if(void 0===n)return r.read(t);r.write(t,n,i)}}),e.layout.plugins.stateManagement=!0,e.layout.config.optionRootKeys.push("stateManagement"),e.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,animateLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},e.layout.optionsMap.layout.push("stateManagement"),e.layout.state={saveCookie:function(t,n,i){var r=t.options,o=r.stateManagement,s=e.extend(!0,{},o.cookie,i||null),a=t.state.stateData=t.readState(n||o.stateKeys);return e.ui.cookie.write(s.name||r.name||"Layout",e.layout.state.encodeJSON(a),s),e.extend(!0,{},a)},deleteCookie:function(t){var n=t.options;e.ui.cookie.clear(n.stateManagement.cookie.name||n.name||"Layout")},readCookie:function(t){var n=t.options,i=e.ui.cookie.read(n.stateManagement.cookie.name||n.name||"Layout");return i?e.layout.state.decodeJSON(i):{}},loadCookie:function(t){var n=e.layout.state.readCookie(t);return n&&(t.state.stateData=e.extend(!0,{},n),t.loadState(n)),n},loadState:function(t,n,i){if(e.isPlainObject(n)&&!e.isEmptyObject(n)){n=t.state.stateData=e.layout.transformData(n);var r=t.options.stateManagement;if(i=e.extend({animateLoad:!1,includeChildren:r.includeChildren},i),t.state.initialized){var o,a,l,c,u,d=!i.animateLoad;if(e.each(e.layout.config.borderPanes,function(i,r){o=n[r],e.isPlainObject(o)&&(s=o.size,a=o.initClosed,l=o.initHidden,ar=o.autoResize,c=t.state[r],u=c.isVisible,ar&&(c.autoResize=ar),u||t._sizePane(r,s,!1,!1,!1),l===!0?t.hide(r,d):a===!0?t.close(r,!1,d):a===!1?t.open(r,!1,d):l===!1&&t.show(r,!1,d),u&&t._sizePane(r,s,!1,!1,d))}),i.includeChildren){var h,f;e.each(t.children,function(t,i){h=n[t]?n[t].children:0,h&&i&&e.each(i,function(e,t){f=h[e],t&&f&&t.loadState(f)})})}}else{var o=e.extend(!0,{},n);e.each(e.layout.config.allPanes,function(e,t){o[t]&&delete o[t].children}),e.extend(!0,t.options,o)}}},readState:function(t,n){"string"===e.type(n)&&(n={keys:n}),n||(n={});var i,r,o,s,a,l,c,u=t.options.stateManagement,d=n.includeChildren,h=void 0!==d?d:u.includeChildren,f=n.stateKeys||u.stateKeys,p={isClosed:"initClosed",isHidden:"initHidden"},g=t.state,m=e.layout.config.allPanes,v={};e.isArray(f)&&(f=f.join(",")),f=f.replace(/__/g,".").split(",");for(var y=0,w=f.length;w>y;y++)i=f[y].split("."),r=i[0],o=i[1],e.inArray(r,m)<0||(s=g[r][o],void 0!=s&&("isClosed"==o&&g[r].isSliding&&(s=!0),(v[r]||(v[r]={}))[p[o]?p[o]:o]=s));return h&&e.each(m,function(n,i){l=t.children[i],a=g.stateData[i],e.isPlainObject(l)&&!e.isEmptyObject(l)&&(c=v[i]||(v[i]={}),c.children||(c.children={}),e.each(l,function(t,n){n.state.initialized?c.children[t]=e.layout.state.readState(n):a&&a.children&&a.children[t]&&(c.children[t]=e.extend(!0,{},a.children[t]))}))}),v},encodeJSON:function(t){function n(t){var i,r,o,s=[],a=0,l=e.isArray(t);for(i in t)r=t[i],o=typeof r,"string"==o?r='"'+r+'"':"object"==o&&(r=n(r)),s[a++]=(l?"":'"'+i+'":')+r;return(l?"[":"{")+s.join(",")+(l?"]":"}")}return n(t)},decodeJSON:function(t){try{return e.parseJSON?e.parseJSON(t):window.eval("("+t+")")||{}}catch(n){return{}}},_create:function(t){var n=e.layout.state,i=t.options,r=i.stateManagement;if(e.extend(t,{readCookie:function(){return n.readCookie(t)},deleteCookie:function(){n.deleteCookie(t)},saveCookie:function(e,i){return n.saveCookie(t,e,i)},loadCookie:function(){return n.loadCookie(t)},loadState:function(e,i){n.loadState(t,e,i)},readState:function(e){return n.readState(t,e)},encodeJSON:n.encodeJSON,decodeJSON:n.decodeJSON}),t.state.stateData={},r.autoLoad)if(e.isPlainObject(r.autoLoad))e.isEmptyObject(r.autoLoad)||t.loadState(r.autoLoad);else if(r.enabled)if(e.isFunction(r.autoLoad)){var o={};try{o=r.autoLoad(t,t.state,t.options,t.options.name||"")}catch(s){}o&&e.isPlainObject(o)&&!e.isEmptyObject(o)&&t.loadState(o)}else t.loadCookie()},_unload:function(t){var n=t.options.stateManagement;if(n.enabled&&n.autoSave)if(e.isFunction(n.autoSave))try{n.autoSave(t,t.state,t.options,t.options.name||"")}catch(i){}else t.saveCookie()}},e.layout.onCreate.push(e.layout.state._create),e.layout.onUnload.push(e.layout.state._unload),e.layout.plugins.buttons=!0,e.layout.defaults.autoBindCustomButtons=!1,e.layout.optionsMap.layout.push("autoBindCustomButtons"),e.layout.buttons={init:function(t){var n,i="ui-layout-button-",r=t.options.name||"";e.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(o,s){e.each(e.layout.config.borderPanes,function(o,a){e("."+i+s+"-"+a).each(function(){n=e(this).data("layoutName")||e(this).attr("layoutName"),(void 0==n||n===r)&&t.bindButton(this,s,a)})})})},get:function(t,n,i,r){var o=e(n),s=t.options,a=s.errors.addButtonError;if(o.length)if(e.inArray(i,e.layout.config.borderPanes)<0)e.layout.msg(a+" "+s.errors.pane+": "+i,!0),o=e("");else{var l=s[i].buttonClass+"-"+r;o.addClass(l+" "+l+"-"+i).data("layoutName",s.name)}else e.layout.msg(a+" "+s.errors.selector+": "+n,!0);return o},bind:function(t,n,i,r){var o=e.layout.buttons;switch(i.toLowerCase()){case"toggle":o.addToggle(t,n,r);break;case"open":o.addOpen(t,n,r);break;case"close":o.addClose(t,n,r);break;case"pin":o.addPin(t,n,r);break;case"toggle-slide":o.addToggle(t,n,r,!0);break;case"open-slide":o.addOpen(t,n,r,!0)}return t},addToggle:function(t,n,i,r){return e.layout.buttons.get(t,n,i,"toggle").click(function(e){t.toggle(i,!!r),e.stopPropagation()}),t},addOpen:function(t,n,i,r){return e.layout.buttons.get(t,n,i,"open").attr("title",t.options[i].tips.Open).click(function(e){t.open(i,!!r),e.stopPropagation()}),t},addClose:function(t,n,i){return e.layout.buttons.get(t,n,i,"close").attr("title",t.options[i].tips.Close).click(function(e){t.close(i),e.stopPropagation()}),t},addPin:function(t,n,i){var r=e.layout.buttons,o=r.get(t,n,i,"pin");if(o.length){var s=t.state[i];o.click(function(n){r.setPinState(t,e(this),i,s.isSliding||s.isClosed),s.isSliding||s.isClosed?t.open(i):t.close(i),n.stopPropagation()}),r.setPinState(t,o,i,!s.isClosed&&!s.isSliding),s.pins.push(n)}return t},setPinState:function(e,t,n,i){var r=t.attr("pin");if(!r||i!==("down"==r)){var o=e.options[n],s=o.buttonClass+"-pin",a=s+"-"+n,l=s+"-up "+a+"-up",c=s+"-down "+a+"-down";t.attr("pin",i?"down":"up").attr("title",i?o.tips.Unpin:o.tips.Pin).removeClass(i?l:c).addClass(i?c:l)}},syncPinBtns:function(t,n,i){e.each(t.state[n].pins,function(r,o){e.layout.buttons.setPinState(t,e(o),n,i)})},_load:function(t){var n=e.layout.buttons;e.extend(t,{bindButton:function(e,i,r){return n.bind(t,e,i,r)},addToggleBtn:function(e,i,r){return n.addToggle(t,e,i,r)},addOpenBtn:function(e,i,r){return n.addOpen(t,e,i,r)},addCloseBtn:function(e,i){return n.addClose(t,e,i)},addPinBtn:function(e,i){return n.addPin(t,e,i)}});for(var i=0;4>i;i++){var r=e.layout.config.borderPanes[i];t.state[r].pins=[]}t.options.autoBindCustomButtons&&n.init(t)},_unload:function(e){}},e.layout.onLoad.push(e.layout.buttons._load),e.layout.plugins.browserZoom=!0,e.layout.defaults.browserZoomCheckInterval=1e3,e.layout.optionsMap.layout.push("browserZoomCheckInterval"),e.layout.browserZoom={_init:function(t){e.layout.browserZoom.ratio()!==!1&&e.layout.browserZoom._setTimer(t)},_setTimer:function(t){if(!t.destroyed){var n=t.options,i=t.state,r=t.hasParentLayout?5e3:Math.max(n.browserZoomCheckInterval,100);setTimeout(function(){if(!t.destroyed&&n.resizeWithWindow){var r=e.layout.browserZoom.ratio();r!==i.browserZoom&&(i.browserZoom=r,t.resizeAll()),e.layout.browserZoom._setTimer(t)}},r)}},ratio:function(){function t(e,t){return(parseInt(e,10)/parseInt(t,10)*100).toFixed()}var n,i,r,o=window,s=screen,a=document,l=a.documentElement||a.body,c=e.layout.browser,u=c.version;return c.msie&&u>8||!c.msie?!1:s.deviceXDPI&&s.systemXDPI?t(s.deviceXDPI,s.systemXDPI):c.webkit&&(n=a.body.getBoundingClientRect)?t(n.left-n.right,a.body.offsetWidth):c.webkit&&(i=o.outerWidth)?t(i,o.innerWidth):(i=s.width)&&(r=l.clientWidth)?t(i,r):!1}},e.layout.onReady.push(e.layout.browserZoom._init)}(jQuery),define("libs/jquery-layout",function(){}),function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,r=i._mouseInit,o=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)}}}(jQuery),define("libs/jquery.ui.touch-punch",function(){}),define("ide/directives/layout",["base","libs/jquery-layout","libs/jquery.ui.touch-punch"],function(e){return e.directive("layout",["$parse","$compile","ide",function(e,t,n){return{compile:function(){return{pre:function(i,r,o){var s,a,l,c,u=o.layout,d=o.customTogglerPane,h=o.customTogglerMsgWhenOpen,f=o.customTogglerMsgWhenClosed,p=null!=d&&null!=h&&null!=f;l=null!=o.spacingOpen?parseInt(o.spacingOpen,10):window.uiConfig.defaultResizerSizeOpen,a=null!=o.spacingClosed?parseInt(o.spacingClosed,10):window.uiConfig.defaultResizerSizeClosed;var g={spacing_open:l,spacing_closed:a,slidable:!1,enableCursorHotkey:!1,onopen:function(e){return A(e)},onclose:function(e){return T(e)},onresize:function(){return w()},maskIframesOnResize:i.$eval(o.maskIframesOnResize||"false"),east:{size:i.$eval(o.initialSizeEast),initClosed:i.$eval(o.initClosedEast)},west:{size:i.$eval(o.initialSizeEast),initClosed:i.$eval(o.initClosedWest)}};null!=(c=n.localStorage("layout.".concat(u)))&&(null!=c.east&&(null==o.minimumRestoreSizeEast||c.east.size>=o.minimumRestoreSizeEast&&!c.east.initClosed)&&(g.east=c.east),null!=c.west&&(null==o.minimumRestoreSizeWest||c.west.size>=o.minimumRestoreSizeWest&&!c.west.initClosed)&&(g.west=c.west)),null!=window.uiConfig.eastResizerCursor&&(g.east.resizerCursor=window.uiConfig.eastResizerCursor),null!=window.uiConfig.westResizerCursor&&(g.west.resizerCursor=window.uiConfig.westResizerCursor);var m=function(){if(c=r.layout().readState(),null!=c.east){var e=r.find("> .ui-layout-resizer-controls");return c.east.initClosed?e.hide():(e.show(),e.css({right:c.east.size}))}},v=function(){if(null!=s){c=r.layout().readState();var e="east"===d?"right":"left",t=c[d];return null!=t?s.css(e,t.initClosed?0:t.size):void 0}},y=function(){if(c=r.layout().readState(),null!=o.openEast&&null!=c.east){var t=e(o.openEast);return t.assign(i,!c.east.initClosed)}},w=function(){return c=r.layout().readState(),i.$broadcast("layout:".concat(u,":resize"),c),m(),p&&v(),y()},b=r.width(),_=function(){if(null!=o.resizeProportionally&&i.$eval(o.resizeProportionally)){var e=r.layout().readState().east;if(null!=e){var t=e.size/b*r.width();return b=r.width(),void r.layout().sizePane("east",t)}}return r.layout().resizeAll()};if(r.layout(g),r.layout().resizeAll(),null!=o.resizeOn)for(var C=0,k=Array.from(o.resizeOn.split(","));C<k.length;C++){var S=k[C];i.$on(S,function(){return _()})}if(p){c=r.layout().readState();var x=i.$new();x.isOpen=!0,x.isVisible=!0,(null!=c[d]?c[d].initClosed:void 0)===!0&&(x.isOpen=!1),x.tooltipMsgWhenOpen=h,x.tooltipMsgWhenClosed=f,x.tooltipPlacement="east"===d?"left":"right",x.handleClick=function(){return r.layout().toggle(d),v()},s=t('<a href ng-show="isVisible" class="custom-toggler '.concat("custom-toggler-".concat(d),'" ng-class="isOpen ? \'custom-toggler-open\' : \'custom-toggler-closed\'" tooltip="{{ isOpen ? tooltipMsgWhenOpen : tooltipMsgWhenClosed }}" tooltip-placement="{{ tooltipPlacement }}" ng-click="handleClick()">'))(x),r.append(s)}var A=function(e){return p||e===d?s.scope().$applyAsync(function(){return s.scope().isOpen=!0}):void 0},T=function(e){return p||e===d?s.scope().$applyAsync(function(){return s.scope().isOpen=!1}):void 0};if($(window).unload(function(){return n.localStorage("layout.".concat(u),r.layout().readState())}),null!=o.openEast&&i.$watch(o.openEast,function(e,t){return null!=e&&e!==t&&(e?r.layout().open("east"):r.layout().close("east")),setTimeout(function(){return i.$digest()},0)}),null!=o.allowOverflowOn){var E=r.layout(),M=i.$eval(o.allowOverflowOn),R=E.panes[M];E.allowOverflow(M);var L=R.zIndex();R.css("z-index",L+1)}return y(),w(),null!=o.layoutDisabled?i.$watch(o.layoutDisabled,function(e){return e?r.layout().hide("east"):r.layout().show("east"),p?s.scope().$applyAsync(function(){return s.scope().isOpen=!e,s.scope().isVisible=!e}):void 0}):void 0},post:function(e,t,n){var i=n.layout,r=t.layout().readState();return e.$broadcast("layout:".concat(i,":linked"),r)}}}}}])});var load=function(){var e,t=new RegExp("[\\/\\\\\\*\\u0000-\\u001F\\u007F\\u0080-\\u009F\\uD800-\\uDFFF]","g"),n=new RegExp("(^\\.$)|(^\\.\\.$)|(^\\s+)|(\\s+$)","g"),i=new RegExp("^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$"),r=1024;return e={clean:function(e){return e=e.replace(t,"_"),e=e.replace(n,function(e){return new Array(e.length+1).join("_")}),e=e.replace(i,"@$1")},isCleanFilename:function(i){return e.isAllowedLength(i)&&!t.test(i)&&!n.test(i)},isAllowedLength:function(e){return e.length>0&&e.length<=r}}};"undefined"!=typeof define&&null!==define?define("ide/directives/SafePath",[],load):module.exports=load(),define("ide/directives/validFile",["base","ide/directives/SafePath"],function(e,t){return e.directive("validFile",function(){return{require:"ngModel",link:function(e,n,i,r){return r.$validators.validFile=function(e){return t.isCleanFilename(e)}}}})}),define("ide/services/ide",["base"],function(e){return e.factory("ide",["$http","queuedHttp","$modal","$q","$filter","$timeout",function(e,t,n,i,r,o){var s=this,a={};return a.$http=e,a.queuedHttp=t,a.$q=i,a.$filter=r,a.$timeout=o,this.recentEvents=[],a.pushEvent=function(e,t){return null==t&&(t={}),sl_console.log("event",e,t),s.recentEvents.push({type:e,meta:t,date:new Date}),s.recentEvents.length>100?s.recentEvents.shift():void 0},a.reportError=function(t,n){null==n&&(n={}),n.client_id=__guard__(null!=s.socket?s.socket.socket:void 0,function(e){return e.sessionid}),n.transport=__guard__(__guard__(null!=s.socket?s.socket.socket:void 0,function(e){return e.transport}),function(e){return e.name}),n.client_now=new Date,n.recent_events=s.recentEvents;var i={};if("object"===_typeof(t))for(var r=0,o=Array.from(Object.getOwnPropertyNames(t));r<o.length;r++){var a=o[r];i[a]=t[a]}else"string"==typeof t&&(i.message=t);return e.post("/error/client",{error:i,meta:n,_csrf:window.csrfToken})},a.showGenericMessageModal=function(e,t){return n.open({templateUrl:"genericMessageModalTemplate",controller:"GenericMessageModalController",resolve:{title:function(){return e},message:function(){return t}}})},a.showLockEditorMessageModal=function(e,t){return n.open({templateUrl:"lockEditorModalTemplate",controller:"GenericMessageModalController",backdrop:"static",keyboard:!1,resolve:{title:function(){return e},message:function(){return t}},windowClass:"lock-editor-modal"})},a}]),e.controller("GenericMessageModalController",["$scope","$modalInstance","title","message",function(e,t,n,i){return e.title=n,e.message=i,e.done=function(){return t.close()}}])}),define("ide/tpr-webmodule/controllers/ReferencesController",["base"],function(e){return e.controller("ReferencesController",["$scope","$modal","ide","$http",function(e,t,n,i){var r=n.$scope.user,o=null!=r?r.features:void 0;return e.thirdPartyReferencesEnabled=(null!=o?o.mendeley:void 0)||(null!=o?o.references:void 0),e.openNewDocModal=function(){return t.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return null},type:function(){return"mendeley"}}})}}])}),define("ide/tpr-webmodule/controllers/LinkedFileModalControllers",["base"],function(e){var t=function(e,t){return["$scope","ide","$timeout","$window","$interval","event_tracking",function(n,i,r,o,s,a){var l=null!=i.$scope.user?i.$scope.user.features:void 0;n.userHasProviderFeature=(null!=l?l[e]:void 0)||(null!=l?l.references:void 0),n.userHasProviderLink=__guard__(null!=i.$scope.user?i.$scope.user.refProviders:void 0,function(t){return t[e]}),n.canLoadBibtex=function(){return n.userHasProviderFeature&&n.userHasProviderLink},n.state.fetchingGroups=!1,n.state.inflight=!1,n.state.error=!1,n.state.errorType="default",n.data={isInitialized:!1,groups:null,selectedGroupId:null,format:"bibtex",name:"references.bib"};var c=function(e){u("already exists"===e.data?{error:"name-exists"}:401===e.status?{error:"expired"}:403===e.status?{error:"forbidden"}:400===e.status?{error:"default"}:{error:!0})},u=function(e){null==e&&(e={}),n.state.fetchingGroups=!1,n.state.fetchingBibtexPreview=!1,n.state.inflight=!1,null!=e.error?(n.state.error=!0,e.error===!0?n.state.errorType="default":n.state.errorType=e.error):n.state.error=!1};n.hasGroups=function(){return null!=n.data.groups&&n.data.groups.length>0},n.supportsGroups=function(){return n.canLoadBibtex()?(u(),n.state.fetchingGroups=!0,i.$http.get("/".concat(e,"/groups"),{disableAutoLoginRedirect:!0}).then(function(e){var t=e.data;return n.data.groups=t.groups,n.data.selectedGroup=null,n.data.isInitialized=!0,n.$applyAsync(function(){return n.$broadcast("open")}),u()})["catch"](function(e){return console.warn(e),c(e)})):void 0};var d=function(){var e=n.data,t=e.name,i=e.isInitialized;null==t||0===t.length?n.state.valid=!1:null==i?n.state.valid=!1:n.state.valid=!0};n.$watch("data.name",d),d(),n.$on("create",function(){if(n.data.isInitialized&&n.data.isInitialized&&n.data.name){var t={};return"mendeley"===e&&n.hasGroups()&&n.data.selectedGroupId&&(t.group_id=n.data.selectedGroupId),"zotero"===e&&(t.format=n.data.format),a.send("references-".concat(e),"modal","import-bibtex"),n.state.inflight=!0,i.fileTreeManager.createLinkedFile(n.data.name,n.parent_folder,e,t).then(function(){return n.$emit("done",{name:n.data.name,shouldReindexReferences:!0}),u()})["catch"](function(e){return c(e)})}});var h=function(){n.canLoadBibtex()&&(t?(n.state.fetchingGroups=!0,r(function(){return n.supportsGroups()},500)):n.data.isInitialized=!0)};h(),n.startFreeTrial=function(e){var t="collaborator_free_trial_7_days";"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",e);var i=window.open(),r=function(){n.startedFreeTrial=!0,i.location="/user/subscription/new?planCode=".concat(t,"&ssp=true")};r()},n.linkAccount=function(){var t=o.open("/".concat(e,"/oauth"),"reference-auth","width=700,height=500");a.send("references-".concat(e),"modal","start-link-account");var l=s(function(){var o;try{o=__guard__(null!=t?t.location:void 0,function(e){return e.pathname})}catch(c){o=null}"/user/settings"===o&&(t.close(),a.send("references-".concat(e),"modal","end-link-account"),n.userHasProviderLink=!0,i.$scope.user.refProviders[e]=!0,r(n.supportsGroups(),500),s.cancel(l))},1e3);return!0},window._S=n}]};e.controller("MendeleyLinkedFileModalController",t("mendeley",!0)),e.controller("ZoteroLinkedFileModalController",t("zotero",!1))}),define("ide/tpr-webmodule/index",["ide/tpr-webmodule/controllers/ReferencesController","ide/tpr-webmodule/controllers/LinkedFileModalControllers"],function(){}),define("ide/templates/controllers/TemplatesController",["base","ide/permissions/PermissionsManager","moment"],function(e,t,n){return e.controller("TemplatesController",["$scope","$modal","ide",function(e,t,n){return e.openPublishTemplateModal=function(){var n=function(){return e.problemTalkingToTemplateApi=!1};n();var i=t.open({templateUrl:"publishProjectAsTemplateModalTemplate",controller:"PublishProjectAsTemplateModalController",scope:e});return i.result.then(n,n)}}]),e.controller("PublishProjectAsTemplateModalController",["$scope","$modalInstance","ide","$http",function(e,t,i,r){i.$scope.user.id;e.templateDetails={exists:!1},e.state={publishInflight:!1,unpublishInflight:!1};var o=function(){return e.problemTalkingToTemplateApi=!0},s=function(){return r.get("/project/".concat(i.project_id,"/template")).then(function(t){var i=t.data;return e.templateDetails=i,e.templateDetails.publishedDate=n(i.publishedDate).format("Do MMM YYYY, h:mm a"),e.templateDetails.description=i.description})["catch"](function(){return o()})};e.$watch(e.problemTalkingToTemplateApi,function(e){return null!=e?s():void 0});var a=function(){return r.post("/project/".concat(i.project_id,"/template/description"),{description:e.templateDetails.description,_csrf:window.csrfToken})};return t.result["finally"](function(){return a()}),e.publishTemplate=function(){return e.state.publishInflight=!0,a().then(function(){return r.post("/project/".concat(i.project_id,"/template/publish"),{_csrf:window.csrfToken}).then(function(){return s(),e.state.publishInflight=!1})["catch"](function(){return o()})})["catch"](function(){return o()})},e.unpublishTemplate=function(){return e.state.unpublishInflight=!0,r.post("/project/".concat(i.project_id,"/template/unpublish"),{_csrf:window.csrfToken}).then(function(){return s(),e.state.unpublishInflight=!1})["catch"](function(){return o()})},e.cancel=function(){return t.dismiss()}}])}),define("ide/templates/index",["ide/templates/controllers/TemplatesController"],function(){}),define("ide/rich-text/rich_text_adapter",[],function(){function e(e){if(e&&e.name){var t=e.name.split(".").pop();return t?t.toLowerCase():null}return null}var t=function(){function t(e){_classCallCheck(this,t),this.fileTreeManager=e}return _createClass(t,[{key:"fileExistsForPath",value:function(e){var t=this.fileTreeManager.findEntityByPath(e);return!!t}},{key:"getEntityForPath",value:function(e){for(var t,n=0,i=["",".png",".pdf",".jpg",".jpeg",".eps"];n<i.length;n++){var r=i[n];if(t=this.fileTreeManager.findEntityByPath("".concat(e).concat(r)))break}return t}},{key:"getPreviewUrlForEntity",value:function(e){return"/project/".concat(window.project_id,"/file/").concat(e.id)}},{key:"isPreviewableEntity",value:function(t){return!["eps","pdf"].includes(e(t))}}]),t}();return t}),define("ide/rich-text/directives/spell_check/spell_check_adapter",[],function(){var e;return e=function(){function e(t){_classCallCheck(this,e),this.replaceWord=this.replaceWord.bind(this),this.editor=t,this.highlightedWordManager=this.editor.highlightedWordManager}return _createClass(e,[{key:"getLines",value:function(){return this.editor.getCodeMirror().getValue().split("\n")}},{key:"normalizeChangeEvent",value:function(e){return{start:{row:e.from.line},end:{row:e.to.line},action:null!=e.removed?"remove":"insert"}}},{key:"getCoordsFromContextMenuEvent",value:function(e){return e.stopPropagation(),{x:e.pageX,y:e.pageY}}},{key:"isContextMenuEventOnBottomHalf",value:function(e){var t=e.clientY,n=e.currentTarget.getBoundingClientRect(),i=(t-n.top)/n.height;return i>.5}},{key:"preventContextMenuEventDefault",value:function(e){return e.preventDefault()}},{key:"getHighlightFromCoords",value:function(e){var t=this.editor.getCodeMirror().coordsChar({left:e.x,top:e.y});return this.highlightedWordManager.findHighlightAtPosition(t)}},{key:"selectHighlightedWord",value:function(e){var t=e.marker.find();return this.editor.getCodeMirror().setSelection(t.from,t.to)}},{key:"replaceWord",value:function(e,t){var n=this.editor.getCodeMirror();return n.replaceSelection(t),n.focus()}}]),e}()}),define("ide/rich-text/autocomplete_adapter",["ide/editor/directives/aceEditor/auto-complete/snippets/TopHundredSnippets","ide/editor/directives/aceEditor/auto-complete/snippets/Environments"],function(e,t){var n;return n=function(){function n(e,t,i){_classCallCheck(this,n),this.onChange=this.onChange.bind(this),this.$scope=e,this.metadata=t,this.bibtexReferences=i,this.debouncer={}}return _createClass(n,[{key:"getCommandCompletions",value:function(t){return[].concat(e,this.getCommandCompletionsFromMetadata()).map(function(e){return{text:e.caption,displayText:e.caption,hint:t}})}},{key:"getCommandCompletionsFromMetadata",value:function(){return _.flatten(this.metadata.getAllPackages())}},{key:"getBeginCommandArguments",value:function(){return t.all}},{key:"getBibtexArguments",value:function(){return this.bibtexReferences}},{key:"getReferenceArguments",value:function(){return this.metadata.getAllLabels()}},{key:"onChange",value:function(e){var t=e.getCursor(),n=t.line,i=e.getLine(n);return i.length>1e4?void 0:/\\(usepackage|RequirePackage|label)(\[.*])?({.*})?/.test(i)?this.metadata.scheduleLoadDocMetaFromServer(this.$scope.docId):void 0}}]),n}()}),define("ide/rich-text/directives/cursor_position/cursor_position_adapter",[],function(){var e,t=10;return e=function(){function e(t){_classCallCheck(this,e),this.getCursor=this.getCursor.bind(this),this.editor=t}return _createClass(e,[{key:"convertToAcePos",value:function(e){var t=e.line,n=e.ch;return{row:t,column:n}}},{key:"convertFromAcePos",value:function(e){var t=e.row,n=e.column;return{line:t,ch:n}}},{key:"getCursor",value:function(){return this.convertToAcePos(this.editor.getCodeMirror().getCursor())}},{key:"getEditorScrollPosition",value:function(){var e=this.editor.getCodeMirror().getViewport();return e.from+t}},{key:"setCursor",value:function(e){return e=e.cursorPosition||{row:0,column:0},this.editor.getCodeMirror().setCursor(this.convertFromAcePos(e))}},{key:"setEditorScrollPosition",value:function(e){e=e.firstVisibleLine||0;var t=this.editor.getCodeMirror(),n=t.heightAtLine(e,"local");return t.scrollTo(null,n)}},{key:"clearSelection",value:function(){}},{key:"gotoLine",value:function(e,t){var n=this.editor.getCodeMirror();return n.setCursor({line:e,ch:t}),n.focus()}},{key:"gotoOffset",value:function(){}}]),e}()}),define("ide/rich-text/directives/track_changes/track_changes_adapter",["ide/editor/EditorShareJsCodec"],function(e){var t=function(){function t(e){_classCallCheck(this,t),this.findTrackChangesMarker=this.findTrackChangesMarker.bind(this),this.getTrackChangesMarkers=this.getTrackChangesMarkers.bind(this),
this.onInsertAdded=this.onInsertAdded.bind(this),this.shareJsOffsetToRowColumn=this.shareJsOffsetToRowColumn.bind(this),this.onDeleteAdded=this.onDeleteAdded.bind(this),this.onChangeMoved=this.onChangeMoved.bind(this),this.editor=e,this.cm=this.editor.getCodeMirror()}return _createClass(t,[{key:"getTrackChangesMarkers",value:function(){return this.cm.doc.getAllMarks().filter(function(e){return e.className&&-1!==e.className.indexOf("track-changes-marker")})}},{key:"findTrackChangesMarker",value:function(e){return this.getTrackChangesMarkers().find(function(t){return t.id===e})}},{key:"clearAnnotations",value:function(){this.getTrackChangesMarkers().forEach(function(e){return e.clear()}),this.changeIdToMarkerIdMap={}}},{key:"tearDown",value:function(){this.changeIdToMarkerIdMap={}}},{key:"onInsertAdded",value:function(e){var t,n,i;t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.i.length),i=this.cm.doc.markText({line:t.row,ch:t.column},{line:n.row,ch:n.column},{className:"track-changes-marker track-changes-added-marker"}),this.changeIdToMarkerIdMap[e.id]=i.id}},{key:"onDeleteAdded",value:function(e){var t=this.shareJsOffsetToRowColumn(e.op.p),n=document.createElement("span");n.className="track-changes-marker track-changes-deleted-marker";var i=this.cm.setBookmark({line:t.row,ch:t.column},{widget:n,insertLeft:!0});this.changeIdToMarkerIdMap[e.id]=i.id}},{key:"onInsertRemoved",value:function(e){var t=this.changeIdToMarkerIdMap[e.id];delete this.changeIdToMarkerIdMap[e.id];var n=this.findTrackChangesMarker(t);n&&n.clear()}},{key:"onDeleteRemoved",value:function(e){var t=this.changeIdToMarkerIdMap[e.id];delete this.changeIdToMarkerIdMap[e.id];var n=this.findTrackChangesMarker(t);n&&n.clear()}},{key:"onChangeMoved",value:function(e){var t,n=this.shareJsOffsetToRowColumn(e.op.p);t=null!=e.op.i?this.shareJsOffsetToRowColumn(e.op.p+e.op.i.length):n,this.updateMarker(e,n,t)}},{key:"onCommentAdded",value:function(e){var t,n,i;t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.c.length),i=this.cm.doc.markText({line:t.row,ch:t.column},{line:n.row,ch:n.column},{className:"track-changes-marker track-changes-comment-marker"}),this.changeIdToMarkerIdMap[e.id]=i.id}},{key:"onCommentMoved",value:function(e){var t=this.shareJsOffsetToRowColumn(e.op.p),n=this.shareJsOffsetToRowColumn(e.op.p+e.op.c.length);this.updateMarker(e,t,n)}},{key:"onCommentRemoved",value:function(e){if(this.changeIdToMarkerIdMap[e.id]){var t=this.changeIdToMarkerIdMap[e.id];delete this.changeIdToMarkerIdMap[e.id];var n=this.findTrackChangesMarker(t);n&&n.clear()}}},{key:"updateMarker",value:function(e,t,n){var i=this.changeIdToMarkerIdMap[e.id];if(e.op.i||e.op.c){var r=this.findTrackChangesMarker(i);if(!r)return;r.clear();var o=e.op.i?"added":"comment",s=this.cm.doc.markText({line:t.row,ch:t.column},{line:n.row,ch:n.column},{className:"track-changes-marker track-changes-".concat(o,"-marker")});this.changeIdToMarkerIdMap[e.id]=s.id}}},{key:"shareJsOffsetToRowColumn",value:function(t){var n=this.cm.doc.getValue().split("\n");return e.shareJsOffsetToRowColumn(t,n)}}]),t}();return t}),define("ide/rich-text/directives/cm_editor",["base","ide/rich-text/rich_text_adapter","ide/editor/directives/aceEditor/spell-check/SpellCheckManager","ide/rich-text/directives/spell_check/spell_check_adapter","ide/rich-text/autocomplete_adapter","ide/editor/directives/aceEditor/cursor-position/CursorPositionManager","ide/rich-text/directives/cursor_position/cursor_position_adapter","ide/editor/directives/aceEditor/track-changes/TrackChangesManager","ide/rich-text/directives/track_changes/track_changes_adapter"],function(e,t,n,i,r,o,s,a,l){return e.directive("cmEditor",["ide","metadata","localStorage","$cacheFactory","$http","$q",function(e,c,u,d,h,f){return{scope:{bundle:"=",formattingEvents:"=",initCodeMirror:"=",sharejsDoc:"=",readOnly:"=",spellCheck:"=",spellCheckLanguage:"=",trackChanges:"=",autoComplete:"=",autoCloseBrackets:"=",fontSize:"=",lineHeight:"=",docId:"=",onSave:"="},link:function(p,g,m){var v=g.find(".cm-editor-body"),y=null,w=null,b=new r(p,c,p.$root._references),C={triggerRecompile:p.onSave,triggerSyncToPdf:U};p.name="editor";var k=function(){return y=new p.bundle.Editor(v[0],new t(e.fileTreeManager),b,C,V),N(),S(p.sharejsDoc),x()},S=function(e,t){return e!==t?(null!=t&&(p.$broadcast("beforeChangeDocument"),P(t)),null!=e&&F(e),null!=e&&null!=t?p.$broadcast("afterChangeDocument"):void 0):void 0};p.$watch("sharejsDoc",S),p.$watch("readOnly",function(e){return null!=e?y.setReadOnly(e):void 0});var x=function(){return p.formattingEvents.on("section",function(){return y.wrapSection()}),p.formattingEvents.on("subsection",function(){return y.wrapSubsection()}),p.formattingEvents.on("bold",function(){return y.wrapBold()}),p.formattingEvents.on("italic",function(){return y.wrapItalic()}),p.formattingEvents.on("inlineMath",function(){return y.wrapInlineMath()}),p.formattingEvents.on("displayMath",function(){return y.wrapDisplayMath()}),p.formattingEvents.on("numberedList",function(){return y.wrapNumberedList()}),p.formattingEvents.on("bulletList",function(){return y.wrapBulletList()})},A=function(){return p.formattingEvents.off("section"),p.formattingEvents.off("subsection"),p.formattingEvents.off("bold"),p.formattingEvents.off("italic"),p.formattingEvents.off("inlineMath"),p.formattingEvents.off("displayMath"),p.formattingEvents.off("numberedList"),p.formattingEvents.off("bulletList")},T=/[\0\uD800-\uDFFF]/g,E="",M=function(e,t){if(t.update){var n=t.text.join("\n");if(T.test(n)){for(var i=[],r=0;r<t.text.length;r++){var o=t.text[r].replace(T,E);i.push(o)}t.update(t.from,t.to,i)}}},R=function(){var e=y.getCodeMirror();e.on("beforeChange",M)},L=function(){var e=y.getCodeMirror();e.off("beforeChange",M)},D=_.once(function(){return p.$broadcast("editorInit")}),F=function(e){return p.$applyAsync(function(){return y.openDoc(e.getSnapshot()),e.attachToCM(y.getCodeMirror()),y.enable(),e.on("remoteop.richtext",function(){return y.update()}),y.getCodeMirror().clearHistory(),R(),D(),p.readOnly||q(),B(),j()})},P=function(e){return O(),H(),W(),L(),e.detachFromCM(),e.off("remoteop.richtext")},I=function(e,t){return this.spellCheckManager.onChange(t)},q=function(){var e=d.get("spellCheck-".concat(p.name))||d("spellCheck-".concat(p.name),{capacity:1e3});this.spellCheckManager=new n(p,e,h,f,new i(y)),this.spellCheckManager.init();var t=y.getCodeMirror();return t.on("change",I),$(t.getWrapperElement()).on("contextmenu",this.spellCheckManager.onContextMenu),t.on("scroll",this.spellCheckManager.onScroll)},O=function(){var e=y.getCodeMirror();e.off("change",I),this.spellCheckManager&&($(e.getWrapperElement()).off("contextmenu",this.spellCheckManager.onContextMenu),e.off("scroll",this.spellCheckManager.onScroll))},B=function(){var e=y.getCodeMirror();this.trackChangesManager=new a(p,null,g,new l(y)),this.trackChangesManager.rangesTracker=p.sharejsDoc.ranges,this.trackChangesManager.onChangeSession(),e.on("swapDoc",this.trackChangesManager.onChangeSession)},H=function(){var e=y.getCodeMirror();this.trackChangesManager.tearDown(),e.off("swapDoc",this.trackChangesManager.onChangeSession)},N=function(){return w=new o(p,new s(y),u),y.getCodeMirror().on("cursorActivity",w.onCursorChange),$(window).on("unload",w.onUnload)},z=function(){return y.getCodeMirror().off("cursorActivity",w.onCursorChange),$(window).off("unload",w.onUnload)},U=function(){return w.onSyncToPdf()},j=function(){return y.getCodeMirror().on("change",b.onChange)},W=function(){return y.getCodeMirror().off("change",b.onChange)},V=function(e){return p[e]};if(p.$on("$destroy",function(){return p.$broadcast("changeEditor"),O(),z(),A(),W(),P(p.sharejsDoc),y.disable()}),k(),null!=m.resizeOn)for(var G=0,K=Array.from(m.resizeOn.split(","));G<K.length;G++){var Y=K[G];p.$on(Y,function(){return __guard__(null!=y?y.getCodeMirror():void 0,function(e){return e.refresh()})})}return p.$watch("fontSize",function(e){return v.css({"font-size":"".concat(e,"px")}),__guard__(null!=y?y.getCodeMirror():void 0,function(e){return e.refresh()})}),p.$watch("lineHeight",function(e){var t;if(e){switch(e){case"compact":t=1.33;break;case"normal":t=1.6;break;case"wide":t=2;break;default:t=1.6}return v.css({"line-height":t}),__guard__(null!=y?y.getCodeMirror():void 0,function(e){return e.refresh()})}})},template:'<div class="cm-editor-wrapper rich-text">\n  <div class="cm-editor-body"></div>\n  <spell-menu\n    open="spellMenu.open"\n    top="spellMenu.top"\n    left="spellMenu.left"\n    layout-from-bottom="spellMenu.layoutFromBottom"\n    highlight="spellMenu.highlight"\n    replace-word="replaceWord(highlight, suggestion)"\n    learn-word="learnWord(highlight)"\n  ></spell-menu>\n</div>'}}])}),define("ide/rich-text/directives/formatting_buttons",["base"],function(e){var t=33,n=70;return e.directive("formattingButtons",function(){return{scope:{buttons:"=",opening:"=",isFullscreenEditor:"="},link:function(e,i,r){e.showMore=!1,e.shownButtons=[],e.overflowedButtons=[];var o=e.$watch("opening",function(e){return e?void 0:(s(),c(),o())}),s=function(){var r=i.width(),o=Math.floor(r/t);return o<e.buttons.length?(e.showMore=!0,r-=n,o=Math.floor(r/t),a(o)):(e.showMore=!1,a(o))},a=function(t){return e.$applyAsync(function(){return e.shownButtons=e.buttons.slice(0,t),e.overflowedButtons=e.buttons.slice(t)})},l=_.debounce(s,300),c=function(){return $(window).on("resize",l),null!=r.resizeOn?Array.from(r.resizeOn.split(",")).map(function(t){return e.$on(t,l)}):void 0},u=function(){return $(window).off("resize",l)};return e.$watch("$destroy",function(){return u()}),e.$watch("isFullscreenEditor",function(e,t){return e!==t?l():void 0})},templateUrl:"formattingButtonsTpl"}})}),define("ide/rich-text/controllers/editor_loader_controller",["base","utils/EventEmitter"],function(e,t){return e.controller("EditorLoaderController",["$scope","localStorage",function(e,n){return e.richText={bundle:null,formattingEvents:new t},e.$watch("editor.showRichText",function(t){return n("editor.mode.".concat(e.project_id),t===!0?"rich-text":"source"),t&&!e.richText.bundle?requirejs(["rich-text"],function(t){return e.$applyAsync(function(){return e.richText.bundle=t})}):void 0})}])}),define("ide/rich-text/controllers/editor_toolbar_controller",["base"],function(e){return e.controller("EditorToolbarController",["$scope","ide",function(e,t){return e.buttons=[{iconText:"",iconClass:"formatting-icon",title:"Insert Section Heading",handleClick:function(){return e.richText.formattingEvents.trigger("section")}},{iconText:"",iconClass:"formatting-icon formatting-icon--small",title:"Insert Subsection Heading",handleClick:function(){return e.richText.formattingEvents.trigger("subsection")}},{iconClass:"formatting-icon fa fa-bold",title:"Format Bold",handleClick:function(){return e.richText.formattingEvents.trigger("bold")}},{iconClass:"formatting-icon fa fa-italic",title:"Format Italic",handleClick:function(){return e.richText.formattingEvents.trigger("italic")}},{iconText:"",iconClass:"formatting-icon formatting-icon--serif",title:"Insert Inline Math",handleClick:function(){return e.richText.formattingEvents.trigger("inlineMath")}},{iconText:"",iconClass:"formatting-icon formatting-icon--serif",title:"Insert Math on its own line",handleClick:function(){return e.richText.formattingEvents.trigger("displayMath")}},{iconClass:"formatting-icon fa fa-list-ol",title:"Insert Numbered List",handleClick:function(){return e.richText.formattingEvents.trigger("numberedList")}},{iconClass:"formatting-icon fa fa-list-ul",title:"Insert Bullet Point List",handleClick:function(){return e.richText.formattingEvents.trigger("bulletList")}}]}])}),define("ide/rich-text/index",["ide/rich-text/directives/cm_editor","ide/rich-text/directives/formatting_buttons","ide/rich-text/controllers/editor_loader_controller","ide/rich-text/controllers/editor_toolbar_controller"],function(){}),define("ide/references-search/controllers/ReferencesSearchController",["base","ace/ace"],function(e){var t=ace.require("ace/range"),n=t.Range,i=function(e){var t;return(t=e.match(/(\\[^\\]+)$/))?t[1]:null};return e.controller("ReferencesSearchController",["$scope","$modal","ide","$timeout","event_tracking","$rootScope",function(e,t,r,o,s,a){if(e.searchFeatureEnabled=function(){return!0},e.searchFeatureEnabled()){e.searchEnabled=!1,e.isCursorAtCitation=function(e){var t=e.getCursorPosition(),r=new n(t.row,0,t.row,t.column),o=e.getSession().getTextRange(r),s=i(o);if(s){var a=s.match(/^~?\\([a-z]*cite[a-z]*(?:\[.*])?){([^}]*, *)?(\w*)/);if(a)return!0}return!1},e._hintNode=null,e._buildHintNode=function(){s.sendMBOnce("bib-search-hint-shown-once");var e=$(".sl_references_search_hint")[0];return e?(e.style.display="block",e.style.visibility="visible",e):void console.log("Error: could not find .sl_references_search_hint node in dom")},e.updateHintNode=function(t){if(__guard__(__guard__(null!=t?t.completer:void 0,function(e){return e.popup}),function(e){return e.isOpen})===!0&&!e._hintNode&&e.isCursorAtCitation(t)){var n=e._buildHintNode(),i=__guard__(__guard__(__guard__(null!=t?t.completer:void 0,function(e){return e.popup}),function(e){return e.renderer}),function(e){return e.container});if(!i)return void console.log("Error attaching search hint: could not find popup container");i.style.overflow="visible",$(i).append(n),e._hintNode=n;var r=t.completer.popup;if(!r.hide._sl_patched){var s=r.hide.bind(r);r.hide=function(){return o(function(){return e.isCursorAtCitation(t)?void 0:e._hideHint()},0),s()},r.hide._sl_patched=!0}}return e._hintNode?e.isCursorAtCitation(t)?e._showHint():e._hideHint():void 0},e._showHint=function(){return e._hintNode?e._hintNode.style.visibility="visible":void 0},e._hideHint=function(){return e._hintNode?e._hintNode.style.visibility="hidden":void 0},e._inited=!1,e.setup=function(){if(e.settings.autoComplete!==!1&&!e._inited){if(null==l)return void console.log("no editor found");var t=__guard__(__guard__(null!=l?l.commands:void 0,function(e){return e.commands}),function(e){return e.startAutocomplete});if(!t)return void console.log("could not find startAutocomplete command");if(!t._sl_patched){var n=t.exec;t.exec=function(t,i,r,s,a){return o(function(){return e.updateHintNode(t)},0),n(t)},t._sl_patched=!0;var i=function(n){o(function(){return e.updateHintNode(n)},0);var i=e.isCursorAtCitation(n);return __guard__(__guard__(null!=n?n.completer:void 0,function(e){return e.popup}),function(e){return e.isOpen})===!0&&i===!0?(s.sendMB("bib-search-modal-opened"),e.searchEnabled=__guard__(__guard__(__guard__(null!=r?r.$scope:void 0,function(e){return e.project}),function(e){return e.features}),function(e){return e.referencesSearch})===!0,e.openReferencesSearchModal()):t.exec(n)};return e.handleOpenSearch=function(){return i(l)},r.browserIsSafari?document.querySelector("#editor").onkeyup=function(e){return e.ctrlKey&&32===e.keyCode?i(l):void 0}:l.commands.addCommand({name:"triggerReferencesSearchPopup",exec:i,bindKey:t.bindKey}),e._inited=!0}}};var l=null;return a.$on("editor:inited",function(t,n){return l=n,setTimeout(e.setup)}),e.insertKeyAtCursor=function(e){if(null==l)return void console.log("no editor found");var t=l.getCursorPosition(),i=l.getSession(),r=l.getSession().getTextRange(new n(t.row,0,t.row,t.column)),o=l.getSession().getTextRange(new n(t.row,t.column,t.row,99999)),s=!o.match(/^[^{]*}/),a=Math.max(r.lastIndexOf("{"),r.lastIndexOf(","),r.lastIndexOf(" "));return a<t.column-1?(i.remove(new n(t.row,a+1,t.row,t.column)),t=l.getCursorPosition(),i.insert(t,e)):i.insert(t,e),s?i.insert(l.getCursorPosition(),"}"):void 0},e.openReferencesSearchModal=function(){var n=t.open({templateUrl:"referencesSearchModalTemplate",controller:"ReferencesSearchModalController",scope:e,size:"lg",animation:!1,backdrop:!0,backdropClass:"references-search-modal-backdrop",keyboard:!0});return e.searchEnabled||s.send("subscription-funnel","editor-click-feature","references-search"),n.result.then(function(t){return e.insertKeyAtCursor(t)})},r.referencesSearchManager={openReferencesModal:function(t){return e.openReferencesSearchModal(t)}}}}])}),define("ide/references-search/controllers/ReferencesSearchModalController",["base"],function(e){return e.controller("ReferencesSearchModalController",["$scope","$modalInstance","$window","$timeout","ide","event_tracking",function(e,t,n,i,r,o){return e.searchFeatureEnabled()?(e.state={queryText:"",searchResults:null,selectedIndex:null,currentlySearching:!1,error:!1},e.handleInputKeyDown=function(t){return 40===t.keyCode?(t.preventDefault(),void e.moveSelectionForward()):38===t.keyCode?(t.preventDefault(),void e.moveSelectionBackward()):9===t.keyCode?(t.preventDefault(),void(t.shiftKey?e.moveSelectionBackward():e.moveSelectionForward())):13===t.keyCode?(t.preventDefault(),void e.acceptSelectedSearchResult()):[37,39].includes(t.keyCode)?void(e.state.selectedIndex=null):[8].includes(t.keyCode)?(e.state.selectedIndex=null,void i(e.doAutoSearch,0)):void(16===t.keyCode||t.altKey||t.ctrlKey||t.metaKey||i(e.doAutoSearch,0))},e.doAutoSearch=function(){var t=e.state;return t.queryText&&t.queryText.length>=3?e.doSearch():void 0},e.moveSelectionForward=function(){if(null===e.state.selectedIndex){if(e.state.searchResults&&e.state.searchResults.length>0)return e.state.selectedIndex=0}else if(e.state.searchResults&&e.state.searchResults.length>0){e.state.selectedIndex++;var t=e.state.searchResults.length-1;if(e.state.selectedIndex>t)return e.state.selectedIndex=t}},e.moveSelectionBackward=function(){if(null===e.state.selectedIndex);else if(e.state.searchResults&&e.state.searchResults.length>0&&(e.state.selectedIndex--,e.state.selectedIndex<0))return e.state.selectedIndex=null},e.doSearch=function(){if(""!==e.state.queryText){({query:e.state.queryText,_csrf:window.csrfToken});return e.state.currentlySearching=!0,r.$http.post("/project/".concat(e.project_id,"/references/search"),{query:e.state.queryText,_csrf:window.csrfToken}).then(function(t){return e.state.searchResults=t.data.hits,e.state.selectedIndex=null,e.state.currentlySearching=!1,e.state.error=!1},function(t){return console.error(">> error searching references",t),e.state.selectedIndex=null,e.state.currentlySearching=!1,e.state.error=!0}),i(function(){return e.state.currentlySearching=!1},3e4)}},e.selectIndex=function(t){return e.state.searchResults?e.state.selectedIndex=t:void 0},e.acceptSelectedSearchResult=function(){if(e.state.searchResults&&null!==e.state.selectedIndex){o.sendMB("bib-search-result-inserted");var n=e.state.searchResults[e.state.selectedIndex];return t.close(n._source.EntryKey)}},e.cancel=function(){return t.dismiss("cancel")}):void 0}])}),define("ide/references-search/index",["ide/references-search/controllers/ReferencesSearchController","ide/references-search/controllers/ReferencesSearchModalController"],function(){}),define("ide/publish-modal/controllers/PublishController",["base"],function(e){return e.controller("PublishController",["$scope","$modal","CobrandingDataService",function(e,t,n){return e.openPublishProjectModal=function(){return t.open({templateUrl:"publishProjectModalTemplate",scope:e,size:"lg"}),requirejs(["publish-modal"],function(t){var i;e.pdf.url&&(i=e.pdf.downloadUrl);var r=function(){var t=e.project.rootDoc_id,n=window._ide.editorManager.getCurrentDocId();if(n===t)return!1;var i=window._ide.editorManager.getCurrentDocValue();if(null==i)return!1;var r=!0,o=!1,s=void 0;try{for(var a,l=i.split("\n")[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var c=a.value;if(/^[^%]*\\documentclass/.test(c))return!0}}catch(u){o=!0,s=u}finally{try{r||null==l["return"]||l["return"]()}finally{if(o)throw s}}return!1},o={projectId:e.project_id,pdfUrl:i,logs:e.pdf.logEntries,uncompiled:e.pdf.uncompiled,hasFolders:window._ide.fileTreeManager.projectContainsFolder(),rootDocOverridden:r(),firstName:e.user.first_name,lastName:e.user.last_name,title:e.project.name},s={isBranded:n.isProjectCobranded()&&(null!=n.getPublishGuideHtml()&&""!==n.getPublishGuideHtml()||null!=n.getPartner()),brandedMenu:n.hasBrandedMenu(),brandId:n.getBrandId(),brandVariationId:n.getBrandVariationId(),partner:n.getPartner()},a=document.getElementsByClassName("modal-body-publish")[0];return t.init(a,o,s)})}}])}),define("ide/publish-modal/index",["ide/publish-modal/controllers/PublishController"],function(){}),define("ide/github-sync/controllers/GithubSyncController",["base"],function(e){return e.controller("GithubSyncController",["$scope","$modal","ide",function(e,t,n){e.openGithubSyncModal=function(){return t.open({templateUrl:"githubSyncModalTemplate",controller:"GithubSyncModalController",scope:e})},n.githubSyncManager={openGithubSyncModal:function(){return e.openGithubSyncModal()}},e.isProjectMember=function(){return n.$scope.permissions.write}}])}),define("ide/github-sync/controllers/GithubSyncModalController",["base"],function(e){return e.controller("GithubSyncModalController",["$scope","$modalInstance","$http","$modal","$window","$interval","ide",function(e,t,n,i,r,o,s){return e.cancel=function(){return t.dismiss()},e.openExportToGithubModal=function(){return t.dismiss(),i.open({templateUrl:"githubSyncExportModalTemplate",controller:"GithubSyncExportModalController"})},e.openMergeModal=function(e){var n;return null==e&&(e=!1),t.dismiss(),n=e?"githubSyncPullFromGithubModalTemplate":"githubSyncPushToGithubModalTemplate",i.open({templateUrl:n,controller:"GithubSyncMergeModalController",resolve:{mergeImmediately:function(){return e}}})},e.startFreeTrial=function(t){return"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",t),window.open("/user/subscription/new?planCode=student_free_trial_7_days"),e.startedFreeTrial=!0},e.linkAccount=function(){var t=r.open("/github-sync/beginAuth","github-sync-auth","width=700,height=500"),n=o(function(){var i;try{i=__guard__(null!=t?t.location:void 0,function(e){return e.pathname})}catch(r){i=null}return"/github-sync/linked"===__guard__(null!=t?t.location:void 0,function(e){return e.pathname})?(t.close(),e.loadStatus(),o.cancel(n)):void 0},1e3);return!0},(e.loadStatus=function(){return e.status={loading:!0,error:!1,user:{enabled:null},project:{enabled:null},commits:{loading:!0,commits:[]}},n.get("/user/github-sync/status",{disableAutoLoginRedirect:!0}).then(function(t){var i=t.data,r=i;return e.status.user=r,n.get("/project/".concat(s.project_id,"/github-sync/status"),{disableAutoLoginRedirect:!0}).then(function(t){var r=t.data;return e.status.project=r,e.status.loading=!1,e.status.project.enabled?n.get("/project/".concat(s.project_id,"/github-sync/commits/unmerged"),{disableAutoLoginRedirect:!0}).then(function(t){var n=t.data;e.status.commits.commits=n,e.status.commits.loading=!1})["catch"](function(t){var n;i=t.data,n=t.status,null!=n?e.status.error={statusCode:n}:e.status.error=!0}):void 0})["catch"](function(t){var n;i=t.data,n=t.status,null!=n?e.status.error={status:n}:e.status.error=!0})})["catch"](function(t){var n=(t.data,t.status);null!=n?e.status.error={status:n}:e.status.error=!0})})()}])}),define("ide/github-sync/controllers/GithubSyncExportModalController",["base"],function(e){return e.controller("GithubSyncExportModalController",["$scope","$modalInstance","$http","ide",function(e,t,n,i){e.cancel=function(){return t.dismiss()},e.status={loading:!0,error:!1},e.form={org:null,name:i.$scope.project.name,"private":"false",description:""},n.get("/user/github-sync/orgs",{disableAutoLoginRedirect:!0}).then(function(t){var n=t.data;e.status.user=n.user,e.status.orgs=n.orgs,e.status.loading=!1,e.form.org=e.status.user.login})["catch"](function(t){var n=t.data,i=t.status;e.status.error={message:null!=n?n.error:void 0,statusCode:i}}),e.create=function(){e.status.inflight=!0;var r={_csrf:window.csrfToken,name:e.form.name,description:e.form.description,"private":"true"===e.form["private"]};return null!=e.form.org&&e.form.org!==e.status.user.login&&(r.org=e.form.org),n.post("/project/".concat(i.project_id,"/github-sync/export"),r).then(function(){return e.status.inflight=!1,t.dismiss(),i.githubSyncManager.openGithubSyncModal()})["catch"](function(t){var n=t.data;e.form.error=n.error,e.status.inflight=!1})}}])}),define("ide/github-sync/controllers/GithubSyncMergeModalController",["base"],function(e){return e.controller("GithubSyncMergeModalController",["$scope","$modalInstance","$http","ide","mergeImmediately",function(e,t,n,i,r){e.cancel=function(){return t.dismiss()},e.status={},e.form={message:""},e.merge=function(){i.editorManager.startIgnoringExternalUpdates(),e.status.inflight=!0;var r={_csrf:window.csrfToken,message:e.form.message};return n.post("/project/".concat(i.project_id,"/github-sync/merge"),r).then(function(){e.status.inflight=!1,t.dismiss(),i.githubSyncManager.openGithubSyncModal(),i.editorManager.stopIgnoringExternalUpdates()})["catch"](function(t){var n=t.data;e.form.error=n.error,e.status.inflight=!1,i.editorManager.stopIgnoringExternalUpdates()})},r&&e.merge()}])}),define("ide/github-sync/index",["ide/github-sync/controllers/GithubSyncController","ide/github-sync/controllers/GithubSyncModalController","ide/github-sync/controllers/GithubSyncExportModalController","ide/github-sync/controllers/GithubSyncMergeModalController"],function(){}),define("ide/git-bridge/controllers/GitBridgeController",["base"],function(e){return e.controller("GitBridgeController",["$scope","$modal","event_tracking","ide",function(e,t,n,i){var r=function(){var t=e.project.features.gitBridge||e.user.features.gitBridge;t||n.send("subscription-funnel","editor-click-feature","gitBridge")};e.openGitBridgeModal=function(){t.open({templateUrl:"gitBridgeModalTemplate",controller:"GitBridgeModalController",size:"lg",scope:e}),r()},i.gitBridgeManager={openGitBridgeModal:function(){return e.openGitBridgeModal()}}}])}),define("ide/git-bridge/controllers/GitBridgeModalController",["base"],function(e){return e.controller("GitBridgeModalController",["$scope","$modalInstance","$window","ide",function(e,t,n,i){e.gitUrl="".concat(n.gitBridgePublicBaseUrl,"/").concat(i.$scope.project_id),e.hasGitBridgeFeature=e.project.features.gitBridge||e.user.features.gitBridge,e.userIsProjectOwner=e.user.id===e.project.owner._id,e.cancel=function(){return t.dismiss()}}])}),define("ide/git-bridge/index",["ide/git-bridge/controllers/GitBridgeController","ide/git-bridge/controllers/GitBridgeModalController"],function(){}),define("ide/dropbox/controllers/DropboxController",["base","ide/permissions/PermissionsManager"],function(e,t){var n={gotLinkStatus:!1,startedLinkProcess:!1,userIsLinkedToDropbox:!1,hasDropboxFeature:!1};return e.controller("DropboxController",["$scope","$modal","ide","event_tracking",function(e,t,n,i){var r=function(){e.user.features.dropbox||i.send("subscription-funnel","editor-click-feature","dropbox")};e.openDropboxModal=function(){t.open({templateUrl:"dropboxModalTemplate",controller:"DropboxModalController",scope:e}),r()}}]),e.controller("DropboxModalController",["$scope","$modalInstance","ide","$timeout","$http",function(e,t,i,r,o){var s=i.$scope.user.id;e.dbState=n,e.dbState.hasDropboxFeature=e.user.features.dropbox,o.get("/dropbox/status").then(function(t){var i=t.data;return e.dbState.gotLinkStatus=!0,i.registered?(e.dbState.userIsLinkedToDropbox=!0,n=e.dbState):void 0}),e.linkToDropbox=function(){return window.open("/user/settings#dropboxSettings"),e.startedLinkProcess=!0},e.cancel=function(){return t.dismiss()},e.isProjectMember=function(){var e=i.$scope.project.members.map(function(e){return e._id});return i.$scope.project.owner._id===s||e.includes(s)}}])}),define("ide/dropbox/index",["ide/dropbox/controllers/DropboxController"],function(){}),define("analytics/AbTestingManager",["base","libs/md5"],function(e){var t=["sl_abt_multi_currency_editor_eu-eu","sl_abt_multi_currency_eu-eu","sl_abt_multi_currency_editor_eu-usd","sl_abt_multi_currency_eu-usd","sl_abt_trial_len_14d","sl_abt_trial_len_7d","sl_abt_trial_len_30d","sl_utt","sl_utt_trial_len","sl_utt_multi_currency"];return e.factory("abTestManager",["$http","ipCookie",function(e,n){var i,r;_.each(t,function(e){return n.remove(e)});var o=function(e,t){var n="sl_abt_".concat(e,"_").concat(t);return n},s=function(e,t){var i=o(e,t),r=n(i);return r},a=function(e,t,i){var r=o(e,t);return n(r,{step:i},{expires:100,path:"/"}),ga("send","event","ab_tests","".concat(e,":").concat(t),"step-".concat(i))},l=function(e,t){return null==e&&0!==t?!1:0===t?!0:e+1===t?!0:!1},c=function(e){var t="sl_utt_".concat(e),i=n(t);null==i&&(i=Math.random(),n(t,i,{expires:365,path:"/"}));var r=CryptoJS.MD5("".concat(i,":").concat(e));return r};return{processTestWithStep:r=function(e,t,n){var i=__guard__(s(e,t),function(e){return e.step});return l(i,n)?a(e,t,n):void 0},getABTestBucket:i=function(e,t){var n=c(e),i=parseInt(n.toString().slice(0,2),16)%((null!=t?t.length:void 0)||2);return t[i]}}}]),e.controller("AbTestController",["$scope","abTestManager",function(e,t){_.keys(window.ab);return _.each(window.ab,function(e){return t.processTestWithStep(e.testName,e.bucket,e.step)})}])}),define("directives/focus",["base"],function(e){var t;e.directive("focusWhen",["$timeout",function(e){return{restrict:"A",link:function(t,n,i){return t.$watch(i.focusWhen,function(t){return t?e(function(){return n.focus()}):void 0})}}}]),e.directive("focusOn",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){return e.$on(n.focusOn,function(){return t.focus()})}}}]),e.directive("selectWhen",["$timeout",function(e){return{restrict:"A",link:function(t,n,i){return t.$watch(i.selectWhen,function(t){return t?e(function(){return n.select()}):void 0})}}}]),e.directive("selectOn",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){return e.$on(n.selectOn,function(){return t.select()})}}}]),e.directive("selectNameWhen",["$timeout",function(e){return{restrict:"A",link:function(n,i,r){return n.$watch(r.selectNameWhen,function(n){return n?e(function(){return t(i)}):void 0})}}}]),e.directive("selectNameOn",function(){return{restrict:"A",link:function(e,n,i){return e.$on(i.selectNameOn,function(){return t(n)})}}}),e.directive("focus",["$timeout",function(e){return{scope:{trigger:"@focus"},link:function(t,n){return t.$watch("trigger",function(t){return"true"===t?e(function(){return n[0].focus()}):void 0})}}}]),t=function(e){e.focus();var t=e.val();if(null!=e[0].setSelectionRange){var n=t.lastIndexOf(".");return-1===n&&(n=t.length),e[0].setSelectionRange(0,n)}}}),function(global){var qq=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(null==e.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var i=new RegExp("(^| )"+t+"( |$)");return i.test(e.className)||!(!n||!i.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var i,r=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(i=e.getElementsByTagName("*"),qq.each(i,function(e,n){qq(n).hasClass(t)&&r.push(n)}),n?r[0]:r)},getFirstByClass:function(t){
return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)1===n.nodeType&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?null==/^false$/i.exec(e.getAttribute(t)):!1:(n=e[t],void 0===n?!1:null==/^false$/i.exec(n))}}};!function(){"use strict";qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,i,r,o=function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})};return n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),i=new Uint8Array(t),qq.each(n,function(e,t){i[e]=t.charCodeAt(0)}),o(t,r)},qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qq.isFunction=function(e){return"function"==typeof e},qq.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qq.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qq.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,i=n.indexOf("{}");return qq.each(t,function(e,t){var r=n.substring(0,i),o=n.substring(i+2);return n=r+t+o,i=n.indexOf("{}",i+t.length),0>i?!1:void 0}),n},qq.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qq.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type)?!0:e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type)?!0:!1},qq.isBlob=function(e){return window.Blob&&"[object Blob]"===Object.prototype.toString.call(e)?!0:void 0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(e,t,n){var i=e.slice||e.mozSlice||e.webkitSlice;return i.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(e,n){var i=n.toString(16);i.length<2&&(i="0"+i),t+=i}),t},qq.readBlobToHex=function(e,t,n){var i=qq.sliceBlob(e,t,t+n),r=new FileReader,o=new qq.Promise;return r.onload=function(){o.success(qq.arrayBufferToHex(r.result))},r.onerror=o.failure,r.readAsArrayBuffer(i),o},qq.extend=function(e,t,n){return qq.each(t,function(t,i){n&&qq.isObject(i)?(void 0===e[t]&&(e[t]={}),qq.extend(e[t],i,!0)):e[t]=i}),e},qq.override=function(e,t){var n={},i=t(n);return qq.each(i,function(t,i){void 0!==e[t]&&(n[t]=e[t]),e[t]=i}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var i=e.length;for(0>n&&(n+=i);i>n;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,i;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(i=t(e.key(n),e.getItem(e.key(n))),i!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(i=t(n,e[n]),i!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(i=t(n,e.charAt(n)),i!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(i=t(n,e[n]),i===!1))break},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var i=qq.extend([],n);return arguments.length&&(i=i.concat(Array.prototype.slice.call(arguments))),e.apply(t,i)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var i=[],r="&",o=function(e,n){var r=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;"undefined"!==r&&"undefined"!==n&&i.push("object"==typeof e?qq.obj2url(e,r,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))};return!n&&t?(r=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",i.push(t),i.push(qq.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e?qq.each(e,function(e,t){o(t,e)}):"undefined"!=typeof e&&null!==e&&"object"==typeof e?qq.each(e,function(e,t){o(t,e)}):i.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?i.join(r):i.join(r).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(e,i){e=n?n+"["+e+"]":e,qq.isObject(i)?qq.obj2FormData(i,t,e):qq.isFunction(i)?t.append(e,i()):t.append(e,i)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,i){n=document.createElement("input"),n.setAttribute("name",e),n.setAttribute("value",i),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;return t>0?e.substr(t,e.length-t):void 0},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define("fineuploader",[],function(){return qq}):"undefined"!=typeof module&&module.exports?module.exports=qq:global.qq=qq}(),function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.15.4",qq.supportedFeatures=function(){"use strict";function e(){var e,t=!0;try{e=document.createElement("input"),e.type="file",qq(e).hide(),e.disabled&&(t=!1)}catch(n){t=!1}return t}function t(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function n(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function i(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return void 0!==e.withCredentials}return!1}function r(){return void 0!==window.XDomainRequest}function o(){return i()?!0:r()}function s(){return void 0!==document.createElement("input").webkitdirectory}function a(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(e){return!1}}function l(){var e=document.createElement("span");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&!qq.android()&&!qq.ios()}var c,u,d,h,f,p,g,m,v,y,w,b,_,C,k;return c=e(),h=c&&qq.isXhrUploadSupported(),u=h&&!qq.androidStock(),d=h&&l(),f=d&&t(),p=h&&qq.isFileChunkingSupported(),g=h&&p&&a(),m=h&&n(),v=c&&(void 0!==window.postMessage||h),w=i(),y=r(),b=o(),_=s(),C=h&&void 0!==window.FileReader,k=function(){return h?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:h,blobUploading:u,canDetermineSize:h,chunking:p,deleteFileCors:b,deleteFileCorsXdr:y,deleteFileCorsXhr:w,dialogElement:!!window.HTMLDialogElement,fileDrop:d,folderDrop:f,folderSelection:_,imagePreviews:C,imageValidation:C,itemSizeValidation:h,pause:p,progressBar:k,resume:g,scaling:C&&u,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:c,uploadCors:v,uploadCustomHeaders:h,uploadNonMultipart:h,uploadViaPaste:m}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],i=[],r=[],o=0;qq.extend(this,{then:function(r,s){return 0===o?(r&&n.push(r),s&&i.push(s)):-1===o?s&&s.apply(null,t):r&&r.apply(null,e),this},done:function(n){return 0===o?r.push(n):n.apply(null,void 0===t?e:t),this},success:function(){return o=1,e=arguments,n.length&&qq.each(n,function(t,n){n.apply(null,e)}),r.length&&qq.each(r,function(t,n){n.apply(null,e)}),this},failure:function(){return o=-1,t=arguments,i.length&&qq.each(i,function(e,n){n.apply(null,t)}),r.length&&qq.each(r,function(e,n){n.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){"use strict";function t(){var e=document.createElement("input");return e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i),e.setAttribute("title",s.title),r.setMultiple(s.multiple,e),s.folders&&qq.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),s.acceptFiles&&e.setAttribute("accept",s.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",s.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(e).css({height:"100%"}),s.element.appendChild(e),o.attach(e,"change",function(){s.onChange(e)}),o.attach(e,"mouseover",function(){qq(s.element).addClass(s.hoverClass)}),o.attach(e,"mouseout",function(){qq(s.element).removeClass(s.hoverClass)}),o.attach(e,"focus",function(){qq(s.element).addClass(s.focusClass)}),o.attach(e,"blur",function(){qq(s.element).removeClass(s.focusClass)}),e}var n,i,r=this,o=new qq.DisposeSupport,s={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(e){},title:null};qq.extend(s,e),i=qq.getUniqueId(),qq(s.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return n},getButtonId:function(){return i},setMultiple:function(e,t){var n=t||this.getInput();s.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?n.setAttribute("multiple",""):e?n.setAttribute("multiple",""):n.removeAttribute("multiple")},setAcceptFiles:function(e){e!==s.acceptFiles&&n.setAttribute("accept",e)},reset:function(){n.parentNode&&qq(n).remove(),qq(s.element).removeClass(s.focusClass),n=null,n=t()}}),n=t()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){"use strict";function t(e){if(qq.isArray(e)){var t=[];return qq.each(e,function(e,n){t.push(r[n])}),t}return r[e]}function n(e){if(qq.isArray(e)){var t=[];return qq.each(e,function(e,n){t.push(r[o[n]])}),t}return r[o[e]]}function i(e){var t=[],n=[].concat(e);return qq.each(n,function(e,n){var i=s[n];void 0!==i&&qq.each(i,function(e,n){t.push(r[n])})}),t}var r=[],o={},s={},a={},l={};qq.extend(this,{addFile:function(t){var n=t.status||qq.status.SUBMITTING,i=r.push({name:t.name,originalName:t.name,uuid:t.uuid,size:null==t.size?-1:t.size,status:n})-1;return t.batchId&&(r[i].batchId=t.batchId,void 0===l[t.batchId]&&(l[t.batchId]=[]),l[t.batchId].push(i)),t.proxyGroupId&&(r[i].proxyGroupId=t.proxyGroupId,void 0===a[t.proxyGroupId]&&(a[t.proxyGroupId]=[]),a[t.proxyGroupId].push(i)),r[i].id=i,o[t.uuid]=i,void 0===s[n]&&(s[n]=[]),s[n].push(i),t.onBeforeStatusChange&&t.onBeforeStatusChange(i),e.onStatusChange(i,null,n),i},retrieve:function(e){return qq.isObject(e)&&r.length?void 0!==e.id?t(e.id):void 0!==e.uuid?n(e.uuid):e.status?i(e.status):void 0:qq.extend([],r,!0)},reset:function(){r=[],o={},s={},l={}},setStatus:function(t,n){var i=r[t].status,o=qq.indexOf(s[i],t);s[i].splice(o,1),r[t].status=n,void 0===s[n]&&(s[n]=[]),s[n].push(t),e.onStatusChange(t,i,n)},uuidChanged:function(e,t){var n=r[e].uuid;r[e].uuid=t,o[t]=e,delete o[n]},updateName:function(e,t){r[e].name=t},updateSize:function(e,t){r[e].size=t},setParentId:function(e,t){r[e].parentId=t},getIdsInProxyGroup:function(e){var t=r[e].proxyGroupId;return t?a[t]:[]},getIdsInBatch:function(e){var t=r[e].batchId;return l[t]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(e,n){t._addCannedFile(n)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var i=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,r=qq.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},i,d)},this),o=qq.bind(function(e){this._handleNewFile(e,i,d)},this),s=qq.bind(function(e){var t=qq.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},i,d)},this),a=qq.bind(function(e){var t=e.quality&&e.quality/100,n=qq.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:n,name:e.name},i,d)},this),l=qq.bind(function(e){if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files),n=this;qq.each(t,function(e,t){n._handleNewFile(t,i,d)})}else this._handleNewFile(e,i,d)},this),c=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},u=this,d=[];this._currentBatchId=i,e&&(c(),qq.each(e,function(e,t){qq.isFileOrInput(t)?l(t):qq.isBlob(t)?r(t):qq.isObject(t)?t.blob&&t.name?o(t):t.canvas&&t.name&&a(t):t.tagName&&"canvas"===t.tagName.toLowerCase()?s(t):u.log(t+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+d.length+" files."),this._prepareItemsForUpload(d,t,n))},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(e,n){t.cancel(n)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return qq.supportedFeatures.pause&&this._options.chunking.enabled?t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1):!1},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,i,r){var o,s,a=new qq.Promise;return this._imageGenerator?(o=this._thumbnailUrls[e],s={customResizeFunction:r,maxSize:n>0?n:null,scale:n>0},!i&&qq.supportedFeatures.imagePreviews&&(o=this.getFile(e)),null==o?a.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(o,t,s).then(function(e){a.success(e)},function(e,t){a.failure({container:e,error:t||"Problem generating thumbnail"})})):a.failure({container:t,error:"Missing image generator module"}),a},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&void 0!==t.parentId&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qq.log("[Fine Uploader "+qq.version+"] "+e,t):qq.log("[Fine Uploader "+qq.version+"] "+e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var i="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(i),new qq.Error(i)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,i){e._onDeleteComplete(t,n,i),e._options.callbacks.onDeleteComplete(t,n,i)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},i=e,r={},o=t,s=function(e){return qq.isObject(e)?qq.extend({},e):e},a=function(){return qq.isFunction(o)?o():o},l=function(e,t){o&&qq.isObject(t)&&qq.extend(t,a()),r[e]&&qq.extend(t,r[e])};return{set:function(e,t){null==t?(n={},i=s(e)):n[t]=s(e)},get:function(e){var t;return t=null!=e&&n[e]?n[e]:s(i),l(e,t),s(t)},addReadOnly:function(e,t){qq.isObject(n)&&(null===e?qq.isFunction(t)?o=t:(o=o||{},qq.extend(o,t)):(r[e]=r[e]||{},qq.extend(r[e],t)))},remove:function(e){return delete n[e]},reset:function(){n={},r={},i=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,i){e._onUploadStatusChange(t,n,i),e._options.callbacks.onStatusChange(t,n,i),e._maybeAllComplete(t,i),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,i)},0)}})},_createUploadButton:function(e){function t(){return qq.supportedFeatures.ajaxUploading?i._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&i._isAllowedExtension(o,".mov")?!1:void 0===e.multiple?i._options.multiple:e.multiple:!1}var n,i=this,r=e.accept||this._options.validation.acceptFiles,o=e.allowedExtensions||this._options.validation.allowedExtensions;return n=new qq.UploadButton({acceptFiles:r,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:t(),name:this._options.request.inputName,onChange:function(e){i._onInputChange(e)},title:null==e.title?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){n.dispose()}),i._buttons.push(n),n},_createUploadHandler:function(e,t){var n=this,i={},r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,r,o){0>r||0>o||(i[e]?(i[e].loaded!==r||i[e].total!==o)&&(n._onProgress(e,t,r,o),n._options.callbacks.onProgress(e,t,r,o)):(n._onProgress(e,t,r,o),n._options.callbacks.onProgress(e,t,r,o)),i[e]={loaded:r,total:o})},onComplete:function(e,t,r,o){delete i[e];var s,a=n.getUploads({id:e}).status;a!==qq.status.UPLOAD_SUCCESSFUL&&a!==qq.status.UPLOAD_FAILED&&(s=n._onComplete(e,t,r,o),s instanceof qq.Promise?s.done(function(){n._options.callbacks.onComplete(e,t,r,o)}):n._options.callbacks.onComplete(e,t,r,o))},onCancel:function(e,t,i){var r=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:r.failure,onSuccess:function(){i.then(function(){n._onCancel(e,t)}),r.success()},identifier:e}),r},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t),n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,i){n._onUploadChunk(e,i),n._options.callbacks.onUploadChunk(e,t,i)},onUploadChunkSuccess:function(e,t,i,r){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,i){return n._options.callbacks.onResume(e,t,i)},onAutoRetry:function(e,t,i,r){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'"),n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch};return qq.each(this._options.request,function(e,t){r[e]=t}),r.customHeaders=this._customHeadersStore,e&&qq.each(e,function(e,t){r[e]=t}),new qq.UploadHandlerController(r,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(0===e)return e+this._options.text.sizeSymbols[0];var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var i=n.multiple,r=qq.extend({},e._options.validation,!0),o=qq.extend({},n);void 0===i&&(i=e._options.multiple),o.validation&&qq.extend(r,n.validation,!0),qq.extend(o,{multiple:i,validation:r},!0),e._initExtraButton(o)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,n,i=e;if(i instanceof qq.BlobProxy&&(i=i.referenceBlob),i&&!qq.isBlob(i)){if(qq.isFile(i))return i.qqButtonId;if("input"===i.tagName.toLowerCase()&&"file"===i.type.toLowerCase())return i.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=i.getElementsByTagName("input"),qq.each(t,function(e,t){return"file"===t.getAttribute("type")?(n=t,!1):void 0}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(e,i){n.push(t._getValidationDescriptor(i))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,i=this._options;n&&n!==this._defaultButtonId&&(i=this._extraButtonSpecs[n]),i.multiple=!1,null===i.validation.acceptFiles?i.validation.acceptFiles=e:i.validation.acceptFiles+=","+e,qq.each(this._buttons,function(e,t){return t.getButtonId()===n?(t.setMultiple(i.multiple),t.setAcceptFiles(i.acceptFiles),!1):void 0})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(n){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(n)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var i=this,r=qq.getUniqueId(),o=-1,s=qq.getFilename(e),a=e.blob||e,l=this._customNewFileHandler?this._customNewFileHandler:qq.bind(i._handleNewFileGeneric,i);!qq.isInput(a)&&a.size>=0&&(o=a.size),l(a,s,r,o,n,t,this._options.request.uuidName,{uploadData:i._uploadData,paramsStore:i._paramsStore,addFileToHandler:function(e,t){i._handler.add(e,t),i._netUploadedOrQueued++,i._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,i,r,o){var s=this._uploadData.addFile({uuid:n,name:t,size:i,batchId:o});this._handler.add(s,e),this._trackButton(s),this._netUploadedOrQueued++,r.push({id:s,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],i=t;null==i&&(i=this._options.paste.defaultName),i+="."+n,this.addFiles({name:i,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),t&&void 0!==t.withCredentials?this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t):this._options.callbacks.onError(e,n,"Delete request failed",t);
},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return qq.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(e,i){if(qq.isString(i)){var r=new RegExp("\\."+i+"$","i");if(null!=t.match(r))return n=!0,!1}}),n):!0},_itemError:function(e,t,n){function i(e,t){s=s.replace(e,t)}var r,o,s=this._options.messages[e],a=[],l=[].concat(t),c=l[0],u=this._getButtonId(n),d=this._getValidationBase(u);return qq.each(d.allowedExtensions,function(e,t){qq.isString(t)&&a.push(t)}),r=a.join(", ").toLowerCase(),i("{file}",this._options.formatFileName(c)),i("{extensions}",r),i("{sizeLimit}",this._formatSize(d.sizeLimit)),i("{minSizeLimit}",this._formatSize(d.minSizeLimit)),o=s.match(/(\{\w+\})/g),null!==o&&qq.each(o,function(e,t){i(t,l[e])}),this._options.callbacks.onError(null,c,s,void 0),s},_manualRetry:function(e,t){return this._onBeforeManualRetry(e)?(this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0):void 0},_maybeAllComplete:function(e,t){var n=this,i=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),0===i&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,i){if(!n.success)if(i&&200!==i.status&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+i.status,i);else{var r=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,r,i)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,i,r){var o=this;if(t.length>n)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=o._getValidationDescriptor(t[n]),s=o._getButtonId(t[n].file),a=o._getButton(s);o._handleCheckedCallback({name:"onValidate",callback:qq.bind(o._options.callbacks.onValidate,o,e,a),onSuccess:qq.bind(o._onValidateCallbackSuccess,o,t,n,i,r),onFailure:qq.bind(o._onValidateCallbackFailure,o,t,n,i,r),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;n<t.length;n++)o._fileOrBlobRejected(t[n].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,i,r){var o=this;if(o._preventRetries[e]=n[o._options.retry.preventRetryResponseProperty],o._shouldAutoRetry(e,t,n)){var s=1e3*o._options.retry.autoAttemptDelay;return o._maybeParseAndSendUploadError.apply(o,arguments),o._options.callbacks.onAutoRetry(e,t,o._autoRetries[e]),o._onBeforeAutoRetry(e,t),o._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),o._retryTimeouts[e]=setTimeout(function(){o.log("Starting retry for "+t+"..."),r?r(e):o._handler.retry(e)},s),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t,n=this._currentItemLimit;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(t=this.getName(e),this._options.callbacks.onManualRetry(e,t)===!1?!1:n>0&&this._netUploadedOrQueued+1>n?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,i){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,i),n.success?!0:!1},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e);n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,i){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,i)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var i,r=this.getUuid(e);return t&&(i=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:i||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,i,r){var o,s=this._currentItemLimit,a=this._netUploadedOrQueued;0===s||s>=a?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],r),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,i),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,i),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),o=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,s),this._batchError(o))},_onValidateCallbackFailure:function(e,t,n,i){var r=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,n,i)},_onValidateCallbackSuccess:function(e,t,n,i){var r=this,o=t+1,s=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],s).then(function(){r._upload(e[t].id,n,i),r._maybeProcessNextItemAfterOnValidateCallback(!0,e,o,n,i)},function(){r._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,n,i)})},_prepareItemsForUpload:function(e,t,n){if(0===e.length)return void this._itemError("noFilesError");var i=this._getValidationDescriptors(e),r=this._getButtonId(e[0].file),o=this._getButton(r);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,i,o),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,i,e,t,n,o),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){return e.getInProgress()?(t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave):void 0})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,n){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(t,!0,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,n){var i=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&i.status!==qq.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;t=qq.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var i=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,i),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,i),onFailure:qq.bind(this._fileOrBlobRejected,this,e,i),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,i=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),r=t.name,o=t.size,s=this._getButtonId(e.file),a=this._getValidationBase(s),l=new qq.Promise;return l.then(function(){},function(){n._fileOrBlobRejected(e.id,r)}),qq.isFileOrInput(i)&&!this._isAllowedExtension(a.allowedExtensions,r)?(this._itemError("typeError",r,i),l.failure()):this._options.validation.allowEmpty||0!==o?o>0&&a.sizeLimit&&o>a.sizeLimit?(this._itemError("sizeError",r,i),l.failure()):o>0&&o<a.minSizeLimit?(this._itemError("minSizeError",r,i),l.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(i)?new qq.ImageValidation(i,qq.bind(n.log,n)).validate(a.image).then(l.success,function(e){n._itemError(e+"ImageError",r,i),l.failure()}):l.success(),l):(this._itemError("emptyError",r,i),l.failure())},_wrapCallbacks:function(){var e,t,n;e=this,t=function(t,n,i){var r;try{return n.apply(e,i)}catch(o){r=o.message||o.toString(),e.log("Caught exception in '"+t+"' callback - "+r,"error")}};for(n in this._options.callbacks)!function(){var i,r;i=n,r=e._options.callbacks[i],e._options.callbacks[i]=function(){return t(i,r,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,i){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onResume:function(e,t,n){},onProgress:function(e,t,n,i){},onTotalProgress:function(e,t){},onError:function(e,t,n,i){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0})),this._currentItemLimit=this._options.validation.itemLimit},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){"use strict";function t(){return qq.indexOf(["GET","POST","HEAD"],C.method)>=0}function n(e){var t=!1;return qq.each(t,function(e,n){return qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0?(t=!0,!1):void 0}),t}function i(e){return C.cors.expected&&void 0===e.withCredentials}function r(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&(e=qq.createXhrInstance(),void 0===e.withCredentials&&(e=new XDomainRequest,e.onload=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onprogress=function(){})),e}function o(e,t){var n=_[e].xhr;return n||(n=t?t:C.cors.expected?r():qq.createXhrInstance(),_[e].xhr=n),n}function s(e){var t,n=qq.indexOf(b,e),i=C.maxConnections;delete _[e],b.splice(n,1),b.length>=i&&i>n&&(t=b[i-1],c(t))}function a(e,t){var n=o(e),r=C.method,a=t===!0;s(e),a?y(r+" request for "+e+" has failed","error"):i(n)||m(n.status)||(a=!0,y(r+" request for "+e+" has failed - response code "+n.status,"error")),C.onComplete(e,n,a)}function l(e){var t,n=_[e].additionalParams,i=C.mandatedParams;return C.paramsStore.get&&(t=C.paramsStore.get(e)),n&&qq.each(n,function(e,n){t=t||{},t[e]=n}),i&&qq.each(i,function(e,n){t=t||{},t[e]=n}),t}function c(e,t){var n,r=o(e,t),s=C.method,a=l(e),c=_[e].payload;return C.onSend(e),n=u(e,a,_[e].additionalQueryParams),i(r)?(r.onload=f(e),r.onerror=p(e)):r.onreadystatechange=d(e),h(e),r.open(s,n,!0),C.cors.expected&&C.cors.sendCredentials&&!i(r)&&(r.withCredentials=!0),g(e),y("Sending "+s+" request for "+e),c?r.send(c):w||!a?r.send():a&&C.contentType&&C.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?r.send(qq.obj2url(a,"")):a&&C.contentType&&C.contentType.toLowerCase().indexOf("application/json")>=0?r.send(JSON.stringify(a)):r.send(a),r}function u(e,t,n){var i=C.endpointStore.get(e),r=_[e].addToPath;return void 0!=r&&(i+="/"+r),w&&t&&(i=qq.obj2url(t,i)),n&&(i=qq.obj2url(n,i)),i}function d(e){return function(){4===o(e).readyState&&a(e)}}function h(e){var t=C.onProgress;t&&(o(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}function f(e){return function(){a(e)}}function p(e){return function(){a(e,!0)}}function g(e){var r=o(e),s=C.customHeaders,a=_[e].additionalHeaders||{},l=C.method,c={};i(r)||(C.acceptHeader&&r.setRequestHeader("Accept",C.acceptHeader),C.allowXRequestedWithAndCacheControl&&(C.cors.expected&&t()&&!n(s)||(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"))),!C.contentType||"POST"!==l&&"PUT"!==l||r.setRequestHeader("Content-Type",C.contentType),qq.extend(c,qq.isFunction(s)?s(e):s),qq.extend(c,a),qq.each(c,function(e,t){r.setRequestHeader(e,t)}))}function m(e){return qq.indexOf(C.successfulResponseCodes[C.method],e)>=0}function v(e,t,n,i,r,o,s){_[e]={addToPath:n,additionalParams:i,additionalQueryParams:r,additionalHeaders:o,payload:s};var a=b.push(e);return a<=C.maxConnections?c(e,t):void 0}var y,w,b=[],_={},C={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};if(qq.extend(C,e),y=C.log,qq.indexOf(C.validMethods,C.method)<0)throw new Error("'"+C.method+"' is not a supported method for this type of request!");w="GET"===C.method||"DELETE"===C.method,qq.extend(this,{initTransport:function(e){var t,n,i,r,o,s;return{withPath:function(e){return t=e,this},withParams:function(e){return n=e,this},withQueryParams:function(e){return s=e,this},withHeaders:function(e){return i=e,this},withPayload:function(e){return r=e,this},withCacheBuster:function(){return o=!0,this},send:function(a){return o&&qq.indexOf(["GET","DELETE"],C.method)>=0&&(n.qqtimestamp=(new Date).getTime()),v(e,a,t,n,s,i,r)}}},canceled:function(e){s(e)}})},qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},i=t.onCancel,r=t.getName;qq.extend(this,{add:function(e,t){n[e]=t,n[e].temp={}},cancel:function(e){var t=this,o=new qq.Promise,s=i(e,r(e),o);s.then(function(){t.isValid(e)&&(n[e].canceled=!0,t.expunge(e)),o.success()})},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return void 0!==n[e]},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})},qq.UploadHandlerController=function(e,t){"use strict";var n,i,r,o=this,s=!1,a=!1,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,i){},onComplete:function(e,t,n,i){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onAutoRetry:function(e,t,n,i){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},c={done:function(e,t,n,i){var o=r._getChunkData(e,t);r._getFileState(e).attemptingResume=!1,delete r._getFileState(e).temp.chunkProgress[t],r._getFileState(e).loaded+=o.size,l.onUploadChunkSuccess(e,r._getChunkDataForCallback(o),n,i)},finalize:function(e){var t=l.getSize(e),n=l.getName(e);i("All chunks have been uploaded for "+e+" - finalizing...."),r.finalizeChunks(e).then(function(o,s){i("Finalize successful for "+e);var a=h.normalizeResponse(o,!0);l.onProgress(e,n,t,t),r._maybeDeletePersistedChunkData(e),h.cleanup(e,a,s)},function(t,r){var o=h.normalizeResponse(t,!1);i("Problem finalizing chunks for file ID "+e+" - "+o.error,"error"),o.reset&&c.reset(e),l.onAutoRetry(e,n,o,r)||h.cleanup(e,o,r)})},handleFailure:function(e,t,n,o){var s=l.getName(t);i("Chunked upload request failed for "+t+", chunk "+e),r.clearCachedChunk(t,e);var d,f=h.normalizeResponse(n,!1);f.reset?c.reset(t):(d=qq.indexOf(r._getFileState(t).chunking.inProgress,e),d>=0&&(r._getFileState(t).chunking.inProgress.splice(d,1),r._getFileState(t).chunking.remaining.unshift(e))),r._getFileState(t).temp.ignoreFailure||(a&&(r._getFileState(t).temp.ignoreFailure=!0,i(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(r._getXhrs(t))),JSON.stringify(r._getFileState(t).chunking.inProgress))),qq.each(r._getXhrs(t),function(e,n){i(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",t,e,n.readyState)),n.abort(),n._cancelled=!0}),r.moveInProgressToRemaining(t),u.free(t,!0)),l.onAutoRetry(t,s,f,o)||h.cleanup(t,f,o))},hasMoreParts:function(e){return!!r._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=r._getFileState(e).chunking.remaining.shift();return t>=r._getTotalChunks(e)&&(t=null),t},reset:function(e){i("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),r._maybeDeletePersistedChunkData(e),r.reevaluateChunking(e),r._getFileState(e).loaded=0},sendNext:function(e){var t=l.getSize(e),n=l.getName(e),o=c.nextPart(e),s=r._getChunkData(e,o),d=r._getFileState(e).attemptingResume,f=r._getFileState(e).chunking.inProgress||[];null==r._getFileState(e).loaded&&(r._getFileState(e).loaded=0),d&&l.onResume(e,n,s)===!1&&(c.reset(e),o=c.nextPart(e),s=r._getChunkData(e,o),d=!1),null==o&&0===f.length?c.finalize(e):(i(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,o,s.start+1,s.end,t)),l.onUploadChunk(e,n,r._getChunkDataForCallback(s)),f.push(o),r._getFileState(e).chunking.inProgress=f,a&&u.open(e,o),a&&u.available()&&r._getFileState(e).chunking.remaining.length&&c.sendNext(e),0===s.blob.size?(i(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",o,e),"error"),c.handleFailure(o,e,"File is no longer available",null)):r.uploadChunk(e,o,d).then(function(t,n){i("Chunked upload request succeeded for "+e+", chunk "+o),r.clearCachedChunk(e,o);var s=r._getFileState(e).chunking.inProgress||[],a=h.normalizeResponse(t,!0),l=qq.indexOf(s,o);i(qq.format("Chunk {} for file {} uploaded successfully.",o,e)),c.done(e,o,a,n),l>=0&&s.splice(l,1),r._maybePersistChunkedState(e),c.hasMoreParts(e)||0!==s.length?c.hasMoreParts(e)?c.sendNext(e):i(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(s))):c.finalize(e)},function(t,n){c.handleFailure(o,e,t,n)}).done(function(){r.clearXhr(e,o)}))}},u={_open:[],_openChunks:{},_waiting:[],available:function(){var e=l.maxConnections,t=0,n=0;return qq.each(u._openChunks,function(e,i){t++,n+=i.length}),e-(u._open.length-t+n)},free:function(e,t){var n,o=!t,s=qq.indexOf(u._waiting,e),a=qq.indexOf(u._open,e);delete u._openChunks[e],h.getProxyOrBlob(e)instanceof qq.BlobProxy&&(i("Generated blob upload has ended for "+e+", disposing generated blob."),delete r._getFileState(e).file),s>=0?u._waiting.splice(s,1):o&&a>=0&&(u._open.splice(a,1),n=u._waiting.shift(),n>=0&&(u._open.push(n),h.start(n)))},getWaitingOrConnected:function(){var e=[];return qq.each(u._openChunks,function(t,n){n&&n.length&&e.push(parseInt(t))}),qq.each(u._open,function(t,n){u._openChunks[n]||e.push(parseInt(n))}),e=e.concat(u._waiting)},isUsingConnection:function(e){return qq.indexOf(u._open,e)>=0},open:function(e,t){return null==t&&u._waiting.push(e),u.available()?(null==t?(u._waiting.pop(),u._open.push(e)):!function(){var n=u._openChunks[e]||[];n.push(t),u._openChunks[e]=n}(),!0):!1},reset:function(){u._waiting=[],u._open=[]}},d={send:function(e,t){r._getFileState(e).loaded=0,i("Sending simple upload request for "+e),r.uploadFile(e).then(function(n,r){i("Simple upload request succeeded for "+e);var o=h.normalizeResponse(n,!0),s=l.getSize(e);l.onProgress(e,t,s,s),h.maybeNewUuid(e,o),h.cleanup(e,o,r)},function(n,r){i("Simple upload request failed for "+e);var o=h.normalizeResponse(n,!1);l.onAutoRetry(e,t,o,r)||h.cleanup(e,o,r)})}},h={cancel:function(e){i("Cancelling "+e),l.paramsStore.remove(e),u.free(e)},cleanup:function(e,t,n){var i=l.getName(e);l.onComplete(e,i,t,n),r._getFileState(e)&&r._clearXhrs&&r._clearXhrs(e),u.free(e)},getProxyOrBlob:function(e){return r.getProxy&&r.getProxy(e)||r.getFile&&r.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";r=new e[n+"UploadHandler"](l,{getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:i,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged}),r._removeExpiredChunkingRecords&&r._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return l.isQueued(e)},maybeDefer:function(e,t){return t&&!r.getFile(e)&&t instanceof qq.BlobProxy?(l.onUploadPrep(e),i("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){i("Generated an on-demand blob for "+e),r.updateBlob(e,t),l.setSize(e,t.size),r.reevaluateChunking(e),h.maybeSendDeferredFiles(e)},function(t){var r={};t&&(r.error=t),i(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),l.onComplete(e,l.getName(e),qq.extend(r,n),null),h.maybeSendDeferredFiles(e),u.free(e)}),!1):h.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=l.getIdsInProxyGroup(e),n=!1;return t&&t.length?(i("Maybe ready to upload proxy group file "+e),qq.each(t,function(t,i){if(h.isDeferredEligibleForUpload(i)&&r.getFile(i))n=i===e,h.now(i);else if(h.isDeferredEligibleForUpload(i))return!1})):(n=!0,h.now(e)),n},maybeNewUuid:function(e,t){void 0!==t.newUuid&&l.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var n=e;return qq.isObject(e)||(n={},qq.isString(e)&&!t&&(n.error=e)),n.success=t,n},now:function(e){var t=l.getName(e);if(!o.isValid(e))throw new qq.Error(e+" is not a valid file ID to upload!");l.onUpload(e,t),s&&r._shouldChunkThisFile(e)?c.sendNext(e):d.send(e,t)},start:function(e){var t=h.getProxyOrBlob(e);return t?h.maybeDefer(e,t):(h.now(e),!0)}};qq.extend(this,{add:function(e,t){r.add.apply(this,arguments)},upload:function(e){return u.open(e)?h.start(e):!1},retry:function(e){return a&&(r._getFileState(e).temp.ignoreFailure=!1),u.isUsingConnection(e)?h.start(e):o.upload(e)},cancel:function(e){var t=r.cancel(e);qq.isGenericPromise(t)?t.then(function(){h.cancel(e)}):t!==!1&&h.cancel(e)},cancelAll:function(){var e,t=u.getWaitingOrConnected();if(t.length)for(e=t.length-1;e>=0;e--)o.cancel(t[e]);u.reset()},getFile:function(e){return r.getProxy&&r.getProxy(e)?r.getProxy(e).referenceBlob:r.getFile&&r.getFile(e)},isProxied:function(e){return!(!r.getProxy||!r.getProxy(e))},getInput:function(e){return r.getInput?r.getInput(e):void 0},reset:function(){i("Resetting upload handler"),o.cancelAll(),u.reset(),r.reset()},expunge:function(e){return o.isValid(e)?r.expunge(e):void 0},isValid:function(e){return r.isValid(e)},getResumableFilesData:function(){return r.getResumableFilesData?r.getResumableFilesData():[]},getThirdPartyFileId:function(e){return o.isValid(e)?r.getThirdPartyFileId(e):void 0},pause:function(e){return o.isResumable(e)&&r.pause&&o.isValid(e)&&r.pause(e)?(u.free(e),r.moveInProgressToRemaining(e),!0):!1},isResumable:function(e){return!!r.isResumable&&r.isResumable(e)}}),qq.extend(l,e),i=l.log,s=l.chunking.enabled&&qq.supportedFeatures.chunking,
a=s&&l.chunking.concurrent.enabled,n=function(){var e={};return e[l.preventRetryParam]=!0,e}(),h.initHandler()},qq.WindowReceiveMessage=function(e){"use strict";var t={log:function(e,t){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(e,t){var i=function(e){t(e.data)};window.postMessage?n[e]=qq(window).attach("message",i):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];t&&t()}}})},qq.FormUploadHandler=function(e){"use strict";function t(e){delete u[e],h&&(clearTimeout(d[e]),delete d[e],m.stopReceivingMessages(e));var t=document.getElementById(s._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())}function n(e){return e.split("_")[0]}function i(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}function r(e,t){var i=e.id,r=n(i),o=p(r);c[o]=t,u[r]=qq(e).attach("load",function(){s.getInput(r)&&(g("Received iframe load event for CORS upload request (iframe name "+i+")"),d[i]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+i;g(e,"error"),t({error:e})},1e3))}),m.receiveMessage(i,function(e){g("Received the following window message: '"+e+"'");var t,r=(n(i),s._parseJsonResponse(e)),o=r.uuid;o&&c[o]?(g("Handling response for iframe name "+i),clearTimeout(d[i]),delete d[i],s._detachLoadEvent(i),t=c[o],delete c[o],m.stopReceivingMessages(i),t(r)):o||g("'"+e+"' does not contain a UUID - ignoring.")})}var o=e.options,s=this,a=e.proxy,l=qq.getUniqueId(),c={},u={},d={},h=o.isCors,f=o.inputName,p=a.getUuid,g=a.log,m=new qq.WindowReceiveMessage({log:g});qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,n){e.add(t,{input:n}),n.setAttribute("name",f),n.parentNode&&qq(n).remove()},expunge:function(n){t(n),e.expunge(n)},isValid:function(t){return e.isValid(t)&&void 0!==s._getFileState(t).input}}}),qq.extend(this,{getInput:function(e){return s._getFileState(e).input},_attachLoadEvent:function(e,t){var n;h?r(e,t):u[e.id]=qq(e).attach("load",function(){if(g("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(i){g("Error when attempting to access iframe during handling of upload response ("+i.message+")","error"),n={success:!1}}t(n)}})},_createIframe:function(e){var t=s._getIframeName(e);return i(t)},_detachLoadEvent:function(e){void 0!==u[e]&&(u[e](),delete u[e])},_getIframeName:function(e){return e+"_"+l},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,i=e.params,r=e.paramsInBody,o=e.targetName,s=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),a=n;return r?qq.obj2Inputs(i,s):a=qq.obj2url(i,n),s.setAttribute("action",a),s.setAttribute("target",o),s.style.display="none",document.body.appendChild(s),s},_parseJsonResponse:function(e){var t={};try{t=qq.parseJson(e)}catch(n){g("Error when attempting to parse iframe upload response ("+n.message+")","error")}return t}})},qq.XhrUploadHandler=function(e){"use strict";function t(e){qq.each(n._getXhrs(e),function(t,i){var r=n._getAjaxRequester(e,t);i.onreadystatechange=null,i.upload.onprogress=null,i.abort(),r&&r.canceled&&r.canceled(e)})}var n=this,i=e.options.namespace,r=e.proxy,o=e.options.chunking,s=e.options.resume,a=o&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,l=s&&e.options.resume.enabled&&a&&qq.supportedFeatures.resume,c=r.getName,u=r.getSize,d=r.getUuid,h=r.getEndpoint,f=r.getDataByUuid,p=r.onUuidChanged,g=r.onProgress,m=r.log;qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,i){if(qq.isFile(i)||qq.isBlob(i))e.add(t,{file:i});else{if(!(i instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(t,{proxy:i})}n._initTempState(t),l&&n._maybePrepareForResume(t)},expunge:function(i){t(i),n._maybeDeletePersistedChunkData(i),n._clearXhrs(i),e.expunge(i)}}}),qq.extend(this,{clearCachedChunk:function(e,t){delete n._getFileState(e).temp.cachedChunks[t]},clearXhr:function(e,t){var i=n._getFileState(e).temp;i.xhrs&&delete i.xhrs[t],i.ajaxRequesters&&delete i.ajaxRequesters[t]},finalizeChunks:function(e,t){var i=n._getTotalChunks(e)-1,r=n._getXhr(e,i);return t?(new qq.Promise).success(t(r),r):(new qq.Promise).success({},r)},getFile:function(e){return n.isValid(e)&&n._getFileState(e).file},getProxy:function(e){return n.isValid(e)&&n._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return n._iterateResumeRecords(function(t,i){n.moveInProgressToRemaining(null,i.chunking.inProgress,i.chunking.remaining);var r={name:i.name,remaining:i.chunking.remaining,size:i.size,uuid:i.uuid};i.key&&(r.key=i.key),e.push(r)}),e},isResumable:function(e){return!!o&&n.isValid(e)&&!n._getFileState(e).notResumable},moveInProgressToRemaining:function(e,t,i){var r=t||n._getFileState(e).chunking.inProgress,o=i||n._getFileState(e).chunking.remaining;r&&(m(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(r))),r.reverse(),qq.each(r,function(e,t){o.unshift(t)}),r.length=0)},pause:function(e){return n.isValid(e)?(m(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,c(e))),n._getFileState(e).paused=!0,t(e),!0):void 0},reevaluateChunking:function(e){if(o&&n.isValid(e)){var t,i,r=n._getFileState(e);if(delete r.chunking,r.chunking={},t=n._getTotalChunks(e),t>1||o.mandatory){for(r.chunking.enabled=!0,r.chunking.parts=t,r.chunking.remaining=[],i=0;t>i;i++)r.chunking.remaining.push(i);n._initTempState(e)}else r.chunking.enabled=!1}},updateBlob:function(e,t){n.isValid(e)&&(n._getFileState(e).file=t)},_clearXhrs:function(e){var t=n._getFileState(e).temp;qq.each(t.ajaxRequesters,function(e){delete t.ajaxRequesters[e]}),qq.each(t.xhrs,function(e){delete t.xhrs[e]})},_createXhr:function(e,t){return n._registerXhr(e,t,qq.createXhrInstance())},_getAjaxRequester:function(e,t){var i=null==t?-1:t;return n._getFileState(e).temp.ajaxRequesters[i]},_getChunkData:function(e,t){var i=o.partSize,r=u(e),s=n.getFile(e),a=i*t,l=a+i>=r?r:a+i,c=n._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,h=d[t]||qq.sliceBlob(s,a,l);return d[t]=h,{part:t,start:a,end:l,count:c,blob:h,size:l-a}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t="5.0",n=c(e),r=u(e),s=o.partSize,a=h(e);return qq.format("qq{}resume{}-{}-{}-{}-{}",i,t,n,r,s,a)},_getMimeType:function(e){return n.getFile(e).type},_getPersistableData:function(e){return n._getFileState(e).chunking},_getTotalChunks:function(e){if(o){var t=u(e),n=o.partSize;return Math.ceil(t/n)}},_getXhr:function(e,t){var i=null==t?-1:t;return n._getFileState(e).temp.xhrs[i]},_getXhrs:function(e){return n._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){l&&qq.each(localStorage,function(t,n){if(0===t.indexOf(qq.format("qq{}resume",i))){var r=JSON.parse(n);e(t,r)}})},_initTempState:function(e){n._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){n._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var t;return l&&n.isResumable(e)&&(t=n._getLocalStorageId(e),t&&localStorage.getItem(t))?(localStorage.removeItem(t),!0):!1},_maybePrepareForResume:function(e){var t,i,r=n._getFileState(e);l&&void 0===r.key&&(t=n._getLocalStorageId(e),i=localStorage.getItem(t),i&&(i=JSON.parse(i),f(i.uuid)?n._markNotResumable(e):(m(qq.format("Identified file with ID {} and name of {} as resumable.",e,c(e))),p(e,i.uuid),r.key=i.key,r.chunking=i.chunking,r.loaded=i.loaded,r.attemptingResume=!0,n.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var t,i,r=n._getFileState(e);if(l&&n.isResumable(e)){t=n._getLocalStorageId(e),i={name:c(e),size:u(e),uuid:d(e),key:r.key,chunking:r.chunking,loaded:r.loaded,lastUpdated:Date.now()};try{localStorage.setItem(t,JSON.stringify(i))}catch(o){m(qq.format("Unable to save resume data for '{}' due to error: '{}'.",e,o.toString()),"warn")}}},_registerProgressHandler:function(e,t,i){var r=n._getXhr(e,t),o=c(e),s={simple:function(t,n){var i=u(e);t===n?g(e,o,i,i):g(e,o,t>=i?i-1:t,i)},chunked:function(r,s){var a=n._getFileState(e).temp.chunkProgress,l=n._getFileState(e).loaded,c=r,d=s,h=u(e),f=c-(d-i),p=l;a[t]=f,qq.each(a,function(e,t){p+=t}),g(e,o,p,h)}};r.upload.onprogress=function(e){if(e.lengthComputable){var t=null==i?"simple":"chunked";s[t](e.loaded,e.total)}}},_registerXhr:function(e,t,i,r){var o=null==t?-1:t,s=n._getFileState(e).temp;return s.xhrs=s.xhrs||{},s.ajaxRequesters=s.ajaxRequesters||{},s.xhrs[o]=i,r&&(s.ajaxRequesters[o]=r),i},_removeExpiredChunkingRecords:function(){var e=s.recordsExpireIn;n._iterateResumeRecords(function(t,n){var i=new Date(n.lastUpdated);i.setDate(i.getDate()+e),i.getTime()<=Date.now()&&(m("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var t=n._getFileState(e);return t.chunking||n.reevaluateChunking(e),t.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){"use strict";function t(){return"POST"===i.method.toUpperCase()?{_method:"DELETE"}:{}}var n,i={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(i,e),n=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:i.method,endpointStore:i.endpointStore,paramsStore:i.paramsStore,mandatedParams:t(),maxConnections:i.maxConnections,customHeaders:function(e){return i.customHeaders.get(e)},log:i.log,onSend:i.onDelete,onComplete:i.onDeleteComplete,cors:i.cors})),qq.extend(this,{sendDelete:function(e,t,r){var o=r||{};i.log("Submitting delete file request for "+e),"DELETE"===i.method?n.initTransport(e).withPath(t).withParams(o).send():(o[i.uuidParamName]=t,n.initTransport(e).withParams(o).send())}})},function(){function e(e){var t,n=e.naturalWidth,i=e.naturalHeight,r=document.createElement("canvas");return n*i>1048576?(r.width=r.height=1,t=r.getContext("2d"),t.drawImage(e,-n+1,0),0===t.getImageData(0,0,1,1).data[3]):!1}function t(e,t,n){var i,r,o,s,a=document.createElement("canvas"),l=0,c=n,u=n;for(a.width=1,a.height=n,i=a.getContext("2d"),i.drawImage(e,0,0),r=i.getImageData(0,0,1,n).data;u>l;)o=r[4*(u-1)+3],0===o?c=u:l=u,u=c+l>>1;return s=u/n,0===s?1:s}function n(e,t,n,i){var o=document.createElement("canvas"),s=n.mime||"image/jpeg",a=new qq.Promise;return r(e,t,o,n,i).then(function(){a.success(o.toDataURL(s,n.quality||.8))}),a}function i(e){var t=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");return e.origHeight*e.origWidth>t?{newHeight:Math.round(Math.sqrt(t*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(t*(e.origWidth/e.origHeight)))}:void 0}function r(n,r,a,l,c){var u,d=n.naturalWidth,h=n.naturalHeight,f=l.width,p=l.height,g=a.getContext("2d"),m=new qq.Promise;return g.save(),l.resize?o({blob:r,canvas:a,image:n,imageHeight:h,imageWidth:d,orientation:l.orientation,resize:l.resize,targetHeight:p,targetWidth:f}):(qq.supportedFeatures.unlimitedScaledImageSize||(u=i({origWidth:f,origHeight:p}),u&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",f,p,u.newWidth,u.newHeight),"warn"),f=u.newWidth,p=u.newHeight)),s(a,f,p,l.orientation),qq.ios()?!function(){e(n)&&(d/=2,h/=2);var i,r,o,s=1024,a=document.createElement("canvas"),l=c?t(n,d,h):1,u=Math.ceil(s*f/d),m=Math.ceil(s*p/h/l),v=0,y=0;for(a.width=a.height=s,i=a.getContext("2d");h>v;){for(r=0,o=0;d>r;)i.clearRect(0,0,s,s),i.drawImage(n,-r,-v),g.drawImage(a,0,0,s,s,o,y,u,m),r+=s,o+=u;v+=s,y+=m}g.restore(),a=i=null}():g.drawImage(n,0,0,f,p),a.qqImageRendered&&a.qqImageRendered(),m.success(),m)}function o(e){var t=e.blob,n=e.image,i=e.imageHeight,r=e.imageWidth,o=e.orientation,a=new qq.Promise,l=e.resize,c=document.createElement("canvas"),u=c.getContext("2d"),d=e.canvas,h=e.targetHeight,f=e.targetWidth;return s(c,r,i,o),d.height=h,d.width=f,u.drawImage(n,0,0),l({blob:t,height:h,image:n,sourceCanvas:c,targetCanvas:d,width:f}).then(function(){d.qqImageRendered&&d.qqImageRendered(),a.success()},a.failure),a}function s(e,t,n,i){switch(i){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var r=e.getContext("2d");switch(i){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,n),r.rotate(Math.PI);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-n);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-n),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}}function a(e,t){var n=this;window.Blob&&e instanceof Blob&&!function(){var t=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!i)throw Error("No createObjectURL function found to create blob url");t.src=i.createObjectURL(e),n.blob=e,e=t}(),e.naturalWidth||e.naturalHeight||(e.onload=function(){var e=n.imageLoadListeners;e&&(n.imageLoadListeners=null,setTimeout(function(){for(var t=0,n=e.length;n>t;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}a.prototype.render=function(e,t){t=t||{};var i,o=this,s=this.srcImage.naturalWidth,a=this.srcImage.naturalHeight,l=t.width,c=t.height,u=t.maxWidth,d=t.maxHeight,h=!this.blob||"image/jpeg"===this.blob.type,f=e.tagName.toLowerCase();return this.imageLoadListeners?void this.imageLoadListeners.push(function(){o.render(e,t)}):(l&&!c?c=a*l/s<<0:c&&!l?l=s*c/a<<0:(l=s,c=a),u&&l>u&&(l=u,c=a*l/s<<0),d&&c>d&&(c=d,l=s*c/a<<0),i={width:l,height:c},qq.each(t,function(e,t){i[e]=t}),"img"===f?!function(){var t=e.src;n(o.srcImage,o.blob,i,h).then(function(n){e.src=n,t===e.src&&e.onload()})}():"canvas"===f&&r(this.srcImage,this.blob,e,i,h),void("function"==typeof this.onrender&&this.onrender(e)))},qq.MegaPixImage=a}(),qq.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function n(e){return"canvas"===e.tagName.toLowerCase()}function i(){return void 0!==(new Image).crossOrigin}function r(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function o(e){var t=e.split("/"),n=t[t.length-1].split("?")[0],i=qq.getExtension(n);switch(i=i&&i.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function s(e){var t,n,i,r=document.createElement("a");return r.href=e,t=r.protocol,i=r.port,n=r.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()?!0:n.toLowerCase()!==window.location.hostname.toLowerCase()?!0:i===window.location.port||qq.ie()?!1:!0}function a(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}function l(e,t){e.qqImageRendered=function(){t.success(e)}}function c(i,r){var o=t(i)||n(i);return t(i)?a(i,r):n(i)?l(i,r):(r.failure(i),e(qq.format("Element container of type {} is not supported!",i.tagName),"error")),o}function u(t,n,i){var r=new qq.Promise,o=new qq.Identify(t,e),s=i.maxSize,a=null==i.orient?!0:i.orient,l=function(){n.onerror=null,n.onload=null,e("Could not render preview, file may be too large!","error"),r.failure(n,"Browser cannot render image!")};return o.isPreviewable().then(function(o){var u={parse:function(){return(new qq.Promise).success()}},d=a?new qq.Exif(t,e):u,h=new qq.MegaPixImage(t,l);c(n,r)&&d.parse().then(function(e){var t=e&&e.Orientation;h.render(n,{maxWidth:s,maxHeight:s,orientation:t,mime:o,resize:i.customResizeFunction})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),h.render(n,{maxWidth:s,maxHeight:s,mime:o,resize:i.customResizeFunction})})},function(){e("Not previewable"),r.failure(n,"Not previewable")}),r}function d(e,t,n,i,r){var a=new Image,l=new qq.Promise;c(a,l),s(e)&&(a.crossOrigin="anonymous"),a.src=e,l.then(function(){c(t,n);var s=new qq.MegaPixImage(a);s.render(t,{maxWidth:i,maxHeight:i,mime:o(e),resize:r})},n.failure)}function h(e,t,n,i){c(t,n),qq(t).css({maxWidth:i+"px",maxHeight:i+"px"}),t.src=e}function f(e,o,a){var l=new qq.Promise,u=a.scale,f=u?a.maxSize:null;return u&&t(o)?r()?s(e)&&!i()?h(e,o,l,f):d(e,o,l,f):h(e,o,l,f):n(o)?d(e,o,l,f):c(o,l)&&(o.src=e),l}qq.extend(this,{generate:function(t,n,i){return qq.isString(t)?(e("Attempting to update thumbnail based on server response."),f(t,n,i||{})):(e("Attempting to draw client-side image preview."),u(t,n,i||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=s,this._testing.determineMimeOfFileName=o},qq.Exif=function(e,t){"use strict";function n(e){for(var t=0,n=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function i(t,n){var r=t,o=n;return void 0===r&&(r=2,o=new qq.Promise),qq.readBlobToHex(e,r,4).then(function(e){var t,n=/^ffe([0-9])/.exec(e);n?"1"!==n[1]?(t=parseInt(e.slice(4,8),16),i(r+t+2,o)):o.success(r):o.failure("No EXIF header to be found!")}),o}function r(){var t=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(e){0!==e.indexOf("ffd8")?t.failure("Not a valid JPEG!"):i().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}function o(t){var n=new qq.Promise;return qq.readBlobToHex(e,t+10,2).then(function(e){n.success("4949"===e)}),n}function s(t,i){var r=new qq.Promise;return qq.readBlobToHex(e,t+18,2).then(function(e){return i?r.success(n(e)):void r.success(parseInt(e,16))}),r}function a(t,n){var i=t+20,r=12*n;return qq.readBlobToHex(e,i,r)}function l(e){for(var t=[],n=0;n+24<=e.length;)t.push(e.slice(n,n+24)),n+=24;return t}function c(e,t){var i=16,r=qq.extend([],u),o={};return qq.each(t,function(t,s){var a,l,c,u=s.slice(0,4),h=e?n(u):parseInt(u,16),f=r.indexOf(h);return f>=0&&(l=d[h].name,c=d[h].bytes,a=s.slice(i,i+2*c),o[l]=e?n(a):parseInt(a,16),r.splice(f,1)),0===r.length?!1:void 0}),o}var u=[274],d={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var n=new qq.Promise,i=function(e){t(qq.format("EXIF header parse failed: '{}' ",e)),n.failure(e)};return r().then(function(r){t(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),o(r).then(function(e){t(qq.format("EXIF Byte order is {} endian",e?"little":"big")),s(r,e).then(function(o){t(qq.format("Found {} APP1 directory entries",o)),a(r,o).then(function(i){var r=l(i),o=c(e,r);t("Successfully parsed some EXIF tags"),n.success(o)},i)},i)},i)},i),n}}),this._testing={},this._testing.parseLittleEndian=n},qq.Identify=function(e,t){"use strict";function n(e,t){var n=!1,i=[].concat(e);return qq.each(i,function(e,i){return 0===t.indexOf(i)?(n=!0,!1):void 0}),n}qq.extend(this,{isPreviewable:function(){var i=this,r=new qq.Promise,o=!1,s=void 0===e.name?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",s)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(e){qq.each(i.PREVIEWABLE_MIME_TYPES,function(t,i){return n(i,e)?(("image/tiff"!==t||qq.supportedFeatures.tiffPreviews)&&(o=!0,r.success(t)),!1):void 0}),t(qq.format("'{}' is {} able to be rendered in this browser",s,o?"":"NOT")),o||r.failure()},function(){t("Error reading file w/ name '"+s+"'.  Not able to be rendered in this browser."),r.failure()})):r.failure(),r},isPreviewableSync:function(){var n=e.type,i=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,r=!1,o=void 0===e.name?"blob":e.name;return i&&(r="image/tiff"===n?qq.supportedFeatures.tiffPreviews:!0),!r&&t(o+" is not previewable in this browser per the blob's type attr"),r}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){"use strict";function n(e){var t=!1;return qq.each(e,function(e,n){return n>0?(t=!0,!1):void 0}),t}function i(){var n=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var i=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;r?(i.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),n.failure()},i.onload=function(){n.success({width:this.width,height:this.height})},i.src=r.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),n.failure())},n.failure),n}function r(e,t){var n;return qq.each(e,function(e,i){if(i>0){var r=/(max|min)(Width|Height)/.exec(e),o=r[2].charAt(0).toLowerCase()+r[2].slice(1),s=t[o];switch(r[1]){case"min":if(i>s)return n=e,!1;break;case"max":if(s>i)return n=e,!1}}}),n}this.validate=function(e){var o=new qq.Promise;return t("Attempting to validate image."),n(e)?i().then(function(t){var n=r(e,t);n?o.failure(n):o.success()},o.success):o.success(),o}},qq.Session=function(e){"use strict";function t(e){return qq.isArray(e)?!0:void i.log("Session response is not an array.","error")}function n(e,n,r,o){var s=!1;n=n&&t(e),n&&qq.each(e,function(e,t){if(null==t.uuid)s=!0,i.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==t.name)s=!0,i.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return i.addFileRecord(t),!0}catch(n){s=!0,i.log(n.message,"error")}return!1}),o[n&&!s?"success":"failure"](e,r)}var i={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};qq.extend(i,e,!0),this.refresh=function(){var e=new qq.Promise,t=function(t,i,r){n(t,i,r,e)},r=qq.extend({},i),o=new qq.SessionAjaxRequester(qq.extend(r,{onComplete:t}));return o.queryServer(),e}},qq.SessionAjaxRequester=function(e){"use strict";function t(e,t,n){var r=null;if(null!=t.responseText)try{r=qq.parseJson(t.responseText)}catch(o){i.log("Problem parsing session response: "+o.message,"error"),n=!0}i.onComplete(r,!n,t)}var n,i={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(i,e),n=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return i.endpoint}},customHeaders:i.customHeaders,log:i.log,onComplete:t,cors:i.cors})),qq.extend(this,{queryServer:function(){var e=qq.extend({},i.params);i.log("Session query request."),n.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qq.Scaler=function(e,t){"use strict";var n=e.customResizer,i=e.sendOriginal,r=e.orient,o=e.defaultType,s=e.defaultQuality/100,a=e.failureText,l=e.includeExif,c=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&c.length>0,getFileRecords:function(e,u,d){var h=this,f=[],p=d.blob?d.blob:d,g=new qq.Identify(p,t);return g.isPreviewableSync()?(qq.each(c,function(e,i){var c=h._determineOutputType({defaultType:o,requestedType:i.type,refType:p.type});f.push({uuid:qq.getUniqueId(),name:h._getName(u,{name:i.name,type:c,refType:p.type}),blob:new qq.BlobProxy(p,qq.bind(h._generateScaledImage,h,{customResizeFunction:n,maxSize:i.maxSize,orient:r,type:c,quality:s,failedText:a,includeExif:l,log:t}))})}),f.push({uuid:e,name:u,size:p.size,blob:i?p:null})):f.push({uuid:e,name:u,size:p.size,blob:p}),f},handleNewFile:function(e,t,n,i,r,o,s,a){var l=this,c=(e.qqButtonId||e.blob&&e.blob.qqButtonId,[]),u=null,d=a.addFileToHandler,h=a.uploadData,f=a.paramsStore,p=qq.getUniqueId();qq.each(l.getFileRecords(n,t,e),function(e,t){var n,i=t.size;t.blob instanceof qq.BlobProxy&&(i=-1),n=h.addFile({uuid:t.uuid,name:t.name,size:i,batchId:o,proxyGroupId:p}),t.blob instanceof qq.BlobProxy?c.push(n):u=n,t.blob?(d(n,t.blob),r.push({id:n,file:t.blob})):h.setStatus(n,qq.status.REJECTED)}),null!==u&&(qq.each(c,function(e,t){var n={qqparentuuid:h.retrieve({id:u}).uuid,qqparentsize:h.retrieve({id:u}).size};n[s]=h.retrieve({id:t}).uuid,h.setParentId(t,u),f.addReadOnly(t,n)}),c.length&&!function(){var e={};e[s]=h.retrieve({id:u}).uuid,f.addReadOnly(u,e)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var i=new qq.Promise,r=n.log,o=n.getFile(e),s=n.uploadData.retrieve({id:e}),a=s&&s.name,l=s&&s.uuid,c={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},u=new qq.Scaler(c,r);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&o?qq.bind(function(){var t=u.getFileRecords(l,a,o)[0];t&&t.blob instanceof qq.BlobProxy?t.blob.create().then(i.success,i.failure):(r(e+" is not a scalable image!","error"),i.failure())},this)():(i.failure(),r("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),i},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,i=e.refType;return n||t?t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?qq.supportedFeatures.tiffPreviews?t:n:t:n:"image/jpeg"!==i?"image/png":i},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),i=t.type||"image/png",r=t.refType,o="",s=qq.getExtension(e),a="";return t.name&&t.name.trim().length&&(a=" ("+t.name+")"),n>=0?(o=e.substr(0,n),r!==i&&(s=i.split("/")[1]),o+=a+"."+s):o=e+a,o},_getSortedSizes:function(e){"use strict";return e=qq.extend([],e),e.sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var n=this,i=e.customResizeFunction,r=e.log,o=e.maxSize,s=e.orient,a=e.type,l=e.quality,c=e.failedText,u=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===a,d=new qq.Promise,h=new qq.ImageGenerator(r),f=document.createElement("canvas");return r("Attempting to generate scaled version for "+t.name),h.generate(t,f,{maxSize:o,orient:s,customResizeFunction:i}).then(function(){var e=f.toDataURL(a,l),i=function(){r("Success generating scaled version for "+t.name);var n=qq.dataUriToBlob(e);d.success(n)};u?n._insertExifHeader(t,e,r).then(function(t){e=t,i()},function(){r("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),i()}):i()},function(){r("Failed attempt to generate scaled version for "+t.name,"error"),d.failure(c)}),d},_insertExifHeader:function(e,t,n){"use strict";var i=new FileReader,r=new qq.Promise,o="";return i.onload=function(){o=i.result,r.success(qq.ExifRestorer.restore(o,t))},i.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),r.failure()},i.readAsDataURL(e),r},_dataUriToBlob:function(e){"use strict";var t,n,i,r;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),qq.each(t,function(e,t){r[e]=t.charCodeAt(0)}),this._createBlob(i,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(e){var t,n,i,r,o,s="",a="",l="",c=0;do t=e[c++],n=e[c++],a=e[c++],i=t>>2,r=(3&t)<<4|n>>4,o=(15&n)<<2|a>>6,l=63&a,isNaN(n)?o=l=64:isNaN(a)&&(l=64),s=s+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(l),t=n=a="",i=r=o=l="";while(c<e.length);return s},e.restore=function(e,t){var n="data:image/jpeg;base64,";if(!e.match(n))return t;var i=this.decode64(e.replace(n,"")),r=this.slice2Segments(i),o=this.exifManipulation(t,r);return n+this.encode64(o)},e.exifManipulation=function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n),r=new Uint8Array(i);return r},e.getExifArray=function(e){for(var t,n=0;n<e.length;n++)if(t=e[n],255==t[0]&225==t[1])return t;return[]},e.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),s=i.slice(r),a=o;return a=a.concat(t),a=a.concat(s)},e.slice2Segments=function(e){for(var t=0,n=[];;){if(255==e[t]&218==e[t+1])break;if(255==e[t]&216==e[t+1])t+=2;else{var i=256*e[t+2]+e[t+3],r=t+i+2,o=e.slice(t,r);n.push(o),t=r}if(t>e.length)break}return n},e.decode64=function(e){var t,n,i,r,o,s="",a="",l=0,c=[],u=/[^A-Za-z0-9\+\/\=]/g;if(u.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=this.KEY_STR.indexOf(e.charAt(l++)),r=this.KEY_STR.indexOf(e.charAt(l++)),o=this.KEY_STR.indexOf(e.charAt(l++)),a=this.KEY_STR.indexOf(e.charAt(l++)),t=i<<2|r>>4,n=(15&r)<<4|o>>2,s=(3&o)<<6|a,c.push(t),64!=o&&c.push(n),64!=a&&c.push(s),t=n=s="",i=r=o=a="";while(l<e.length);return c},e}(),qq.TotalProgress=function(e,t){"use strict";var n={},i=0,r=0,o=-1,s=-1,a=function(t,n){(t!==o||n!==s)&&e(t,n),o=t,s=n},l=function(e,t){var n=!0;return qq.each(e,function(e,i){return qq.indexOf(t,i)>=0?(n=!1,!1):void 0}),n},c=function(e){h(e,-1,-1),delete n[e]},u=function(e,t,n){(0===t.length||l(t,n))&&(a(r,r),this.reset())},d=function(e){var i=t(e);i>0&&(h(e,0,i),n[e]={loaded:0,total:i})},h=function(e,t,o){var s=n[e]?n[e].loaded:0,l=n[e]?n[e].total:0;-1===t&&-1===o?(i-=s,r-=l):(t&&(i+=t-s),o&&(r+=o-l)),a(i,r)};qq.extend(this,{onAllComplete:u,onStatusChange:function(e,t,n){n===qq.status.CANCELED||n===qq.status.REJECTED?c(e):n===qq.status.SUBMITTING&&d(e)},onIndividualProgress:function(e,t,i){h(e,t,i),n[e]={loaded:t,total:i}},onNewSize:function(e){d(e)},reset:function(){n={},i=0,r=0}})},qq.PasteSupport=function(e){"use strict";function t(e){return e.type&&0===e.type.indexOf("image/")}function n(){o=qq(r.targetElement).attach("paste",function(e){var n=e.clipboardData;n&&qq.each(n.items,function(e,n){if(t(n)){var i=n.getAsFile();r.callbacks.pasteReceived(i)}})})}function i(){o&&o()}var r,o;r={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},qq.extend(r,e),n(),qq.extend(this,{reset:function(){i()}})},qq.FormSupport=function(e,t,n){"use strict";function i(e){e.getAttribute("action")&&(a.newEndpoint=e.getAttribute("action"))}function r(e,t){return!e.checkValidity||e.checkValidity()?!0:(n("Form did not pass validation checks - will not upload.","error"),void t())}function o(e){var n=e.submit;qq(e).attach("submit",function(i){i=i||window.event,i.preventDefault?i.preventDefault():i.returnValue=!1,r(e,n)&&t()}),e.submit=function(){r(e,n)&&t()}}function s(e){return e&&(qq.isString(e)&&(e=document.getElementById(e)),e&&(n("Attaching to form element."),i(e),l&&o(e))),e}var a=this,l=e.interceptSubmit,c=e.element,u=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:u,attachedToForm:!1,getFormInputsAsObject:function(){return null==c?null:a._form2Obj(c)}}),c=s(c),this.attachedToForm=!!c},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){var t=["button","image","reset","submit"];return qq.indexOf(t,e.toLowerCase())<0},i=function(e){
return qq.indexOf(["checkbox","radio"],e.toLowerCase())>=0},r=function(e){return i(e.type)&&!e.checked?!0:e.disabled&&"hidden"!==e.type.toLowerCase()},o=function(e){var t=null;return qq.each(qq(e).children(),function(e,n){return"option"===n.tagName.toLowerCase()&&n.selected?(t=n.value,!1):void 0}),t};return qq.each(e.elements,function(e,i){if(!qq.isInput(i,!0)&&"textarea"!==i.tagName.toLowerCase()||!n(i.type)||r(i)){if("select"===i.tagName.toLowerCase()&&!r(i)){var s=o(i);null!==s&&(t[i.name]=s)}}else t[i.name]=i.value}),t}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){"use strict";function n(e,t){var n,i,o;try{i=t.contentDocument||t.contentWindow.document,o=i.body.innerHTML,a("converting iframe's innerHTML to JSON"),a("innerHTML = "+o),o&&o.match(/^<pre/i)&&(o=i.body.firstChild.firstChild.nodeValue),n=r._parseJsonResponse(o)}catch(s){a("Error when attempting to parse form upload response ("+s.message+")","error"),n={success:!1}}return n}function i(t,n){var i=e.paramsStore.get(t),a="get"===e.method.toLowerCase()?"GET":"POST",l=e.endpointStore.get(t),c=o(t);return i[e.uuidName]=s(t),i[e.filenameParam]=c,r._initFormForUpload({method:a,endpoint:l,params:i,paramsInBody:e.paramsInBody,targetName:n.name})}var r=this,o=t.getName,s=t.getUuid,a=t.log;this.uploadFile=function(t){var o,s=r.getInput(t),l=r._createIframe(t),c=new qq.Promise;return o=i(t,l),o.appendChild(s),r._attachLoadEvent(l,function(i){a("iframe loaded");var o=i?i:n(t,l);r._detachLoadEvent(t),e.cors.expected||qq(l).remove(),o.success?c.success(o):c.failure(o)}),a("Sending upload request for "+t),o.submit(),qq(o).remove(),c},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:o,getUuid:s,log:a}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){"use strict";var n=this,i=t.getName,r=t.getSize,o=t.getUuid,s=t.log,a=e.forceMultipart||e.paramsInBody,l=function(t,n,o){var s=r(t),l=i(t);n[e.chunking.paramNames.partIndex]=o.part,n[e.chunking.paramNames.partByteOffset]=o.start,n[e.chunking.paramNames.chunkSize]=o.size,n[e.chunking.paramNames.totalParts]=o.count,n[e.totalFileSizeName]=s,a&&(n[e.filenameParam]=l)},c=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,log:s}),u=function(e,t){var n=new qq.Promise;return t.onreadystatechange=function(){if(4===t.readyState){var i=f(e,t);i.success?n.success(i.response,t):n.failure(i.response,t)}},n},d=function(t){var s=e.paramsStore.get(t),a=i(t),l=r(t);return s[e.uuidName]=o(t),s[e.filenameParam]=a,s[e.totalFileSizeName]=l,s[e.chunking.paramNames.totalParts]=n._getTotalChunks(t),s},h=function(e,t){return qq.indexOf([200,201,202,203,204],e.status)<0||!t.success||t.reset},f=function(e,t){var n;return s("xhr - server response received for "+e),s("responseText = "+t.responseText),n=p(!0,t),{success:!h(t,n),response:n}},p=function(e,t){var n={};try{s(qq.format("Received response status {} with body: {}",t.status,t.responseText)),n=qq.parseJson(t.responseText)}catch(i){e&&s("Error when attempting to parse xhr response text ("+i.message+")","error")}return n},g=function(t){var i=new qq.Promise;return c.complete(t,n._createXhr(t),d(t),e.customHeaders.get(t)).then(function(e){i.success(p(!1,e),e)},function(e){i.failure(p(!1,e),e)}),i},m=function(t,n,s,l){var c=new FormData,u=e.method,d=e.endpointStore.get(l),h=i(l),f=r(l);return t[e.uuidName]=o(l),t[e.filenameParam]=h,a&&(t[e.totalFileSizeName]=f),e.paramsInBody||(a||(t[e.inputName]=h),d=qq.obj2url(t,d)),n.open(u,d,!0),e.cors.expected&&e.cors.sendCredentials&&(n.withCredentials=!0),a?(e.paramsInBody&&qq.obj2FormData(t,c),c.append(e.inputName,s),c):s},v=function(t,i){var r=e.customHeaders.get(t),o=n.getFile(t);i.setRequestHeader("Accept","application/json"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Cache-Control","no-cache"),a||(i.setRequestHeader("Content-Type","application/octet-stream"),i.setRequestHeader("X-Mime-Type",o.type)),qq.each(r,function(e,t){i.setRequestHeader(e,t)})};qq.extend(this,{uploadChunk:function(t,i,o){var s,a,c,d=n._getChunkData(t,i),h=n._createXhr(t,i);r(t);return s=u(t,h),n._registerProgressHandler(t,i,d.size),c=e.paramsStore.get(t),l(t,c,d),o&&(c[e.resume.paramNames.resuming]=!0),a=m(c,h,d.blob,t),v(t,h),h.send(a),s},uploadFile:function(t){var i,r,o,s,a=n.getFile(t);return r=n._createXhr(t),n._registerProgressHandler(t),i=u(t,r),o=e.paramsStore.get(t),s=m(o,r,a,t),v(t,r),r.send(s),i}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(t){return{finalizeChunks:function(n){return e.chunking.success.endpoint?g(n):t.finalizeChunks(n,qq.bind(p,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,n="POST",i={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){}},r={},o={get:function(e){return i.endpoint}};qq.extend(i,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:[n],method:n,endpointStore:o,allowXRequestedWithAndCacheControl:!1,cors:i.cors,log:i.log,onComplete:function(e,t,n){var i=r[e];delete r[e],n?i.failure(t):i.success(t)}})),qq.extend(this,{complete:function(e,n,o,s){var a=new qq.Promise;return i.log("Submitting All Chunks Done request for "+e),r[e]=a,t.initTransport(e).withParams(o).withHeaders(s).send(n),a}})},qq.DragAndDrop=function(e){"use strict";function t(e,t){var n=Array.prototype.slice.call(e);c.callbacks.dropLog("Grabbed "+e.length+" dropped files."),t.dropDisabled(!1),c.callbacks.processingDroppedFilesComplete(n,t.getElement())}function n(e){var t=new qq.Promise;return e.isFile?e.file(function(n){var i=e.name,r=e.fullPath,o=r.indexOf(i);r=r.substr(0,o),"/"===r.charAt(0)&&(r=r.substr(1)),n.qqPath=r,f.push(n),t.success()},function(n){c.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error"),t.failure()}):e.isDirectory&&i(e).then(function(e){var i=e.length;qq.each(e,function(e,r){n(r).done(function(){i-=1,0===i&&t.success()})}),e.length||t.success()},function(n){c.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error"),t.failure()}),t}function i(e,t,n,r){var o=r||new qq.Promise,s=t||e.createReader();return s.readEntries(function(t){var r=n?n.concat(t):t;t.length?setTimeout(function(){i(e,s,r,o)},0):o.success(r)},o.failure),o}function r(e,t){var i=[],r=new qq.Promise;return c.callbacks.processingDroppedFiles(),t.dropDisabled(!0),e.files.length>1&&!c.allowMultipleItems?(c.callbacks.processingDroppedFilesComplete([]),c.callbacks.dropError("tooManyFilesError",""),t.dropDisabled(!1),r.failure()):(f=[],qq.isFolderDropSupported(e)?qq.each(e.items,function(e,t){var o=t.webkitGetAsEntry();o&&(o.isFile?f.push(t.getAsFile()):i.push(n(o).done(function(){i.pop(),0===i.length&&r.success()})))}):f=e.files,0===i.length&&r.success()),r}function o(e){var n=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:u,element:e,onEnter:function(t){qq(e).addClass(c.classes.dropActive),t.stopPropagation()},onLeaveNotDescendants:function(t){qq(e).removeClass(c.classes.dropActive)},onDrop:function(e){r(e.dataTransfer,n).then(function(){t(f,n)},function(){c.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return p.addDisposer(function(){n.dispose()}),qq(e).hasAttribute(d)&&qq(e).hide(),h.push(n),n}function s(e){var t;return qq.each(e.dataTransfer.types,function(e,n){return"Files"===n?(t=!0,!1):void 0}),t}function a(e){return qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function l(){var e=c.dropZoneElements,t=function(){setTimeout(function(){qq.each(e,function(e,t){qq(t).hasAttribute(d)&&qq(t).hide(),qq(t).removeClass(c.classes.dropActive)})},10)};qq.each(e,function(t,n){var i=o(n);e.length&&qq.supportedFeatures.fileDrop&&p.attach(document,"dragenter",function(t){!i.dropDisabled()&&s(t)&&qq.each(e,function(e,t){t instanceof HTMLElement&&qq(t).hasAttribute(d)&&qq(t).css({display:"block"})})})}),p.attach(document,"dragleave",function(e){a(e)&&t()}),p.attach(qq(document).children()[0],"mouseenter",function(e){t()}),p.attach(document,"drop",function(e){s(e)&&(e.preventDefault(),t())}),p.attach(document,u,t)}var c,u="qq-hidezones",d="qq-hide-dropzone",h=[],f=[],p=new qq.DisposeSupport;c={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(c,e,!0),l(),qq.extend(this,{setupExtraDropzone:function(e){c.dropZoneElements.push(e),o(e)},removeDropzone:function(e){var t,n=c.dropZoneElements;for(t in n)if(n[t]===e)return n.splice(t,1)},dispose:function(){p.dispose(),qq.each(h,function(e,t){t.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){"use strict";function t(){return qq.safari()||qq.firefox()&&qq.windows()}function n(e){u||(t?d.attach(document,"dragover",function(e){e.preventDefault()}):d.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),u=!0)}function i(e){if(!qq.supportedFeatures.fileDrop)return!1;var t,n=e.dataTransfer,i=qq.safari();return t=qq.ie()&&qq.supportedFeatures.fileDrop?!0:"none"!==n.effectAllowed,n&&t&&(n.files&&n.files.length||!i&&n.types.contains&&n.types.contains("Files")||n.types.includes&&n.types.includes("Files"))}function r(e){return void 0!==e&&(c=e),c}function o(){function e(){t=document.createEvent("Event"),t.initEvent(a.HIDE_ZONES_EVENT_NAME,!0,!0)}var t;if(window.CustomEvent)try{t=new CustomEvent(a.HIDE_ZONES_EVENT_NAME)}catch(n){e()}else e();document.dispatchEvent(t)}function s(){d.attach(l,"dragover",function(e){if(i(e)){var t=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;"move"===t||"linkMove"===t?e.dataTransfer.dropEffect="move":e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()}}),d.attach(l,"dragenter",function(e){if(!r()){if(!i(e))return;a.onEnter(e)}}),d.attach(l,"dragleave",function(e){if(i(e)){a.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(t)||a.onLeaveNotDescendants(e)}}),d.attach(l,"drop",function(e){if(!r()){if(!i(e))return;e.preventDefault(),e.stopPropagation(),a.onDrop(e),o()}})}var a,l,c,u,d=new qq.DisposeSupport;a={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(a,e),l=a.element,n(),s(),qq.extend(this,{dropDisabled:function(e){return r(e)},dispose:function(){d.dispose()},getElement:function(){return l}}),this._testing={},this._testing.isValidFileDrag=i},function(){"use strict";qq.uiPublicApi={addInitialFiles:function(e){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){return this._dnd?this._dnd.removeDropzone(e):void 0},getItemByFileId:function(e){return this._templating.isHiddenForever(e)?void 0:this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}},qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,i=n.getDropZone();return i&&t.push(i),new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,i){n.hideDropProcessing(),qq.each(t,function(e,t){t.qqDropTarget=i}),t.length&&e.addFiles(t,null,null)},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,n){var i=qq(t.getEditInput(e)),r=qq(t.getFileContainer(e));n?(i.addClass("qq-editing"),t.hideFilename(e),t.hideEditIcon(e)):(i.removeClass("qq-editing"),t.showFilename(e),t.showEditIcon(e)),r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e)),t===qq.status.UPLOAD_RETRYING&&n===qq.status.UPLOADING?(this._templating.hideRetry(e),this._templating.setStatusText(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.retrying)):n===qq.status.UPLOAD_FAILED&&this._templating.hidePause(e)},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,i){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,i),0===i||100===Math.round(n/i*100)?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,i)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,i){function r(t){a&&(s.setStatusText(e),qq(a).removeClass(l._classes.retrying),s.hideProgress(e),l.getUploads({id:e}).status!==qq.status.UPLOAD_FAILED&&s.hideCancel(e),s.hideSpinner(e),t.success?l._markFileAsSuccessful(e):(qq(a).addClass(l._classes.fail),s.showCancel(e),s.isRetryPossible()&&!l._preventRetries[e]&&(qq(a).addClass(l._classes.retryable),s.showRetry(e)),l._controlFailureTextDisplay(e,t)))}var o=this._parent.prototype._onComplete.apply(this,arguments),s=this._templating,a=s.getFileContainer(e),l=this;return o instanceof qq.Promise?o.done(function(e){r(e)}):r(n),o},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qq(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,n,i;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],n=this._options.retry.maxAutoAttempts,i=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t),i=i.replace(/\{maxAuto\}/g,n),this._templating.setStatusText(e,i),qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var i,r=this.getName(e),o=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,r),s=(this.getUuid(e),arguments),a=this;i=this._options.showConfirm(o),qq.isGenericPromise(i)?i.then(function(){a._sendDeleteRequest.apply(a,s)}):i!==!1&&a._sendDeleteRequest.apply(a,s)},_addToList:function(e,t,n){var i,r,o=0,s=this._handler.isProxied(e)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(o=this._filesInBatchAddedToUi-1),i={index:o}),n||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(r=this.getUploads({id:e}),this._handledProxyGroup=this._handledProxyGroup||r.proxyGroupId,r.proxyGroupId===this._handledProxyGroup&&r.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),n?(this._templating.addFileToCache(e,this._options.formatFileName(t),i,s),this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(e,this._options.formatFileName(t),i,s),this._templating.generatePreview(e,this.getFile(e),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(e)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var i=this.getSize(e),r=this._formatSize(i);i>=0&&(void 0!==t&&void 0!==n&&(r=this._formatProgress(t,n)),this._templating.updateSize(e,r))},_formatProgress:function(e,t){function n(e,t){i=i.replace(e,t)}var i=this._options.text.formatProgress;return n("{percent}",Math.round(e/t*100)),n("{total_size}",this._formatSize(t)),i},_controlFailureTextDisplay:function(e,t){var n,i,r;n=this._options.failedUploadTextDisplay.mode,i=this._options.failedUploadTextDisplay.responseProperty,"custom"===n?(r=t[i],r||(r=this._options.text.failUpload),this._templating.setStatusText(e,r),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,r)):"default"===n?this._templating.setStatusText(e,this._options.text.failUpload):"none"!==n&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&this._templating.showCancel(e)},_itemError:function(e,t,n){var i=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(i)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e],n=this.getUploads({id:e}).status;n===qq.status.DELETED||!t&&!this._options.thumbnails.placeholders.waitUntilResponse&&qq.supportedFeatures.imagePreviews||this._templating.updateThumbnail(e,t,this._options.thumbnails.customResizer)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),qq.FineUploader=function(e,t){"use strict";var n=this;this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(e){return n._templating.hasDialog("alert")?n._templating.showDialog("alert",e):void setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return n._templating.hasDialog("confirm")?n._templating.showDialog("confirm",e):window.confirm(e)},showPrompt:function(e,t){return n._templating.hasDialog("prompt")?n._templating.showDialog("prompt",e,t):window.prompt(e,t)}},!0),qq.extend(this._options,e,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(e){"use strict";var t,n,i,r,o,s,a,l,c="qq-file-id",u="qq-file-id-",d="qq-max-size",h="qq-server-scale",f="qq-hide-dropzone",p="qq-drop-area-text",g="qq-in-progress",m="qq-hidden-forever",v={content:document.createDocumentFragment(),map:{}},y=!1,w=0,b=!1,_=[],C=-1,k={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},S={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},$={},x=new qq.Promise,A=new qq.Promise,T=function(){var e=k.placeholders.thumbnailNotAvailable,n=k.placeholders.waitingForThumbnail,i={maxSize:C,scale:l};a&&(e?k.imageGenerator.generate(e,new Image,i).then(function(e){x.success(e)},function(){x.failure(),t("Problem loading 'not available' placeholder image at "+e,"error")}):x.failure(),n?k.imageGenerator.generate(n,new Image,i).then(function(e){A.success(e)},function(){A.failure(),t("Problem loading 'waiting for thumbnail' placeholder image at "+n,"error")}):A.failure())},E=function(e){var t=new qq.Promise;return A.then(function(n){K(n,e),e.src?t.success():(e.src=n.src,e.onload=function(){e.onload=null,te(e),t.success()})},function(){G(e),t.success()}),t},M=function(e,n,i){var r=V(e);return t("Generating new thumbnail for "+e),n.qqThumbnailId=e,k.imageGenerator.generate(n,r,i).then(function(){w++,te(r),$[e].success()},function(){$[e].failure(),k.placeholders.waitUntilUpdate||Y(e,r)})},R=function(){if(_.length){b=!0;var e=_.shift();e.update?Z(e):Q(e)}else b=!1},L=function(e){return W(O(e),S.cancel)},D=function(e){return W(O(e),S.continueButton)},F=function(e){return W(o,S[e+"Dialog"])},P=function(e){return W(O(e),S.deleteButton)},I=function(){return W(o,S.dropProcessing)},q=function(e){return W(O(e),S.editNameIcon)},O=function(e){return v.map[e]||qq(s).getFirstByClass(u+e)},B=function(e){return W(O(e),S.file)},H=function(e){return W(O(e),S.pause)},N=function(e){return null==e?W(o,S.totalProgressBarContainer)||W(o,S.totalProgressBar):W(O(e),S.progressBarContainer)||W(O(e),S.progressBar)},z=function(e){return W(O(e),S.retry)},U=function(e){return W(O(e),S.size)},j=function(e){return W(O(e),S.spinner)},W=function(e,t){return e&&qq(e).getFirstByClass(t)},V=function(e){return a&&W(O(e),S.thumbnail)},G=function(e){e&&qq(e).addClass(k.classes.hide)},K=function(e,t){var n=e.style.maxWidth,i=e.style.maxHeight;i&&n&&!t.style.maxWidth&&!t.style.maxHeight&&qq(t).css({maxWidth:n,maxHeight:i})},Y=function(e,t){var n=$[e]||(new qq.Promise).failure(),i=new qq.Promise;return x.then(function(e){n.then(function(){i.success()},function(){K(e,t),t.onload=function(){t.onload=null,i.success()},t.src=e.src,te(t)})}),i},X=function(){var e,r,o,s,c,u,g,m,v,y,w;if(t("Parsing template"),null==k.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(k.templateIdOrEl)){if(e=document.getElementById(k.templateIdOrEl),
null===e)throw new Error(qq.format("Cannot find template script at ID '{}'!",k.templateIdOrEl));r=e.innerHTML}else{if(void 0===k.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");r=k.templateIdOrEl.innerHTML}if(r=qq.trimStr(r),s=document.createElement("div"),s.appendChild(qq.toElement(r)),w=qq(s).getFirstByClass(S.uploader),k.button&&(u=qq(s).getFirstByClass(S.button),u&&qq(u).remove()),qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(v=qq(s).getFirstByClass(S.dropProcessing),v&&qq(v).remove()),g=qq(s).getFirstByClass(S.drop),g&&!qq.DragAndDrop&&(t("DnD module unavailable.","info"),qq(g).remove()),qq.supportedFeatures.fileDrop?qq(w).hasAttribute(p)&&g&&(y=qq(g).getFirstByClass(S.dropText),y&&qq(y).remove()):(w.removeAttribute(p),g&&qq(g).hasAttribute(f)&&qq(g).css({display:"none"})),m=qq(s).getFirstByClass(S.thumbnail),a?m&&(C=parseInt(m.getAttribute(d)),C=C>0?C:null,l=qq(m).hasAttribute(h)):m&&qq(m).remove(),a=a&&m,n=qq(s).getByClass(S.editFilenameInput).length>0,i=qq(s).getByClass(S.retry).length>0,o=qq(s).getFirstByClass(S.list),null==o)throw new Error("Could not find the file list container in the template!");return c=o.children[0].cloneNode(!0),o.innerHTML="",s.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),t("Template parsing complete"),{template:s,fileTemplate:c}},J=function(e,t,n){var i=n,r=i.firstChild;t>0&&(r=qq(i).children()[t].nextSibling),i.insertBefore(e,r)},Q=function(e){var t=e.id,n=e.optFileOrBlob,i=n&&n.qqThumbnailId,r=V(t),o={customResizeFunction:e.customResizeFunction,maxSize:C,orient:!0,scale:!0};qq.supportedFeatures.imagePreviews?r?k.limits.maxThumbs&&k.limits.maxThumbs<=w?(Y(t,r),R()):E(r).done(function(){$[t]=new qq.Promise,$[t].done(function(){setTimeout(R,k.limits.timeBetweenThumbs)}),null!=i?ne(t,i):M(t,n,o)}):R():r&&(E(r),R())},Z=function(e){var t=e.id,n=e.thumbnailUrl,i=e.showWaitingImg,r=V(t),o={customResizeFunction:e.customResizeFunction,scale:l,maxSize:C};if(r)if(n){if(!(k.limits.maxThumbs&&k.limits.maxThumbs<=w))return i&&E(r),k.imageGenerator.generate(n,r,o).then(function(){te(r),w++,setTimeout(R,k.limits.timeBetweenThumbs)},function(){Y(t,r),setTimeout(R,k.limits.timeBetweenThumbs)});Y(t,r),R()}else Y(t,r),R()},ee=function(e,t){var n=N(e),i=null==e?S.totalProgressBar:S.progressBar;n&&!qq(n).hasClass(i)&&(n=qq(n).getFirstByClass(i)),n&&(qq(n).css({width:t+"%"}),n.setAttribute("aria-valuenow",t))},te=function(e){e&&qq(e).removeClass(k.classes.hide)},ne=function(e,n){var i=V(e),r=V(n);t(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,n,n)),$[n].then(function(){w++,$[e].success(),t(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",n,e)),i.src=r.src,te(i)},function(){$[e].failure(),k.placeholders.waitUntilUpdate||Y(e,i)})};qq.extend(k,e),t=k.log,qq.supportedFeatures.imagePreviews||(k.limits.timeBetweenThumbs=0,k.limits.maxThumbs=0),o=k.containerEl,a=void 0!==k.imageGenerator,r=X(),T(),qq.extend(this,{render:function(){t("Rendering template in DOM."),w=0,o.appendChild(r.template.cloneNode(!0)),G(I()),this.hideTotalProgress(),s=k.fileContainerEl||W(o,S.list),t("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);o.innerHTML="",o.appendChild(t)},reset:function(){this.render()},clearFiles:function(){s.innerHTML=""},disableCancel:function(){y=!0},addFile:function(e,t,n,i,a){var l,d=r.fileTemplate.cloneNode(!0),h=W(d,S.file),f=W(o,S.uploader),g=a?v.content:s;a&&(v.map[e]=d),qq(d).addClass(u+e),f.removeAttribute(p),h&&(qq(h).setText(t),h.setAttribute("title",t)),d.setAttribute(c,e),n?J(d,n.index,g):g.appendChild(d),i?(d.style.display="none",qq(d).addClass(m)):(G(N(e)),G(U(e)),G(P(e)),G(z(e)),G(H(e)),G(D(e)),y&&this.hideCancel(e),l=V(e),l&&!l.src&&A.then(function(e){l.src=e.src,e.style.maxHeight&&e.style.maxWidth&&qq(l).css({maxHeight:e.style.maxHeight,maxWidth:e.style.maxWidth}),te(l)}))},addFileToCache:function(e,t,n,i){this.addFile(e,t,n,i,!0)},addCacheToDom:function(){s.appendChild(v.content),v.content=document.createDocumentFragment(),v.map={}},removeFile:function(e){qq(O(e)).remove()},getFileId:function(e){var t=e;if(t){for(;null==t.getAttribute(c);)t=t.parentNode;return parseInt(t.getAttribute(c))}},getFileList:function(){return s},markFilenameEditable:function(e){var t=B(e);t&&qq(t).addClass(k.classes.editable)},updateFilename:function(e,t){var n=B(e);n&&(qq(n).setText(t),n.setAttribute("title",t))},hideFilename:function(e){G(B(e))},showFilename:function(e){te(B(e))},isFileName:function(e){return qq(e).hasClass(S.file)},getButton:function(){return k.button||W(o,S.button)},hideDropProcessing:function(){G(I())},showDropProcessing:function(){te(I())},getDropZone:function(){return W(o,S.drop)},isEditFilenamePossible:function(){return n},hideRetry:function(e){G(z(e))},isRetryPossible:function(){return i},showRetry:function(e){te(z(e))},getFileContainer:function(e){return O(e)},showEditIcon:function(e){var t=q(e);t&&qq(t).addClass(k.classes.editable)},isHiddenForever:function(e){return qq(O(e)).hasClass(m)},hideEditIcon:function(e){var t=q(e);t&&qq(t).removeClass(k.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(S.editNameIcon,!0)},getEditInput:function(e){return W(O(e),S.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(S.editFilenameInput,!0)},updateProgress:function(e,t,n){var i,r=N(e);r&&n>0&&(i=Math.round(t/n*100),100===i?G(r):te(r),ee(e,i))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=N(e);t&&G(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){ee(e,0),this.hideTotalProgress(e)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!y){var t=L(e);t&&qq(t).removeClass(k.classes.hide)}},hideCancel:function(e){G(L(e))},isCancel:function(e){return qq(e).hasClass(S.cancel,!0)},allowPause:function(e){te(H(e)),G(D(e))},uploadPaused:function(e){this.setStatusText(e,k.text.paused),this.allowContinueButton(e),G(j(e))},hidePause:function(e){G(H(e))},isPause:function(e){return qq(e).hasClass(S.pause,!0)},isContinueButton:function(e){return qq(e).hasClass(S.continueButton,!0)},allowContinueButton:function(e){te(D(e)),G(H(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),te(j(e))},showDeleteButton:function(e){te(P(e))},hideDeleteButton:function(e){G(P(e))},isDeleteButton:function(e){return qq(e).hasClass(S.deleteButton,!0)},isRetry:function(e){return qq(e).hasClass(S.retry,!0)},updateSize:function(e,t){var n=U(e);n&&(te(n),qq(n).setText(t))},setStatusText:function(e,t){var n=W(O(e),S.statusText);n&&(null==t?qq(n).clearText():qq(n).setText(t))},hideSpinner:function(e){qq(O(e)).removeClass(g),G(j(e))},showSpinner:function(e){qq(O(e)).addClass(g),te(j(e))},generatePreview:function(e,t,n){this.isHiddenForever(e)||(_.push({id:e,customResizeFunction:n,optFileOrBlob:t}),!b&&R())},updateThumbnail:function(e,t,n,i){this.isHiddenForever(e)||(_.push({customResizeFunction:i,update:!0,id:e,thumbnailUrl:t,showWaitingImg:n}),!b&&R())},hasDialog:function(e){return qq.supportedFeatures.dialogElement&&!!F(e)},showDialog:function(e,t,n){var i=F(e),r=W(i,S.dialogMessage),o=i.getElementsByTagName("INPUT")[0],s=W(i,S.dialogCancelButton),a=W(i,S.dialogOkButton),l=new qq.Promise,c=function(){s.removeEventListener("click",u),a&&a.removeEventListener("click",d),l.failure()},u=function(){s.removeEventListener("click",u),i.close()},d=function(){i.removeEventListener("close",c),a.removeEventListener("click",d),i.close(),l.success(o&&o.value)};return i.addEventListener("close",c),s.addEventListener("click",u),a&&a.addEventListener("click",d),o&&(o.value=n),r.textContent=t,i.showModal(),l}})},qq.UiEventHandler=function(e,t){"use strict";function n(e){i.attach(e,r.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;r.onHandled(t,e)})}var i=new qq.DisposeSupport,r={eventType:"click",attachTo:null,onHandled:function(e,t){}};qq.extend(this,{addHandler:function(e){n(e)},dispose:function(){i.dispose()}}),qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return i}}),qq.extend(r,e),r.attachTo&&n(r.attachTo)},qq.FileButtonsClickHandler=function(e){"use strict";function t(e,t){qq.each(r,function(n,r){var o,s=n.charAt(0).toUpperCase()+n.slice(1);return i.templating["is"+s](e)?(o=i.templating.getFileId(e),qq.preventDefault(t),i.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",i.onGetName(o),o)),r(o),!1):void 0})}var n={},i={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},r={cancel:function(e){i.onCancel(e)},retry:function(e){i.onRetry(e)},deleteButton:function(e){i.onDeleteFile(e)},pause:function(e){i.onPause(e)},continueButton:function(e){i.onContinue(e)}};qq.extend(i,e),i.eventType="click",i.onHandled=t,i.attachTo=i.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(i,n))},qq.FilenameClickHandler=function(e){"use strict";function t(e,t){if(i.templating.isFileName(e)||i.templating.isEditIcon(e)){var r=i.templating.getFileId(e),o=i.onGetUploadStatus(r);o===qq.status.SUBMITTED&&(i.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",i.onGetName(r),r)),qq.preventDefault(t),n.handleFilenameEdit(r,e,!0))}}var n={},i={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(i,e),i.eventType="click",i.onHandled=t,qq.extend(this,new qq.FilenameEditHandler(i,n))},qq.FilenameInputFocusInHandler=function(e,t){"use strict";function n(e,n){if(i.templating.isEditInput(e)){var r=i.templating.getFileId(e),o=i.onGetUploadStatus(r);o===qq.status.SUBMITTED&&(i.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",i.onGetName(r),r)),t.handleFilenameEdit(r,e))}}var i={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};t||(t={}),i.eventType="focusin",i.onHandled=n,qq.extend(i,e),qq.extend(this,new qq.FilenameEditHandler(i,t))},qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))},qq.FilenameEditHandler=function(e,t){"use strict";function n(e){var t=a.onGetName(e),n=t.lastIndexOf(".");return n>0&&(t=t.substr(0,n)),t}function i(e){var t=a.onGetName(e);return qq.getExtension(t)}function r(e,t){var n,r=e.value;void 0!==r&&qq.trimStr(r).length>0&&(n=i(t),void 0!==n&&(r=r+"."+n),a.onSetName(t,r)),a.onEditingStatusChange(t,!1)}function o(e,n){t.getDisposeSupport().attach(e,"blur",function(){r(e,n)})}function s(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){var i=t.keyCode||t.which;13===i&&r(e,n)})}var a={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};qq.extend(a,e),a.attachTo=a.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(a,t)),qq.extend(t,{handleFilenameEdit:function(e,t,i){var r=a.templating.getEditInput(e);a.onEditingStatusChange(e,!0),r.value=n(e),i&&r.focus(),o(r,e),s(r,e)}})}}(window),define("directives/fineUpload",["base","fineuploader"],function(e,t){return e.directive("fineUpload",["$timeout",function(e){return{scope:{multiple:"=",endpoint:"@",templateId:"@",sizeLimit:"@",allowedExtensions:"=",onCompleteCallback:"=",onUploadCallback:"=",onValidateBatch:"=",onErrorCallback:"=",onSubmitCallback:"=",onCancelCallback:"=",autoUpload:"=",params:"=",control:"="},link:function(e,n,i){var r,o,s=e.multiple||!1,a=e.endpoint,l=e.templateId;o=null!=e.allowedExtensions?{allowedExtensions:e.allowedExtensions}:{},e.sizeLimit&&(o.sizeLimit=e.sizeLimit);var c=e.maxConnections||1,u=e.onCompleteCallback||function(){},d=e.onUploadCallback||function(){},h=e.onErrorCallback||function(){},f=e.onValidateBatch||function(){},p=e.onSubmitCallback||function(){},g=e.onCancelCallback||function(){};r=null==e.autoUpload?!0:e.autoUpload;var m=e.params||{};m._csrf=window.csrfToken;var v=new t.FineUploader({element:n[0],multiple:s,autoUpload:r,disabledCancelForFormUploads:!0,validation:o,maxConnections:c,request:{endpoint:a,forceMultipart:!0,params:m,paramsInBody:!1},callbacks:{onComplete:u,onUpload:d,onValidateBatch:f,onError:h,onSubmit:p,onCancel:g},template:l,failedUploadTextDisplay:{mode:"custom",responseProperty:"error"}});return window.q=v,null!=e.control&&(e.control.q=v),v}}}])}),define("directives/scroll",["base"],function(e){return e.directive("updateScrollBottomOn",["$timeout",function(e){return{restrict:"A",link:function(t,n,i,r){var o=0;return n.on("scroll",function(e){return o=n[0].scrollHeight-n[0].scrollTop-n[0].clientHeight}),t.$on(i.updateScrollBottomOn,function(){return e(function(){return n.scrollTop(n[0].scrollHeight-n[0].clientHeight-o)},0)})}}}])}),define("directives/onEnter",["base"],function(e){return e.directive("onEnter",function(){return function(e,t,n){return t.bind("keydown keypress",function(t){return 13===t.which?(e.$apply(function(){return e.$eval(n.onEnter,{event:t})}),t.preventDefault()):void 0})}})}),define("directives/stopPropagation",["base"],function(e){return e.directive("stopPropagation",["$http",function(e){return{restrict:"A",link:function(e,t,n){return t.bind(n.stopPropagation,function(e){return e.stopPropagation()})}}}]),e.directive("preventDefault",["$http",function(e){return{restrict:"A",link:function(e,t,n){return t.bind(n.preventDefault,function(e){return e.preventDefault()})}}}])}),define("directives/rightClick",["base"],function(e){return e.directive("rightClick",function(){return{restrict:"A",link:function(e,t,n){return t.bind("contextmenu",function(t){return t.preventDefault(),t.stopPropagation(),e.$eval(n.rightClick)})}}})}),define("directives/expandableTextArea",["base"],function(e){return e.directive("expandableTextArea",function(){return{restrict:"A",link:function(e,t){var n=function(){var n=t.outerHeight(),i=t.prop("scrollHeight");return i>n&&""!==t.val()?(e.$emit("expandable-text-area:resize"),t.css("height",i)):void 0};return e.$watch(function(){return t.val()},n)}}})}),define("directives/videoPlayState",["base"],function(e){return e.directive("videoPlayState",["$parse",function(e){return{restrict:"A",link:function(t,n,i){var r=n[0];return t.$watch(function(){return e(i.videoPlayState)(t)},function(e){return e?(r.currentTime=0,r.play()):r.pause()})}}}])}),define("services/queued-http",["base"],function(e){return e.factory("queuedHttp",["$http","$q",function(e,t){var n=[],i=!1,r=function s(){if(!i){var e=n.shift();return null!=e?(i=!0,e().then(function(){return i=!1,s()})["catch"](function(){return i=!1,s()})):void 0}},o=function(){for(var t=arguments.length,i=new Array(t),o=0;t>o;o++)i[o]=arguments[o];var s={},a=[],l=[];s.then=function(e,t){return a.push(e),null!=t&&l.push(t),s},s["catch"]=function(e){return l.push(e),s};var c=function(){return e.apply(void 0,_toConsumableArray(Array.from(i||[]))).then(function(){for(var e=arguments.length,t=new Array(e),n=0;e>n;n++)t[n]=arguments[n];return Array.from(a).map(function(e){return e.apply(void 0,_toConsumableArray(Array.from(t||[])))})})["catch"](function(){for(var e=arguments.length,t=new Array(e),n=0;e>n;n++)t[n]=arguments[n];return Array.from(l).map(function(e){return e.apply(void 0,_toConsumableArray(Array.from(t||[])))})})};return n.push(c),r(),s};return o.post=function(e,t){return o({method:"POST",url:e,data:t})},o}])}),define("services/validateCaptcha",["base"],function(e){return e.factory("validateCaptcha",function(){var e=[],t=function(t){for(var n=0,i=e;n<i.length;n++){var r=i[n];r(t)}e=[]},n=null,i=function(i,r){if(null==i&&(i=function(e){}),"undefined"==typeof grecaptcha||null===grecaptcha||r)return i();var o=function(){return grecaptcha.reset()};if(e.push(i),e.push(o),null==n){var s=$("#recaptcha")[0];n=grecaptcha.render(s,{callback:t})}return grecaptcha.execute(n)};return i})}),define("services/validateCaptchaV3",["base"],function(e){return e.factory("validateCaptchaV3",function(){var e=window.grecaptcha,t=window.ExposedSettings;return function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e&&t&&t.recaptchaSiteKeyV3&&e.ready(function(){e.execute(t.recaptchaSiteKeyV3,{action:n}).then(i)})}})}),define("services/wait-for",["base"],function(e){return e.factory("waitFor",["$q",function(e){var t=function(t,n,i){null==i&&(i=500);var r=Math.floor(n/i),o=0;return e(function(e,s){var a;return(a=function(){if(o>r)return s(new Error("waiting too long, ".concat(JSON.stringify({timeout:n,pollInterval:i}))));o+=1;var l=t();return null!=l?e(l):setTimeout(a,i)})()})};return t}])}),define("filters/formatDate",["base","moment"],function(e,t){t.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}}),e.filter("formatDate",function(){return function(e,n){return e?(null==n&&(n="Do MMM YYYY, h:mm a"),t(e).format(n)):"N/A"}}),e.filter("relativeDate",function(){return function(e){return t(e).calendar()}}),e.filter("fromNowDate",function(){return function(e){return t(e).fromNow()}})}),define("main/event",["moment","base","modules/localStorage"],function(e,t){var n="mbEvents",i=0,r=new Date;return t.factory("event_tracking",["$http","localStorage",function(t,o){var s=function(){var e=o(n);return null==e&&(e={},o(n,e)),e},a=function(e){var t=s();return t[e]||!1},l=function(e){var t=s();return t[e]=!0,o(n,t)},c=function(){return t({url:"/editingSession/".concat(window.project_id),method:"PUT",headers:{"X-CSRF-Token":window.csrfToken}})};return{send:function(e,t,n,i){return ga("send","event",e,t,n,i)},sendGAOnce:function(e,t,n,i){return a(t)?void 0:(l(t),this.send(e,t,n,i))},editingSessionHeartbeat:function(){if(r<=new Date){c(),i++;var t=2>=i?30:6>=i?60*(i-2):300;return r=e().add(t,"seconds").toDate()}},sendMB:function(e,n){return null==n&&(n={}),t({url:"/event/".concat(e),method:"POST",data:n,headers:{"X-CSRF-Token":window.csrfToken}})},sendMBSampled:function(e,t){return Math.random()<.01?this.sendMB(e,t):void 0},sendMBOnce:function(e,t){return a(e)?void 0:(l(e),this.sendMB(e,t))},eventInCache:function(e){return a(e)}}}]),$(".navbar a").on("click",function(e){var t=$(e.target).attr("href");return null!=t?ga("send","event","navigation","top menu bar",t):void 0})}),define("main/account-upgrade",["base"],function(e){return e.controller("FreeTrialModalController",["$scope","event_tracking",function(e,t){return e.buttonClass="btn-primary",e.startFreeTrial=function(n,i){var r="collaborator_free_trial_7_days",o=window.open(),s=function(){var s;return"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",n),window.useV2TrialUrl?s="/user/trial":(s="/user/subscription/new?planCode=".concat(r,"&ssp=true"),null!=i&&(s="".concat(s,"&cc=").concat(i))),e.startedFreeTrial=!0,t.sendMB("subscription-start-trial",{source:n,plan:r}),o.location=s};return s()}}])}),define("ide",["base","ide/file-tree/FileTreeManager","ide/connection/ConnectionManager","ide/editor/EditorManager","ide/online-users/OnlineUsersManager","ide/history/HistoryManager","ide/history/HistoryV2Manager","ide/permissions/PermissionsManager","ide/pdf/PdfManager","ide/binary-files/BinaryFilesManager","ide/references/ReferencesManager","ide/metadata/MetadataManager","ide/review-panel/ReviewPanelManager","ide/SafariScrollPatcher","ide/cobranding/CobrandingDataService","ide/settings/index","ide/share/index","ide/chat/index","ide/clone/index","ide/hotkeys/index","ide/test-controls/index","ide/wordcount/index","ide/directives/layout","ide/directives/validFile","ide/services/ide","ide/tpr-webmodule/index","ide/templates/index","ide/rich-text/index","ide/references-search/index","ide/publish-modal/index","ide/github-sync/index","ide/git-bridge/index","ide/dropbox/index","analytics/AbTestingManager","directives/focus","directives/fineUpload","directives/scroll","directives/onEnter","directives/stopPropagation","directives/rightClick","directives/expandableTextArea","directives/videoPlayState","services/queued-http","services/validateCaptcha","services/validateCaptchaV3","services/wait-for","filters/formatDate","main/event","main/account-upgrade"],function(e,t,n,i,r,o,s,a,l,c,u,d,h,f){return e.controller("IdeController",["$scope","$timeout","ide","localStorage","event_tracking","metadata","$q","CobrandingDataService",function(e,h,p,g,m,v,y,w){var b,_,C;e.$originalApply=e.$apply,e.$apply=function(e){null==e&&(e=function(){});var t=this.$root.$$phase;return"$apply"===t||"$digest"===t?e():this.$originalApply(e)},e.state={loading:!0,load_progress:40,error:null},e.ui={leftMenuShown:!1,view:"editor",chatOpen:!1,pdfLayout:"sideBySide",pdfHidden:!1,pdfWidth:0,reviewPanelOpen:g("ui.reviewPanelOpen.".concat(window.project_id)),miniReviewPanelVisible:!1,chatResizerSizeOpen:window.uiConfig.chatResizerSizeOpen,chatResizerSizeClosed:window.uiConfig.chatResizerSizeClosed,defaultFontFamily:window.uiConfig.defaultFontFamily,defaultLineHeight:window.uiConfig.defaultLineHeight},e.user=window.user,e.settings=window.userSettings,e.anonymous=window.anonymous,e.isTokenMember=window.isTokenMember,e.cobranding={isProjectCobranded:w.isProjectCobranded(),logoImgUrl:w.getLogoImgUrl(),submitBtnHtml:w.getSubmitBtnHtml(),brandVariationName:w.getBrandVariationName(),brandVariationHomeUrl:w.getBrandVariationHomeUrl()},e.chat={},p.toggleReviewPanel=e.toggleReviewPanel=function(){return e.project.features.trackChangesVisible?(e.ui.reviewPanelOpen=!e.ui.reviewPanelOpen,m.sendMB("rp-toggle-panel",{value:e.ui.reviewPanelOpen})):void 0},e.$watch("ui.reviewPanelOpen",function(e){return null!=e?g("ui.reviewPanelOpen.".concat(window.project_id),e):void 0}),e.$on("layout:pdf:resize",function(t,n){return e.ui.pdfHidden=n.east.initClosed,e.ui.pdfWidth=n.east.size}),e.$watch("ui.view",function(t,n){return t!==n&&e.$broadcast("layout:flat-screen:toggle"),null!=t&&"editor"!==t&&"pdf"!==t?m.sendMBOnce("ide-open-view-".concat(t,"-once")):void 0}),e.$watch("ui.chatOpen",function(e){return e?m.sendMBOnce("ide-open-chat-once"):void 0}),e.$watch("ui.leftMenuShown",function(e){return e?m.sendMBOnce("ide-open-left-menu-once"):void 0}),e.trackHover=function(e){return m.sendMBOnce("ide-hover-".concat(e,"-once"))},window._ide=p,p.validFileRegex="^[^*/]*$";var k=window.location&&window.location.search&&window.location.search.match(/ws=fallback/);p.wsUrl=k?null:window.sharelatex.wsUrl||null,p.project_id=e.project_id=window.project_id,p.$scope=e,p.referencesSearchManager=new u(p,e),p.connectionManager=new n(p,e),p.fileTreeManager=new t(p,e),p.editorManager=new i(p,e,g),p.onlineUsersManager=new r(p,e),window.data.useV2History?p.historyManager=new s(p,e,g):p.historyManager=new o(p,e),p.pdfManager=new l(p,e),p.permissionsManager=new a(p,e),p.binaryFilesManager=new c(p,e),p.metadataManager=new d(p,e,v);var S=!1;e.$on("project:joined",function(){return S?void 0:(S=!0,__guard__(null!=e?e.project:void 0,function(e){return e.deletedByExternalDataSource})&&p.showGenericMessageModal("Project Renamed or Deleted","This project has either been renamed or deleted by an external data source such as Dropbox.\nWe don't want to delete your data on ShareLaTeX, so this project still contains your history and collaborators.\nIf the project has been renamed please look in your project list for a new project under the new name."),h(function(){if(e.permissions.write){var t;return p.metadataManager.loadProjectMetaFromServer(),t=!0}},200))});var $=!1;e.$on("doc:opened",function(){return $?void 0:(e.$broadcast("ide:loaded"),$=!0)}),e.$on("cursor:editor:update",m.editingSessionHeartbeat);var x=["ambiance","chaos","clouds_midnight","cobalt","idle_fingers","merbivore","merbivore_soft","mono_industrial","monokai","pastel_on_dark","solarized_dark","terminal","tomorrow_night","tomorrow_night_blue","tomorrow_night_bright","tomorrow_night_eighties","twilight","vibrant_ink"];e.darkTheme=!1,e.$watch("settings.editorTheme",function(t){return Array.from(x).includes(t)?e.darkTheme=!0:e.darkTheme=!1}),p.localStorage=g,p.browserIsSafari=!1,e.switchToFlatLayout=function(t){return e.ui.pdfLayout="flat",e.ui.view=t,p.localStorage("pdf.layout","flat")},e.switchToSideBySideLayout=function(t){return e.ui.pdfLayout="sideBySide",e.ui.view=t,g("pdf.layout","split")},(_=g("pdf.layout"))?("split"===_&&e.switchToSideBySideLayout(),"flat"===_&&e.switchToFlatLayout()):e.switchToSideBySideLayout();try{var A=navigator;C=A.userAgent,p.browserIsSafari=C&&/.*Safari\/.*/.test(C)&&!/.*Chrome\/.*/.test(C)&&!/.*Chromium\/.*/.test(C)}catch(T){b=T,console.error(b)}p.browserIsSafari&&(p.safariScrollPatcher=new f(e));var E=!1;try{var M=parseFloat(navigator.userAgent.split(" Chrome/")[1])||null;E=null!=M,E&&document.styleSheets[0].insertRule(".ace_editor.ace_autocomplete .ace_completion-highlight { text-shadow: none !important; font-weight: bold; }",1)}catch(R){b=R,console.error(b)}return p.featureToggle=__guard__(__guard__("undefined"!=typeof location&&null!==location?location.search:void 0,function(e){return e.match(/^\?ft=(\w+)$/)}),function(e){return e[1]}),p.socket.on("project:publicAccessLevel:changed",function(t){return null!=t.newAccessLevel?(p.$scope.project.publicAccesLevel=t.newAccessLevel,e.$digest()):void 0})}]),angular.bootstrap(document.body,["SharelatexApp"])});
//# sourceMappingURL=ide.js.map
//ide.js is complete - used for automated testing